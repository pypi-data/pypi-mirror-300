import{_ as f,o as a,c as n,aL as k,i as c,bv as v,y as B,u as p,ae as E,m as h,H as b,x as L,r as d,w as u,A as N,b as I,C as y,a as l,L as g,a9 as C,E as P}from"./main-B3EwXQ3Q.js";import{V as _,i as A}from"./VDialog-CSHgHIlG.js";import{V as O,S as U,d as T,a as m}from"./VTextField-DMRKRbbT.js";const M={name:"DrawerItem"};function x(e,s,t,w,o,i){return a(),n(O,{class:"drawerItem",slim:"",compact:""})}const F=f(M,[["render",x],["__scopeId","data-v-84b50583"]]),R={name:"CloseButton",data(){return{mdiClose:k}}};function W(e,s,t,w,o,i){return a(),n(_,c({class:"closeButton",icon:o.mdiClose},e.$attrs),null,16,["icon"])}const z=f(R,[["render",W],["__scopeId","data-v-cfdced0d"]]),q={name:"ChangePasswordDialog",components:{SubmitFooter:U,CloseButton:z,DrawerItem:F},props:{user:{type:Object,required:!0},isAdminMode:{type:Boolean,default:!1},size:{type:String,default:"default"},density:{type:String,default:"default"}},data(){return{rules:{oldPassword:[e=>!!e||"Old Password is required"],password:[e=>e?e.length<this.MIN_PASSWORD_LENGTH?`Password must be ${this.MIN_PASSWORD_LENGTH} characters long`:e===this.credentials.oldPassword?"New password must be different than old password":!0:"New Password is required"],passwordConfirm:[e=>e===this.credentials.password||"Passwords must match"]},credentials:{oldPassword:"",password:"",passwordConfirm:""},submitButtonEnabled:!1,mdiLockReset:v,showOnlyThisDialog:!1}},computed:{...B(p,{formErrors:e=>e.form.errors,formSuccess:e=>e.form.success,MIN_PASSWORD_LEN:e=>e.MIN_PASSWORD_LEN}),...E(b,["showChangePasswordDialog"])},watch:{showOnlyThisDialog(e){if(this.showChangePasswordDialog=e,e){const s=this.$refs.form;s&&s.reset(),this.clearErrors()}},credentials:{handler(){const e=this.$refs.form;if(!e){this.submitButtonEnabled=!1;return}e.validate().then(({valid:s})=>(this.submitButtonEnabled=s,this.submitButtonEnabled)).catch(()=>{this.submitButtonEnabled=!1})},deep:!0}},mounted(){window.addEventListener("keyup",this._keyUpListener)},beforeUnmount(){window.removeEventListener("keyup",this._keyUpListener)},methods:{...h(b,["changePassword"]),...h(p,["clearErrors"]),doUserChange(){return L().changeUserPassword(this.user.pk,this.credentials).catch(console.error)},doSelfChange(){return this.changePassword(this.credentials).catch(console.error)},submit(){const e=this.$refs.form;e&&e.validate().then(({valid:s})=>{if(s)return this.isAdminMode?this.doUserChange():this.doSelfChange()}).catch(console.error)},_keyUpListener(e){e.stopImmediatePropagation()}}},H={key:0,class:"codexFormSuccess"},K=["value"];function G(e,s,t,w,o,i){const S=d("DrawerItem"),V=d("CloseButton"),D=d("SubmitFooter");return t.user?(a(),n(A,{key:0,modelValue:o.showOnlyThisDialog,"onUpdate:modelValue":s[7]||(s[7]=r=>o.showOnlyThisDialog=r),origin:"center-top",transition:"slide-y-transition","max-width":"22em"},{activator:u(({props:r})=>[t.isAdminMode?(a(),n(_,c({key:0,icon:o.mdiLockReset},r,{size:t.size,density:t.density,title:"Change Password"}),null,16,["icon","size","density"])):(a(),n(S,c({key:1,"prepend-icon":o.mdiLockReset},r,{title:"Change Password"}),null,16,["prepend-icon"]))]),default:u(()=>[e.formSuccess?(a(),N("div",H,[I(y(e.formSuccess)+" ",1),l(V,{onClick:s[0]||(s[0]=r=>o.showOnlyThisDialog=!1)})])):(a(),n(T,{key:1,ref:"form",class:"changePasswordForm"},{default:u(()=>[g("h2",null,"User "+y(t.user.username),1),g("input",{name:"username",autocomplete:"username",disabled:"",type:"text",class:"hidden",value:t.user.username},null,8,K),t.isAdminMode?P("",!0):(a(),n(m,{key:0,ref:"oldPassword",modelValue:o.credentials.oldPassword,"onUpdate:modelValue":s[1]||(s[1]=r=>o.credentials.oldPassword=r),autocomplete:"current-password",label:"Old Password",rules:o.rules.oldPassword,clearable:"",type:"password",autofocus:"",onKeydown:s[2]||(s[2]=C(r=>e.$refs.password.focus(),["enter"]))},null,8,["modelValue","rules"])),l(m,{ref:"password",modelValue:o.credentials.password,"onUpdate:modelValue":s[3]||(s[3]=r=>o.credentials.password=r),autocomplete:"new-password",label:"New Password",rules:o.rules.password,clearable:"",type:"password",autofocus:t.isAdminMode,onKeydown:s[4]||(s[4]=C(r=>e.$refs.passwordConfirm.focus(),["enter"]))},null,8,["modelValue","rules","autofocus"]),l(m,{ref:"passwordConfirm",modelValue:o.credentials.passwordConfirm,"onUpdate:modelValue":s[5]||(s[5]=r=>o.credentials.passwordConfirm=r),autocomplete:"new-password",label:"Confirm Password",rules:o.rules.passwordConfirm,clearable:"",type:"password"},null,8,["modelValue","rules"]),l(D,{verb:"Change",table:"Password",disabled:!o.submitButtonEnabled,onSubmit:i.submit,onCancel:s[6]||(s[6]=r=>o.showOnlyThisDialog=!1)},null,8,["disabled","onSubmit"])]),_:1},512))]),_:1},8,["modelValue"])):P("",!0)}const Q=f(q,[["render",G],["__scopeId","data-v-e688c8a5"]]);export{z as C,F as D,Q as a};
