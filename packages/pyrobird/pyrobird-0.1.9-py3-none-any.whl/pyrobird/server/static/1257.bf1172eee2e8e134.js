"use strict";(self.webpackChunkfirebird=self.webpackChunkfirebird||[]).push([[1257],{1257:(w,B,l)=>{l.r(B),l.d(B,{TF3Painter:()=>C});var b=l(467),o=l(5461),H=l(6636),W=l(1568),D=l(5727),L=l(3641),j=l(3282),p=l(6084);function N(T,i,e=0){for(let t=T.length-2;t>=0;--t){const n=i[t],x=i[t+1],d=T[t],y=T[t+1];if(n===e)return d;if(x===e)return y;if(n<e!=x<e)return d+(e-n)/(x-n)*(y-d)}return T[0]-1}class C extends H.TH2Painter{getObjectName(){return this.$func?.fName??"func"}getClassName(){return this.$func?._typename??o.clTF3}isTF1(){return!0}getPrimaryObject(){return this.$func}updateObject(i){if(!i||this.getClassName()!==i._typename)return!1;delete i.evalPar;const e=this.getHisto();if(this.webcanv_hist){const t=this.getPadPainter()?.findInPrimitives("Func",o.clTH2F);t&&this.updateAxes(e,t,this.getFramePainter())}return this.$func=i,this.createTF3Histogram(i,e),this.scanContent(),!0}redraw(i){return!this._use_saved_points&&("logx"===i||"logy"===i||"logy"===i||"zoom"===i)&&(this.createTF3Histogram(this.$func,this.getHisto()),this.scanContent()),super.redraw(i)}createTF3Histogram(i,e){const t=i.fSave.length-9;this._use_saved_points=t>0&&(o.settings.PreferSavedPoints||this.force_saved);const n=this.getFramePainter(),x=this.getPadPainter()?.getRootPad(!0),d=x?.fLogx,y=x?.fLogy,a=n?.getGrFuncs(this.second_x,this.second_y);let r=i.fXmin,P=i.fXmax,u=i.fYmin,S=i.fYmax,M=i.fZmin,c=i.fZmax;a?.zoom_xmin!==a?.zoom_xmax&&(r=Math.min(r,a.zoom_xmin),P=Math.max(P,a.zoom_xmax)),a?.zoom_ymin!==a?.zoom_ymax&&(u=Math.min(u,a.zoom_ymin),S=Math.max(S,a.zoom_ymax)),a?.zoom_zmin!==a?.zoom_zmax&&(M=Math.min(M,a.zoom_zmin),c=Math.max(c,a.zoom_zmax));const X=(f,m)=>{e.fNcells!==(f+2)*(m+2)&&(e.fNcells=(f+2)*(m+2),e.fArray=new Float32Array(e.fNcells)),e.fArray.fill(0),e.fXaxis.fNbins=f,e.fXaxis.fXbins=[],e.fYaxis.fNbins=m,e.fYaxis.fXbins=[],e.fXaxis.fXmin=r,e.fXaxis.fXmax=P,e.fYaxis.fXmin=u,e.fYaxis.fXmax=S,e.fMinimum=M,e.fMaximum=c};if(delete this._fail_eval,!this._use_saved_points){const f=Math.max(i.fNpx,20),m=Math.max(i.fNpy,20),_=Math.max(i.fNpz,20);let h=!1;!i.evalPar&&!(0,W.Dx)(i)&&(h=!0),X(f,m),d&&(0,D.produceTAxisLogScale)(e.fXaxis,f,r,P),y&&(0,D.produceTAxisLogScale)(e.fYaxis,m,u,S);const E=new Array(_),g=new Array(_);for(let s=0;s<_;++s)g[s]=M+s/(_-1)*(c-M);for(let s=0;s<m&&!h;++s)for(let v=0;v<f&&!h;++v){const A=e.fXaxis.GetBinCenter(v+1),z=e.fYaxis.GetBinCenter(s+1);let F=0;try{for(let O=0;O<_;++O)E[O]=i.evalPar(A,z,g[O]);F=N(g,E)}catch{h=!0}h||e.setBinContent(e.getBin(v+1,s+1),Number.isFinite(F)?F:0)}h&&(this._fail_eval=!0),h&&t>0&&(this._use_saved_points=!0)}if(this._use_saved_points){r=i.fSave[t],P=i.fSave[t+1],u=i.fSave[t+2],S=i.fSave[t+3],M=i.fSave[t+4],c=i.fSave[t+5];const f=Math.round(i.fSave[t+6]),m=Math.round(i.fSave[t+7]),_=Math.round(i.fSave[t+8]),h=(c-M)/_;X(f+1,m+1);const E=new Array(_+1),g=new Array(_+1);for(let s=0;s<=_;s++)g[s]=M+s*h;for(let s=0;s<=f;++s)for(let v=0;v<=m;++v){for(let z=0;z<=_;z++)E[z]=i.fSave[s+(f+1)*(v+(m+1)*z)];const A=N(g,E);e.setBinContent(e.getBin(s+1,v+1),Number.isFinite(A)?A:0)}}return e.fName="Func",(0,o.setHistogramTitle)(e,i.fTitle),e.fLineColor=i.fLineColor,e.fLineStyle=i.fLineStyle,e.fLineWidth=i.fLineWidth,e.fFillColor=i.fFillColor,e.fFillStyle=i.fFillStyle,e.fMarkerColor=i.fMarkerColor,e.fMarkerStyle=i.fMarkerStyle,e.fMarkerSize=i.fMarkerSize,e.fBits|=o.kNoStats,e}extractAxesProperties(i){super.extractAxesProperties(i);const e=this.$func,t=e?.fSave.length??0;t>9&&this._use_saved_points&&(this.xmin=Math.min(this.xmin,e.fSave[t-9]),this.xmax=Math.max(this.xmax,e.fSave[t-8]),this.ymin=Math.min(this.ymin,e.fSave[t-7]),this.ymax=Math.max(this.ymax,e.fSave[t-6]),this.zmin=Math.min(this.zmin,e.fSave[t-5]),this.zmax=Math.max(this.zmax,e.fSave[t-4])),e&&(this.xmin=Math.min(this.xmin,e.fXmin),this.xmax=Math.max(this.xmax,e.fXmax),this.ymin=Math.min(this.ymin,e.fYmin),this.ymax=Math.max(this.ymax,e.fYmax),this.zmin=Math.min(this.zmin,e.fZmin),this.zmax=Math.max(this.zmax,e.fZmax))}fillWebObjectOptions(i){i.fcust=this._fail_eval?"func_fail":""}static draw(i,e,t){return(0,b.A)(function*(){(0,o.isStr)(t)||(t="");let n=t.indexOf(";webcanv_hist"),x=!1,d=!1;n>=0&&(x=!0,t=t.slice(0,n)),n=t.indexOf(";force_saved"),n>=0&&(d=!0,t=t.slice(0,n));const y=new j.nC(t);let a;y.empty()||"gl"===t?t="surf1":"SAME"===y.opt&&(t="surf1 same"),(0===t.indexOf("same")||0===t.indexOf("SAME"))&&((0,L.Nn)(i)||(t="A_ADJUST_FRAME_"+t.slice(4))),x&&(a=new L.JW(i).getPadPainter()?.findInPrimitives("Func",o.clTH2F)),a||(a=(0,o.createHistogram)(o.clTH2F,20,20),a.fBits|=o.kNoStats);const r=new C(i,a);return r.$func=e,r.webcanv_hist=x,r.force_saved=d,r.createTF3Histogram(e,a),p.mf._drawHist(r,t)})()}}}}]);