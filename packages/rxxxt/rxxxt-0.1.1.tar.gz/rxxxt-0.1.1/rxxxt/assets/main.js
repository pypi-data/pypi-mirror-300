(()=>{var _e=Object.create;var te=Object.defineProperty;var ke=Object.getOwnPropertyDescriptor;var Ce=Object.getOwnPropertyNames;var Ie=Object.getPrototypeOf,Pe=Object.prototype.hasOwnProperty;var Ue=(t,e,r)=>e in t?te(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r;var De=(t,e)=>()=>(e||t((e={exports:{}}).exports,e),e.exports);var Me=(t,e,r,n)=>{if(e&&typeof e=="object"||typeof e=="function")for(let a of Ce(e))!Pe.call(t,a)&&a!==r&&te(t,a,{get:()=>e[a],enumerable:!(n=ke(e,a))||n.enumerable});return t};var He=(t,e,r)=>(r=t!=null?_e(Ie(t)):{},Me(e||!t||!t.__esModule?te(r,"default",{value:t,enumerable:!0}):r,t));var M=(t,e,r)=>Ue(t,typeof e!="symbol"?e+"":e,r);var be=De((ye,X)=>{(function(t,e){"use strict";typeof X=="object"&&typeof X.exports=="object"?X.exports=e():typeof define=="function"&&define.amd?define([],e):t.objectPath=e()})(ye,function(){"use strict";var t=Object.prototype.toString;function e(d,l){return d==null?!1:Object.prototype.hasOwnProperty.call(d,l)}function r(d){if(!d||p(d)&&d.length===0)return!0;if(typeof d!="string"){for(var l in d)if(e(d,l))return!1;return!0}return!1}function n(d){return t.call(d)}function a(d){return typeof d=="object"&&n(d)==="[object Object]"}var p=Array.isArray||function(d){return t.call(d)==="[object Array]"};function h(d){return typeof d=="boolean"||n(d)==="[object Boolean]"}function T(d){var l=parseInt(d);return l.toString()===d?l:d}function x(d){d=d||{};var l=function(u){return Object.keys(l).reduce(function(i,s){return s==="create"||typeof l[s]=="function"&&(i[s]=l[s].bind(l,u)),i},{})},O;d.includeInheritedProps?O=function(){return!0}:O=function(u,i){return typeof i=="number"&&Array.isArray(u)||e(u,i)};function F(u,i){if(O(u,i))return u[i]}var I;d.includeInheritedProps?I=function(u,i){typeof i!="string"&&typeof i!="number"&&(i=String(i));var s=F(u,i);if(i==="__proto__"||i==="prototype"||i==="constructor"&&typeof s=="function")throw new Error("For security reasons, object's magic properties cannot be set");return s}:I=function(u,i){return F(u,i)};function P(u,i,s,c){if(typeof i=="number"&&(i=[i]),!i||i.length===0)return u;if(typeof i=="string")return P(u,i.split(".").map(T),s,c);var y=i[0],S=I(u,y);return i.length===1?((S===void 0||!c)&&(u[y]=s),S):(S===void 0&&(typeof i[1]=="number"?u[y]=[]:u[y]={}),P(u[y],i.slice(1),s,c))}return l.has=function(u,i){if(typeof i=="number"?i=[i]:typeof i=="string"&&(i=i.split(".")),!i||i.length===0)return!!u;for(var s=0;s<i.length;s++){var c=T(i[s]);if(typeof c=="number"&&p(u)&&c<u.length||(d.includeInheritedProps?c in Object(u):e(u,c)))u=u[c];else return!1}return!0},l.ensureExists=function(u,i,s){return P(u,i,s,!0)},l.set=function(u,i,s,c){return P(u,i,s,c)},l.insert=function(u,i,s,c){var y=l.get(u,i);c=~~c,p(y)||(y=[],l.set(u,i,y)),y.splice(c,0,s)},l.empty=function(u,i){if(!r(i)&&u!=null){var s,c;if(s=l.get(u,i)){if(typeof s=="string")return l.set(u,i,"");if(h(s))return l.set(u,i,!1);if(typeof s=="number")return l.set(u,i,0);if(p(s))s.length=0;else if(a(s))for(c in s)O(s,c)&&delete s[c];else return l.set(u,i,null)}}},l.push=function(u,i){var s=l.get(u,i);p(s)||(s=[],l.set(u,i,s)),s.push.apply(s,Array.prototype.slice.call(arguments,2))},l.coalesce=function(u,i,s){for(var c,y=0,S=i.length;y<S;y++)if((c=l.get(u,i[y]))!==void 0)return c;return s},l.get=function(u,i,s){if(typeof i=="number"&&(i=[i]),!i||i.length===0)return u;if(u==null)return s;if(typeof i=="string")return l.get(u,i.split("."),s);var c=T(i[0]),y=I(u,c);return y===void 0?s:i.length===1?y:l.get(u[c],i.slice(1),s)},l.del=function(i,s){if(typeof s=="number"&&(s=[s]),i==null||r(s))return i;if(typeof s=="string")return l.del(i,s.split("."));var c=T(s[0]);if(I(i,c),!O(i,c))return i;if(s.length===1)p(i)?i.splice(c,1):delete i[c];else return l.del(i[c],s.slice(1));return i},l}var A=x();return A.create=x,A.withInheritedProps=x({includeInheritedProps:!0}),A})});var de=11;function Re(t,e){var r=e.attributes,n,a,p,h,T;if(!(e.nodeType===de||t.nodeType===de)){for(var x=r.length-1;x>=0;x--)n=r[x],a=n.name,p=n.namespaceURI,h=n.value,p?(a=n.localName||a,T=t.getAttributeNS(p,a),T!==h&&(n.prefix==="xmlns"&&(a=n.name),t.setAttributeNS(p,a,h))):(T=t.getAttribute(a),T!==h&&t.setAttribute(a,h));for(var A=t.attributes,d=A.length-1;d>=0;d--)n=A[d],a=n.name,p=n.namespaceURI,p?(a=n.localName||a,e.hasAttributeNS(p,a)||t.removeAttributeNS(p,a)):e.hasAttribute(a)||t.removeAttribute(a)}}var G,Le="http://www.w3.org/1999/xhtml",w=typeof document>"u"?void 0:document,Be=!!w&&"content"in w.createElement("template"),Fe=!!w&&w.createRange&&"createContextualFragment"in w.createRange();function Ve(t){var e=w.createElement("template");return e.innerHTML=t,e.content.childNodes[0]}function We(t){G||(G=w.createRange(),G.selectNode(w.body));var e=G.createContextualFragment(t);return e.childNodes[0]}function Ke(t){var e=w.createElement("body");return e.innerHTML=t,e.childNodes[0]}function $e(t){return t=t.trim(),Be?Ve(t):Fe?We(t):Ke(t)}function J(t,e){var r=t.nodeName,n=e.nodeName,a,p;return r===n?!0:(a=r.charCodeAt(0),p=n.charCodeAt(0),a<=90&&p>=97?r===n.toUpperCase():p<=90&&a>=97?n===r.toUpperCase():!1)}function Ge(t,e){return!e||e===Le?w.createElement(t):w.createElementNS(e,t)}function Je(t,e){for(var r=t.firstChild;r;){var n=r.nextSibling;e.appendChild(r),r=n}return e}function ne(t,e,r){t[r]!==e[r]&&(t[r]=e[r],t[r]?t.setAttribute(r,""):t.removeAttribute(r))}var ve={OPTION:function(t,e){var r=t.parentNode;if(r){var n=r.nodeName.toUpperCase();n==="OPTGROUP"&&(r=r.parentNode,n=r&&r.nodeName.toUpperCase()),n==="SELECT"&&!r.hasAttribute("multiple")&&(t.hasAttribute("selected")&&!e.selected&&(t.setAttribute("selected","selected"),t.removeAttribute("selected")),r.selectedIndex=-1)}ne(t,e,"selected")},INPUT:function(t,e){ne(t,e,"checked"),ne(t,e,"disabled"),t.value!==e.value&&(t.value=e.value),e.hasAttribute("value")||t.removeAttribute("value")},TEXTAREA:function(t,e){var r=e.value;t.value!==r&&(t.value=r);var n=t.firstChild;if(n){var a=n.nodeValue;if(a==r||!r&&a==t.placeholder)return;n.nodeValue=r}},SELECT:function(t,e){if(!e.hasAttribute("multiple")){for(var r=-1,n=0,a=t.firstChild,p,h;a;)if(h=a.nodeName&&a.nodeName.toUpperCase(),h==="OPTGROUP")p=a,a=p.firstChild;else{if(h==="OPTION"){if(a.hasAttribute("selected")){r=n;break}n++}a=a.nextSibling,!a&&p&&(a=p.nextSibling,p=null)}t.selectedIndex=r}}},H=1,pe=11,ge=3,he=8;function C(){}function Xe(t){if(t)return t.getAttribute&&t.getAttribute("id")||t.id}function ze(t){return function(r,n,a){if(a||(a={}),typeof n=="string")if(r.nodeName==="#document"||r.nodeName==="HTML"||r.nodeName==="BODY"){var p=n;n=w.createElement("html"),n.innerHTML=p}else n=$e(n);else n.nodeType===pe&&(n=n.firstElementChild);var h=a.getNodeKey||Xe,T=a.onBeforeNodeAdded||C,x=a.onNodeAdded||C,A=a.onBeforeElUpdated||C,d=a.onElUpdated||C,l=a.onBeforeNodeDiscarded||C,O=a.onNodeDiscarded||C,F=a.onBeforeElChildrenUpdated||C,I=a.skipFromChildren||C,P=a.addChild||function(f,o){return f.appendChild(o)},u=a.childrenOnly===!0,i=Object.create(null),s=[];function c(f){s.push(f)}function y(f,o){if(f.nodeType===H)for(var m=f.firstChild;m;){var v=void 0;o&&(v=h(m))?c(v):(O(m),m.firstChild&&y(m,o)),m=m.nextSibling}}function S(f,o,m){l(f)!==!1&&(o&&o.removeChild(f),O(f),y(f,m))}function q(f){if(f.nodeType===H||f.nodeType===pe)for(var o=f.firstChild;o;){var m=h(o);m&&(i[m]=o),q(o),o=o.nextSibling}}q(r);function Q(f){x(f);for(var o=f.firstChild;o;){var m=o.nextSibling,v=h(o);if(v){var g=i[v];g&&J(o,g)?(o.parentNode.replaceChild(g,o),V(g,o)):Q(o)}else Q(o);o=m}}function Oe(f,o,m){for(;o;){var v=o.nextSibling;(m=h(o))?c(m):S(o,f,!0),o=v}}function V(f,o,m){var v=h(o);if(v&&delete i[v],!m){var g=A(f,o);if(g===!1||(g instanceof HTMLElement&&(f=g,q(f)),t(f,o),d(f),F(f,o)===!1))return}f.nodeName!=="TEXTAREA"?Se(f,o):ve.TEXTAREA(f,o)}function Se(f,o){var m=I(f,o),v=o.firstChild,g=f.firstChild,U,N,D,K,_;e:for(;v;){for(K=v.nextSibling,U=h(v);!m&&g;){if(D=g.nextSibling,v.isSameNode&&v.isSameNode(g)){v=K,g=D;continue e}N=h(g);var $=g.nodeType,k=void 0;if($===v.nodeType&&($===H?(U?U!==N&&((_=i[U])?D===_?k=!1:(f.insertBefore(_,g),N?c(N):S(g,f,!0),g=_,N=h(g)):k=!1):N&&(k=!1),k=k!==!1&&J(g,v),k&&V(g,v)):($===ge||$==he)&&(k=!0,g.nodeValue!==v.nodeValue&&(g.nodeValue=v.nodeValue))),k){v=K,g=D;continue e}N?c(N):S(g,f,!0),g=D}if(U&&(_=i[U])&&J(_,v))m||P(f,_),V(_,v);else{var ee=T(v);ee!==!1&&(ee&&(v=ee),v.actualize&&(v=v.actualize(f.ownerDocument||w)),P(f,v),Q(v))}v=K,g=D}Oe(f,g,N);var ce=ve[f.nodeName];ce&&ce(f,o)}var b=r,W=b.nodeType,le=n.nodeType;if(!u){if(W===H)le===H?J(r,n)||(O(r),b=Je(r,Ge(n.nodeName,n.namespaceURI))):b=n;else if(W===ge||W===he){if(le===W)return b.nodeValue!==n.nodeValue&&(b.nodeValue=n.nodeValue),b;b=n}}if(b===n)O(r);else{if(n.isSameNode&&n.isSameNode(b))return;if(V(b,n,u),s)for(var Z=0,Ne=s.length;Z<Ne;Z++){var j=i[s[Z]];j&&S(j,j.parentNode,!1)}}return!u&&b!==r&&r.parentNode&&(b.actualize&&(b=b.actualize(r.ownerDocument||w)),r.parentNode.replaceChild(b,r)),b}}var Ye=ze(Re),me=Ye;var xe=He(be());var L="",qe=!1,z=!1,R=0,B,E,we=[],Te=new WeakMap,Qe="rxxxt-root",re="rxxxt-on-",ue=()=>{R++,z=!1},ie=()=>{R=Math.max(0,R-1),R==0&&z&&B()},Ee=()=>{let t=[],e;for(;e=we.shift();)t.push(...e());return t},fe=t=>{var r;let e=!1;for(let n of t)if(n.event==="force-refresh")e=!0;else if(n.event==="navigate")window.history.pushState({},"",n.location),e=!0;else if(n.event==="use-websocket"&&n.websocket)Ze(),e=!0;else if(n.event==="set-cookie"){let a=["".concat(n.name,"=").concat((r=n.value)!=null?r:"")];typeof n.path=="string"&&a.push("path=".concat(n.path)),typeof n.expires=="string"&&a.push("expires=".concat(new Date(n.expires).toUTCString())),typeof n.max_age=="number"&&a.push("max-age=".concat(n.max_age)),typeof n.domain=="string"&&a.push("domain=".concat(n.domain)),n.secure&&a.push("secure"),n.http_only&&a.push("httponly"),document.cookie=a.join(";")}e&&Y()},oe=t=>{let e;if(t===void 0){let r=document.getElementById(Qe);if(r===null)throw new Error("Update target not found!");e=r}else{let r=document.createElement("div");r.innerHTML=t;let n=r.children.item(0);if(n===null||n.tagName!=="rxxxt-meta".toUpperCase())throw new Error("Invalid update root!");let a=document.getElementById(n.id);if(a===null)throw new Error("Update target not found!");e=a,me(e,n)}for(let r of e.getElementsByTagName("*")){let n=Te.get(r);n===void 0&&(n=new se,Te.set(r,n)),n.track(r)}},Ze=()=>{if(E)return;ue();let t=new URL(location.href);t.protocol=location.protocol=="https:"?"wss":"ws",E=new WebSocket(t),E.addEventListener("close",()=>{B=Ae,E=void 0}),E.addEventListener("open",()=>{B=je,E==null||E.send(JSON.stringify({type:"init",stateToken:L,enableStateUpdates:qe})),ie()}),E.addEventListener("message",e=>{if(typeof e.data!="string")return;let r=JSON.parse(e.data);oe(r.html),r.stateToken&&(L=r.stateToken),fe(r.events),r.end&&ie()})},je=async()=>{ue(),E==null||E.send(JSON.stringify({type:"update",events:Ee(),location:location.href.substring(location.origin.length)}))},Ae=async()=>{ue();let t=JSON.stringify({stateToken:L,events:Ee()}),e=await fetch(location.href,{method:"POST",body:t,headers:{"Content-Type":"application/json"},credentials:"include"}).then(r=>r.json());oe(e.html),L=e.stateToken,fe(e.events),ie()};B=Ae;var Y=()=>{z||(z=!0,setTimeout(()=>{R==0&&B()},0))},ae=class{constructor(){M(this,"lastCall");M(this,"timeoutHandle");M(this,"nextEvent");M(this,"handler",e=>this.handle(e))}produceEvent(){this.timeoutHandle&&clearTimeout(this.timeoutHandle);let e=[];return this.nextEvent&&(this.lastCall=new Date().getTime(),e.push(this.nextEvent),this.nextEvent=void 0),e}handle(e){if(e.target===null||!(e.target instanceof Element))return;let r=re+e.type,n=e.target.getAttribute(r);if(n===null)return;let a=JSON.parse(atob(n)),p={};for(let x of Object.keys(a.param_map)){let A=a.param_map[x];p[x]=xe.default.withInheritedProps.get(e,A)}this.nextEvent={context_id:a.context_id,data:p,handler_name:a.handler_name},we.push(this.produceEvent.bind(this)),this.timeoutHandle&&(clearTimeout(this.timeoutHandle),this.timeoutHandle=void 0),a.options.prevent_default&&e.preventDefault();let h=[];if(a.options.debounce&&h.push(a.options.debounce),a.options.throttle&&this.lastCall){let x=new Date().getTime();h.push(a.options.throttle+this.lastCall-x)}let T=Math.max(0,...h);T===0?Y():this.timeoutHandle=setTimeout(Y,T)}},se=class{constructor(){M(this,"eventMap",new Map)}track(e){let r=new Set;for(let n of e.getAttributeNames())if(n.startsWith(re)){let a=n.substring(re.length);r.add(a)}for(let n of this.eventMap.entries()){let a=n[0],p=n[1];r.has(a)||(e.removeEventListener(a,p.handler),this.eventMap.delete(a))}for(let n of r)if(!this.eventMap.has(n)){let a=new ae;this.eventMap.set(n,a),e.addEventListener(n,a.handler)}}};window.rxxxtInit=t=>{window.addEventListener("popstate",Y),L=t.stateToken,fe(t.events),oe()};})();
