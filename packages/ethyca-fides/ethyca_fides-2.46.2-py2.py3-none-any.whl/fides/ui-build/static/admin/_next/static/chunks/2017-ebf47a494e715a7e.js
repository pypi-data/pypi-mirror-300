"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[2017],{73269:function(e,s,t){t.d(s,{Gt:function(){return h},eB:function(){return m},oI:function(){return u}});var i=t(24246),n=t(34090),a=t(27378),r=t(44296),l=t(3073),d=t(77650);let o=(0,a.createRef)(),c=(0,a.createRef)(),u=()=>{let e=(0,r.T)(),s=(0,r.C)(l.DB),t=(0,a.useCallback)(()=>{c.current=void 0,o.current=void 0},[]),i=(0,a.useCallback)(()=>{e((0,l.Mr)()),c.current&&(c.current(!0),t())},[e,t]),n=(0,a.useCallback)(()=>{e((0,l.Mr)()),c.current&&(c.current(!1),t())},[e,t]);return{attemptAction:(0,a.useCallback)(()=>s?(e((0,l.h7)()),o.current||(o.current=new Promise(e=>{c.current=e})),o.current):Promise.resolve(!0),[s,e]),onConfirm:i,onClose:n}},h=e=>{let{id:s,name:t}=e,{dirty:i}=(0,n.u6)(),d=(0,r.T)();return(0,a.useEffect)(()=>(d((0,l.Zu)({id:s,name:t})),()=>{d((0,l.dz)({id:s}))}),[d,s,t]),(0,a.useEffect)(()=>{d((0,l.$p)({id:s,isDirty:i}))},[i,d,s]),null},m=()=>{let{onConfirm:e,onClose:s}=u(),t=(0,r.C)(l.uv);return(0,i.jsx)(d.Z,{isOpen:t,onClose:s,onConfirm:e,isCentered:!0,title:"Unsaved Changes",message:"You have unsaved changes"})}},93990:function(e,s,t){t.d(s,{q:function(){return C}});var i=t(24246),n=t(13054),a=t(27378),r=t(60136),l=t(73269),d=t(62528),o=t(20133),c=t(34090);let u=e=>{let{systems:s,dataFlows:t,onDataFlowSystemChange:a}=e,{setFieldValue:r}=(0,c.u6)(),l=t.map(e=>e.fides_key),d=e=>{let s=t.filter(s=>s.fides_key!==e.fides_key);r("dataFlowSystems",s),a(s)};return(0,i.jsxs)(n.iA_,{size:"sm","data-testid":"assign-systems-delete-table",children:[(0,i.jsx)(n.hrZ,{children:(0,i.jsxs)(n.Tr,{children:[(0,i.jsx)(n.Th,{children:"System"}),(0,i.jsx)(n.Th,{})]})}),(0,i.jsx)(n.p3B,{children:s.filter(e=>l.includes(e.fides_key)).map(e=>(0,i.jsxs)(n.Tr,{_hover:{bg:"gray.50"},"data-testid":"row-".concat(e.fides_key),children:[(0,i.jsx)(n.Td,{children:(0,i.jsx)(n.xvT,{fontSize:"xs",lineHeight:4,fontWeight:"medium",children:e.name})}),(0,i.jsx)(n.Td,{textAlign:"end",children:(0,i.jsx)(n.hU,{background:"gray.50","aria-label":"Unassign data flow from system",icon:(0,i.jsx)(o.l,{}),variant:"outline",size:"sm",onClick:()=>d(e),"data-testid":"unassign-btn"})})]},e.fides_key))})]})};var h=t(33312),m=e=>{let{allSystems:s,dataFlowSystems:t,onChange:a,flowType:r}=e,{setFieldValue:l}=(0,c.u6)(),d=e=>{if(t.find(s=>s.fides_key===e.fides_key)){let s=t.filter(s=>s.fides_key!==e.fides_key);l("dataFlowSystems",s),a(s)}else{let s=[...t,{fides_key:e.fides_key,type:"system"}];l("dataFlowSystems",s),a(s)}};return(0,i.jsx)(n.xuv,{overflowY:"auto",maxHeight:"300px",children:(0,i.jsxs)(n.iA_,{size:"sm","data-testid":"assign-systems-table",maxHeight:"50vh",overflowY:"scroll",children:[(0,i.jsx)(n.hrZ,{position:"sticky",top:0,background:"white",zIndex:1,children:(0,i.jsxs)(n.Tr,{children:[(0,i.jsx)(n.Th,{children:"System"}),(0,i.jsxs)(n.Th,{textAlign:"right",children:["Set as ",r]})]})}),(0,i.jsx)(n.p3B,{children:s.map(e=>{let s=!!t.find(s=>s.fides_key===e.fides_key);return(0,i.jsxs)(n.Tr,{_hover:{bg:"gray.50"},"data-testid":"row-".concat(e.fides_key),children:[(0,i.jsx)(n.Td,{children:(0,i.jsx)(n.xvT,{fontSize:"xs",lineHeight:4,fontWeight:"medium",children:e.name})}),(0,i.jsx)(n.Td,{textAlign:"right",children:(0,i.jsx)(n.rsf,{isChecked:s,onChange:()=>d(e),"data-testid":"assign-switch"})})]},e.fides_key)})})]})})};let f=(e,s)=>{var t,i;return(null===(t=e.name)||void 0===t?void 0:t.toLocaleLowerCase().includes(s.toLocaleLowerCase()))||(null===(i=e.description)||void 0===i?void 0:i.toLocaleLowerCase().includes(s.toLocaleLowerCase()))};var x=e=>{let{currentSystem:s,systems:t,isOpen:r,onClose:l,dataFlowSystems:d,onDataFlowSystemChange:o,flowType:u}=e,{setFieldValue:x}=(0,c.u6)(),[y,g]=(0,a.useState)(""),[j,k]=(0,a.useState)(d),C=async()=>{o(j),l()},p=0===t.length,w=(0,a.useMemo)(()=>t?t.filter(e=>e.fides_key!==s.fides_key).filter(e=>f(e,y)):[],[t,s.fides_key,y]),b=(0,a.useMemo)(()=>{let e=new Set(j.map(e=>e.fides_key));return w.every(s=>e.has(s.fides_key))},[w,j]);return(0,i.jsxs)(n.u_l,{isOpen:r,onClose:l,size:"2xl",isCentered:!0,children:[(0,i.jsx)(n.ZAr,{}),(0,i.jsxs)(n.hzk,{p:8,"data-testid":"confirmation-modal",children:[(0,i.jsxs)(n.xBx,{fontWeight:"medium",display:"flex",justifyContent:"space-between",alignItems:"center",children:[(0,i.jsxs)(n.xvT,{fontSize:"2xl",lineHeight:8,fontWeight:"semibold",children:["Configure ",u.toLocaleLowerCase()," systems"]}),(0,i.jsxs)(n.Cts,{bg:"green.500",color:"white",px:1,children:["Assigned to ",j.length," systems"]})]}),(0,i.jsx)(n.fef,{"data-testid":"assign-systems-modal-body",children:p?(0,i.jsx)(n.xvT,{children:"No systems found"}):(0,i.jsxs)(n.Kqy,{spacing:4,children:[(0,i.jsxs)(n.kCb,{justifyContent:"space-between",children:[(0,i.jsx)(n.xvT,{fontSize:"sm",flexGrow:1,fontWeight:"medium",children:"Add or remove destination systems from your data map"}),(0,i.jsx)(n.xuv,{children:(0,i.jsxs)(n.NIc,{display:"flex",alignItems:"center",children:[(0,i.jsx)(n.lXp,{fontSize:"sm",htmlFor:"assign-all-systems",mb:"0",children:"Assign all systems"}),(0,i.jsx)(n.rsf,{size:"sm",id:"assign-all-systems",isChecked:b,onChange:e=>{let{checked:s}=e.target;if(s&&t){let e=w.map(e=>({fides_key:e.fides_key,type:"system"}));x("dataFlowSystems",e),k(e)}else k([])},"data-testid":"assign-all-systems-toggle"})]})})]}),(0,i.jsx)(h.Z,{search:y,onChange:g,placeholder:"Search for systems","data-testid":"system-search",withIcon:!0}),(0,i.jsx)(m,{flowType:u,allSystems:w,dataFlowSystems:j,onChange:k})]})}),(0,i.jsx)(n.mzw,{justifyContent:"flex-start",children:(0,i.jsxs)(n.hE2,{size:"sm",children:[(0,i.jsx)(n.zxk,{variant:"outline",mr:2,onClick:l,"data-testid":"cancel-btn",children:"Cancel"}),p?null:(0,i.jsx)(n.zxk,{colorScheme:"primary",onClick:C,"data-testid":"confirm-btn",children:"Confirm"})]})})]})]})},y=t(16781),g=t(22153);let j={dataFlowSystems:[]},k=e=>{let{system:s,isIngress:t,isSystemTab:o}=e,h=(0,n.pmc)(),m=t?"Source":"Destination",f="".concat(m,"s"),k=(0,n.qY0)(),[C]=(0,g.qQ)(),{data:p=[]}=(0,g.K3)(),w=(0,a.useMemo)(()=>{let e=t?s.ingress:s.egress;e||(e=[]);let i=p?p.map(e=>e.fides_key):[];return e.filter(e=>i.includes(e.fides_key))},[t,s,p]),[b,v]=(0,a.useState)(w);(0,a.useEffect)(()=>{v(w)},[w]);let S=async(e,i)=>{let{dataFlowSystems:n}=e,{resetForm:a}=i,l={...s,ingress:t?n:s.ingress,egress:t?s.egress:n},d=await C(l);(0,r.D4)(d)?h((0,y.Vo)("Failed to update data flows")):h((0,y.t5)("".concat(f," updated"))),a({values:{dataFlowSystems:n}})};return(0,i.jsxs)(n.Qdk,{children:[(0,i.jsx)(n.KFZ,{height:"68px",paddingLeft:o?6:2,"data-testid":"data-flow-button-".concat(m),children:(0,i.jsxs)(n.kCb,{alignItems:"center",justifyContent:"start",flex:1,textAlign:"left",children:[(0,i.jsx)(n.xvT,{fontSize:"sm",lineHeight:5,fontWeight:"semibold",mr:2,children:f}),(0,i.jsx)(n.Vp9,{ml:2,backgroundColor:"primary.400",borderRadius:"6px",color:"white",children:b.length}),(0,i.jsx)(n.LZC,{}),(0,i.jsx)(n.XEm,{})]})}),(0,i.jsx)(n.Hk3,{backgroundColor:"gray.50",padding:6,"data-testid":"data-flow-panel-".concat(m),children:(0,i.jsx)(n.Kqy,{borderRadius:"md",backgroundColor:"gray.50","aria-selected":"true",spacing:4,"data-testid":"selected",children:(0,i.jsx)(c.J9,{initialValues:j,onSubmit:S,children:e=>{let{isSubmitting:t,dirty:a,resetForm:r}=e;return(0,i.jsxs)(c.l0,{children:[(0,i.jsx)(l.Gt,{id:"".concat(s.fides_key,":").concat(m),name:"".concat(m," Data Flow")}),(0,i.jsx)(n.zxk,{colorScheme:"primary",size:"xs",width:"fit-content",onClick:k.onOpen,"data-testid":"assign-systems-btn",rightIcon:(0,i.jsx)(d.A5,{}),marginBottom:4,children:"Configure ".concat(f.toLocaleLowerCase())}),(0,i.jsx)(u,{systems:p,dataFlows:b,onDataFlowSystemChange:v}),(0,i.jsxs)(n.hE2,{marginTop:6,children:[(0,i.jsx)(n.zxk,{size:"sm",variant:"outline",isDisabled:!a&&b===w,onClick:()=>{v(w),r({values:{dataFlowSystems:w}})},children:"Cancel"}),(0,i.jsx)(n.zxk,{size:"sm",colorScheme:"primary",type:"submit",isLoading:t,isDisabled:!a&&b===w,"data-testid":"save-btn",children:"Save"})]}),k.isOpen?(0,i.jsx)(x,{currentSystem:s,systems:p,isOpen:k.isOpen,onClose:k.onClose,dataFlowSystems:b,onDataFlowSystemChange:v,flowType:m}):null]})}})})})]})},C=e=>{let{system:s,isSystemTab:t}=e;return(0,i.jsxs)(n.UQy,{allowToggle:!0,"data-testid":"data-flow-accordion",children:[(0,i.jsx)(k,{system:s,isIngress:!0,isSystemTab:t}),(0,i.jsx)(k,{system:s,isSystemTab:t})]})}},70810:function(e,s,t){t.d(s,{f:function(){return d}});var i=t(44296),n=t(91650),a=t(79851),r=t(52987),l=t(47411);let d=e=>{let{includeDatasets:s,includeDisabled:t}=e,{isLoading:d}=(0,l.MO)(),{isLoading:o}=(0,n.te)(),{isLoading:c}=(0,a.fd)(),{isLoading:u}=(0,r.LH)({onlyUnlinkedDatasets:!1},{skip:!s}),h=(0,i.C)(l.qb),m=(0,i.C)(l.Bd),f=(0,i.C)(n.ZL),x=(0,i.C)(n.H7),y=(0,i.C)(a.U3),g=(0,i.C)(a.jp),j=(0,i.C)(r.Q4);return{allDataCategories:t?h:m,allDataSubjects:t?f:x,allDataUses:t?y:g,allDatasets:s?j:void 0,isLoading:d||o||c||u}}},43073:function(e,s,t){t.d(s,{Bw:function(){return i.Bw},D4:function(){return i.D4}});var i=t(41164)}}]);