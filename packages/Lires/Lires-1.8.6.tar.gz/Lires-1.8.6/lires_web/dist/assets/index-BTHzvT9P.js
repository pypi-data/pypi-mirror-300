var Lt=Object.defineProperty;var qt=(o,t,e)=>t in o?Lt(o,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):o[t]=e;var ae=(o,t,e)=>qt(o,typeof t!="symbol"?t+"":t,e);import{d as M,f as U,B as p,C as v,D as fe,E as oe,o as he,G as vt,H as a,c as $,I,w as ne,a as w,F as H,J as te,z as x,K as Y,L as A,M as B,N as Je,O as q,P as Et,Q as zt,R as se,S as ie,U as Qe,V as gt,W as me,X as V,Y as Ft,Z as X,_ as Ye,$ as Ve,a0 as Me,a1 as Le,a2 as Ot,a3 as ut,a4 as Ht,n as _t,r as Nt,y as Wt,a5 as Ge,a6 as He,a7 as jt}from"./@vue-CCsYaBvc.js";import{d as We,c as Vt}from"./pinia-CrXx1641.js";import{u as ye,a as yt,c as Kt,b as Zt}from"./vue-router-CpTyZyNo.js";import{M as Gt}from"./async-mutex-CSJywVGb.js";import{f as Jt}from"./fast-xml-parser-BUeCD-Rh.js";import{P as Ke}from"./plotly.js-dist-BPixWVI-.js";import{E as Qt,M as Yt}from"./md-editor-v3-OB-szcpr.js";import{m as Xt}from"./gray-matter-D4hcLa5V.js";import"./vite-plugin-node-polyfills-Cgl3E5jI.js";import"./strnum-u8jQhLSb.js";import"./copy-to-clipboard-B1uT6SkR.js";import"./toggle-selection-BHUZwh74.js";import"./@vavt-gYAenMAp.js";import"./@codemirror-DmN_zXa9.js";import"./@lezer-GBmThkPu.js";import"./crelt-C8TCjufn.js";import"./style-mod-Bc2inJdb.js";import"./w3c-keyname-Vcq4gwWv.js";import"./medium-zoom-bWEtUbjf.js";import"./markdown-it-DI8MEbma.js";import"./mdurl-k9Sl0PQj.js";import"./uc.micro-kMc2yuuw.js";import"./entities-C20TfXL6.js";import"./linkify-it-DmNjr4Kv.js";import"./punycode.js-Dj65hjkv.js";import"./markdown-it-image-figures-BD49Kf-b.js";import"./markdown-it-task-lists-BNI9E7ji.js";import"./node-stdlib-browser-d7cmxmpa.js";import"./section-matter-DWrNKXO4.js";import"./kind-of-l3izQsJJ.js";import"./extend-shallow-DA8A8LGH.js";import"./is-extendable-CiA4f1iz.js";import"./js-yaml-B7yGoGZD.js";import"./strip-bom-string-BxrG9K6S.js";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))n(s);new MutationObserver(s=>{for(const i of s)if(i.type==="childList")for(const l of i.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&n(l)}).observe(document,{childList:!0,subtree:!0});function e(s){const i={};return s.integrity&&(i.integrity=s.integrity),s.referrerPolicy&&(i.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?i.credentials="include":s.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function n(s){if(s.ep)return;s.ep=!0;const i=e(s);fetch(s.href,i)}})();const ea=M({__name:"Popup",props:{styleType:{default:"info"},position:{default:"top-center"}},setup(o){const t=o,e=U(()=>{switch(t.styleType){case"alert":case"error":return{backgroundColor:"rgba(180, 0, 20, 0.9)",color:"rgba(255, 255, 255, 1)"};case"warning":return{backgroundColor:"rgba(210, 150, 0, 0.9)",color:"rgba(255, 255, 255, 1)"};case"info":return{backgroundColor:"rgba(0, 0, 0, 0.75)",color:"rgba(255, 255, 255, 1)"};case"success":return{backgroundColor:"rgba(0, 180, 0, 0.9)",color:"rgba(255, 255, 255, 1)"};default:return{backgroundColor:"rgba(0, 0, 0, 0.5)",color:"var(--color-text)"}}}),n=U(()=>{if(t.position==="top-center")return{top:"30px",left:"50%",transform:"translate(-50%, 0)"};if(t.position==="center")return{top:"50%",left:"50%",transform:"translate(-50%, -50%)"};throw Error("Incorrect style.")});return(s,i)=>(p(),v("div",{id:"popup",style:oe({...e.value,...n.value})},[fe(s.$slots,"default",{},void 0)],4))}}),E=(o,t)=>{const e=o.__vccOpts||o;for(const[n,s]of t)e[n]=s;return e},ct=E(ea,[["__scopeId","data-v-7a7b12ca"]]),pe="->";class O extends Set{static removeSpaces(t){const e=t.split(pe);for(let n=0;n<e.length;n++)e[n]=e[n].trim();return t=e.join(pe),t}constructor(t=null){t===null&&(t=[]);const e=t instanceof Set?t:new Set(t);e.forEach(n=>O.removeSpaces(n)),super(e)}copy(){return new O(this)}equals(t){if(t.size!==this.size)return!1;for(const e of this)if(!t.has(e))return!1;return!0}add(t){return super.add(O.removeSpaces(t))}has(t){return super.has(O.removeSpaces(t))}union(t){const e=new O(this);return e.union_(t),e}union_(t){return t.forEach(e=>this.add(e)),this}pop(t){const e=new O(this);return e.pop_(t),e}pop_(t){return t.forEach(e=>this.delete(e)),this}pop_ifcontains_(t){return t.forEach(e=>{this.has(e)&&this.delete(e)}),this}issubset(t){return Ce.isSubset(this,t)}withParents(){const t=new O(this);return this.forEach(e=>t.union_(Ce.allParentsOf(e))),t}withChildsFrom(t){const e=new O(this);return this.forEach(n=>e.union_(Ce.allChildsOf(n,t))),e}allParents(){const t=new O;return this.forEach(e=>t.union_(Ce.allParentsOf(e))),t}toArray(){return Array.from(this)}}class Ce{static allParentsOf(t){const e=t.split(pe);if(e.length===1)return new O([]);const n=[],s=[];for(let i=0;i<e.length-1;i++)n.push(e[i]),s.push(n.join(pe));return new O(s)}static allChildsOf(t,e){const n=new O;for(const s of e)s.startsWith(t)&&s.length>t.length+pe.length&&s.substring(t.length,t.length+pe.length)===`${pe}`&&n.add(s);return n}static tagHierarchy(t){const e=pe;function n(l,r){const d=l.split(r);return d.length===1?[l]:[d[0],d.slice(1).join(r)]}function s(l,r=e){const d={},g=l.map(c=>n(c,r));for(const c of g)c[0]in d||(d[c[0]]=[]),c.length===2&&d[c[0]].push(c[1]);const u={};for(const c in d)u[c]=s(d[c],r);return u}function i(l,r=e){for(const d in l){const g=l[d];for(const u in g){const c=[d,u].join(e);g[c]=g[u],delete g[u]}i(g,r)}return l}return i(s(Array.from(t)))}static isSubset(t,e){let n=!0;for(const s of t)if(!e.has(s)){n=!1;break}return n}}class Re{constructor(t,e){ae(this,"summary");ae(this,"supp");ae(this,"conn");this.summary=e,this.supp={note:null,abstract:null},this.conn=t}get backendUrl(){return this.conn.baseURL}get dtype(){return this.summary.doc_type}get tags(){return new O(this.summary.tags)}get uid(){return this.summary.uuid}get title(){return this.summary.title}get authors(){return this.summary.authors}get year(){return this.summary.year}get publication(){return this.summary.publication}get url(){return this.summary.url}get bibtex(){return this.summary.bibtex}toString(){return`${this.summary.title} - ${this.authorAbbr()} (${this.summary.year}) [uid: ${this.summary.uuid}]`}fetchAbstract(){return new Promise((t,e)=>{this.conn.reqDatapointAbstract(this.summary.uuid).then(n=>{this.supp.abstract=n,t(n)}).catch(n=>{e(n)})})}uploadAbstract(t){return new Promise((e,n)=>{if(t===this.supp.abstract||t===null){e(!0);return}this.conn.updateDatapointAbstract(this.summary.uuid,t).then(s=>{this.supp.abstract=t,e(s)}).catch(s=>{n(s)})})}fetchNote(){return new Promise((t,e)=>{this.conn.reqDatapointNote(this.summary.uuid).then(n=>{this.supp.note=n,t(n)}).catch(n=>{e(n)})})}uploadNote(t){return t===null?Promise.reject("Note is null"):new Promise((e,n)=>{this.conn.updateDatapointNote(this.summary.uuid,t).then(s=>{this.supp.note=t,this.summary.note_linecount=t.split(`
`).map(i=>i.trim()==""?0:1).reduce((i,l)=>i+l,0),e(s)}).catch(s=>{n(s)})})}deleteMiscFile(t){return this.conn.deleteMiscFile(this.summary.uuid,t)}renameMiscFile(t,e){return this.conn.renameMiscFile(this.summary.uuid,t,e)}listMiscFiles(){const t=this.conn.reqMiscFileList(this.summary.uuid),e=`${this.backendUrl}/misc/${this.summary.uuid}`;return t.then(n=>n.map(s=>{const i=new URLSearchParams;return i.append("fname",s),i.append("_u",J().user.id.toString()),{fname:s,rpath:`./misc/${s}`,url:`${e.toString()}?${i.toString()}`}}))}uploadMisc(t){return new Promise((e,n)=>{this.conn.uploadMiscFiles(this.summary.uuid,t).then(s=>{e(s.map(i=>`./misc/${i}`))},s=>{n(s)})})}uploadDocument(t){return this.conn.uploadDocument(this.summary.uuid,t)}freeDocument(){return this.conn.deleteDocument(this.summary.uuid)}update(t=null){if(t!==null)return this.summary=t,Promise.resolve(t);const e=this.conn.reqDatapointSummary(this.summary.uuid);return e.then(n=>{this.summary=n}),e}destory(){this.summary=Ne}authorAbbr(){let t="";return this.summary.authors.length>1&&(t=" et al."),this.summary.authors[0]+t}authorYear(){return`${this.authorAbbr()} ${this.summary.year}`}yearAuthor(t=" "){return`${this.summary.year}${t}${this.authorAbbr()}`}isDummy(){return this.summary.uuid===Ne.uuid}getRawDocURL(){const t=this.summary.uuid;return this.summary.has_file?`${this.backendUrl}/doc/${t}?u=${J().user.id}`:!this.summary.has_file&&this.url?this.url:"about:blank"}getOpenDocURL({extraPDFViewerParams:t={},urlHashMark:e=""}={}){const n=`${this.backendUrl}/pdfjs/web/viewer.html`;function s(r,d=n){const g=new URLSearchParams;d===n&&g.append("key",W().encKey),g.append("file",`${r}`);for(const u in t)g.append(u,t[u]);return`${d}?${g.toString()}`}function i(r){return e?(new URL(r).hash&&(r=r.slice(0,r.indexOf("#"))),`${r}#${e}`):r}let l="about:blank";if(this.isDummy()&&(l="about:blank"),this.summary.has_file&&this.summary.file_type==".pdf"){const r=this.getRawDocURL();l=s(i(r))}if(this.summary.has_file&&this.summary.file_type==".html"){const r=this.getRawDocURL();l=i(r)}return!this.summary.has_file&&this.summary.url&&(l=i(this.summary.url)),console.log("Open doc url: ",l),l}fileType(){return this.summary.has_file&&this.summary.file_type==".pdf"?"pdf":this.summary.has_file&&this.summary.file_type==".html"?"html":!this.summary.has_file&&this.summary.url?"url":!this.summary.has_file&&!this.summary.url?"":"unknown"}}const Ne={doc_type:"",has_file:!1,file_type:"",year:"0000",title:" ",author:" ",authors:[" "],publication:null,tags:[],uuid:" ",url:"about:blank",time_added:0,time_modified:0,bibtex:"",doc_size:0,note_linecount:0,has_abstract:!1};class ta{constructor(t){ae(this,"cache");ae(this,"tags");ae(this,"uids");ae(this,"dataInfoAcquireMutex",new Gt);ae(this,"conn");ae(this,"_initliazed");this.cache={},this.uids=new Array,this.tags=new O,this._initliazed=!1,this.conn=t}get initialized(){return this._initliazed}async init(){console.time("Get init data"),await Promise.all([this.updateKeyCache(),this.updateTagCache()]),console.timeEnd("Get init data"),this._initliazed=!0,console.debug("Get init data of size: ",((JSON.stringify(this.uids)+JSON.stringify(this.tags)).length*2/1024/1024).toPrecision(2),"MB")}allTags(){return this.tags}allKeys(){return this.uids}async updateKeyCache(){this.uids=await this.conn.reqAllKeys()}async updateTagCache(){this.tags=new O(await this.conn.reqAllTags())}async update(t,e=!0){let n;return t.uuid in this.cache?(this.cache[t.uuid].update(t),n=this.cache[t.uuid].tags):(this.cache[t.uuid]=new Re(this.conn,t),n=new O),this.uids.includes(t.uuid)||this.uids.unshift(t.uuid),e&&(i=>{const l=new O;for(const r in this.cache)l.union_(this.cache[r].tags);return this.tags.union_(l),!i.issubset(l)})(n)&&await this.updateTagCache(),this.cache[t.uuid]}clear(){this.cache={},this.uids=new Array,this.tags=new O([]),this._initliazed=!1}async delete(t,e=!0){let n;t in this.cache?(n=this.cache[t].tags,delete this.cache[t]):n=null,this.uids.includes(t)&&(this.uids=this.uids.filter(i=>i!==t)),e&&(i=>{if(i===null)return!0;const l=new O;for(const r in this.cache)l.union_(this.cache[r].tags);return!i.issubset(l)})(n)&&await this.updateTagCache()}hasCache(t){return t in this.cache}getDummy(){return new Re(this.conn,Ne)}async aget(t){if(!(t in this.cache))try{const e=await this.conn.reqDatapointSummary(t);this.cache[t]=new Re(this.conn,e)}catch(e){return console.warn("Caught error in aget: ",e),new Re(this.conn,Ne)}return this.cache[t]}async agetMany(t,e=!0,n=!0){const s=async()=>{this.dataInfoAcquireMutex.acquire();try{const r=Object.keys(this.cache),d=t.filter(c=>!r.includes(c));if(d.length===0)return t.map(c=>this.cache[c]);const g=await this.conn.reqDatapointSummaries(d);console.debug("DEBUG: get data points of size: ",g.length),g.map(c=>new Re(this.conn,c)).forEach(c=>{this.cache[c.uid]=c})}catch(r){throw r}finally{this.dataInfoAcquireMutex.release()}return t.map(r=>this.cache[r])},i=async()=>await Promise.all(t.map(r=>this.aget(r)));if(e)try{return await s()}catch(l){if(n)return console.warn("Caught error in agetMany: ",l),await i();throw l}return await i()}async agetByAuthor(t){const e=await this.conn.query({searchBy:"author",searchContent:t});return await this.agetMany(e.uids)}getCacheByTags(t){t=new O(t);const e=[];for(const n in this.cache){const s=this.cache[n],i=new O(s.summary.tags);t.issubset(i.withParents())&&e.push(s)}return e}}class dt{constructor(t,e){ae(this,"conn");ae(this,"info");this.conn=t,this.info=e}get baseURL(){return this.conn.baseURL}avatarURL(t=128,e=-1){let n;return e===null?n="":e<0?n=`&t=${Date.now()}`:n=`&t=${e}`,`${this.baseURL}/user-avatar/${this.info.username}?size=${t}${n}`}}class aa{constructor(t){ae(this,"conn");this.conn=t}async list(){return(await this.conn.reqUserList()).map(e=>new dt(this.conn,e))}async get(t){let e=await this.conn.reqUserInfo(t);return new dt(this.conn,e)}}var ve=function o(t){function e(ue,z){return ue>>>z|ue<<32-z}for(var n=Math.pow,s=n(2,32),i="length",l,r,d="",g=[],u=t[i]*8,c=o.h=o.h||[],m=o.k=o.k||[],f=m[i],h={},k=2;f<64;k++)if(!h[k]){for(l=0;l<313;l+=k)h[l]=k;c[f]=n(k,.5)*s|0,m[f++]=n(k,1/3)*s|0}for(t+="";t[i]%64-56;)t+="\0";for(l=0;l<t[i];l++){if(r=t.charCodeAt(l),r>>8)throw new Error("ASCII check failed");g[l>>2]|=r<<(3-l)%4*8}for(g[g[i]]=u/s|0,g[g[i]]=u,r=0;r<g[i];){var C=g.slice(r,r+=16),D=c;for(c=c.slice(0,8),l=0;l<64;l++){var _=C[l-15],P=C[l-2],S=c[0],y=c[4],b=c[7]+(e(y,6)^e(y,11)^e(y,25))+(y&c[5]^~y&c[6])+m[l]+(C[l]=l<16?C[l]:C[l-16]+(e(_,7)^e(_,18)^_>>>3)+C[l-7]+(e(P,17)^e(P,19)^P>>>10)|0),T=(e(S,2)^e(S,13)^e(S,22))+(S&c[1]^S&c[2]^c[1]&c[2]);c=[b+T|0].concat(c),c[4]=c[4]+b|0}for(l=0;l<8;l++)c[l]=c[l]+D[l]|0}for(l=0;l<8;l++)for(r=3;r+1;r--){var Z=c[l]>>r*8&255;d+=(Z<16?0:"")+Z.toString(16)}return d};class na{constructor({baseUrlGetter:t=()=>"",tokenGetter:e=()=>"",sessionIDGetter:n=()=>""}){this._baseUrlGetter=t,this._tokenGetter=e,this._sessionIDGetter=n}get baseUrl(){return this._baseUrlGetter()}get token(){return this._tokenGetter()}get sessionID(){return this._sessionIDGetter()}async get(t,e={}){const n=new URL(`${this._baseUrlGetter()}${t}`);return Object.keys(e).forEach(s=>n.searchParams.append(s,e[s])),await this._fetch(n.toString(),{method:"GET"})}async post(t,e={}){const n=new FormData;for(const s in e){let i=e[s];i instanceof Array&&(i=JSON.stringify(i)),n.append(s,i)}return await this._fetch(`${this._baseUrlGetter()}${t}`,{method:"POST",body:n})}async put(t,e){const n=new FormData;return n.append("key",this._tokenGetter()),n.append("session_id",this._sessionIDGetter()),n.append("file",e),await this._fetch(`${this._baseUrlGetter()}${t}`,{method:"PUT",body:n})}async delete(t,e={}){const n=new FormData;for(const s in e){let i=e[s];i instanceof Array&&(i=JSON.stringify(i)),n.append(s,i)}return n.append("key",this._tokenGetter()),n.append("session_id",this._sessionIDGetter()),await this._fetch(`${this._baseUrlGetter()}${t}`,{method:"DELETE",body:n})}async _fetch(t,e){if(e===void 0&&(e={}),e.headers===void 0?e.headers=new Headers:typeof e.headers=="string"?e.headers=new Headers(e.headers):e.headers=new Headers(e.headers),e.headers.append("Authorization",`Bearer ${this._tokenGetter()}`),(e==null?void 0:e.method)==="GET"){const s=new URL(t);s.searchParams.append("session_id",this._sessionIDGetter()),t=s.toString()}else if((e==null?void 0:e.method)==="POST"||(e==null?void 0:e.method)==="PUT"||(e==null?void 0:e.method)==="DELETE")if(typeof e.body=="string")e.body=JSON.stringify({session_id:this._sessionIDGetter(),...JSON.parse(e.body)});else if(e.body instanceof FormData)e.body.has("session_id")||e.body.append("session_id",this._sessionIDGetter());else throw new Error("Not implemented body type");const n=await fetch(t,e);if(!n.ok)throw new Error(`Request failed with status ${n.status}`);return n}}class oa{constructor(t,e=()=>""){ae(this,"docDry",(t,e)=>this.doc(t,e).replace("/doc/","/doc-dry/"));ae(this,"docText",(t,e)=>this.doc(t,e).replace("/doc/","/doc-text/"));this.baseURLGetter=t,this.tokenGetter=e}get baseURL(){return this.baseURLGetter()}get token(){return this.tokenGetter()}doc(t,e){return`${this.baseURL}/doc/${t}?u=${e}`}databaseDownload(t=!1){return`${this.baseURL}/api/database/download?data=${t}&key=${this.token}`}miscFile(t,e){const n=encodeURIComponent(e);return`${this.baseURL}/misc/${t}?fname=${n}`}userAvatar(t,e={size:128,t:-1}){let n;return e.t===null?n="":e.t<0?n=`&t=${Date.now()}`:n=`&t=${e.t}`,`${this.baseURL}/user-avatar/${t}?size=${e.size}${n}`}}class sa{constructor(t,e,n=null){if(n===null){const s=Math.random().toString(36).substring(2);n=()=>s}this.fetcher=new na({baseUrlGetter:t,tokenGetter:e,sessionIDGetter:n}),this.resolve=new oa(t,e)}get baseURL(){return this.fetcher.baseUrl}async authorize(){return await this.fetcher.post("/api/auth").then(t=>t.json())}async status(){return await this.fetcher.get("/api/status").then(t=>t.json())}async reqAllKeys(){return await this.fetcher.get("/api/database/keys").then(t=>t.json())}async reqAllTags(){return await this.fetcher.get("/api/database/tags").then(t=>t.json())}async reqDatabaseFeatureTSNE(t="doc_feature",e=3,n=10){return await this.fetcher.get(`/api/datafeat/tsne/${t}`,{n_component:e.toString(),perplexity:n.toString()}).then(s=>s.json())}async reqDatabaseUsage(){return await this.fetcher.get("/api/database/usage").then(t=>t.json())}async reqDatapointSummary(t){return await this.fetcher.get(`/api/datainfo/${t}`).then(e=>e.json())}async reqDatapointSummaries(t){return await this.fetcher.post("/api/datainfo-list",{uids:JSON.stringify(t)}).then(e=>e.json())}async deleteDatapoint(t){return await this.fetcher.post("/api/dataman/delete",{uuid:t}).then(()=>!0)}async updateDatapoint(t,{bibtex:e=null,tags:n=null,url:s=null}){if(!t&&(e===null||n===null||s===null))throw new Error("uid is null, other fields should be complete");const i={};return t!==null&&(i.uuid=t),e!==null&&(i.bibtex=e),n!==null&&(i.tags=JSON.stringify(n)),s!==null&&(i.url=s),await this.fetcher.post("/api/dataman/update",i).then(l=>l.json())}async reqDatapointAbstract(t){return await this.fetcher.get(`/api/datainfo-supp/abstract/${t}`).then(e=>e.text())}async updateDatapointAbstract(t,e){return await this.fetcher.post(`/api/datainfo-supp/abstract-update/${t}`,{content:e}).then(n=>!0)}async reqDatapointNote(t){return await this.fetcher.get(`/api/datainfo-supp/note/${t}`).then(e=>e.text())}async updateDatapointNote(t,e){return await this.fetcher.post(`/api/datainfo-supp/note-update/${t}`,{content:e}).then(n=>!0)}async query({tags:t=[],searchBy:e="title",searchContent:n="",maxResults:s=9999}={}){return await this.fetcher.post("/api/filter/basic",{tags:t,search_by:e,search_content:n,top_k:s}).then(i=>i.json())}async featurizeText(t,e=!1){return await this.fetcher.post("/api/iserver/textFeature",{text:t,require_cache:e}).then(n=>n.json())}reqAISummary(t,e,n=()=>{},s=!0,i="DEFAULT"){this.fetcher.post("/api/summary",{force:s,uuid:t,model:i}).then(l=>{if(!l.ok)throw e("(Error: "+l.status+")"),new Error("HTTP error "+l.status);const r=l.body.getReader(),d=({value:g,done:u})=>{if(u){n();return}let c=new TextDecoder().decode(g);return e(c),r.read().then(d)};return r.read().then(d)})}async reqMiscFileList(t){return await this.fetcher.get(`/api/misc-list/${t}`).then(e=>e.json())}async deleteMiscFile(t,e){return await this.fetcher.delete(`/misc/${t}`,{fname:e}).then(()=>!0)}async renameMiscFile(t,e,n){return await this.fetcher.post(`/misc/${t}`,{fname:e,dst_fname:n}).then(()=>!0)}async uploadMiscFiles(t,e){return(await Promise.all(e.map(s=>new Promise((i,l)=>{this.fetcher.put(`/misc/${t}`,s).then(r=>r.json()).then(i).catch(l)})))).map(s=>s.file_name)}async uploadDocument(t,e){return await this.fetcher.put(`/doc/${t}`,e).then(n=>n.json())}async deleteDocument(t){return await this.fetcher.delete(`/doc/${t}`).then(e=>e.json())}async updateTagAll(t,e){return await this.fetcher.post("/api/database/tag-rename",{oldTag:t,newTag:e}).then(()=>!0)}async deleteTagAll(t){return await this.fetcher.post("/api/database/tag-delete",{tag:t}).then(()=>!0)}async reqUserInfo(t){return await this.fetcher.post(`/api/user/info/${t}`).then(e=>e.json())}async updateUserNickname(t){return await this.fetcher.post("/api/user/info-update",{name:t}).then(e=>e.json())}async updateUserPassword(t){return await this.fetcher.post("/api/user/info-update",{password:ve(t)}).then(e=>e.json())}async reqUserList(){return await this.fetcher.post("/api/user/list",{}).then(t=>t.json())}async uploadUserAvatar(t,e){return await this.fetcher.put(`/user-avatar/${t}`,e).then(n=>n.json())}async updateUserAccess(t,e,n,s){const i={};return i.username=t,e!==null&&(i.is_admin=e.toString()),n!==null&&(i.mandatory_tags=JSON.stringify(n)),s!==null&&(i.max_storage=s),await this.fetcher.post("/api/userman/modify",i).then(l=>l.json())}async registerUser(t,e,n,s){return await this.fetcher.post("/api/userman/register",{invitation_code:t,username:e,password:ve(n),name:s}).then(i=>i.json())}async createUser(t,e,n,s,i,l){return await this.fetcher.post("/api/userman/create",{username:t,name:e,password:ve(n),is_admin:s.toString(),mandatory_tags:JSON.stringify(i),max_storage:l}).then(r=>r.json())}async deleteUser(t){return await this.fetcher.post("/api/userman/delete",{username:t}).then(()=>!0)}async reqFeedList({maxResults:t=10,category:e="",timeBefore:n=-1,timeAfter:s=-1}){return console.log("reqFeedList",t,e,n,s),await this.fetcher.post("/api/feed/query",{max_results:t,category:e,time_before:n,time_after:s}).then(i=>i.json())}async reqFeedCategories(){return await this.fetcher.get("/api/feed/categories").then(t=>t.json())}async changelog(){return await this.fetcher.get("/api/info/changelog").then(t=>t.json())}}const ge={};window.g_eventHooks=ge;function de(o,t){if(Array.isArray(o)){for(const e of o)de(e,t);return}ge[o]===void 0&&(ge[o]=[]),ge[o].includes(t)||ge[o].push(t)}function wt(o,t){if(Array.isArray(o)){for(const e of o)wt(e,t);return}ge[o]!==void 0&&(ge[o]=ge[o].filter(e=>e!==t))}function ia(o,t){he(()=>{de(o,t),console.log(`registered event callback [${o}]`,t.name)}),vt(()=>{wt(o,t),console.log(`unregistered event callback [${o}]`,t.name)})}class la{constructor(t,e){ae(this,"resetRemainingRetries",()=>{this.__remainingRetries=10});ae(this,"decreaseRemainingRetries",()=>{this.__remainingRetries-=1});ae(this,"isOpen",()=>this.ws?this.ws.readyState===WebSocket.OPEN:!1);ae(this,"willTryReconnect",()=>this.__remainingRetries>0);this.__baseUrlGetter=t,this.__tokenGetter=e,this.resetRemainingRetries(),this.sessionID=ve(Date.now().toString()).slice(0,16),this.__eventCallback_records={onopenCallback:()=>{},onmessageCallback:n=>{},oncloseCallback:()=>{},onfailedToConnectCallback:()=>{}}}connect({onopenCallback:t=()=>{},onmessageCallback:e=i=>{},oncloseCallback:n=()=>{},onfailedToConnectCallback:s=()=>{}}={}){this.__eventCallback_records={onopenCallback:t,onmessageCallback:e,oncloseCallback:n,onfailedToConnectCallback:s};const i=new URLSearchParams(window.location.search);i.append("key",this.__tokenGetter()),i.append("session_id",this.sessionID);const l=this.__baseUrlGetter().replace("https://","wss://").replace("http://","ws://")+"/ws?"+i.toString();return console.log("connecting to server websocket at: ",l),this.ws=new WebSocket(l),this.ws.onmessage=r=>{console.log(r);const d=JSON.parse(r.data);if(d.type==="event"){const g=d.content;if(console.log(g),Object.keys(ge).includes(g.type))for(const u of ge[g.type])u(g)}e(r)},this.ws.onopen=()=>{console.log("connected to server websocket"),t(),this.resetRemainingRetries()},this.ws.onclose=()=>{console.log("server websocket closed, will try to reconnect in 1 second"),n(),this.willTryReconnect()?(this.decreaseRemainingRetries(),new Promise(r=>setTimeout(r,1e3)).then(()=>{this.ws.readyState===WebSocket.CLOSED&&this.connect({onopenCallback:t,onmessageCallback:e,oncloseCallback:n,onfailedToConnectCallback:s})})):s()},this}send(t){this.ws.readyState===WebSocket.OPEN?this.ws.send(JSON.stringify(t)):console.log("server websocket not ready, cannot send data")}resetReconnect(){this.ws&&this.ws.readyState===WebSocket.OPEN&&this.ws.close(),this.resetRemainingRetries(),this.connect(this.__eventCallback_records)}close(){this.__remainingRetries=0,this.ws&&this.ws.readyState===WebSocket.OPEN?this.ws.close():console.log("server websocket not ready, cannot close")}}async function Xe(o){if(navigator.clipboard&&window.isSecureContext)return await navigator.clipboard.writeText(o),!0;{const t=document.createElement("textarea");t.value=o,t.style.position="absolute",t.style.left="-99999999px",document.body.prepend(t),t.select();let e=!1;try{document.execCommand("copy")}catch(n){console.log(n),e=!0}finally{t.remove()}return!e}}function ra(o){window.open(o,"_blank")}function bt(o,t){let e=null;return function(...n){e&&window.clearTimeout(e),e=window.setTimeout(()=>{o(...n),e=null},t)}}function kt(o){let t,e,n;function s(r){var d;return((d=o.match(new RegExp(`^\\s*${r}\\s*=\\s*({.*}|"[^"]*"),?\\s*$`,"m")))==null?void 0:d[1])||""}function i(r){return r.replace(/"/g,"").replace(/{/g,"").replace(/}/g,"").trim()}t=s("volume"),e=s("number"),e||(e=s("issue")),n=s("pages"),n=n.replace("--","-"),t=i(t),e=i(e),n=i(n);let l="";return t&&(l+=`${t}`),e&&(l+=`(${e})`),n&&(l?l+=`: ${n}`:l+=`${n}`),l}function ht(o,t,e=null){let n="";if(e){let s=new Date;s.setTime(s.getTime()+e*24*60*60*1e3),n=`expires=${s.toUTCString()}; `}document.cookie=`${o}=${t}; ${n} path=/; sameSite=Lax`}function ua(o){return decodeURIComponent(document.cookie).split("; ").forEach(n=>{if(n.startsWith(`${o}=`)&&n.includes("expires"))return!0}),!1}function ca(o){const e=decodeURIComponent(document.cookie).split("; ");let n="";return e.forEach(s=>{s.indexOf(o)===0&&(n=s.substring(`${o}=`.length))}),n}const N=We("uiStatus",{state:()=>({tagStatus:{checked:new O,all:new O,unfolded:new O},shownDataUIDs:[],shownDataScores:[],searchState:{searchBy:"title",content:""},unfoldedDataUIDs:[],recentlyReadDataUIDs:[],preferredReaderLeftPanelWidthPerc:.65,showMiscPanel:!1,popupValues:{},databaseLoadingStatus:{nCurrent:0,nTotal:-1},dataEditorOpened:!1}),getters:{databaseLoadingProgress(){return this.databaseLoadingStatus.nTotal===-1?this.databaseLoadingStatus.nCurrent===0?0:1:this.databaseLoadingStatus.nCurrent/this.databaseLoadingStatus.nTotal},focusedDataUID(){return this.unfoldedDataUIDs.length===0?null:this.unfoldedDataUIDs[0]}},actions:{updateShownData(){const o=J();this.tagStatus.all=o.allTags,console.log("DEBUG: updateShownData() is called."),ee().conn.query({tags:Array.from(this.tagStatus.checked),searchBy:this.searchState.searchBy,searchContent:this.searchState.content}).then(t=>{this.shownDataUIDs=t.uids,this.shownDataScores=t.scores})},addRecentlyReadDataUID(o){this.recentlyReadDataUIDs.includes(o)&&this.recentlyReadDataUIDs.splice(this.recentlyReadDataUIDs.indexOf(o),1),this.recentlyReadDataUIDs.unshift(o),this.recentlyReadDataUIDs.length>5&&this.recentlyReadDataUIDs.pop()},showPopup(o,t="info",e=3e3){const n=Math.random().toString();this.popupValues[n]={content:o,styleType:t},setTimeout(()=>{delete this.popupValues[n]},e)},reloadDatabase(){J().reload(()=>{this.databaseLoadingStatus.nCurrent=0,J().database.clear(),this.shownDataUIDs=[],this.shownDataScores=[]},()=>{this.databaseLoadingStatus.nTotal=-1,this.tagStatus.all=J().database.allTags(),this.updateShownData()},()=>{this.showPopup(`Failed to load database from: ${ee().conn.baseURL}`,"alert"),this.databaseLoadingStatus.nTotal=-1})}}}),ee=We("connection",{state:()=>{const o=new la(W().backend,()=>W().encKey);return{conn:new sa(W().backend,()=>W().encKey,()=>o.sessionID),wsConn:o}}}),J=We("data",{state:()=>({database:new ta(ee().conn),userPool:new aa(ee().conn),user:{id:-1,username:"",enc_key:"",name:"",is_admin:!1,mandatory_tags:[],has_avatar:!1,max_storage:0}}),getters:{allTags(){return this.database.allTags()}},actions:{clearUserInfo(){this.user={id:0,username:"",enc_key:"",name:"",is_admin:!1,mandatory_tags:[],has_avatar:!1,max_storage:0}},reload(o=()=>{this.database.clear()},t=()=>{},e=()=>{}){o();function n(s){s.database.init().then(i=>{t()},i=>{e(i)})}n(this)}}}),W=We("settings",{state:()=>({__encKey:(()=>{const o=localStorage.getItem("encKey");return o?(localStorage.removeItem("encKey"),ht("encKey",o,1),o):ca("encKey")})(),__showTagPanel:(localStorage.getItem("showTagPanel")||String(window.innerWidth>768))==="true",__showHomeInfoPanel:(localStorage.getItem("showHomeInfoPanel")||"false")==="true",__show3DScatterPlot:(localStorage.getItem("show3DScatterPlot")||"false")==="true",__readerLayoutType:localStorage.getItem("readerLayoutType")||"2",__numItemsPerPage:localStorage.getItem("numItemsPerPage")||"50",__backendHost:sessionStorage.getItem("backendUrl")||da(),__backendPort:sessionStorage.getItem("backendPort")||ha(),loggedIn:!1}),getters:{encKey(){return this.__encKey},backendHost(){return this.__backendHost},backendPort(){return this.__backendPort},showTagPanel(){return this.__showTagPanel},showHomeInfoPanel(){return this.__showHomeInfoPanel},show3DScatterPlot(){return this.__show3DScatterPlot},readerLayoutType(){return parseInt(this.__readerLayoutType)},numItemsPerPage(){return parseInt(this.__numItemsPerPage)}},actions:{setEncKey(o,t=void 0){t===void 0&&(t=ua("encKey")),this.__encKey=o,ht("encKey",o,t?7:null)},setBackendHost(o){this.__backendHost=o,sessionStorage.setItem("backendUrl",o)},setBackendPort(o){this.__backendPort=o,sessionStorage.setItem("backendPort",o)},setShowTagPanel(o){this.__showTagPanel=o,localStorage.setItem("showTagPanel",o.toString())},setShowHomeInfoPanel(o){this.__showHomeInfoPanel=o,localStorage.setItem("showHomeInfoPanel",o.toString())},setShow3DScatterPlot(o){this.__show3DScatterPlot=o,localStorage.setItem("show3DScatterPlot",o.toString())},setReaderLayoutType(o){this.__readerLayoutType=o.toString(),localStorage.setItem("readerLayoutType",o.toString())},setNumItemsPerPage(o){this.__numItemsPerPage=o.toString(),localStorage.setItem("numItemsPerPage",o.toString())},backend(){return`${this.backendHost}:${this.backendPort}`}}});function da(){let o=window.location.protocol,t=window.location.hostname;return`${o}//${t}`}function ha(){const o=window.location.port;return o==="1420"?"8080":o}function et(o,t,e){W().setEncKey(o,e),t!==null?J().user=t:J().clearUserInfo(),t?W().loggedIn=!0:W().loggedIn=!1}function pa(){et("",null,!0)}async function fa(){const o=ee().conn,t=W().encKey;try{const e=await o.authorize();return et(t,e,!0),e}catch(e){return console.log("settingsAuthentication failed: ",e),null}}function ma(o,t){return ve(o+ve(t))}const va={class:"loading-widget"},ga=M({__name:"LoadingWidget",props:{size:{default:"40px"},border_width:{default:"5px"}},setup(o){const t=o,e=U(()=>({width:t.size,height:t.size,border:t.border_width+" solid var(--color-border)",borderTopColor:"var(--color-primary)"}));return(n,s)=>(p(),v("div",va,[a("div",{class:"loading-widget__spinner",style:oe(e.value)},null,4)]))}}),je=E(ga,[["__scopeId","data-v-1d6933bb"]]),_a={class:"loading-popout"},ya=M({__name:"LoadingPopout",props:{text:{default:"loading"}},setup(o){const t=o;return(e,n)=>(p(),v("div",_a,[$(je,{size:"25px"}),a("label",null,I(t.text),1)]))}}),$t=E(ya,[["__scopeId","data-v-95a13423"]]),Ae=[];class Q{static registerThemeChangeCallback(t){Ae.indexOf(t)===-1&&Ae.push(t)}static unregisterThemeChangeCallback(t){const e=Ae.indexOf(t);e!==-1&&Ae.splice(e,1)}static toggleDarkMode(){document.documentElement.classList.contains("light")?Q.setDarkMode(!0):document.documentElement.classList.contains("dark")?Q.setDarkMode(!1):(window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches,Q.setDarkMode(!0))}static isDefaultDarkMode(){return!!(window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches)}static isDarkMode(){return document.documentElement.classList.contains("light")?!1:!!document.documentElement.classList.contains("dark")}static setDefaultDarkMode(){const t=localStorage.getItem("themeMode");t==="dark"?Q.setDarkMode(!0):t=="light"?Q.setDarkMode(!1):Q.isDefaultDarkMode()&&!Q.isDarkMode()&&this.setDarkMode(!0,!1)}static setDarkMode(t,e=!0){t?(document.documentElement.classList.remove("light"),document.documentElement.classList.add("dark")):(document.documentElement.classList.remove("dark"),document.documentElement.classList.add("light"));for(let n of Ae)n(t);if(e){const n=t?"dark":"light";localStorage.getItem("themeMode")!==n&&localStorage.setItem("themeMode",t?"dark":"light")}}static getThemeMode(){const t=localStorage.getItem("themeMode");return t==="dark"?"dark":t==="light"?"light":"auto"}static clear(){document.documentElement.classList.remove("dark"),document.documentElement.classList.remove("light"),this.setDefaultDarkMode(),localStorage.removeItem("themeMode")}}function pt(o,t){let e=o.parentNode;for(;e!=null;){if(e==t)return!0;e=e.parentNode}return!1}function Be(o){if(o===null||typeof o!="object")return o;let t=Array.isArray(o)?[]:{};for(let e in o)t[e]=Be(o[e]);return t}function St(o,t,e=!1){if(o.length!==t.length)throw new Error("arr.length !== scores.length");const n=new Array;for(let r=0;r<o.length;r++)n.push([o[r],t[r]]);let s;e?s=n.sort((r,d)=>r[1]-d[1]):s=n.sort((r,d)=>d[1]-r[1]);const i=new Array,l=new Array;for(const r of s)i.push(r[0]),l.push(r[1]);return[i,l]}const wa=o=>(se("data-v-934929d5"),o=o(),ie(),o),ba={id:"popups"},ka=wa(()=>a("div",null,[a("div",{style:{"font-size":"2em","font-weight":"bold",color:"var(--color-red)"}},"Failed to connect to server"),a("div",{style:{color:"gray"}},"Maximum retry exceeded")],-1)),$a={id:"app"},Sa=M({__name:"App",setup(o){const t=ye(),e=N(),n=W();t.isReady().then(()=>{if(t.currentRoute.value.query.backendPort&&W().setBackendPort(t.currentRoute.value.query.backendPort),t.currentRoute.value.query.backendHost&&W().setBackendHost(t.currentRoute.value.query.backendHost),t.currentRoute.value.query.credential&&W().setEncKey(t.currentRoute.value.query.credential,!1),window.location.hash.split("?")[0]!=="#/login"){console.log("Authenticating...");const h=()=>{n.loggedIn?n.loggedIn=!1:s()};fa().then(k=>{k||h()},()=>{h()})}});function s(){J().$reset(),N().$reset(),i.close(),t.push({path:"/login",query:{from:t.currentRoute.value.fullPath}})}ne(()=>n.loggedIn,(h,k)=>{h?m():s()});const i=ee().wsConn,l=w(!1),r=w(!1),d=w(window.location.hash.split("?")[0]==="#/login");t.afterEach((h,k)=>{d.value=h.path==="/login"});const g=U(()=>!l.value&&!d.value&&!r.value),u=U(()=>r.value&&!d.value);function c(){i.connect({onopenCallback:()=>{l.value=!0,r.value=!1},oncloseCallback:()=>l.value=!1,onfailedToConnectCallback:()=>r.value=!0})}setInterval(()=>{!i.isOpen()&&l.value&&!d.value&&!r.value?(console.log("DEBUG: Connection lost, try to reconnect"),l.value=!1,c()):d.value&&i.willTryReconnect()&&(console.log("DEBUG: In login page, close connection."),i.close())},5e3);function m(){c(),e.reloadDatabase()}de("add_entry",h=>{const k=J(),C=h.datapoint_summary;k.database.update(C).then(()=>{console.log("DEBUG: add entry update UI"),e.updateShownData()})}),de(["update_entry","update_note"],h=>{const k=J(),C=h.datapoint_summary;k.database.update(C).then(()=>{console.log("DEBUG: update entry update UI"),e.updateShownData()})}),de("delete_entry",h=>{const k=J(),C=h.uuid;k.database.delete(C).then(()=>{console.log("DEBUG: delete entry update UI"),e.updateShownData()})}),de(["delete_tag","update_tag"],h=>{const k=new O([h.src_tag]),C=J();(async function(){await C.database.updateTagCache();const _=C.database.getCacheByTags(k);await Promise.all(_.map(P=>P.update())),e.updateShownData(),console.log("DEBUG: update tag update UI")})()}),de("update_user",h=>{if(h.username===J().user.username){if(h.user_info===null)throw new Error("assertion failed: User info is null");for(const k of Object.keys(J().user))k!=="enc_key"&&(J().user[k]=h.user_info[k])}});const f=()=>{window.location.reload()};return he(()=>{Q.setDefaultDarkMode()}),(h,k)=>{const C=Je("router-view");return p(),v(H,null,[a("div",ba,[(p(!0),v(H,null,te(Object.keys(x(e).popupValues),(D,_)=>(p(),Y(ct,{key:_,styleType:x(e).popupValues[D].styleType,style:oe({transform:`translate(-50%, ${-50+110*_}%) scale(0.9)`})},{default:B(()=>[q(I(x(e).popupValues[D].content),1)]),_:2},1032,["styleType","style"]))),128))]),g.value?(p(),Y($t,{key:0,text:"connecting..."})):A("",!0),u.value?(p(),Y(ct,{key:1,styleType:"info",position:"center"},{default:B(()=>[a("div",{style:{display:"flex","flex-direction":"column","align-items":"center",margin:"10px"}},[ka,a("div",{style:{"font-size":"1.2em","margin-top":"10px"}},[q(" Please check if the server is running, make sure your network is working properly, and try to "),a("a",{style:{"text-decoration":"underline",cursor:"pointer"},onClick:f},"reload the page"),q(". ")])])]),_:1})):A("",!0),a("div",$a,[$(C,null,{default:B(({Component:D})=>[(p(),Y(zt,{exclude:"Reader"},[(p(),Y(Et(D)))],1024))]),_:1})])],64)}}}),xa=E(Sa,[["__scopeId","data-v-934929d5"]]),Da={for:"chk"},Ca={id:"checkCircle"},Pa={key:0,id:"checkStatus"},Ia=M({__name:"Toggle",props:{checked:{type:Boolean},identifier:{default:""}},emits:["onCheck"],setup(o,{emit:t}){const e=t,n=o;function s(i){e("onCheck",n.identifier)}return(i,l)=>(p(),v("div",{class:"toggle",onClick:s},[a("label",Da,[fe(i.$slots,"default",{},void 0)]),a("div",Ca,[i.checked?(p(),v("div",Pa)):A("",!0)])]))}}),Se=E(Ia,[["__scopeId","data-v-582ee950"]]),Ta={class:"toggleText"},Ua={class:"children slideInDown"},Ra=M({__name:"TagCollapsibleToggle",props:{tagStatus:{},identifier:{default:""},children:{}},emits:["update:tagStatus"],setup(o,{emit:t}){const e=o,n=t,s=U({get:()=>e.tagStatus,set:h=>n("update:tagStatus",h)}),i=U(()=>{let h="collapseButton";return Object.keys(e.children).length!==0&&(h+=" collapsible"),h}),l=w(null),r=U(()=>!e.tagStatus.unfolded.has(e.identifier)),d=U(()=>r.value?"triangle-right":"triangle-down rotate90in");function g(h){let k=s.value.unfolded;k.has(e.identifier)?k.delete(e.identifier):k.add(e.identifier)}const u=U(()=>e.tagStatus.checked.has(e.identifier));function c(h){if(h===void 0)return;let k=s.value.checked;k.has(h)?k.delete(h):k.add(h)}const m=w(null),f=h=>{h.button===2&&(g(),h.preventDefault())};return Qe(()=>{var h;(h=m.value)==null||h.addEventListener("contextmenu",f)}),gt(()=>{var h;(h=m.value)==null||h.removeEventListener("contextmenu",f)}),(h,k)=>(p(),v(H,null,[a("div",{class:"row",ref_key:"rowDiv",ref:m},[a("div",{id:"button",class:me(i.value),ref_key:"button",ref:l,onClick:g},[Object.keys(e.children).length!==0?(p(),v("div",{key:0,class:me(d.value)},null,2)):A("",!0)],2),a("div",Ta,[$(Se,{checked:u.value,identifier:e.identifier,onOnCheck:c},{default:B(()=>[fe(h.$slots,"default",{},void 0,!0)]),_:3},8,["checked","identifier"])])],512),V(a("div",Ua,[(p(!0),v(H,null,te(h.children,(C,D)=>(p(),Y(xt,{identifier:String(D),children:C,"tag-status":s.value,"onUpdate:tagStatus":k[0]||(k[0]=_=>s.value=_)},{default:B(()=>[q(I(String(D).split(x(pe)).slice(-1)[0]),1)]),_:2},1032,["identifier","children","tag-status"]))),256))],512),[[Ft,!r.value]])],64))}}),xt=E(Ra,[["__scopeId","data-v-3c7d3255"]]),Aa={id:"tagSelector-main",class:"hover-scrollable"},Ba=M({__name:"TagSelector",props:{tagStatus:{}},emits:["update:tagStatus"],setup(o,{emit:t}){const e=o,n=t,s=U(()=>Ce.tagHierarchy(e.tagStatus.all)),i=U(()=>Object.keys(s.value).sort()),l=U({get:()=>e.tagStatus,set:r=>n("update:tagStatus",r)});return(r,d)=>(p(),v("div",Aa,[(p(!0),v(H,null,te(i.value,g=>(p(),Y(xt,{identifier:String(g),children:s.value[g],tagStatus:l.value,"onUpdate:tagStatus":d[0]||(d[0]=u=>l.value=u)},{default:B(()=>[q(I(String(g).split(x(pe)).slice(-1)[0]),1)]),_:2},1032,["identifier","children","tagStatus"]))),256))]))}}),Dt=E(Ba,[["__scopeId","data-v-f90dfe41"]]),Ma={key:0,class:"prefix"},La=M({__name:"TagBubble",props:{tag:{},tStyle:{default:""}},emits:["click"],setup(o,{emit:t}){const e=o,n=t,s=U(()=>{const i=e.tag.split(pe);return i.length==1?["",i[0]]:[i.slice(0,i.length-1).join("·"),i[i.length-1]]});return(i,l)=>(p(),v("div",{class:me(`bubble${i.tStyle?" "+i.tStyle:""}`),onClick:l[0]||(l[0]=()=>n("click"))},[s.value[0]?(p(),v("div",Ma,I(s.value[0]),1)):A("",!0),q(" "+I(s.value[1]),1)],2))}}),qa=E(La,[["__scopeId","data-v-f454bc70"]]),Ea=M({__name:"TagBubbleContainer",props:{tags:{},highlightTags:{default:null},mutedTags:{default:null},maxWidth:{default:null},middleAlign:{type:Boolean,default:!1}},emits:["clickOnBubble"],setup(o,{emit:t}){const e=o,n=t,s=U(()=>{const i={};for(const l of e.tags)e.highlightTags&&e.highlightTags.has(l)?i[l]="highlight":e.mutedTags&&e.mutedTags.has(l)?i[l]="muted":i[l]="";return i});return(i,l)=>(p(),v("div",{id:"bubbleContainer",style:oe({maxWidth:`${(e.maxWidth?e.maxWidth:999)-10}px`,justifyContent:e.middleAlign?"center":"flex-start"})},[(p(!0),v(H,null,te(e.tags,r=>(p(),Y(qa,{onClick:()=>n("clickOnBubble",r),tag:r,"t-style":s.value[r]},null,8,["onClick","tag","t-style"]))),256))],4))}}),tt=E(Ea,[["__scopeId","data-v-62e107cd"]]),at=o=>(se("data-v-9523b989"),o=o(),ie(),o),za=at(()=>a("h3",{class:"green"},"Tags",-1)),Fa=at(()=>a("hr",null,null,-1)),Oa=at(()=>a("hr",null,null,-1)),Ha=M({__name:"FileTags",emits:["onCheck"],setup(o,{emit:t}){const e=t,n=N(),s=J(),i=w(null),l=w(null);ne(()=>n.unfoldedDataUIDs,()=>{n.unfoldedDataUIDs.length==0?l.value=null:n.shownDataUIDs.includes(n.unfoldedDataUIDs[0])&&s.database.aget(n.unfoldedDataUIDs[0]).then(m=>{l.value=m})});const r=U(()=>l.value==null?null:n.tagStatus.checked.withChildsFrom(l.value.tags)),d=U(()=>{const m=n.tagStatus.checked.copy();return l.value!==null&&m.pop_ifcontains_(l.value.tags),m});function g(){n.tagStatus.checked=new O,n.updateShownData()}ne(n.tagStatus,()=>e("onCheck",n.tagStatus),{deep:!0});function u(){const m=prompt("Old tag");if(m&&s.database.allTags().has(m)){const f=prompt("New tag");f&&ee().conn.updateTagAll(m,f).then(()=>{n.showPopup("Tag renamed","success")},()=>{n.showPopup("Failed to rename tag","error")})}else n.showPopup("Invalid tag","warning")}function c(){const m=prompt("Tag to delete");if(m&&s.database.allTags().has(m)){if(!confirm(`Are you sure to delete tag "${m}"?`))return;ee().conn.deleteTagAll(m).then(()=>{n.showPopup("Tag deleted","success")},()=>{n.showPopup("Failed to delete tag","error")})}else n.showPopup("Invalid tag","warning")}return(m,f)=>(p(),v("div",{id:"file-tags-main",ref_key:"ftPanel",ref:i},[a("div",{class:"title"},[a("div",{id:"title-title"},[za,a("div",{id:"title-buttons"},[a("div",{class:"button",onClick:u},"rename"),a("div",{class:"button",onClick:c},"delete")])]),Fa]),$(Dt,{onOnCheck:f[0]||(f[0]=h=>e("onCheck",h)),tagStatus:x(n).tagStatus,"onUpdate:tagStatus":f[1]||(f[1]=h=>x(n).tagStatus=h)},null,8,["tagStatus"]),Oa,$(tt,{onClickOnBubble:f[2]||(f[2]=h=>{x(n).tagStatus.checked.has(h)?x(n).tagStatus.checked.delete(h):x(n).tagStatus.checked.add(h),x(n).updateShownData()}),tags:l.value?l.value.tags:x(n).tagStatus.checked,"highlight-tags":r.value,"muted-tags":d.value,"max-width":i.value?i.value.clientWidth:null},null,8,["tags","highlight-tags","muted-tags","max-width"]),a("div",{class:"buttons"},[a("button",{id:"btnClear",class:"green",onClick:g},"CLEAR SELECTION")])],512))}}),Na=E(Ha,[["__scopeId","data-v-9523b989"]]),Wa="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20height='24'%20viewBox='0%20-960%20960%20960'%20width='24'%3e%3cpath%20d='M240-80q-50%200-85-35t-35-85v-120h120v-560h600v680q0%2050-35%2085t-85%2035H240Zm480-80q17%200%2028.5-11.5T760-200v-600H320v480h360v120q0%2017%2011.5%2028.5T720-160ZM360-600v-80h360v80H360Zm0%20120v-80h360v80H360ZM240-160h360v-80H200v40q0%2017%2011.5%2028.5T240-160Zm0%200h-40%20400-360Z'/%3e%3c/svg%3e",nt="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20height='48'%20viewBox='0%2096%20960%20960'%20width='48'%3e%3cpath%20d='M480%20856q-115%200-197.5-82.5T200%20576q0-115%2082.5-197.5T480%20296q115%200%20197.5%2082.5T760%20576q0%20115-82.5%20197.5T480%20856Z'/%3e%3c/svg%3e",ja="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20height='48'%20viewBox='0%2096%20960%20960'%20width='48'%3e%3cpath%20d='M331%20625h37v-83h48q15.725%200%2026.362-10.638Q453%20520.725%20453%20505v-48q0-15.725-10.638-26.362Q431.725%20420%20416%20420h-85v205Zm37-120v-48h48v48h-48Zm129%20120h84q15%200%2026-10.638%2011-10.637%2011-26.362V457q0-15.725-11-26.362Q596%20420%20581%20420h-84v205Zm37-37V457h47v131h-47Zm133%2037h37v-83h50v-37h-50v-48h50v-37h-87v205ZM260%20856q-24%200-42-18t-18-42V236q0-24%2018-42t42-18h560q24%200%2042%2018t18%2042v560q0%2024-18%2042t-42%2018H260ZM140%20976q-24%200-42-18t-18-42V296h60v620h620v60H140Z'/%3e%3c/svg%3e",Va="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20height='48'%20viewBox='0%2096%20960%20960'%20width='48'%3e%3cpath%20d='M251%20896q-88%200-149.5-61.5T40%20685q0-78%2050-137t127-71q20-97%2094-158.5T482%20257q112%200%20189%2081.5T748%20534v24q72-2%20122%2046.5T920%20727q0%2069-50%20119t-119%2050H251Z'/%3e%3c/svg%3e",Ka="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20height='48'%20viewBox='0%2096%20960%20960'%20width='48'%3e%3cpath%20d='M251%20896q-88%200-149.5-61.5T40%20685q0-78%2050-137t127-71q20-97%2094-158.5T482%20257q112%200%20189%2081.5T748%20534v24q72-2%20122%2046.5T920%20727q0%2069-50%20119t-119%2050H251Zm0-60h500q45%200%2077-32t32-77q0-45-32-77t-77-32h-63v-84q0-91-61-154t-149-63q-88%200-149.5%2063T267%20534h-19q-62%200-105%2043.5T100%20685q0%2063%2044%20107t107%2044Zm229-260Z'/%3e%3c/svg%3e",Za="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20height='48'%20viewBox='0%2096%20960%20960'%20width='48'%3e%3cpath%20d='M220%20976q-24%200-42-18t-18-42V236q0-24%2018-42t42-18h361l219%20219v521q0%2024-18%2042t-42%2018H220Zm331-554h189L551%20236v186Z'/%3e%3c/svg%3e",Ga="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20height='48'%20viewBox='0%2096%20960%20960'%20width='48'%3e%3cpath%20d='M220%20976q-24%200-42-18t-18-42V236q0-24%2018-42t42-18h361l219%20219v521q0%2024-18%2042t-42%2018H220Zm331-554V236H220v680h520V422H551ZM220%20236v186-186%20680-680Z'/%3e%3c/svg%3e",Ja=o=>(se("data-v-c6dbcdc2"),o=o(),ie(),o),Qa={key:0,id:"window"},Ya={class:"header"},Xa=Ja(()=>a("span",{class:"close-icon"},"✕",-1)),en=[Xa],tn=M({__name:"FloatingWindow",props:{title:{default:"_"},show:{type:Boolean},closeKey:{default:"Escape"},compact:{type:Boolean,default:!1},zIndex:{default:100}},emits:["close","onClose","update:show"],setup(o,{emit:t}){const e=o,n=t,s=U({get:()=>e.show,set:r=>{n("update:show",r)}});function i(){s.value=!1,n("onClose"),n("close")}function l(r){r.target===r.currentTarget&&i()}return window.addEventListener("keydown",r=>{r.key===e.closeKey&&(i(),r.preventDefault())}),(r,d)=>s.value?(p(),v("div",Qa,[a("div",{id:"blocker",onClick:l,style:oe({"z-index":r.zIndex-1})},[a("div",{class:"floating-window",style:oe({"z-index":r.zIndex})},[a("div",Ya,[a("label",null,I(e.title),1),a("button",{class:"close-button",onClick:i},en)]),a("div",{class:"window-content scrollable",style:oe({margin:e.compact?"0px":"15px",marginTop:e.compact?"0px":"5px"})},[fe(r.$slots,"default",{},void 0)],4)],4)],4)])):A("",!0)}}),ke=E(tn,[["__scopeId","data-v-c6dbcdc2"]]),an={id:"query-dialog-main"},nn={class:"content"},on={id:"buttons"},sn=M({__name:"QueryDialog",props:{show:{type:Boolean},title:{default:"Query"},showCancel:{type:Boolean,default:!0},zIndex:{default:99}},emits:["update:show","onClose","onAccept","onCancel"],setup(o,{emit:t}){const e=o,n=t,s=U({get:()=>e.show,set:i=>{n("update:show",i)}});return(i,l)=>(p(),Y(ke,{show:s.value,"onUpdate:show":l[2]||(l[2]=r=>s.value=r),title:i.title,compact:!0,"z-index":i.zIndex,onOnClose:l[3]||(l[3]=()=>n("onClose"))},{default:B(()=>[a("div",an,[a("div",nn,[fe(i.$slots,"default",{},void 0,!0)]),a("div",on,[a("div",{class:"button ok-button",onClick:l[0]||(l[0]=()=>n("onAccept"))},"OK"),i.showCancel?(p(),v("div",{key:0,class:"button cancel-button last-button",onClick:l[1]||(l[1]=()=>n("onCancel"))},"Cancel")):A("",!0)])])]),_:3},8,["show","title","z-index"]))}}),xe=E(sn,[["__scopeId","data-v-81948a9f"]]),ln=o=>(se("data-v-990ad4c4"),o=o(),ie(),o),rn={id:"tag-selector-with-entry-main"},un={style:{textAlign:"left"}},cn=ln(()=>a("label",{for:"tagSelector"},"Tags",-1)),dn={id:"tagSelector",class:"scrollable"},hn={class:"entry"},pn=M({__name:"TagSelectorWithEntry",props:{tagStatus:{},tagInputValue:{default:""}},emits:["update:tagStatus","update:tagInputValue"],setup(o,{emit:t}){const e=o,n=t,s=U({get:()=>e.tagStatus,set:d=>n("update:tagStatus",d)}),i=w(e.tagInputValue);ne(()=>e.tagInputValue,d=>{i.value=d});const l=U({get:()=>i.value,set:d=>{n("update:tagInputValue",d),i.value=d}}),r=()=>{const d=l.value.trim();d!==""&&(s.value.all.add(d),s.value.checked.add(d),s.value.unfolded.union_(Ce.allParentsOf(d)),l.value="")};return(d,g)=>(p(),v("div",rn,[a("div",un,[cn,a("div",dn,[$(Dt,{tagStatus:s.value,"onUpdate:tagStatus":g[0]||(g[0]=u=>s.value=u)},null,8,["tagStatus"])])]),a("div",hn,[V(a("input",{type:"text",placeholder:"New tag","onUpdate:modelValue":g[1]||(g[1]=u=>l.value=u),onKeyup:Ye(r,["enter"])},null,544),[[X,l.value]]),a("button",{class:me(`green${l.value?" to-be-confirmed":""}`),onClick:r},"ADD",2)])]))}}),fn=E(pn,[["__scopeId","data-v-990ad4c4"]]);async function mn(o){const t=`https://export.arxiv.org/api/query?id_list=${o}`,n=await(await fetch(t,{method:"GET"})).text();let l=new Jt.XMLParser().parse(n).feed.entry;function r(d){return Array.isArray(d.author)?d.author.map(g=>g.name):d.author?[d.author.name]:[]}if(l){const d=l.id.split("/").pop().split("v")[0],g=l.id,u=l.title,c=l.summary,m=r(l),f=l.updated,h=l.published;return{id:d,link:g,title:u,abstract:c,authors:m,updatedTime:f,publishedTime:h}}else throw new Error("Failed to fetch paper from arxiv")}function vn(o){return`@article{${o.id},
  author = {${o.authors.join(" and ")}},
  title = {${o.title}},
  journal = {arXiv preprint arXiv:${o.id}},
  year = {${o.publishedTime.split("-")[0]}},
  abstract = {${o.abstract}}
  }`.replace(/  /g,"")}const ft=(o,{entry:t="",title:e="",authors:n=[""],year:s=new Date().getFullYear()}={})=>(t||(t=`${s}_${Math.random().toString(36).substring(7)}`),o=="article"?`@article{${t},
        author = {${n.join(" and ")}},
        title = {${e}},
        journal = {},
        year = {${s}},
        abstract = {},
        volume = {},
        number = {},
        pages = {},
        month = {},
        doi = {},
        }`.replace(/  /g,""):o=="inproceedings"?`@inproceedings{${t},
        author = {${n.join(" and ")},
        title = {${e}},
        booktitle = {},
        year = {${s}},
        abstract = {},
        editor = {},
        volume = {},
        number = {},
        series = {},
        pages = {},
        }`.replace(/  /g,""):o=="webpage"||o=="online"?`@online{${t},
        title = {${e}},
        author = {${n.join(" and ")}},
        year = {${s}},
        url = {},
        note = {}
        }`.replace(/  /g,""):o=="misc"?`@misc{${t},
        author = {${n.join(" and ")}},
        title = {${e}},
        year = {${s}},
        url = {},
        }`.replace(/  /g,""):"");class Ze{static async fromArxiv(t){let e=t.toLowerCase();e.startsWith("arxiv:")?e=e.split("arxiv:")[1]:e.includes("arxiv.org/abs/")?e=e.split("arxiv.org/abs/")[1]:e.includes("arxiv.org/pdf/")&&(e=e.split("arxiv.org/pdf/")[1].split(".pdf")[0]);const n=await mn(e);return{bibtex:vn(n),url:n.link}}static async fromWebpage(t){var d;const n=await(await fetch(`https://api.allorigins.win/get?url=${encodeURIComponent(t)}`)).text(),l=(d=new DOMParser().parseFromString(n,"text/html").querySelector("title"))==null?void 0:d.innerText;return{bibtex:`@misc{${t},
            author = {},
            title = {${l}},
            url = {${t}},
            year = {${new Date().getFullYear()}},
            }`.replace(/  /g,""),url:t}}static async fromDoi(t){const e=`https://api.crossref.org/works/${t}/transform/application/x-bibtex`;return{bibtex:await(await fetch(e,{method:"GET"})).text(),url:`https://doi.org/${t}`}}}const gn={key:0,id:"arrow"},_n=["onKeydown","onClick"],yn=M({__name:"Menu",props:{show:{type:Boolean},menuItems:{},position:{},blocker:{type:Boolean,default:!1},middleTop:{type:Boolean,default:!1},zIndex:{default:100},arrow:{type:Boolean,default:!1}},emits:["update:show"],setup(o,{emit:t}){const e=o,n=t,s=U({get:()=>e.show,set:l=>{n("update:show",l)}});function i(){s.value=!1}return(l,r)=>(p(),v(H,null,[l.blocker?(p(),v("div",{key:0,id:"blocker",onClick:i,style:oe({zIndex:e.zIndex-1})},null,4)):A("",!0),a("div",{id:"floatingMenu",style:oe({left:e.position.x+"px",top:e.position.y+"px",visibility:s.value?"visible":"hidden",transform:e.middleTop?"translate(-50%, 0)":"",zIndex:e.zIndex})},[e.arrow?(p(),v("div",gn)):A("",!0),(p(!0),v(H,null,te(e.menuItems,(d,g)=>(p(),v("div",{class:me(`non-selectable floatingMenuItem${g!==e.menuItems.length-1?"":" floatingMenuItemLast"}`),tabindex:"0",onKeydown:Ye(u=>{d.action(),i()},["enter"]),onClick:u=>{d.action(),i()}},I(d.name),43,_n))),256))],4)],64))}}),wn=E(yn,[["__scopeId","data-v-c6b659c7"]]),Ue=M({name:"file-select-button",props:{asLink:{type:Boolean,default:!1},text:{type:String,default:"Upload"},action:{type:Function,required:!0},style:{type:Object,default:()=>({})}},setup(o,t){const e=w(null),n=i=>{const l=i.target;if(l.files&&l.files.length>0){const r=l.files[0];o.action(r)}};function s(){e.value.click()}return t.expose({click:s}),()=>$(H,null,[$("input",{type:"file",id:"upload-file",onChange:n,ref:e,style:{display:"none"}},null),o.asLink?$("a",{class:"btn upload-btn",rel:"noopener noreferrer",onClick:()=>e.value.click(),style:o.style},[o.text]):$("button",{type:"button",class:"btn upload-btn",onClick:()=>e.value.click(),style:o.style},[o.text])])}}),ot=M({name:"editable-paragraph",props:{contentEditable:{type:Boolean,default:!0},style:{type:Object,default:()=>({})}},emits:["finish","change"],setup(o,t){const e=w(null),n=m=>{e.value.innerText=m},s=m=>{e.value.contentEditable=m.toString()},i=m=>e.value.contains(m),l=function(){return document.activeElement===e.value},r=U({get(){return e.value.innerText},set(m){e.value.innerText=m}});t.expose({setText:n,setEditable:s,contains:i,innerText:r,hasFocus:l});const d=()=>{t.emit("change",e.value.innerText)},g=()=>{t.emit("finish",e.value.innerText)},u=m=>{if(m.key==="Enter")if(m.ctrlKey||m.metaKey){m.preventDefault();const f=window.getSelection(),h=f==null?void 0:f.getRangeAt(0);if(h){const k=document.createElement("br");h.insertNode(k),h.setStartAfter(k),h.setEndAfter(k),f==null||f.removeAllRanges(),f==null||f.addRange(h)}}else e.value.blur()},c=m=>{var h;m.preventDefault();const f=(h=m.clipboardData)==null?void 0:h.getData("text/plain");document.execCommand("insertText",!1,f)};return()=>$("p",{class:"editable-paragraph",contenteditable:o.contentEditable,ref:e,onInput:d,onBlur:g,onKeydown:u,style:o.style,onPaste:c},[t.slots.default&&t.slots.default()])}}),Ct=M({name:"menu-attached",props:{menuItems:{type:Array,required:!0}},setup(o,t){const e=w(!1),n=w(null),s=w({x:0,y:0});return ne(e,i=>{if(i){const l=n.value.getBoundingClientRect();s.value={x:l.left+l.width/2,y:l.bottom+5}}else s.value={x:0,y:0}}),()=>$("div",null,[$("div",{ref:n,onClick:()=>e.value=!e.value,onKeydown:i=>{i.key==="Enter"&&(i.preventDefault(),e.value=!e.value)}},[t.slots.default&&t.slots.default()]),$(wn,{show:e.value,"onUpdate:show":i=>e.value=i,menuItems:o.menuItems,position:s.value,middleTop:!0,arrow:!0},null)])}}),bn=M({name:"CircularImage",props:{href:{type:String,required:!0},size:{type:String,required:!0},alt:{type:String,default:""}},emits:["click"],setup(o,t){const e={width:`${o.size}`,height:`${o.size}`,borderRadius:"50%",border:"1px solid var(--color-border)",overflow:"hidden"};return()=>$("img",{src:o.href,alt:o.alt,style:e,onClick:()=>t.emit("click")},null)}});function mt(o){function t(u,c){var f;const m=(f=u.split(".").pop())==null?void 0:f.toLowerCase();for(const h of c)if(m===h)return!0;return!1}function e(u){return!!(u.type.startsWith("image/")||t(u.name,["jpg","jpeg","png","gif","bmp","svg","webp"]))}function n(u){return!!(u.type==="application/pdf"||t(u.name,["pdf"]))}function s(u){return!!(u.type==="text/html"||t(u.name,["html"]))}function i(u){return!!(u.type==="text/plain"||t(u.name,["txt","bib","bibtex","nbib","enw","ris"]))}function l(u){return!!(n(u)||s(u)||e(u))}const r=[],d=[],g=[];for(let u=0;u<o.length;u++)i(o[u])?r.push(o[u]):l(o[u])?d.push(o[u]):g.push(o[u]);return{citation:r,document:d,unknown:g}}const we=o=>(se("data-v-833fe5ec"),o=o(),ie(),o),kn={style:{display:"flex",flexDirection:"column",gap:"10px",padding:"10px",width:"100%",height:"100%"}},$n={style:{margin:"10px"}},Sn={style:{display:"flex",flexDirection:"row",gap:"10px",border:"1px solid var(--color-border)"}},xn=we(()=>a("legend",null,"Source",-1)),Dn={class:"bibsource-container"},Cn=we(()=>a("legend",{for:"bibsource-arxiv"},"arxiv",-1)),Pn={class:"bibsource-container"},In=we(()=>a("legend",{for:"bibsource-doi"},"doi",-1)),Tn={class:"bibsource-container"},Un=we(()=>a("legend",{for:"bibsource-webpage"},"webpage",-1)),Rn=["placeholder"],An={key:0},Bn={id:"inputDiv"},Mn={id:"inputLeft"},Ln={id:"bibtexArea"},qn={class:"horizontal"},En=we(()=>a("label",{for:"bibtex"},"Bibtex",-1)),zn={id:"bibtexSource",class:"horizontal"},Fn={id:"urlArea"},On=we(()=>a("label",{for:"url"},"URL: ",-1)),Hn={id:"inputRight"},Nn={key:0,style:{display:"flex","justify-content":"center","align-items":"center","padding-inline":"15px"}},Wn=we(()=>a("div",{class:"hr"},null,-1)),jn={style:{"margin-top":"5px","text-wrap":"nowrap","white-space":"nowrap","margin-inline":"5px"}},Vn=we(()=>a("div",{class:"hr"},null,-1)),Kn={key:1},Zn=we(()=>a("div",{style:{display:"flex","flex-direction":"column","align-items":"center","justify-content":"center",height:"430px",width:"590px",border:"5px dashed var(--color-border)","border-radius":"10px",margin:"15px"}},[a("div",{style:{"font-size":"20px","font-weight":"bold","margin-bottom":"10px"}},"Drop to insert citation or document"),a("div",{style:{"font-size":"12px",opacity:"0.5"}},"(only support bibtex/enw/nbib)")],-1)),Gn=[Zn],Jn=M({__name:"DataEditor",setup(o,{expose:t}){const e=N(),n=ee().conn,s=w(!1),i=w(null),l=w(""),r=w(""),d=w(null),g=w({all:new O,checked:new O,unfolded:new O});function u(){const F={uuid:i.value?i.value.summary.uuid:null,bibtex:l.value,tags:Array.from(g.value.checked),url:r.value,file:d.value};f(),e.showPopup("Saving entry...","info"),n.updateDatapoint(F.uuid,{bibtex:F.bibtex,tags:F.tags,url:F.url}).then(R=>{F.file?(e.showPopup("Uploading document...","info"),n.uploadDocument(R.uuid,F.file).then(L=>{e.showPopup("Saved","success")},()=>e.showPopup("Failed to upload document","error"))):e.showPopup("Saved","success")},()=>e.showPopup("Failed to save","error"))}const c=w("");function m({datapoint:F=null,bibtex:R=null,url:L=null,tags:re=null}){e.dataEditorOpened||(e.dataEditorOpened=!0,F!==null&&(i.value=F,l.value=F.summary.bibtex,r.value=F.summary.url,re===null&&(re=new O(F.summary.tags))),R!==null&&(l.value=R),L!==null&&(r.value=L),re!==null?(Array.isArray(re)&&(re=new O(re)),g.value={all:new O(e.tagStatus.all).union(re),checked:re,unfolded:re.allParents()}):g.value={all:new O(e.tagStatus.all),checked:new O(e.tagStatus.checked),unfolded:new O(e.tagStatus.unfolded)},s.value=!0)}function f(){s.value=!1,i.value=null,l.value="",r.value="",g.value={all:new O(e.tagStatus.all),checked:new O(e.tagStatus.checked),unfolded:new O(e.tagStatus.unfolded)},d.value=null,c.value="",z.value=!1,e.dataEditorOpened=!1}function h(){return s.value}function k(F){if(i.value)return e.showPopup("Document can only be added to new entry","error"),!1;if(!mt([F]).document)return e.showPopup("Unsupported file","error"),!1;if(d.value=F,console.log("file selected"),l.value.trim().length===0){console.log("try to extract bibtex from file");const R=F.name,L=F.lastModified;let re=_.value;switch(R.split(".").pop()){case"pdf":re="article";break;case"html":re="online";break}const Oe=ft(re,{title:R,year:new Date(L).getFullYear()});l.value=Oe}return!0}function C(F){let R=!1;if(!F||F.length===0)return R;const L=mt(F);if((L.citation.length>1||L.document.length>1)&&e.showPopup("Only one citation and one document are allowed","error"),L.citation.length==0&&L.document.length==0&&(console.log("[Error] Got files: ",F),e.showPopup("Unsupported file type","error")),L.citation.length>0){const re=L.citation[0];if(re.size<64*1024){const Oe=new FileReader;Oe.onload=Bt=>{var rt;const Mt=(rt=Bt.target)==null?void 0:rt.result;l.value=Mt},Oe.readAsText(re),R=!0}else e.showPopup("Text file too large","error")}return L.document.length>0&&(R=k(L.document[0])),R}t({show:m,close:f,isShown:h,loadFiles:C});const D=w(!1),_=w("article"),P=U(()=>ft(_.value)),S=w(!1),y=w("arxiv"),b={arxiv:F=>Ze.fromArxiv(F),doi:F=>Ze.fromDoi(F),webpage:F=>Ze.fromWebpage(F)},T={arxiv:"e.g. 2106.00001",doi:"e.g. 10.1145/344779.344937",webpage:"e.g. https://news.mit.edu/2021/xxx"},Z=w("");function ue(F){e.showPopup("Fetching from BibTeX source...","info"),S.value=!1,Z.value="",b[y.value](F).then(R=>{e.showPopup("Obtained bibtex from source","success"),l.value=R.bibtex,r.value=R.url},()=>{e.showPopup("Failed to fetch from source","error")})}const z=w(!1),j=w(null),K=F=>{F.preventDefault(),z.value=!0},G=F=>{F.preventDefault(),z.value=!1},_e=F=>{var L;F.preventDefault();const R=(L=F.dataTransfer)==null?void 0:L.files;R&&C(R),z.value=!1};return(F,R)=>(p(),v(H,null,[$(xe,{show:D.value,"onUpdate:show":R[4]||(R[4]=L=>D.value=L),onOnAccept:R[5]||(R[5]=()=>{l.value=P.value,D.value=!1}),onOnCancel:R[6]||(R[6]=L=>D.value=!1),"z-index":102,title:"Select template"},{default:B(()=>[a("div",kn,[$(Se,{onOnCheck:R[0]||(R[0]=L=>_.value="article"),checked:_.value=="article"},{default:B(()=>[q("Article")]),_:1},8,["checked"]),$(Se,{onOnCheck:R[1]||(R[1]=L=>_.value="inproceedings"),checked:_.value=="inproceedings"},{default:B(()=>[q("Inproceedings")]),_:1},8,["checked"]),$(Se,{onOnCheck:R[2]||(R[2]=L=>_.value="webpage"),checked:_.value=="webpage"},{default:B(()=>[q("Webpage")]),_:1},8,["checked"]),$(Se,{onOnCheck:R[3]||(R[3]=L=>_.value="misc"),checked:_.value=="misc"},{default:B(()=>[q("Misc")]),_:1},8,["checked"])])]),_:1},8,["show"]),$(xe,{show:S.value,"onUpdate:show":R[11]||(R[11]=L=>S.value=L),onOnCancel:R[12]||(R[12]=L=>S.value=!1),onOnAccept:R[13]||(R[13]=()=>{ue(Z.value)}),"z-index":102,title:"Source input"},{default:B(()=>[a("div",$n,[a("fieldset",Sn,[xn,a("div",Dn,[V(a("input",{type:"radio",id:"bibsource-arxiv",name:"bibSource",value:"arxiv","onUpdate:modelValue":R[7]||(R[7]=L=>y.value=L)},null,512),[[Ve,y.value]]),Cn]),a("div",Pn,[V(a("input",{type:"radio",id:"bibsource-doi",name:"bibSource",value:"doi","onUpdate:modelValue":R[8]||(R[8]=L=>y.value=L)},null,512),[[Ve,y.value]]),In]),a("div",Tn,[V(a("input",{type:"radio",id:"bibsource-webpage",name:"bibSource",value:"webpage","onUpdate:modelValue":R[9]||(R[9]=L=>y.value=L)},null,512),[[Ve,y.value]]),Un])]),V(a("input",{type:"text","onUpdate:modelValue":R[10]||(R[10]=L=>Z.value=L),placeholder:T[y.value],style:{width:"100%",marginTop:"10px"}},null,8,Rn),[[X,Z.value]])])]),_:1},8,["show"]),$(xe,{show:s.value,"onUpdate:show":R[21]||(R[21]=L=>s.value=L),title:i.value?i.value.authorAbbr():"new","show-cancel":!1,onOnAccept:u,onOnCance:f,onOnClose:f},{default:B(()=>[a("div",{id:"data-editor-main",ref_key:"dataEditorComponent",ref:j,onDragover:K,onDrop:_e,onDragend:G},[z.value?(p(),v("div",Kn,Gn)):(p(),v("div",An,[a("div",Bn,[a("div",Mn,[a("div",Ln,[a("div",qn,[En,a("div",zn,[a("div",{class:"button",onClick:R[14]||(R[14]=L=>D.value=!0)},"template"),a("div",{class:"button",onClick:R[15]||(R[15]=L=>S.value=!0)},"from-source")])]),V(a("textarea",{id:"bibtex","onUpdate:modelValue":R[16]||(R[16]=L=>l.value=L),placeholder:"bibtex / enw / nbib",class:"scrollable wrapword",style:{resize:"none"}},null,512),[[X,l.value]])]),a("div",Fn,[On,V(a("input",{id:"url","onUpdate:modelValue":R[17]||(R[17]=L=>r.value=L),placeholder:"url",type:"text"},null,512),[[X,r.value]])])]),a("div",Hn,[$(fn,{"tag-status":g.value,"onUpdate:tagStatus":R[18]||(R[18]=L=>g.value=L),"tag-input-value":c.value,"onUpdate:tagInputValue":R[19]||(R[19]=L=>c.value=L)},null,8,["tag-status","tag-input-value"])])]),i.value===null?(p(),v("div",Nn,[Wn,a("div",jn,[q(I(d.value?d.value.name:"")+" ",1),d.value?(p(),v("a",{key:1,onClick:R[20]||(R[20]=L=>d.value=null),style:{cursor:"pointer",padding:"3px","border-radius":"5px"}}," (Remove) ")):(p(),Y(x(Ue),{key:0,text:"Select document",action:k,"as-link":!0,style:{cursor:"pointer",padding:"3px","border-radius":"5px"}}))]),Vn])):A("",!0)]))],544)]),_:1},8,["show","title"])],64))}}),st=E(Jn,[["__scopeId","data-v-833fe5ec"]]),De=o=>(se("data-v-9b2c5a9d"),o=o(),ie(),o),Qn={class:"layout"},Yn={id:"info"},Xn=De(()=>a("td",null,[a("b",null,"Authors")],-1)),eo={id:"authorTD"},to=["onClick"],ao={key:0,id:"otherPubTR"},no={colspan:"2"},oo={id:"authorPapers"},so=De(()=>a("td",null,[a("b",null,"Publication")],-1)),io=De(()=>a("td",null,[a("b",null,"Year")],-1)),lo=De(()=>a("td",null,[a("b",null,"Tags")],-1)),ro=De(()=>a("td",null,[a("b",null,"Type")],-1)),uo={id:"shortSummary"},co={id:"shortSummaryTitle"},ho=De(()=>a("b",null,"AI Summary",-1)),po=De(()=>a("summary",null,[a("b",null,"Related Articles")],-1)),fo=M({__name:"DataSummary",props:{datapoint:{}},setup(o){const t=o,e=J(),n=w([]),s=w([]),i=U(()=>Object.fromEntries(n.value.map((_,P)=>[_.summary.uuid,s.value[P].toPrecision(3)]))),l=ee().conn,r=w(null),d=w("");function g(_=!1){d.value="Loading...";let P="";u(),l.reqAISummary(t.datapoint.summary.uuid,S=>{S.replace(/\\n/g,"<br>"),P+=S,d.value=P},()=>{u(),console.log("finished")},_)}async function u(){let _=null;if(t.datapoint.supp.abstract?_=t.datapoint.supp.abstract:_=await t.datapoint.fetchAbstract(),_||(d.value&&!d.value.startsWith("Error")&&!d.value.startsWith("Loading")?_=d.value:_=t.datapoint.title),_=="")return;const P=await l.query({searchBy:"feature",searchContent:_,maxResults:9}),S=await e.database.agetMany(P.uids,!1),y=new Array;for(const b of S){const T=P.uids.indexOf(b.summary.uuid);if(T>=0)y.push(P.scores[T]);else throw new Error("Related article not found in search result, IMPOSSIBLE")}[n.value,s.value]=St(S,y,!1),n.value&&n.value[0].summary.uuid==t.datapoint.summary.uuid&&(n.value.shift(),s.value.shift())}const c=w(""),m=w([]),f=w({});async function h(){const _=t.datapoint.authors,P=await Promise.all(_.map(S=>e.database.agetByAuthor(S)));f.value={};for(let S=0;S<_.length;S++)f.value[_[S]]=P[S]}const k=U(()=>{const _={};for(const P in f.value)f.value[P]&&f.value[P].length>1?_[P]=f.value[P].length-1:_[P]=null;return _});function C(_){m.value=f.value[_],m.value||(m.value=[]),m.value=m.value.filter(P=>P.summary.uuid!=t.datapoint.summary.uuid),c.value===_?c.value="":c.value=_}he(()=>{h(),g(!1)});const D=U(()=>{const b=(Math.min(Math.max(window.innerWidth-600,0)/1800,1)-.5)*Math.PI,T=(Math.sin(b)+1)*.5*1200,Z=Math.round(T);return`${window.innerWidth-Z}px`});return(_,P)=>(p(),v("div",{id:"main",style:oe({width:D.value})},[a("h2",null,I(_.datapoint.summary.title),1),a("div",Qn,[a("div",Yn,[a("table",null,[a("tr",null,[Xn,a("td",eo,[(p(!0),v(H,null,te(_.datapoint.summary.authors,S=>(p(),v("div",null,[a("span",null,I(S),1),k.value[S]!==null?(p(),v("a",{key:0,onClick:()=>C(S)}," ("+I(k.value[S])+") ",9,to)):A("",!0)]))),256))])]),$(Me,{name:"slideDown"},{default:B(()=>[c.value?(p(),v("tr",ao,[a("td",no,[a("b",null,I(`Other publications from ${c.value.toUpperCase()}:`),1),a("div",oo,[$(Ie,{uids:m.value.map(S=>S.summary.uuid)},null,8,["uids"])])])])):A("",!0)]),_:1}),a("tr",null,[so,a("td",null,I(_.datapoint.summary.publication),1)]),a("tr",null,[io,a("td",null,I(_.datapoint.summary.year),1)]),a("tr",null,[lo,a("td",null,I(_.datapoint.summary.tags.toString()),1)]),a("tr",null,[ro,a("td",null,I(_.datapoint.fileType()+`${_.datapoint.summary.has_file?" ("+_.datapoint.summary.doc_size.toString()+"M)":""}`),1)])])]),a("div",uo,[a("div",co,[ho,a("div",{class:"button",onClick:P[0]||(P[0]=S=>g(!0))},"↻")]),a("p",{id:"aiSummary",ref_key:"aiSummaryParagraph",ref:r},I(d.value),513)]),a("details",null,[po,$(Ie,{uids:n.value.map(S=>S.summary.uuid),scores:i.value},null,8,["uids","scores"])])])],4))}}),mo=E(fo,[["__scopeId","data-v-9b2c5a9d"]]),vo=o=>(se("data-v-564cf261"),o=o(),ie(),o),go={id:"citations",style:{textAlign:"left"}},_o=["onClick"],yo={class:"citation-type",style:{marginLeft:"10px",marginRight:"10px",borderRadius:"5px",backgroundColor:"var(--color-background-mute)",padding:"3px",fontWeight:"bold",display:"flex",alignItems:"center",justifyContent:"center"}},wo={class:"citation-text",style:{overflowX:"hidden",whiteSpace:"nowrap"}},bo={key:0},ko={key:0,id:"moreMain"},$o={class:"row",id:"buttons"},So=["href"],xo={key:0,class:"row",id:"actions"},Do={id:"abstract"},Co=vo(()=>a("summary",null,"Abstract",-1)),Po=M({__name:"FileRowMore",props:{datapoint:{},show:{type:Boolean}},setup(o,{expose:t}){const e=o,n=N(),s=w(null),i=async _=>{_.target instanceof HTMLDetailsElement&&!_.target.open||(s.value.setEditable(!1),s.value.innerText="Loading...",e.datapoint.fetchAbstract().then(P=>{s.value.innerText=P,s.value.setEditable(!0)},()=>{s.value.innerText="Failed to load abstract."}))},l=async _=>{_&&(await e.datapoint.uploadAbstract(_),await e.datapoint.update())},r=w(!1);function d(_,P){return[_,`${P.length>80?P.slice(0,80)+"...":P}`,P]}function g(_){Xe(_).then(P=>{P?n.showPopup("Copied to clipboard.","info"):n.showPopup("Failed to copy to clipboard.","error")})}const u=w(!1);function c(_){n.showPopup("uploading..."),e.datapoint.uploadDocument(_).then(P=>{e.datapoint.update(P),n.showPopup("Document uploaded","success")},()=>n.showPopup("Failed to upload document","error"))}function m(){window.confirm(`Free document? 
${e.datapoint.toString()}`)&&e.datapoint.freeDocument().then(_=>{e.datapoint.update(_),n.showPopup("Document deleted","info")},()=>n.showPopup("Failed to free document","error"))}function f(){const _=e.datapoint.summary.uuid;window.confirm(`[IMPORTANT] Delete? 
${e.datapoint.toString()}`)&&ee().conn.deleteDatapoint(_).then(P=>{n.showPopup("Deleted")})}const h=w(null);function k(){h.value.show({datapoint:e.datapoint})}const C=U(()=>s.value===null?!h.value.isShown():!h.value.isShown()&&!s.value.hasFocus());t({editThisDatapoint:k,deleteThisDatapoint:f,shouldEnableEditDatapoint:C});const D=w(!1);return(_,P)=>{const S=Je("router-link");return p(),v(H,null,[$(ke,{show:D.value,"onUpdate:show":P[0]||(P[0]=y=>D.value=y),title:"Summary"},{default:B(()=>[$(mo,{datapoint:_.datapoint},null,8,["datapoint"])]),_:1},8,["show"]),$(ke,{show:r.value,"onUpdate:show":P[1]||(P[1]=y=>r.value=y),title:"Citations"},{default:B(()=>[(p(!0),v(H,null,te([d("Title",`${_.datapoint.summary.title}`),d("Author-year",`${_.datapoint.authorAbbr()} (${_.datapoint.summary.year})`),d("APA",`${_.datapoint.authorAbbr()} (${_.datapoint.summary.year}). ${_.datapoint.summary.title}. ${_.datapoint.summary.publication}.`),d("Bibtex",_.datapoint.summary.bibtex),d("DocURL",_.datapoint.getRawDocURL()),d("Markdown",`[${_.datapoint.authorAbbr()} (${_.datapoint.summary.year})](${_.datapoint.getRawDocURL()})`),d("UUID",`${_.datapoint.summary.uuid}`)],(y,b)=>(p(),v("div",go,[a("div",{onClick:()=>{g(y[2]),r.value=!1},style:{cursor:"pointer",display:"flex",flexDirection:"row"}},[a("div",yo,I(y[0]),1),a("p",wo,I(y[1]),1)],8,_o),b!==6?(p(),v("hr",bo)):A("",!0)]))),256))]),_:1},8,["show"]),$(st,{ref_key:"dataEditor",ref:h},null,512),$(Me,{name:"expand-transition"},{default:B(()=>[_.show?(p(),v("div",ko,[a("div",$o,[$(S,{to:`/reader/${e.datapoint.summary.uuid}`},{default:B(()=>[q("Reader")]),_:1},8,["to"]),_.datapoint.url?(p(),v("a",{key:0,href:_.datapoint.url,target:"_blank"},"Link",8,So)):A("",!0),a("a",{rel:"noopener noreferrer",onClick:P[2]||(P[2]=()=>D.value=!D.value)},"Summary"),a("a",{rel:"noopener noreferrer",onClick:P[3]||(P[3]=()=>r.value=!r.value)},"Cite"),a("a",{rel:"noopener noreferrer",onClick:P[4]||(P[4]=()=>u.value=!u.value)},"Actions")]),$(Me,{name:"actions"},{default:B(()=>[u.value?(p(),v("div",xo,[a("a",{rel:"noopener noreferrer",class:"btn",onClick:k},"Edit"),_.datapoint.summary.has_file?(p(),v("a",{key:1,rel:"noopener noreferrer",onClick:m,class:"danger btn"},"Free document")):(p(),Y(x(Ue),{key:0,action:y=>c(y),text:"Upload document","as-link":!0},null,8,["action"])),a("a",{rel:"noopener noreferrer",onClick:f,class:"danger btn"},"Delete")])):A("",!0)]),_:1}),a("div",Do,[a("details",{onToggle:i},[Co,$(x(ot),{id:"abstractParagraph",ref_key:"abstractParagraph",ref:s,style:{minHeight:"20px"},onFinish:P[5]||(P[5]=y=>l(y))},null,512)],32)])])):A("",!0)]),_:1})],64)}}}),Io=E(Po,[["__scopeId","data-v-564cf261"]]),To="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20height='24'%20viewBox='0%20-960%20960%20960'%20width='24'%3e%3cpath%20d='M200-120v-640q0-33%2023.5-56.5T280-840h400q33%200%2056.5%2023.5T760-760v640L480-240%20200-120Zm80-122%20200-86%20200%2086v-518H280v518Zm0-518h400-400Z'/%3e%3c/svg%3e",Uo="data:image/svg+xml,%3c?xml%20version='1.0'?%3e%3csvg%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%2024%2024'%20width='24px'%20height='24px'%3e%3cpath%20d='M%206%202%20C%205.861875%202%205.7278809%202.0143848%205.5976562%202.0410156%20C%204.686084%202.2274316%204%203.033125%204%204%20L%204%2022%20L%2012%2019%20L%2020%2022%20L%2020%204%20C%2020%203.8625%2019.985742%203.7275391%2019.958984%203.5976562%20C%2019.799199%202.8163086%2019.183691%202.2008008%2018.402344%202.0410156%20C%2018.272119%202.0143848%2018.138125%202%2018%202%20L%206%202%20z'/%3e%3c/svg%3e",Ro={class:"left",style:{display:"flex",flexDirection:"row",alignItems:"center",justifyContent:"flex-start",flexWrap:"nowrap",gap:"0.25rem"}},Ao={id:"marks"},Bo=["src"],Mo=["src"],Lo={class:"row text"},qo={style:{borderRadius:"10px",marginLeft:"5px",display:"flex",flexDirection:"column"}},Eo={id:"title",style:{display:"flex",fontSize:"1rem"}},zo={style:{"margin-right":"0.1rem","margin-top":"0.25rem","font-size":"0.75rem",opacity:"0.8",display:"inline-block",filter:"drop-shadow(1px 1px 0.5px var(--color-border))"}},Fo={style:{marginTop:"0px",padding:"0px",color:"var(--color-text-soft)",fontSize:"0.75rem"}},Oo={class:"right row"},Ho={id:"status-container"},No={class:"status"},Wo={key:0,src:Wa,alt:"",class:"icon"},jo={key:1,src:nt,alt:"",class:"icon placeholder"},Vo={class:"status"},Ko={key:0,src:ja,alt:"",class:"icon"},Zo={key:1,src:Va,alt:"",class:"icon"},Go={key:2,src:Ka,alt:"",class:"icon"},Jo={key:3,src:nt,alt:"",class:"icon placeholder"},Qo={class:"status"},Yo={key:0,src:Za,alt:"",class:"icon"},Xo={key:1,src:Ga,alt:"",class:"icon"},es={key:2,src:nt,alt:"",class:"icon placeholder"},ts=12,as=1,ns=M({__name:"FileRow",props:{datapoint:{},unfoldedIds:{},hoveredIds:{},line_number:{default:0}},emits:["update:unfoldedIds","update:hoveredIds"],setup(o,{emit:t}){const e=o,n=t,s=U({get:()=>e.unfoldedIds,set:y=>n("update:unfoldedIds",y)}),i=U({get:()=>e.hoveredIds,set:y=>n("update:hoveredIds",y)}),l=U(()=>s.value.includes(e.datapoint.summary.uuid)),r=w(null),d=w(null),g=w(null),u=w(null);let c=!1;function m(y){if(pt(y.target,r.value)){if(y.target.id=="authorYear"){const b=e.datapoint.getOpenDocURL();b!==""&&ra(b),c=!0}if(!pt(y.target,g.value)){if(c){c=!1;return}l.value?s.value=s.value.filter(b=>b!==e.datapoint.summary.uuid):s.value=[e.datapoint.summary.uuid]}}}const f=U(()=>{switch(e.datapoint.dtype){case"article":return"📄";case"book":return"📚";case"incollection":return"📖";case"inbook":return"📖";case"manual":return"📖";case"inproceedings":return"📜";case"conference":return"📜";case"misc":return"📎";case"thesis":return"🎓";case"phdthesis":return"🎓";case"mastersthesis":return"🎓";case"techreport":return"📑";case"unpublished":return"📝";case"webpage":return"🌐";case"online":return"🌐";default:return"❔"}}),h=U(()=>e.datapoint.yearAuthor("-")),k=w(!1);ne(k,y=>{y?i.value.push(e.datapoint.summary.uuid):i.value=i.value.filter(b=>b!==e.datapoint.summary.uuid)});const C=U(()=>k.value?"var(--color-background-theme-highlight)":s.value.includes(e.datapoint.summary.uuid)?"var(--color-background-theme)":e.line_number%2==0?"var(--color-background-ssoft)":"var(--color-background)"),D=U(()=>kt(e.datapoint.summary.bibtex));function _(y){const b=e.datapoint.summary.tags.slice();y?b.push("* Bookmark"):b.splice(b.indexOf("* Bookmark"),1);const T=e.datapoint.summary.uuid;ee().conn.updateDatapoint(T,{tags:b}).then(Z=>{e.datapoint.update(Z),N().updateShownData()},()=>N().showPopup("Failed to save","error")),c=!0}function P(){var y;return s.value.includes(e.datapoint.summary.uuid)&&k.value&&document.activeElement===document.body&&((y=u.value)==null?void 0:y.shouldEnableEditDatapoint)}function S(y){var b,T;y.code==="Space"&&P()&&((b=u.value)==null||b.editThisDatapoint(),y.preventDefault()),(y.code==="Delete"||y.code==="Backspace")&&P()&&((T=u.value)==null||T.deleteThisDatapoint(),y.preventDefault())}return ne(()=>s.value,y=>{y.includes(e.datapoint.summary.uuid)?window.addEventListener("keydown",S):window.removeEventListener("keydown",S)}),(y,b)=>(p(),v("div",{id:"fileRow",class:me(`${l.value?" unfolded":""}`),onClick:m,onMouseover:b[2]||(b[2]=T=>k.value=!0),onMouseleave:b[3]||(b[3]=T=>k.value=!1),ref_key:"dataCard",ref:r,style:oe({backgroundColor:C.value})},[a("div",{id:"init",class:"row",ref_key:"initDiv",ref:d},[a("div",Ro,[a("div",Ao,[y.datapoint.summary.tags.includes("* Bookmark")?(p(),v("img",{key:0,src:x(Uo),alt:"",class:"icon redIcon",onClick:b[0]||(b[0]=()=>_(!1)),style:{height:"1rem"}},null,8,Bo)):(p(),v("img",{key:1,src:x(To),alt:"",class:"icon",onClick:b[1]||(b[1]=()=>_(!0)),style:{height:"1rem"}},null,8,Mo))]),a("div",Lo,[a("div",qo,[a("div",Eo,[a("p",null,[a("span",zo,I(f.value),1),q(" "+I(y.datapoint.summary.title),1)])]),a("div",Fo,I(h.value+", "+y.datapoint.publication+(D.value?". "+D.value:"")),1)]),fe(y.$slots,"default",{},void 0)])]),a("div",Oo,[a("div",Ho,[a("div",No,[y.datapoint.summary.has_abstract?(p(),v("img",Wo)):(p(),v("img",jo))]),a("div",Vo,[y.datapoint.fileType()=="pdf"?(p(),v("img",Ko)):y.datapoint.fileType()=="html"?(p(),v("img",Zo)):y.datapoint.fileType()=="url"?(p(),v("img",Go)):(p(),v("img",Jo))]),a("div",Qo,[y.datapoint.summary.note_linecount>ts?(p(),v("img",Yo)):y.datapoint.summary.note_linecount>as?(p(),v("img",Xo)):(p(),v("img",es))])])])],512),a("div",{id:"more",ref_key:"moreDiv",ref:g},[$(Io,{datapoint:y.datapoint,show:l.value,ref_key:"moreComponent",ref:u},null,8,["datapoint","show"])],512)],38))}}),os=E(ns,[["__scopeId","data-v-f2b3f69e"]]),ss={id:"datacard-container-main"},is={key:0,class:"relatedArticleScore"},ls={key:1,id:"datacard-container-footer"},rs=["disabled"],us={style:{"margin-left":"10px","margin-right":"10px",display:"flex",gap:"5px"}},cs=["disabled"],ds=M({__name:"FileRowContainer",props:{uids:{},unfoldedIds:{default:null},hoveredIds:{default:null},scores:{default:null},compact:{type:Boolean,default:!0}},emits:["update:datapoints","update:unfoldedIds","update:hoveredIds"],setup(o,{emit:t}){const e=o,n=t,s=w([]),i=U({get:()=>e.unfoldedIds==null?s.value:e.unfoldedIds,set:S=>{e.unfoldedIds==null?s.value=S:n("update:unfoldedIds",S)}}),l=w([]),r=U({get:()=>e.hoveredIds==null?l.value:e.hoveredIds,set:S=>{e.hoveredIds==null?l.value=S:n("update:hoveredIds",S)}}),d=w(null),g=w(null),u=w(0),c=W(),m=w([]),f=w([]),h=w(!1);function k(){console.debug("updateDisplayDataUIDs");const S=u.value*c.numItemsPerPage,y=Math.min(S+c.numItemsPerPage,e.uids.length),b=e.uids.slice(S,y);m.value=b}ne([()=>e.uids,()=>u.value,()=>c.numItemsPerPage],()=>{e.uids.length<u.value*c.numItemsPerPage&&(u.value=0),k()},{immediate:!0});function C(){let S=!0;(async()=>(await new Promise(y=>setTimeout(y,500)),S&&(h.value=!1)))(),console.debug("updateDisplayDataPoints"),J().database.agetMany(m.value).then(y=>{f.value=y,S=!1,h.value=!0})}ne(m,()=>{C()},{immediate:!0});const D=()=>{var S;u.value>=Math.ceil(e.uids.length/c.numItemsPerPage)-1||(u.value++,g.value.setText(""+(u.value+1)),(S=d.value)==null||S.scrollTo({top:0,behavior:"auto"}))},_=()=>{var S;u.value!=0&&(u.value--,g.value.setText(""+(u.value+1)),(S=d.value)==null||S.scrollTo({top:0,behavior:"auto"}))},P=S=>{const y=S.target;y.scrollTop==0||y.scrollTop+y.clientHeight>=y.scrollHeight};return(S,y)=>(p(),v("div",ss,[a("div",{id:"datacard-container",style:oe({gap:S.compact?"0px":"5px"}),ref_key:"datacardContainer",ref:d,onScroll:P,class:"scrollable"},[(p(!0),v(H,null,te(f.value,(b,T)=>(p(),Y(os,{datapoint:b,"unfolded-ids":i.value,"onUpdate:unfoldedIds":y[0]||(y[0]=Z=>i.value=Z),"hovered-ids":r.value,"onUpdate:hoveredIds":y[1]||(y[1]=Z=>r.value=Z),line_number:T,compact:S.compact},{default:B(()=>[e.scores!=null&&e.scores[b.summary.uuid]!=null?(p(),v("label",is,I(e.scores[b.summary.uuid]),1)):A("",!0)]),_:2},1032,["datapoint","unfolded-ids","hovered-ids","line_number","compact"]))),256))],36),h.value?A("",!0):(p(),Y(Me,{key:0,name:"fade"},{default:B(()=>[$($t,{text:"Loading data..."})]),_:1})),S.uids.length>x(c).numItemsPerPage?(p(),v("div",ls,[a("button",{onClick:_,disabled:u.value==0},"Prev",8,rs),a("span",us,[$(x(ot),{ref_key:"pageIndicatorEditableParagrah",ref:g,onFinish:y[2]||(y[2]=b=>{parseInt(b)>0&&parseInt(b)<=Math.ceil(S.uids.length/x(c).numItemsPerPage)&&(u.value=parseInt(b)-1)})},{default:B(()=>[q(I(u.value+1),1)]),_:1},512),q(" / "),a("p",null,I(Math.ceil(S.uids.length/x(c).numItemsPerPage)),1)]),a("button",{onClick:D,disabled:u.value>=Math.ceil(S.uids.length/x(c).numItemsPerPage)-1},"Next",8,cs)])):A("",!0)]))}}),Ie=E(ds,[["__scopeId","data-v-a3cd371b"]]),hs=["title"],ps=["src","alt"],fs={for:"icon",class:"iconLabel non-selectable"},ms=M({__name:"ToolbarIcon",props:{iconSrc:{},labelText:{},title:{default:""},shortcut:{default:null}},emits:["onClick","click"],setup(o,{expose:t,emit:e}){const n=o,s=U(()=>n.title+(n.shortcut===null?"":` (${n.shortcut})`)),i=e,l=w(null);t({getBoundingClientRect:()=>{var c;return(c=l.value)==null?void 0:c.getBoundingClientRect()}});function d(){i("onClick"),i("click")}function g(c){if(c===null)return null;const m=c.toLowerCase().split("+");return f=>{m.includes("ctrl")&&!f.ctrlKey||m.includes("alt")&&!f.altKey||m.includes("shift")&&!f.shiftKey||m.includes("meta")&&!f.metaKey||m.includes(f.key.toLowerCase())&&(console.log("shortcut triggered: "+c+" | "+n.labelText),d(),f.preventDefault())}}const u=g(n.shortcut);return Qe(()=>{u!==null&&window.addEventListener("keydown",u)}),gt(()=>{u!==null&&window.removeEventListener("keydown",u)}),(c,m)=>(p(),v("span",{class:"hoverMaxout105 button non-selecable",onClick:d,onKeydown:Ye(d,["enter"]),tabindex:0,title:`${s.value}`,ref_key:"button",ref:l},[a("img",{id:"icon",class:"icon",src:c.iconSrc,alt:c.labelText.toUpperCase()+"_ICON"},null,8,ps),a("label",fs,I(c.labelText),1)],40,hs))}}),be=E(ms,[["__scopeId","data-v-f0fccbdf"]]);let vs=window.location.protocol,Pt;Pt=`${vs}//${window.location.hostname}:${window.location.port}`;const gs=`${Pt}/documentation/`;console.log("production mode");function qe(){const o=W().backendPort,t=W().backendHost;return o?`${t}:${o}`:t}const _s={name:"Li, Mengxun",email:"mengxunli@whu.edu.cn"},Pe=["SweetiePie","CutiePatootie","CuddleBug","FluffyPaws","HoneyBee","SnuggleMuffin","SugarPlum","AngelFace","PawsomePuppy","TeddyBearHugs","PrettyKitty","LoveBug","BabyDoll","SunshineSmiles","FuzzyWuzzy","BumbleBee","CupcakeQueen","DoodleDaisy","PurrfectPaws","CuddlyKoala","SweetPea","BunnyHop","SparklePony","HappyPanda","DreamyDove","FluffyCloud","CherryBlossom","AngelicWhisper","SnickerDoodle","LuckyLadybug","BlossomButterfly","SugarCubes","CottonCandyDreams","HoneyBunches","FurryFriend","BabyBlueEyes","SweetCheeks","PawsitiveVibes","SnugglyBear","LovelyLlama","PurrfectlyAdorable","TwinkleToes","CuddleBunny","CookieCrumbs","SunnySmiles","FluffyKitten","DarlingDeer","ButterflyKisses","FuzzyWuzzyPanda","SweetDreamer","SillyGoose","DaisyDoodle","CupcakeCutie","BuzzyBee","SnoozySnail","CharmingChick","CandyCane","BerryBlossom","Dimples","CocoaCuddles","CheerfulCherub","PetalPaws","BubblyBumble","AngelWings","JollyJellybean","WhiskerWonder","SprinkleSmiles","GigglyGiraffe","DancingDaisy","SunnySideUp","SnugglySloth","CuteQuokka","PeachyPaws","BouncyBunny","DazzlingDimples","ChirpyChickadee","CandyHeart","CupcakeSprinkle","BuzzyButterfly","SnoozyPanda","CharmingCorgi","CottonCandyCloud","BerryBlush","DimpleDoll","CocoaCuddler","CheerfulChipmunk","PetalWhiskers","BubblyButterfly","AngelFeathers","JollyJumper","WhiskerWanderer","SprinkleSweets","GigglyGazelle","DancingDolphin","SunnySmiles","SnugglySquirrel","CuteKangaroo","PeachyPup","BouncyBear","DazzlingDarling","ChirpyCockatiel","CandyCharm","CupcakeDelight","BuzzyBee","SnoozySloth","CharmingChinchilla","CottonCandyDream","BerryBlossom","DimpleDaisy","CocoaCuddles","CheerfulCheek","PetalPurr","BubblyBumblebee","AngelWhispers","JollyJester","WhiskerWonder","SprinkleSunshine","GigglyGiraffe","DancingDandelion","SunnySideUp","SnugglySheep","CuteKoala","PeachyPanda","BouncyBunny","DazzlingDaisy","ChirpyChickadee","CandyCane","CupcakeCutie","BuzzyButterfly","SnoozySnail","CharmingCherub","CottonCandyCloud","BerryBlush","DimpleDoll","CocoaCuddler","CheerfulChipmunk","PetalWhiskers","BubblyButterfly","AngelFeathers","JollyJumper","WhiskerWanderer","SprinkleSweets","GigglyGazelle","DancingDolphin","SunnySmiles","SnugglySquirrel","CuteKangaroo","PeachyPup","BouncyBear","DazzlingDarling","ChirpyCockatiel","CandyCharm","CupcakeDelight","BuzzyBee","SnoozySloth","CharmingChinchilla","CottonCandyDream","BerryBlossom","DimpleDaisy","CocoaCuddles","CheerfulCheek","PetalPurr","BubblyBumblebee","AngelWhispers","JollyJester","WhiskerWonder","SprinkleSunshine","GigglyGiraffe","DancingDandelion","SunnySideUp","SnugglySheep","CuteKoala","PeachyPanda","BouncyBunny","DazzlingDaisy"],ys="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20height='24'%20viewBox='0%20-960%20960%20960'%20width='24'%3e%3cpath%20d='M200-120q-33%200-56.5-23.5T120-200v-560q0-33%2023.5-56.5T200-840h357l-80%2080H200v560h560v-278l80-80v358q0%2033-23.5%2056.5T760-120H200Zm280-360ZM360-360v-170l367-367q12-12%2027-18t30-6q16%200%2030.5%206t26.5%2018l56%2057q11%2012%2017%2026.5t6%2029.5q0%2015-5.5%2029.5T897-728L530-360H360Zm481-424-56-56%2056%2056ZM440-440h56l232-232-28-28-29-28-231%20231v57Zm260-260-29-28%2029%2028%2028%2028-28-28Z'/%3e%3c/svg%3e",ws={data(){return{usedSpace:0,totalSpace:1,unit:"MB"}},computed:{fillPercentage(){return`${Math.min(this.usedSpace/this.totalSpace,1)*100}%`}},mounted(){this.usedSpace=0,this.totalSpace=1,this.unit="MB",this.fetchDiskUsage()},methods:{fetchDiskUsage(){ee().conn.reqDatabaseUsage().then(o=>{const t=(o.disk_usage/1024/1024).toFixed(1),e=(o.disk_limit/1024/1024).toFixed(1);e>1024?(this.unit="GB",this.usedSpace=(t/1024).toFixed(1),this.totalSpace=(e/1024).toFixed(1)):(this.unit="MB",this.usedSpace=t,this.totalSpace=e)},()=>{console.log("failed to fetch disk usage")})}}},bs={id:"disk-usage-main"},ks={class:"disk-usage-bar"},$s={class:"disk-usage-text"};function Ss(o,t,e,n,s,i){return p(),v("div",bs,[a("div",ks,[a("div",{class:"disk-usage-fill",style:oe({width:i.fillPercentage})},null,4)]),a("div",$s," Space: "+I(s.usedSpace)+" / "+I(s.totalSpace)+" "+I(s.unit),1)])}const xs=E(ws,[["render",Ss],["__scopeId","data-v-35d9044c"]]),it=o=>(se("data-v-02517de9"),o=o(),ie(),o),Ds={id:"usercard-main"},Cs={id:"user-settings"},Ps=it(()=>a("hr",null,null,-1)),Is=it(()=>a("summary",null,"Change password",-1)),Ts={id:"password-container"},Us={id:"info"},Rs={id:"user-desc"},As={id:"name-edit"},Bs={id:"name"},Ms=["src"],Ls={key:0,class:"admin_hint"},qs=it(()=>a("div",{style:{height:"0.2rem"}},null,-1)),Es=M({__name:"UserCard",props:{userInfo:{},avatarSize:{default:"168px"}},emits:["update:userInfo"],setup(o,{emit:t}){const e=o,n=ee().conn,s=t,i=U(()=>J().user.id===e.userInfo.id),l=w(null),r=w(d());function d(){return`${qe()}/user-avatar/${e.userInfo.username}?t=${Date.now()}&size=256`}function g(C){if(!C.type.startsWith("image/")){N().showPopup("Please select an image file","error");return}N().showPopup("Uploading avatar..."),n.uploadUserAvatar(e.userInfo.username,C).then(D=>{r.value=d(),s("update:userInfo",D)},D=>{N().showPopup(D,"error")})}const u=w(!1),c=w(""),m=w(""),f=w(""),h=w("");function k(){if(c.value===""||c.value===e.userInfo.name||c.value!==e.userInfo.name&&n.updateUserNickname(c.value).then(C=>{s("update:userInfo",C),u.value=!1},C=>{N().showPopup(C,"error")}),f.value!==""||h.value!==""){if(f.value===""){N().showPopup("Please enter the new password","error");return}if(f.value!==h.value){N().showPopup("The new passwords do not match","error");return}if(W().encKey!==ve(e.userInfo.username+ve(m.value))){N().showPopup("The old password is incorrect","error");return}n.updateUserPassword(f.value).then(C=>{const D=ve(e.userInfo.username+ve(f.value));W().setEncKey(D),m.value="",f.value="",h.value="",u.value=!1},C=>{N().showPopup(C,"error")})}}return(C,D)=>(p(),v("div",Ds,[$(xe,{show:u.value,"onUpdate:show":D[4]||(D[4]=_=>u.value=_),title:"User settings",onOnCancel:D[5]||(D[5]=_=>u.value=!1),onOnAccept:k},{default:B(()=>[a("div",Cs,[a("b",null,I(e.userInfo.username),1),V(a("input",{type:"text","onUpdate:modelValue":D[0]||(D[0]=_=>c.value=_),placeholder:"Nickname",class:"input"},null,512),[[X,c.value]]),Ps,a("details",null,[Is,a("div",Ts,[V(a("input",{type:"password","onUpdate:modelValue":D[1]||(D[1]=_=>m.value=_),placeholder:"Old password",class:"input"},null,512),[[X,m.value]]),V(a("input",{type:"password","onUpdate:modelValue":D[2]||(D[2]=_=>f.value=_),placeholder:"New password",class:"input"},null,512),[[X,f.value]]),V(a("input",{type:"password","onUpdate:modelValue":D[3]||(D[3]=_=>h.value=_),placeholder:"Confirm new password",class:"input"},null,512),[[X,h.value]])])])])]),_:1},8,["show"]),a("div",Us,[a("div",{id:"avatar",style:oe(i.value?{cursor:"pointer",borderRadius:"50%"}:{})},[$(x(bn),{href:r.value,size:C.avatarSize,onClick:D[6]||(D[6]=_=>{var P;return i.value?(P=l.value)==null?void 0:P.click():()=>{}})},null,8,["href","size"]),$(x(Ue),{text:"Change avatar",action:g,ref_key:"avatarUploadBtn",ref:l,style:{display:"none"}},null,512)],4),a("div",Rs,[a("div",As,[a("h1",Bs,I(e.userInfo.name),1),i.value?(p(),v("img",{key:0,src:x(ys),alt:"",class:"icon",id:"edit-settings-icon",onClick:D[7]||(D[7]=_=>u.value=!0)},null,8,Ms)):A("",!0)]),a("p",{onClick:D[8]||(D[8]=_=>u.value=!0),style:{cursor:"pointer"}},[q(I(e.userInfo.username)+" ",1),e.userInfo.is_admin?(p(),v("label",Ls,"admin")):A("",!0)]),$(xs),qs])]),a("p",{id:"credential",onClick:D[9]||(D[9]=()=>{x(Xe)(x(W)().encKey).then(()=>{x(N)().showPopup("Secret copied to clipboard","info")})})},"-- Credential:"+I(x(W)().encKey.substring(0,12))+" --",1)]))}}),zs=E(Es,[["__scopeId","data-v-02517de9"]]),Fs={props:{title:{type:String,required:!0},description:{type:String,required:!0}}},Os={class:"settings-container"},Hs={class:"settings-header"},Ns={class:"widget"};function Ws(o,t,e,n,s,i){return p(),v("div",Os,[a("div",Hs,[a("label",null,I(e.title),1),a("p",null,I(e.description),1)]),a("div",Ns,[fe(o.$slots,"default",{},void 0)])])}const Ee=E(Fs,[["render",Ws],["__scopeId","data-v-f00f1fc8"]]),js=a("option",{value:"auto"},"Auto",-1),Vs=a("option",{value:"light"},"Light",-1),Ks=a("option",{value:"dark"},"Dark",-1),Zs=[js,Vs,Ks],Gs=M({__name:"ConfigTheme",setup(o){const t=w("auto");function e(){t.value=Q.getThemeMode()}function n(s){s==="auto"?(Q.clear(),Q.setDefaultDarkMode()):s==="light"?Q.setDarkMode(!1):s==="dark"&&Q.setDarkMode(!0),e()}return e(),(s,i)=>(p(),Y(Ee,{title:"Theme",description:"Change the theme of the app"},{default:B(()=>[V(a("select",{"onUpdate:modelValue":i[0]||(i[0]=l=>t.value=l),onChange:i[1]||(i[1]=l=>n(t.value)),style:{width:"80px",textAlign:"center",padding:"0.2rem",justifySelf:"flex-end"}},Zs,544),[[Le,t.value]])]),_:1}))}}),Js={class:"switch-toggle"},Qs=M({__name:"SwitchToggle",props:{checked:{type:Boolean}},emits:["update:checked"],setup(o,{emit:t}){const n=w(o.checked),s=t,i=w(null);return(l,r)=>(p(),v("div",Js,[V(a("input",{type:"checkbox",id:"toggle","onUpdate:modelValue":r[0]||(r[0]=d=>n.value=d),onChange:r[1]||(r[1]=()=>{s("update:checked",n.value)}),ref_key:"checkerRef",ref:i},null,544),[[Ot,n.value]]),a("label",{class:"switch",onClick:r[2]||(r[2]=d=>{var g;return(g=i.value)==null?void 0:g.click()})})]))}}),Te=E(Qs,[["__scopeId","data-v-58ea3d44"]]),Ys=M({__name:"ConfigShowTags",setup(o){const t=W(),e=U({get:()=>t.showTagPanel,set:n=>t.setShowTagPanel(n)});return(n,s)=>(p(),Y(Ee,{title:"Tag Panel",description:"Show tag panel at home page"},{default:B(()=>[$(Te,{checked:e.value,"onUpdate:checked":s[0]||(s[0]=i=>e.value=i)},null,8,["checked"])]),_:1}))}}),Xs=M({__name:"ConfigShowHomeInfoPanel",setup(o){const t=W(),e=U({get:()=>t.showHomeInfoPanel,set:n=>t.setShowHomeInfoPanel(n)});return(n,s)=>(p(),Y(Ee,{title:"Info Panel",description:"Show info panel at home page"},{default:B(()=>[$(Te,{checked:e.value,"onUpdate:checked":s[0]||(s[0]=i=>e.value=i)},null,8,["checked"])]),_:1}))}}),ei=M({__name:"ConfigShowScatterPlot",setup(o){const t=W(),e=U({get:()=>t.show3DScatterPlot,set:n=>t.setShow3DScatterPlot(n)});return(n,s)=>(p(),Y(Ee,{title:"Scatter Plot",description:"Show scatter plot at home page"},{default:B(()=>[$(Te,{checked:e.value,"onUpdate:checked":s[0]||(s[0]=i=>e.value=i)},null,8,["checked"])]),_:1}))}}),ti=["value"],ai=M({__name:"ConfigPageCapacity",setup(o){const t=U({get:()=>W().numItemsPerPage,set:n=>W().setNumItemsPerPage(n)}),e=[10,20,50,100,200,500];return(n,s)=>(p(),Y(Ee,{title:"Page Capacity",description:"Smaller number can improve performance"},{default:B(()=>[V(a("select",{"onUpdate:modelValue":s[0]||(s[0]=i=>t.value=i),style:{width:"80px",textAlign:"center",padding:"0.2rem",justifySelf:"flex-end"}},[(p(),v(H,null,te(e,i=>a("option",{value:i,key:i},I(i),9,ti)),64))],512),[[Le,t.value]])]),_:1}))}}),ni={style:{display:"flex",flexDirection:"column",gap:"0.5rem",padding:"0.5rem",width:"100%",height:"100%",overflowY:"auto"}},oi={style:{display:"flex",justifyContent:"center",alignItems:"center"}},si=a("hr",null,null,-1),ii=M({__name:"SettingsWindow",setup(o){const t=J().user;return(e,n)=>(p(),v("div",ni,[a("div",oi,[$(zs,{"user-info":x(t),"avatar-size":"120px"},null,8,["user-info"])]),si,$(Gs),$(ai),$(Ys),$(Xs),$(ei)]))}}),li="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20height='48'%20viewBox='0%2096%20960%20960'%20width='48'%3e%3cpath%20d='M180%20936q-24%200-42-18t-18-42V276q0-24%2018-42t42-18h291v60H180v600h291v60H180Zm486-185-43-43%20102-102H375v-60h348L621%20444l43-43%20176%20176-174%20174Z'/%3e%3c/svg%3e",ri="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20height='48'%20viewBox='0%20-960%20960%20960'%20width='48'%3e%3cpath%20d='m263-263%20290-143%20143-290-290%20143-143%20290Zm217-177q-17%200-28.5-11.5T440-480q0-17%2011.5-28.5T480-520q17%200%2028.5%2011.5T520-480q0%2017-11.5%2028.5T480-440Zm0%20360q-82%200-155-31.5t-127.5-86Q143-252%20111.5-325T80-480q0-83%2031.5-156t86-127Q252-817%20325-848.5T480-880q83%200%20156%2031.5T763-763q54%2054%2085.5%20127T880-480q0%2082-31.5%20155T763-197.5q-54%2054.5-127%2086T480-80Zm0-60q142%200%20241-99.5T820-480q0-142-99-241t-241-99q-141%200-240.5%2099T140-480q0%20141%2099.5%20240.5T480-140Zm0-340Z'/%3e%3c/svg%3e",ui="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20height='24'%20viewBox='0%20-960%20960%20960'%20width='24'%3e%3cpath%20d='M240-200h120v-240h240v240h120v-360L480-740%20240-560v360Zm-80%2080v-480l320-240%20320%20240v480H520v-240h-80v240H160Zm320-350Z'/%3e%3c/svg%3e",ci="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20height='24'%20viewBox='0%20-960%20960%20960'%20width='24'%3e%3cpath%20d='M440-120v-240h80v80h320v80H520v80h-80Zm-320-80v-80h240v80H120Zm160-160v-80H120v-80h160v-80h80v240h-80Zm160-80v-80h400v80H440Zm160-160v-240h80v80h160v80H680v80h-80Zm-480-80v-80h400v80H120Z'/%3e%3c/svg%3e",di={class:"button"},hi={key:0,id:"navigator"},pi={class:"nav-toggle"},fi=M({__name:"Toolbar",props:{returnHome:{type:Boolean,default:!0},compact:{type:Boolean,default:!0},showNavigator:{type:Boolean,default:!0}},setup(o){const t=o,e=ye();function n(){pa()}const s=w(null);let i=0;window.addEventListener("scroll",function(){const g=window.scrollY||document.documentElement.scrollTop;g<=i||i<10?s.value&&s.value.classList.contains("hidden")&&s.value.classList.remove("hidden"):s.value&&!s.value.classList.contains("hidden")&&s.value.classList.add("hidden"),i=g});const l=w(!1),r=yt(),d=U(()=>r.path.split("/")[1]);return(g,u)=>(p(),v(H,null,[$(ke,{show:l.value,"onUpdate:show":u[0]||(u[0]=c=>l.value=c),title:"Settings"},{default:B(()=>[$(ii)]),_:1},8,["show"]),a("div",{class:me(`main-toolbar ${t.compact?"compact-layout":"normal-layout shadow"}`),ref_key:"mainDiv",ref:s},[a("div",di,[t.returnHome?(p(),Y(be,{key:0,iconSrc:x(ui),labelText:"Home",shortcut:"ctrl+h",onOnClick:u[1]||(u[1]=()=>{x(e).push("/")}),title:"home"},null,8,["iconSrc"])):(p(),Y(be,{key:1,iconSrc:x(li),labelText:"Logout",shortcut:"ctrl+q",onOnClick:n,title:"logout"},null,8,["iconSrc"])),$(be,{iconSrc:x(ci),labelText:"Settings",shortcut:"ctrl+,",onOnClick:u[2]||(u[2]=()=>{l.value=!0}),title:"Open settings"},null,8,["iconSrc"]),g.showNavigator?A("",!0):(p(),Y(x(Ct),{key:2,menuItems:[{name:"Home",action:()=>{x(e).push("/")}},{name:"Feed",action:()=>{x(e).push("/feed")}},{name:"About",action:()=>{x(e).push("/about")}}]},{default:B(()=>[$(be,{iconSrc:x(ri),labelText:"Explore",shortcut:"ctrl+e",title:"look around"},null,8,["iconSrc"])]),_:1},8,["menuItems"]))]),g.showNavigator?(p(),v("div",hi,[a("div",pi,[a("div",{class:me(`button ${d.value==="home"||!d.value?"active-nav":""}`),onClick:u[3]||(u[3]=()=>{x(e).push("/")})},"Home",2),a("div",{class:me(`button ${d.value==="feed"?"active-nav":""}`),onClick:u[4]||(u[4]=()=>{x(e).push("/feed")})},"Feed",2),a("div",{class:me(`button ${d.value==="about"?"active-nav":""}`),onClick:u[5]||(u[5]=()=>{x(e).push("/about")})},"About",2)])])):A("",!0),fe(g.$slots,"default",{},void 0)],2)],64))}}),ze=E(fi,[["__scopeId","data-v-0d6cb588"]]),mi="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20height='48'%20viewBox='0%20-960%20960%20960'%20width='48'%3e%3cpath%20d='M453-280h60v-166h167v-60H513v-174h-60v174H280v60h173v166Zm27.266%20200q-82.734%200-155.5-31.5t-127.266-86q-54.5-54.5-86-127.341Q80-397.681%2080-480.5q0-82.819%2031.5-155.659Q143-709%20197.5-763t127.341-85.5Q397.681-880%20480.5-880q82.819%200%20155.659%2031.5Q709-817%20763-763t85.5%20127Q880-563%20880-480.266q0%2082.734-31.5%20155.5T763-197.684q-54%2054.316-127%2086Q563-80%20480.266-80Zm.234-60Q622-140%20721-239.5t99-241Q820-622%20721.188-721%20622.375-820%20480-820q-141%200-240.5%2098.812Q140-622.375%20140-480q0%20141%2099.5%20240.5t241%2099.5Zm-.5-340Z'/%3e%3c/svg%3e",It="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20height='48'%20viewBox='0%20-960%20960%20960'%20width='48'%3e%3cpath%20d='M480-160q-133%200-226.5-93.5T160-480q0-133%2093.5-226.5T480-800q85%200%20149%2034.5T740-671v-129h60v254H546v-60h168q-38-60-97-97t-137-37q-109%200-184.5%2075.5T220-480q0%20109%2075.5%20184.5T480-220q83%200%20152-47.5T728-393h62q-29%20105-115%20169t-195%2064Z'/%3e%3c/svg%3e",vi=M({__name:"Splitter",props:ut({direction:{},movable:{type:Boolean,default:!0},minSplitRatio:{default:0},maxSplitRatio:{default:1},mode:{default:"ab"},splitterWidth:{default:"3px"},overflow:{default:"auto"}},{splitRatio:{default:.5},splitRatioModifiers:{}}),emits:ut(["moveStart","moveStop"],["update:splitRatio"]),setup(o,{emit:t}){const e=o,n=Ht(o,"splitRatio"),s=t,i=w(null),l=w(null),r=w(null),d=w(null),g=w(!1);function u(){e.mode=="ab"&&l.value&&r.value&&(e.direction==="vertical"?(l.value.style.width=`calc(${n.value*100}%)`,r.value.style.width=`calc(${(1-n.value)*100}%)`):(l.value.style.height=`calc(${n.value*100}%)`,r.value.style.height=`calc(${(1-n.value)*100}%)`)),e.mode=="a"&&l.value&&(e.direction==="vertical"?l.value.style.width="100%":l.value.style.height="100%"),e.mode=="b"&&r.value&&(e.direction==="vertical"?r.value.style.width="100%":r.value.style.height="100%")}function c(h){d.value&&d.value.contains(h.target)&&(g.value=!0),s("moveStart",h)}function m(){g.value=!1,s("moveStop")}function f(h){if(g.value&&l.value&&r.value&&d.value){const k="touches"in h?h.touches[0].clientX:h.clientX,C="touches"in h?h.touches[0].clientY:h.clientY,D=l.value.getBoundingClientRect(),_=i.value.getBoundingClientRect(),P=e.direction==="vertical"?(k-D.left)/_.width:(C-D.top)/_.height;n.value=Math.max(e.minSplitRatio,Math.min(e.maxSplitRatio,P)),h.preventDefault()}}return window.addEventListener("mousedown",c),window.addEventListener("touchstart",c),window.addEventListener("mouseup",m),window.addEventListener("touchend",m),window.addEventListener("mousemove",f),window.addEventListener("touchmove",f),ne(()=>[e.direction,e.mode,n.value],()=>{_t(u)}),he(()=>{u()}),(h,k)=>(p(),v("div",{id:"sp-container",ref_key:"container",ref:i,style:oe(e.direction==="vertical"?{flexDirection:"row"}:{flexDirection:"column"})},[e.mode=="ab"||e.mode=="a"?(p(),v("div",{key:0,ref_key:"aPane",ref:l,class:"splitter-pane panel",style:oe({overflow:e.overflow})},[fe(h.$slots,"a",{},void 0)],4)):A("",!0),e.mode=="ab"&&e.movable?(p(),v("div",{key:1,ref_key:"splitter",ref:d,class:"splitter",style:oe(e.direction==="vertical"?{cursor:"col-resize",height:"100%",width:h.splitterWidth}:{cursor:"row-resize",width:"100%",height:h.splitterWidth})},null,4)):A("",!0),e.mode=="ab"||e.mode=="b"?(p(),v("div",{key:2,ref_key:"bPane",ref:r,class:"splitter-pane panel",style:oe({overflow:e.overflow})},[fe(h.$slots,"b",{},void 0)],4)):A("",!0)],4))}}),lt=E(vi,[["__scopeId","data-v-d141d9f5"]]),gi=M({__name:"Plot3d",props:{data:{}},setup(o,{expose:t}){const e=w(null),n=o,s=U(()=>n.data.map(h=>({x:h.x,y:h.y,z:h.z,mode:"markers",type:"scatter3d",hoverinfo:"text",hoverlabel:{bgcolor:"#181818",font:{color:"white"}},text:h.text,marker:{size:3.5,opacity:h.opacity,color:h.color}}))),i={autosize:!0,margin:{l:0,r:0,b:0,t:0},showlegend:!1,scene:{xaxis:{title:"",showticklabels:!1,tickfont:{size:10}},yaxis:{title:"",showticklabels:!1,tickfont:{size:10}},zaxis:{title:"",showticklabels:!1,tickfont:{size:10}}},paper_bgcolor:"#f6f6f6",plot_bgcolor:"#f6f6f6"},l={...i,paper_bgcolor:"#151515",plot_bgcolor:"#151515",font:{color:"white"}},r=w(Q.isDarkMode()?"dark":"light");Q.registerThemeChangeCallback(()=>{r.value=Q.isDarkMode()?"dark":"light",c()});const d=U(()=>r.value==="dark"?l:i),g={modeBarButtonsToRemove:["toImage","sendDataToCloud","resetCameraLastSave3d","resetCameraDefault3d"],displaylogo:!1,responsive:!0};let u=null;function c(){if(!e.value)return;Ke.react(e.value,s.value,d.value,g),e.value.layout.scene&&u&&Ke.relayout(e.value,"scene.camera",u)}return t({update:c}),he(()=>{Ke.newPlot(e.value,s.value,d.value,g).then(()=>{e.value.on("plotly_relayout",m=>{if(console.log("plotly_relayout",m),!m["scene.camera"])return;const f=m["scene.camera"];u=Be(f)})}),e.value.on("plotly_click",function(m){m.points||console.log("Not clicking on any data.");const f=m.points[0].x,h=m.points[0].y,k=m.points[0].z,C=m.points[0].pointNumber;console.log(`You clicked on ${f}, ${h}, ${k} (point ${C})}`)}),ne(s,()=>{c()})}),(m,f)=>(p(),v("div",{id:"ploty-chart",ref_key:"plotlyChart",ref:e},null,512))}}),_i=E(gi,[["__scopeId","data-v-db3ba83e"]]),yi={id:"main-filtervis"},wi={key:0,id:"plot3dDiv"},bi={key:0,id:"loadingDiv",class:"full"},ki={key:1,class:"status"},$i=M({__name:"FilterVis",setup(o){const t=J(),e=w(null),n=N(),s=W(),i=w(null),l=U(()=>{if(i.value===null)return{};const m=t.database.allKeys(),f={};for(const h of m)i.value[h]&&(f[h]=i.value[h]);return f});async function r(m,f="rgb(100, 100, 200)"){const h=l.value;if(!h)m=[];else for(let b=m.length-1;b>=0;b--)h[m[b]]===void 0&&m.splice(b,1);const k=m.length,C=await t.database.agetMany(m),D=new Float32Array(k),_=new Float32Array(k),P=new Float32Array(k),S=new Array(k);for(const[b,T]of m.entries()){let Z=h[T];if(Z==null)throw new Error("uid not found in feats: "+T);D[b]=Z[0],_[b]=Z[1],P[b]=Z[2];const ue=C[b];S[b]=`${ue.authorYear()}<br>${ue.summary.title}`}let y;if(typeof f=="string")y=f;else if(f instanceof Array)if(typeof f[0]=="string")y=f;else{const b=f,T=Math.max(...b),Z=Math.min(...b),ue={0:Q.isDarkMode()?[50,50,50]:[220,220,220],1:[50,200,150]};y=b.map(j=>{const K=(j-Z)/(T-Z),G=Array(3);for(let _e=0;_e<3;_e++)G[_e]=Math.round(ue[0][_e]*(1-K)+ue[1][_e]*K);return`rgb(${G[0]}, ${G[1]}, ${G[2]})`})}else throw new Error("Invalid color type");return{x:D,y:_,z:P,opacity:.75,color:y,text:S}}const d=w(null);async function g(){const m=n.shownDataScores;let f;m?f=await r(Be(n.shownDataUIDs),m):f=await r(Be(n.shownDataUIDs));const k=t.database.allKeys().filter(_=>n.shownDataUIDs.indexOf(_)==-1),C=await r(k,Q.isDarkMode()?"rgb(50, 50, 50)":"rgb(220, 220, 220)"),D=await r(Be(n.unfoldedDataUIDs),"rgb(255, 0, 0)");d.value=[f,C,D]}const u=U(()=>Object.keys(l.value).length>0);async function c(){i.value=null;const m=ee().conn,f=(await m.status()).n_data;let h;f<50?h=-1:f<100?h=5:f<300?h=8:f<500?h=12:h=15,console.log("dataset size: ",f,"perp: ",h),i.value=await m.reqDatabaseFeatureTSNE("doc_feature",3,h)}return ne(()=>[n.shownDataUIDs,n.unfoldedDataUIDs],()=>{g()}),ne(()=>s.show3DScatterPlot,m=>{m&&c().then(()=>{g()})}),he(()=>{s.show3DScatterPlot&&c().then(()=>{g()})}),(m,f)=>(p(),v("div",yi,[x(s).show3DScatterPlot?(p(),v("div",wi,[$(_i,{data:d.value?d.value:[],ref_key:"plot3DRef",ref:e},null,8,["data"]),!u.value||!l.value?(p(),v("div",bi,[i.value===null?(p(),Y(je,{key:0})):(p(),v("p",ki,"Data not ready"))])):A("",!0)])):A("",!0)]))}}),Si=E($i,[["__scopeId","data-v-97428746"]]),xi={id:"searchbar"},Di={id:"searchbar-container"},Ci=["value"],Pi=M({__name:"Searchbar",setup(o){const t=N(),e=["title","author","year","note","publication","feature","uuid"],n=w(""),s=w(null);function i(){const d={searchBy:s.value.value,content:n.value};t.searchState=d,console.debug("search status updated",d),t.updateShownData()}const l=bt(i,300);function r(d){return d.charAt(0).toUpperCase()+d.slice(1)}return(d,g)=>(p(),v("div",xi,[a("div",Di,[a("select",{ref_key:"searchSelector",ref:s,name:"search_type",id:"searchType",onChange:i},[(p(),v(H,null,te(e,u=>a("option",{value:u},I(r(u)),9,Ci)),64))],544),V(a("input",{type:"text",id:"searchbar-input",placeholder:"Search","onUpdate:modelValue":g[0]||(g[0]=u=>n.value=u),onInput:g[1]||(g[1]=(...u)=>x(l)&&x(l)(...u))},null,544),[[X,n.value]])])]))}}),Ii=E(Pi,[["__scopeId","data-v-0e98011a"]]);class Ti{constructor(t){ae(this,"router");this.router=t}getURLParams(){const t={},e=this.router.currentRoute.value.query;for(const n in e)t[n]=e[n];return t}setURLParam(t,e){const n=this.getURLParams();n[t]=e,this.router.push({query:n})}updateURLWithParam(t,e){const n=this.getURLParams();return n[t]=e,this.router.resolve({query:n}).href}}function Ui(o,{router:t=null,datapoint:e=null}){const n=t?new Ti(t):null;if(o=o.replace(/^---[\s\S]*?---/,""),e){const s=J().user;o=o.replace(new RegExp("./misc/","g"),`${qe()}/misc/${e.summary.uuid}?u=${s.id}&&fname=`),n&&(window.location.href.includes("/reader/")?o=o.replace(new RegExp("\\$\\{doc\\}#","g"),n.updateURLWithParam("docHashMark","")):o=o.replace(new RegExp("\\$\\{doc\\}#","g"),`${e.getOpenDocURL()}#`))}return o}const Ri=o=>(se("data-v-fb234051"),o=o(),ie(),o),Ai={id:"noteEditor"},Bi={key:2,id:"save-hint"},Mi={style:{"padding-inline":"5px","padding-block":"0.5rem"}},Li={key:0,style:{display:"flex",gap:"5px"}},qi=Ri(()=>a("label",{class:"frontmatter-label"},"LINKS",-1)),Ei=["href"],zi={key:1,style:{display:"flex"}},Fi={id:"btn-container"},Oi=["id"],Hi={key:0,id:"misc-container",class:"hover-scrollable"},Ni={key:0,style:{"font-weight":"bold",color:"var(--color-text-soft)",top:"0.5rem"}},Wi=["href"],ji={key:0,style:{color:"var(--color-text-soft)"}},Vi={class:"misc-file-op-container"},Ki=["onClick"],Zi=["onClick"],Gi=["onClick"],Ji=M({__name:"NoteEditor",props:{datapoint:{},autoEnableEdit:{type:Boolean,default:!1}},setup(o,{expose:t}){const e=o,n=ye(),s=w(""),i=w({}),l=U(()=>{var z;return!e.datapoint||((z=e.datapoint)==null?void 0:z.isDummy())}),r=w(Q.isDarkMode()?"dark":"light"),d=()=>r.value=Q.isDarkMode()?"dark":"light";he(()=>Q.registerThemeChangeCallback(d)),vt(()=>Q.unregisterThemeChangeCallback(d)),ne(()=>s.value,z=>{try{const j=Xt(z);if(typeof j.data!="object"||j.data===i.value)return;i.value=j.data,console.log("DEBUG: front matter",i.value)}catch{}});const g=U(()=>Ui(s.value,{router:n,datapoint:e.datapoint})),u=w(null),c=N(),m=w([]),f=w(""),h=U(()=>{function z(G){return G.replace(/\n/g,"").replace(/\r/g,"")}if(z(f.value)===z(s.value))return"";const j=z(f.value).trim(),K=z(s.value).trim();if(j.length!==K.length)return console.log("length diff",j.length,K.length),"Unsaved";for(let G=0;G<j.length;G++)if(j[G]!==K[G]){console.log("diff at",G,j[G],K[G]),console.log("char code",j.charCodeAt(G),K.charCodeAt(G));break}return"Unsaved"});function k(){s.value="",f.value="",m.value=[]}async function C(){if(!e.datapoint||e.datapoint.isDummy())return;const z=await e.datapoint.fetchNote();f.value=z,s.value=z,e.autoEnableEdit&&!z&&(T.value=!1)}async function D(){!e.datapoint||e.datapoint.isDummy()||(m.value=await e.datapoint.listMiscFiles())}async function _(){!e.datapoint||e.datapoint.isDummy()||await Promise.all([C(),D()])}Qe(_),he(_),ne(()=>e.datapoint,()=>{l.value?k():(_(),console.log("datapoint changed, fetching note and misc files..."))});async function P(){!e.datapoint||e.datapoint.isDummy()||(await e.datapoint.uploadNote(s.value),f.value=s.value)}const S=async z=>{!e.datapoint||e.datapoint.isDummy()||(await e.datapoint.deleteMiscFile(z),m.value=m.value.filter(j=>j.fname!==z),N().showPopup("File deleted","info"))},y=async(z,j)=>{if(!(!e.datapoint||e.datapoint.isDummy())){if(z.split(".").pop()!==j.split(".").pop()){N().showPopup("File extension must be the same","error");return}await e.datapoint.renameMiscFile(z,j),s.value=s.value.replace(z,j),D(),N().showPopup("File renamed","info")}},b=async z=>{if(!e.datapoint||e.datapoint.isDummy())return;c.showPopup("Upload","info"),(await e.datapoint.uploadMisc(z)).map(K=>u.value.insert(()=>({targetValue:`![image](${K})`,select:!1,deviationStart:0,deviationEnd:0}))),P(),D()},T=w(!0);function Z(z){return s.value.indexOf(z)>=0}function ue(z){const j=window.prompt(z);if(!j)throw new Error("User cancelled");return j}return t({preview:T,fetchNote:C}),ia("update_note",z=>{if(!e.datapoint||e.datapoint.isDummy()||z.session_id===ee().wsConn.sessionID)return;z.datapoint_summary.uuid===e.datapoint.uid&&_().then(()=>{N().showPopup("update note from other clients","info")})}),(z,j)=>(p(),v("div",Ai,[a("div",{class:"editor",onDblclick:j[1]||(j[1]=K=>T.value=!1)},[T.value?(p(),Y(x(Yt),{key:1,"model-value":g.value,theme:r.value,"preview-theme":"vuepress"},null,8,["model-value","theme"])):(p(),Y(x(Qt),{key:0,ref_key:"mdEditor",ref:u,modelValue:s.value,"onUpdate:modelValue":j[0]||(j[0]=K=>s.value=K),preview:!1,language:"en-US",theme:r.value,onOnSave:P,onOnUploadImg:b,disabled:l.value,toolbars:["bold","underline","italic","-","strikeThrough","title","quote","unorderedList","orderedList","task","-","link","-","revoke","next","save","=","catalog"]},null,8,["modelValue","theme","disabled"])),!T.value&&h.value?(p(),v("div",Bi,I(h.value),1)):A("",!0)],32),a("div",Mi,[(p(!0),v(H,null,te(i.value,(K,G)=>(p(),v(H,{key:G},[G=="links"?(p(),v("div",Li,[qi,(p(!0),v(H,null,te(K,(_e,F)=>(p(),v(H,null,[typeof F=="string"?(p(),v("a",{key:0,class:"frontmatter-link",href:_e,target:"_blank"},I(F),9,Ei)):A("",!0)],64))),256))])):(p(),v("div",zi,[q(" [unknown-entry] "),a("b",null,I(G)+": ",1),q(I(K),1)]))],64))),128))]),a("div",Fi,[a("button",{onClick:j[2]||(j[2]=K=>T.value=!T.value)},I(T.value?"Edit":"Preview"),1),$(x(Ue),{action:K=>{!e.datapoint||e.datapoint.isDummy()||e.datapoint.uploadMisc([K]).then(G=>{x(N)().showPopup("File uploaded","success"),D(),u.value.insert(()=>({targetValue:`[${K.name}](${G[0]})`,select:!1,deviationStart:0,deviationEnd:0}))})}},null,8,["action"])]),a("div",{id:"misc-toggle",onClick:j[3]||(j[3]=()=>{x(c).showMiscPanel=!x(c).showMiscPanel})},[a("div",{id:x(c).showMiscPanel?"triangle-down":"triangle"},null,8,Oi)]),x(c).showMiscPanel?(p(),v("div",Hi,[m.value.length===0?(p(),v("div",Ni," No attached files. ")):A("",!0),(p(!0),v(H,null,te(m.value,K=>(p(),v("div",{key:K.fname,class:"misc-file"},[a("div",null,[a("a",{href:K.url,target:"_blank"},I(K.fname),9,Wi),Z(K.fname)?A("",!0):(p(),v("label",ji," (no-ref) "))]),a("div",Vi,[a("a",{style:{color:"var(--color-text-soft)",cursor:"pointer"},onClick:G=>{x(Xe)(K.fname),x(N)().showPopup("Copied")}}," copy ",8,Ki),a("a",{style:{color:"var(--color-text-soft)",cursor:"pointer"},onClick:G=>y(K.fname,ue("New name"))}," rename ",8,Zi),Z(K.fname)?A("",!0):(p(),v("a",{key:0,style:{color:"var(--color-danger)",cursor:"pointer"},onClick:G=>S(K.fname)}," delete ",8,Gi))])]))),128))])):A("",!0)]))}}),Tt=E(Ji,[["__scopeId","data-v-fb234051"]]);function Ut(){const o=Nt({width:window.innerWidth,height:window.innerHeight});function t(){o.width=window.innerWidth,o.height=window.innerHeight}window.addEventListener("resize",t);function e(){window.removeEventListener("resize",t)}return{...Wt(o),cleanup:e}}function Qi(o){const t=ee().conn,e=w({}),n=()=>{Promise.all(o.value.map(s=>t.query({searchBy:"author",searchContent:s}))).then(s=>{for(let i=0;i<o.value.length;i++)e.value[o.value[i]]=s[i].uids})};return ne(o,n,{immediate:!0}),{authorPapers:e,updateAuthorPapers:n}}const Yi=o=>(se("data-v-b81a3032"),o=o(),ie(),o),Xi={style:{"font-weight":"bold"}},el=Yi(()=>a("div",{style:{height:"10px"}},null,-1)),tl={id:"summary-panel-main"},al={class:"title"},nl={class:"authors-div"},ol={class:"author-container"},sl={class:"author"},il=["onClick"],ll={key:0,class:"publication"},rl={key:1,class:"docsize"},ul=M({__name:"InfoPanel",props:{datapoint:{}},setup(o){const t=o,e=U(()=>t.datapoint?t.datapoint:J().database.getDummy()),n=U(()=>t.datapoint?kt(t.datapoint.summary.bibtex):""),s=U(()=>{var c;return((c=t.datapoint)==null?void 0:c.authors)||[]}),{authorPapers:i}=Qi(s),l=U(()=>{const c={};for(const[m,f]of Object.entries(i.value))c[m]=f.filter(h=>{var k;return h!==((k=t.datapoint)==null?void 0:k.uid)});return c}),r=w(""),{width:d}=Ut(),g=U(()=>d.value>768?"horizontal":"vertical"),u=d.value>768?.3:.5;return(c,m)=>(p(),v(H,null,[$(ke,{show:r.value.length>0,onClose:m[0]||(m[0]=f=>r.value="")},{default:B(()=>[a("h2",Xi," All entries by "+I(r.value),1),el,$(Ie,{uids:x(i)[r.value]},null,8,["uids"])]),_:1},8,["show"]),$(lt,{direction:g.value,"split-ratio":x(u)},{a:B(()=>[a("div",tl,[a("h2",al,I(e.value.summary.title),1),a("div",nl,[(p(!0),v(H,null,te(s.value,f=>{var h;return p(),v("div",ol,[a("span",sl,I(f),1),((h=l.value[f])==null?void 0:h.length)>0?(p(),v("span",{key:0,class:"author-paper-count",onClick:k=>r.value=f}," ("+I(l.value[f].length)+") ",9,il)):A("",!0)])}),256))]),e.value.isDummy()?A("",!0):(p(),v("div",ll,I(e.value.publication+`. (${e.value.year})`+(n.value?", "+n.value:"")),1)),e.value.summary.doc_size?(p(),v("div",rl,[a("span",null,I(e.value.summary.doc_size)+" MB ",1)])):A("",!0)])]),b:B(()=>[$(Tt,{datapoint:c.datapoint},null,8,["datapoint"])]),_:1},8,["direction","split-ratio"])],64))}}),cl=E(ul,[["__scopeId","data-v-b81a3032"]]),dl=o=>(se("data-v-0f4f5f5b"),o=o(),ie(),o),hl={id:"main-home",class:"gradIn compact"},pl={class:"horizontal fullHeight"},fl={key:0,id:"left-panel"},ml={id:"doc-panel",class:"panel1"},vl={key:0,class:"fullWidth"},gl={id:"doc-top-bar"},_l={style:{"flex-grow":"1"}},yl={style:{display:"flex","flex-grow":"0","margin-right":"5px","margin-block":"5px"}},wl={key:1,id:"blankPlaceholder"},bl={key:0,style:{"font-size":"xx-large","font-weight":"bold","user-select":"none"}},kl=dl(()=>a("br",null,null,-1)),$l={name:"Home",inheritAttrs:!1,customOptions:{}},Sl=M({...$l,setup(o){const t=N(),e=J(),n=W(),{width:s}=Ut(),l=ye().currentRoute.value.query.tags;l!=null&&(t.tagStatus.checked=new O(l.split("&&")),t.tagStatus.unfolded=t.tagStatus.checked.allParents());const r=w(null);ne(()=>t.focusedDataUID,f=>{f?e.database.aget(f).then(h=>{r.value=h}):r.value=null});let d=new O;ne(()=>t.tagStatus,()=>{const f=t.tagStatus.checked;f.equals(d)||(t.updateShownData(),d=f.copy())},{deep:!0});const g=w(null);function u(){g.value.show({datapoint:null})}function c(f){var k;f.preventDefault();const h=(k=f.dataTransfer)==null?void 0:k.files;h&&(u(),g.value.loadFiles(h)||g.value.close())}function m(){t.reloadDatabase(),ee().wsConn.resetReconnect()}return(f,h)=>(p(),v(H,null,[$(st,{ref_key:"dataEditor",ref:g},null,512),$(ze,{"return-home":!1,compact:!0}),a("div",hl,[a("div",pl,[$(Me,{name:"left-in"},{default:B(()=>[x(n).showTagPanel?(p(),v("div",fl,[$(Na)])):A("",!0)]),_:1}),$(lt,{direction:x(s)>768?"vertical":"horizontal",mode:x(n).showHomeInfoPanel?"ab":"a","split-ratio":x(s)>768?.8:.6},{a:B(()=>[a("div",ml,[x(n).show3DScatterPlot?(p(),v("div",vl,[$(Si)])):A("",!0),a("div",{class:"scrollable",id:"doc-container",onDragover:h[1]||(h[1]=k=>k.preventDefault()),onDrop:c},[a("div",gl,[a("div",_l,[$(Ii)]),a("div",yl,[$(be,{iconSrc:x(mi),labelText:"New",title:"Add new data to database",onClick:u,shortcut:"ctrl+n"},null,8,["iconSrc"]),$(be,{iconSrc:x(It),labelText:"Reload",title:"Reload database",onClick:m},null,8,["iconSrc"])])]),x(t).shownDataUIDs.length?(p(),Y(Ie,{key:0,uids:x(t).shownDataUIDs,unfoldedIds:x(t).unfoldedDataUIDs,"onUpdate:unfoldedIds":h[0]||(h[0]=k=>x(t).unfoldedDataUIDs=k)},null,8,["uids","unfoldedIds"])):(p(),v("div",wl,[x(e).database.initialized?(p(),v("p",bl,[q(" Nothing to show "),a("p",{style:{"font-size":"medium"}},[q(" Add your first enty by clicking the "),a("b",null,[a("a",{onClick:u,style:{cursor:"pointer","border-radius":"5px","padding-inline":"3px","background-color":"var(--color-background-soft)"}},"⊕ New")]),q(" button above."),kl])])):A("",!0),x(e).database.initialized?A("",!0):(p(),Y(je,{key:1}))]))],32)])]),b:B(()=>[$(cl,{datapoint:r.value},null,8,["datapoint"])]),_:1},8,["direction","mode","split-ratio"])])])],64))}}),xl=E(Sl,[["__scopeId","data-v-0f4f5f5b"]]);function Dl(o,t=!1){t&&(o*=1e3);const e=new Date(o);let n=e.getFullYear().toString();n.length!==4&&(n="0".repeat(4-n.length)+n);let s=(e.getMonth()+1).toString();s.length===1&&(s="0"+s);let i=e.getDate().toString();i.length===1&&(i="0"+i);let l=`${n}-${s}-${i} `;const r={hourCycle:"h23",hour:"2-digit",minute:"2-digit",second:"2-digit"};return l+=e.toLocaleTimeString([],r),l}const Cl=o=>(se("data-v-8a4a3cb8"),o=o(),ie(),o),Pl={id:"authorPapers"},Il={id:"feed-main",class:"slideInFast"},Tl={class:"articleBlock"},Ul={class:"titleBlock"},Rl={style:{"font-weight":"bold"}},Al={style:{display:"flex","flex-direction":"row","justify-content":"center","align-items":"center"}},Bl={class:"titleId"},Ml={class:"authors"},Ll={class:"authorSpan"},ql=["href"];const El=["onClick"],zl={key:3},Fl={class:"actions"},Ol=["href"],Hl=["href"],Nl=Cl(()=>a("summary",null,"Abstract",-1)),Wl={id:"relatedArticles"},jl=M({__name:"ArticleBlock",props:{article:{}},setup(o){const t=o,e=J(),n=ee().conn,s=w(null);async function i(){var C;(C=s.value)==null||C.show({datapoint:null,bibtex:t.article.bibtex,tags:[],url:t.article.url})}const l=w({});async function r(){for(let C=0;C<t.article.authors.length;C++){const D=t.article.authors[C],_=t.article.authors_other_publications[C],P=await e.database.agetMany(_);l.value[D]=P}}r();const d=U(()=>{const C={};for(const D in l.value)l.value[D]?C[D]=l.value[D].length:C[D]=null;return C}),g=w(!1),u=w([]);function c(C){u.value=l.value[C],u.value||(u.value=[]),g.value=!0}const m=w([]),f=w([]),h=U(()=>{const C={};for(let D=0;D<m.value.length;D++)C[m.value[D].summary.uuid]=f.value[D].toPrecision(4);return C});function k(){m.value.length>0||n.query({searchBy:"feature",searchContent:t.article.abstract,maxResults:10}).then(C=>{const D=C.scores,_=C.uids,P=St(_,D);e.database.agetMany(P[0],!1).then(S=>{m.value=S;const y=[];for(const b of S){const T=_.indexOf(b.summary.uuid);T>=0&&y.push(D[T])}f.value=y})})}return(C,D)=>(p(),v(H,null,[$(st,{ref_key:"dataEditor",ref:s},null,512),$(ke,{show:g.value,"onUpdate:show":D[0]||(D[0]=_=>g.value=_),title:"Publications in the database",onOnClose:D[1]||(D[1]=_=>u.value=[])},{default:B(()=>[a("div",Pl,[$(Ie,{uids:u.value.map(_=>_.summary.uuid)},null,8,["uids"])])]),_:1},8,["show"]),a("div",Il,[a("div",Tl,[a("div",Ul,[a("h2",Rl,I(t.article.title),1),a("div",Al,[$(tt,{tags:t.article.tags},null,8,["tags"]),a("label",Bl,I(t.article.uuid),1)])]),a("div",Ml,[(p(!0),v(H,null,te(t.article.authors,(_,P)=>(p(),v("span",Ll,[(p(),v("a",{key:0,class:"link",href:`https://arxiv.org/search/?query=${_}&searchtype=author`,target:"_blank"},I(_),9,ql)),d.value[_]?(p(),v("a",{key:2,class:"pubCount",onClick:()=>c(_)},I(`(${d.value[_]})`),9,El)):A("",!0),P<t.article.authors.length-1?(p(),v("span",zl,", ")):A("",!0)]))),256))]),a("div",Fl,[a("a",{href:C.article.url,target:"_blank"},"Link",8,Ol),q(" | "),a("a",{href:`https://arxiv.org/pdf/${C.article.uuid}.pdf`,target:"_blank"},"PDF",8,Hl),q(" | "),a("a",{onClick:i},"Collect")]),a("p",null,"Added: "+I(x(Dl)(t.article.time_added,!0)),1),a("details",null,[Nl,a("p",null,I(t.article.abstract),1)]),a("details",null,[a("summary",{onClick:k},"Related articles"),a("div",Wl,[$(Ie,{uids:m.value.map(_=>_.summary.uuid),scores:h.value},null,8,["uids","scores"])])])])])],64))}}),Vl=E(jl,[["__scopeId","data-v-8a4a3cb8"]]),Rt=o=>(se("data-v-ed7e2b2f"),o=o(),ie(),o),Kl={id:"toolbar"},Zl={id:"main"},Gl={style:{"margin-block":"1rem"}},Jl=["src"],Ql={id:"settings"},Yl={style:{display:"flex","justify-content":"center","align-items":"center",width:"100%",gap:"0.5rem","flex-flow":"row wrap"}},Xl=["value"],er=["value"],tr={style:{display:"flex","justify-content":"center","align-items":"center",width:"100%",gap:"0.5rem"}},ar={key:0,id:"loadingPlaceholder"},nr=Rt(()=>a("b",null,"Fetching...",-1)),or={key:1,id:"loadingPlaceholder"},sr=Rt(()=>a("b",null,"No articles found",-1)),ir=[sr],lr=M({__name:"Feed",setup(o){const t=ee().conn,e=ye();function n(P=0){const S=new Date;return S.setDate(S.getDate()+P),S.toISOString().split("T")[0]}const s=w("arxiv"),i=w(!1),l=w(["arxiv"]),r=w(n(1)),d=w(n(-1)),g=w(parseInt(e.currentRoute.value.query.maxResults)||100),u=w(""),c=w(null),m=w([]),f=U(function(){return[...m.value].sort((S,y)=>{if(c.value===null||!S.feature||!y.feature)return 0;{const b=new Float32Array(S.feature),T=new Float32Array(y.feature),Z=c.value,ue=b.reduce((j,K,G)=>j+(K-Z[G])**2,0),z=T.reduce((j,K,G)=>j+(K-Z[G])**2,0);return ue-z}})});function h(){if(u.value.trim()===""){c.value=null;return}t.featurizeText(u.value).then(P=>{c.value=new Float32Array(P)},()=>{console.log("failed to featurize")})}const k=bt(h,100);g.value>200&&(window.alert("maxResults cannot be larger than 200"),g.value=200);let C=e.currentRoute.value.query.search||"";C!==""&&(u.value=C);const D=w(null);async function _(){m.value=[];const P=ee().conn;l.value=["arxiv"].concat(await P.reqFeedCategories()),i.value=!0;const S=new Date(r.value).getTime()/1e3,y=new Date(d.value).getTime()/1e3;try{const b=await P.reqFeedList({maxResults:g.value,category:s.value,timeBefore:S,timeAfter:y});m.value=b,h()}finally{i.value=!1}}return he(()=>{_().then(()=>D.value.classList.remove("spin"),()=>{D.value.classList.remove("spin"),window.alert("Failed to fetch articles")})}),(P,S)=>(p(),v(H,null,[a("div",Kl,[$(ze,{ref:"toolbar"},null,512)]),a("div",Zl,[a("h1",Gl,[q(" Daily Feed "),a("img",{ref_key:"refreshButton",ref:D,src:x(It),alt:"",class:"icon spin",title:"refresh the page",onClick:S[0]||(S[0]=y=>{const b=y.target;b.classList.contains("spin")||(b.classList.add("spin"),_().then(()=>b.classList.remove("spin")))})},null,8,Jl)]),a("div",Ql,[a("div",Yl,[a("span",null,[q(" Category: "),V(a("select",{name:"category",id:"category-select","onUpdate:modelValue":S[1]||(S[1]=y=>s.value=y),onChange:_},[(p(!0),v(H,null,te(l.value,y=>(p(),v("option",{value:y},I(y),9,Xl))),256))],544),[[Le,s.value]])]),a("span",null,[q(" Max results: "),V(a("select",{"onUpdate:modelValue":S[2]||(S[2]=y=>g.value=y),onChange:_},[(p(),v(H,null,te([20,50,100,200,500],y=>a("option",{value:y},I(y),9,er)),64))],544),[[Le,g.value]])]),a("span",null,[q(" From: "),V(a("input",{type:"date","onUpdate:modelValue":S[3]||(S[3]=y=>d.value=y),onChange:_},null,544),[[X,d.value]])]),a("span",null,[q(" To: "),V(a("input",{type:"date","onUpdate:modelValue":S[4]||(S[4]=y=>r.value=y),onChange:_},null,544),[[X,r.value]])])]),a("div",tr,[V(a("input",{type:"text",placeholder:"Search",onInput:S[5]||(S[5]=(...y)=>x(k)&&x(k)(...y)),"onUpdate:modelValue":S[6]||(S[6]=y=>u.value=y),autocomplete:"off"},null,544),[[X,u.value]])])]),f.value.length===0&&i.value?(p(),v("div",ar,[nr,$(je)])):A("",!0),f.value.length===0&&!i.value?(p(),v("div",or,ir)):A("",!0),(p(!0),v(H,null,te(f.value,y=>(p(),Y(Vl,{article:y},null,8,["article"]))),256))])],64))}}),rr=E(lr,[["__scopeId","data-v-ed7e2b2f"]]),ur={class:"main"},cr={id:"login",class:"slideIn"},dr={class:"loginLine"},hr={class:"loginLine"},pr=["type"],fr={class:"options"},mr={key:0,class:"error"},vr=M({__name:"LoginInput",setup(o){const t=w(""),e=w(""),n=w(""),s=w(!0),i=w(!1),l=U(()=>i.value?"text":"password"),r=w("Login"),d=ye(),g=w(""),u=w("");d.isReady().then(()=>{_t(()=>{g.value=W().backendHost,u.value=W().backendPort})});function c(){W().setBackendHost(g.value),W().setBackendPort(u.value),r.value="Connecting...";const m=ee().conn,f=ma(t.value,e.value);W().setEncKey(f,!1),m.authorize().then(h=>{et(f,h,s.value),n.value="";const k=d.currentRoute.value.query.from;k?(console.log("Redirecting to",k),d.push(k)):d.push("/"),r.value="Login"},h=>{n.value=h,r.value="Login"})}return(m,f)=>(p(),v("div",ur,[a("div",cr,[a("form",null,[a("div",dr,[V(a("input",{class:"key-input",type:"text",id:"username-input","onUpdate:modelValue":f[0]||(f[0]=h=>t.value=h),placeholder:"Username",autocomplete:"off",autocorrect:"off",autocapitalize:"off",spellcheck:"false"},null,512),[[X,t.value]])]),a("div",hr,[V(a("input",{class:"key-input",type:l.value,id:"password-input","onUpdate:modelValue":f[1]||(f[1]=h=>e.value=h),placeholder:"Password"},null,8,pr),[[Ge,e.value]])]),a("div",fr,[$(Se,{checked:s.value,onOnCheck:f[2]||(f[2]=()=>{s.value=!s.value})},{default:B(()=>[q("Stay login")]),_:1},8,["checked"]),$(Se,{checked:i.value,onOnCheck:f[3]||(f[3]=()=>{i.value=!i.value})},{default:B(()=>[q("Show key")]),_:1},8,["checked"])]),A("",!0),a("button",{type:"submit",onClick:He(c,["prevent"])},I(r.value),1)]),n.value?(p(),v("p",mr,I(n.value),1)):A("",!0)])]))}}),gr=E(vr,[["__scopeId","data-v-34f6e322"]]),_r={props:{defaultInvitationCode:{type:String,default:""}},data(){return{invitationCode:this.defaultInvitationCode,username:"",password:"",passwordConfirm:"",name:Pe[Math.floor(Math.random()*Pe.length)],showPassword:!1}},emits:["register-success","register-fail"],components:{SwitchToggle:Te},methods:{submitForm(o){if(this.password!==this.passwordConfirm){this.$emit("register-fail","Passwords do not match");return}ee().conn.registerUser(this.invitationCode,this.username,this.password,this.name).then(()=>{this.$emit("register-success")},t=>{t.message.includes("409")?this.$emit("register-fail","Username already exists"):t.message.includes("401")?this.$emit("register-fail","Invalid invitation code"):t.message.includes("403")?this.$emit("register-fail","Invitation code expired"):t.message.includes("507")?this.$emit("register-fail","Maximum number of users reached"):this.$emit("register-fail",t)}),o.preventDefault()}}},$e=o=>(se("data-v-892e7367"),o=o(),ie(),o),yr={id:"form-container"},wr={class:"form-elem"},br=$e(()=>a("div",{style:{color:"var(--color-text-soft)","font-size":"smaller","padding-inline":"0.5rem"}}," Get an invitation from the server administrator ",-1)),kr=$e(()=>a("span",null,"Invitation code",-1)),$r={class:"form-elem"},Sr=$e(()=>a("span",null,"Username",-1)),xr={class:"form-elem"},Dr=["type"],Cr=$e(()=>a("span",null,"Password",-1)),Pr={class:"form-elem"},Ir=["type"],Tr=$e(()=>a("span",null,"Confirm password",-1)),Ur={class:"form-elem"},Rr=$e(()=>a("span",null,"Name",-1)),Ar={id:"show-password-container"},Br=$e(()=>a("label",null,"Show password",-1)),Mr=$e(()=>a("button",{type:"submit"},"Register",-1));function Lr(o,t,e,n,s,i){const l=Je("SwitchToggle");return p(),v("form",{onSubmit:t[6]||(t[6]=(...r)=>i.submitForm&&i.submitForm(...r)),id:"registration-form"},[a("div",yr,[a("div",wr,[br,V(a("input",{type:"text","onUpdate:modelValue":t[0]||(t[0]=r=>s.invitationCode=r),required:"",autocomplete:"off",autocorrect:"off",autocapitalize:"off",spellcheck:"false"},null,512),[[X,s.invitationCode]]),kr]),a("div",$r,[V(a("input",{type:"text","onUpdate:modelValue":t[1]||(t[1]=r=>s.username=r),required:"",autocomplete:"off",autocorrect:"off",autocapitalize:"off",spellcheck:"false"},null,512),[[X,s.username]]),Sr]),a("div",xr,[V(a("input",{type:`${s.showPassword?"text":"password"}`,"onUpdate:modelValue":t[2]||(t[2]=r=>s.password=r),required:"",autocomplete:"off",autocorrect:"off",autocapitalize:"off",spellcheck:"false"},null,8,Dr),[[Ge,s.password]]),Cr]),a("div",Pr,[V(a("input",{type:`${s.showPassword?"text":"password"}`,"onUpdate:modelValue":t[3]||(t[3]=r=>s.passwordConfirm=r),required:"",autocomplete:"off",autocorrect:"off",autocapitalize:"off",spellcheck:"false"},null,8,Ir),[[Ge,s.passwordConfirm]]),Tr]),a("div",Ur,[V(a("input",{type:"text","onUpdate:modelValue":t[4]||(t[4]=r=>s.name=r),required:"",autocomplete:"off",autocorrect:"off",autocapitalize:"off",spellcheck:"false"},null,512),[[X,s.name]]),Rr])]),a("div",Ar,[$(l,{checked:s.showPassword,"onUpdate:checked":t[5]||(t[5]=r=>s.showPassword=r)},null,8,["checked"]),Br]),Mr],32)}const qr=E(_r,[["render",Lr],["__scopeId","data-v-892e7367"]]),Er={id:"login-main"},zr={id:"container"},Fr={for:"login",id:"info"},Or=["href"],Hr=M({__name:"Login",setup(o){Q.setDefaultDarkMode();const t=w(""),e=w(!1),n=ye();return console.log(n.currentRoute.value.query.invitation),n.currentRoute.value.query.invitation&&(e.value=!0,t.value=n.currentRoute.value.query.invitation),(s,i)=>(p(),v(H,null,[$(ke,{title:"User registration",show:e.value,"onUpdate:show":i[2]||(i[2]=l=>e.value=l),compact:!0},{default:B(()=>[$(qr,{"default-invitation-code":t.value,onRegisterSuccess:i[0]||(i[0]=()=>{e.value=!1,x(N)().showPopup("Registration successful","success")}),onRegisterFail:i[1]||(i[1]=l=>x(N)().showPopup(l,"error"))},null,8,["default-invitation-code"])]),_:1},8,["show"]),a("div",Er,[a("div",zr,[$(gr),a("label",Fr,[q(" Need assistant? - "),a("a",{onClick:i[3]||(i[3]=l=>e.value=!0)},"Register"),q(" | "),a("a",{href:`mailto:${x(_s).email}`},"Contact me",8,Or)])])])],64))}}),Nr=E(Hr,[["__scopeId","data-v-def42eb3"]]),Wr=o=>(se("data-v-e87ddb4e"),o=o(),ie(),o),jr={id:"body"},Vr=["src"],Kr=Wr(()=>a("div",{style:{color:"var(--color-text-soft)","font-weight":"bold","font-size":"large"}},"No file, drag and drop to  ",-1)),Zr=M({__name:"ReaderBody",props:{datapoint:{},layoutType:{}},setup(o,{expose:t}){const e=o,n=ye(),s=U(()=>{let c=n.currentRoute.value.query.docHashMark;return c||(c=""),e.datapoint.fileType()=="pdf"&&!c.includes("pagemode=")&&(c+="&pagemode=none"),c}),i=w(!1),l=w(null);t({noteEditor:l});function r(u){W().setReaderLayoutType(u)}ne(()=>e.layoutType,(u,c)=>{console.log("layoutType changed:",c,"->",u),r(u)});const d=w(Q.isDarkMode()?"dark":"light");Q.registerThemeChangeCallback(()=>d.value=Q.isDarkMode()?"dark":"light");const g=U(()=>`${e.datapoint.getOpenDocURL({extraPDFViewerParams:{"color-mode":d.value},urlHashMark:s.value})}`);return he(()=>{r(e.layoutType)}),(u,c)=>(p(),v("div",jr,[$(lt,{direction:"vertical","split-ratio":x(N)().preferredReaderLeftPanelWidthPerc,"onUpdate:splitRatio":c[2]||(c[2]=m=>x(N)().preferredReaderLeftPanelWidthPerc=m),"splitter-width":"4px",mode:{0:"a",1:"b",2:"ab"}[u.layoutType],onMoveStart:c[3]||(c[3]=()=>i.value=!0),onMoveStop:c[4]||(c[4]=()=>i.value=!1),overflow:"unset"},{a:B(()=>[u.datapoint.summary.has_file?(p(),v("iframe",{key:0,src:g.value,title:"doc",frameborder:"0",style:oe({"pointer-events":i.value?"none":"auto"})},null,12,Vr)):(p(),v("div",{key:1,style:{display:"flex","justify-content":"center","align-items":"center",height:"100%",width:"100%"},onDragover:c[0]||(c[0]=m=>m.preventDefault()),onDrop:c[1]||(c[1]=m=>{var h;m.preventDefault();const f=(h=m.dataTransfer)==null?void 0:h.files;x(N)().showPopup("Upload file","info"),f&&f.length==1&&u.datapoint.uploadDocument(f[0]).then(()=>{x(N)().showPopup("File uploaded","success")})})},[Kr,$(x(Ue),{action:m=>u.datapoint.uploadDocument(m),text:"upload","as-link":!0,style:{"font-weight":"bold","font-size":"large",cursor:"pointer"}},null,8,["action"])],32))]),b:B(()=>[$(Tt,{datapoint:u.datapoint,"auto-enable-edit":!0,ref_key:"noteEditor",ref:l},null,8,["datapoint"])]),_:1},8,["split-ratio","mode"])]))}}),Gr=E(Zr,[["__scopeId","data-v-e87ddb4e"]]),Jr="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20height='48'%20viewBox='0%20-960%20960%20960'%20width='48'%3e%3cpath%20d='M180-120q-24%200-42-18t-18-42v-600q0-24%2018-42t42-18h210q24%200%2042%2018t18%2042v600q0%2024-18%2042t-42%2018H180Zm390%200q-24%200-42-18t-18-42v-600q0-24%2018-42t42-18h210q24%200%2042%2018t18%2042v600q0%2024-18%2042t-42%2018H570Zm210-660H570v600h210v-600ZM570-180h210-210Z'/%3e%3c/svg%3e",Qr="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20height='48'%20viewBox='0%20-960%20960%20960'%20width='48'%3e%3cpath%20d='M220-160q-24%200-42-18t-18-42v-143h60v143h520v-143h60v143q0%2024-18%2042t-42%2018H220Zm230-153v-371L330-564l-43-43%20193-193%20193%20193-43%2043-120-120v371h-60Z'/%3e%3c/svg%3e",Yr={id:"toolbarOps"},Xr={id:"recently-read"},eu={id:"main-reader",class:"gradIn"},tu={name:"Reader",inheritAttrs:!1,customOptions:{}},au=M({...tu,setup(o){const t=J(),e=N(),n=yt(),s=ye(),i=w(t.database.getDummy());async function l(){const h=await t.database.aget(n.params.id);h&&(i.value=h),e.addRecentlyReadDataUID(h.uid),t.database.agetMany(e.recentlyReadDataUIDs).then(k=>{d(k)}),console.log("Reader: updated datapoint",h.summary.title,"uid",h.uid)}ne(()=>n.params.id,()=>{l()});const r=w([]);function d(h){const k=[];for(const C of h)C.summary.uuid!==n.params.id&&k.push({name:C.authorYear(),action:()=>{s.push("/reader/"+C.summary.uuid)}});console.log("Reader: updated recent read menu items",k),r.value=k}const g=w(W().readerLayoutType);window.innerWidth<800&&(g.value=0);function u(){if(window.innerWidth<800)g.value=(g.value+1)%2;else switch(g.value){case 0:g.value=2;break;case 1:g.value=2;break;case 2:g.value=0;break}}const c=w(null);function m(h){function k(){i.value.uploadDocument(h).then(C=>{i.value.update(C),e.showPopup("Document uploaded","success")},()=>e.showPopup("Failed to upload document","error"))}i.value.summary.has_file?i.value.freeDocument().then(C=>{i.value.update(C),k()},()=>e.showPopup("Failed to free document","error")):k()}const f=w(null);return he(()=>{console.log("Reader mounted"),l()}),(h,k)=>(p(),v(H,null,[$(x(Ue),{action:m,ref_key:"fileSelectionBtn",ref:c,style:{display:"none"}},null,512),$(ze,{compact:!0,"show-navigator":!1},{default:B(()=>[a("div",Yr,[$(be,{iconSrc:x(Jr),labelText:"layout",shortcut:"ctrl+r",onOnClick:u,title:"change layout"},null,8,["iconSrc"]),$(be,{iconSrc:x(Qr),labelText:"replace",shortcut:"ctrl+u",onOnClick:k[0]||(k[0]=()=>c.value.click()),title:"upload a new document"},null,8,["iconSrc"]),$(x(Ct),{"menu-items":r.value},{default:B(()=>[a("div",Xr,I(`${i.value.authorAbbr()} (${i.value.summary.year})`),1)]),_:1},8,["menu-items"])])]),_:1}),a("div",eu,[$(Gr,{datapoint:i.value,layoutType:g.value,ref_key:"readerBody",ref:f},null,8,["datapoint","layoutType"])])],64))}}),nu=E(au,[["__scopeId","data-v-39571ec0"]]),ou="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20height='24'%20viewBox='0%20-960%20960%20960'%20width='24'%3e%3cpath%20d='M160-400v-80h280v80H160Zm0-160v-80h440v80H160Zm0-160v-80h440v80H160Zm360%20560v-123l221-220q9-9%2020-13t22-4q12%200%2023%204.5t20%2013.5l37%2037q8%209%2012.5%2020t4.5%2022q0%2011-4%2022.5T863-380L643-160H520Zm300-263-37-37%2037%2037ZM580-220h38l121-122-18-19-19-18-122%20121v38Zm141-141-19-18%2037%2037-18-19Z'/%3e%3c/svg%3e",le=o=>(se("data-v-d5b9d887"),o=o(),ie(),o),su={id:"users-widget-main"},iu={id:"user-editor-main"},lu={class:"horizontal"},ru=["src"],uu={id:"user-editor"},cu={class:"horizontal"},du={class:"horizonal",style:{display:"flex","align-items":"center",gap:"0.5rem"}},hu=le(()=>a("b",null,"Administrator ",-1)),pu={class:"full-width left-align"},fu=le(()=>a("b",null,"Max Storage (MB):",-1)),mu=le(()=>a("br",null,null,-1)),vu={key:0,class:"full-width left-align"},gu=le(()=>a("b",null,"Mandatory Tags:",-1)),_u={id:"mandatory-tag-edit"},yu={id:"delete-user-dialog-main"},wu=le(()=>a("p",{style:{color:"var(--color-danger)"}}," All data under this user will be deleted! ",-1)),bu=le(()=>a("hr",{style:{"margin-block":"1rem"}},null,-1)),ku={id:"create-user-main"},$u={id:"create-user-table"},Su=le(()=>a("td",null,"Username:",-1)),xu=le(()=>a("td",null,"Name:",-1)),Du=le(()=>a("td",null,"Password:",-1)),Cu=le(()=>a("td",null,"Max Storage (MB):",-1)),Pu=le(()=>a("td",null,"Mandatory Tags:",-1)),Iu=le(()=>a("td",null,"Administrator:",-1)),Tu={style:{display:"flex","align-items":"center","padding-block":"0.25rem"}},Uu={id:"user-widget-header"},Ru=le(()=>a("div",null,[a("b",null," Users ")],-1)),Au={key:0},Bu=le(()=>a("th",null," Avatar ",-1)),Mu=le(()=>a("th",null," Username ",-1)),Lu=le(()=>a("th",null," Name ",-1)),qu=le(()=>a("th",null," Storage ",-1)),Eu=le(()=>a("th",null," Accessibility ",-1)),zu={class:"user-line"},Fu={key:0},Ou=["onClick"],Hu=["src"],Nu={class:"center full-width full-height"},Wu=["src"],ju={class:"username"},Vu={style:{"text-align":"right"}},Ku={key:1,class:"admin_hint"},Zu={key:0,colspan:"5"},Gu=M({__name:"UsersWidget",setup(o){const t=w([]),e=U(()=>J().user.is_admin),n=ee().conn,s=w(!1),i=w({});function l(y){if(!e.value)return;const b=JSON.parse(JSON.stringify(y));i.value=b,i.value.max_storage/=1024*1024,s.value=!0}function r(y){const b=y.split(";").map(T=>T.trim());b.length===1&&b[0]===""?i.value.mandatory_tags=[]:i.value.mandatory_tags=b}function d(){console.log(i.value),n.updateUserAccess(i.value.username,i.value.is_admin,i.value.mandatory_tags,i.value.max_storage*1024*1024).then(y=>{s.value=!1},y=>{console.log(y),N().showPopup(y,"error")})}const g=w(!1),u=w("");function c(){if(u.value!==i.value.username){N().showPopup("Wrong input","error");return}n.deleteUser(i.value.username).then(y=>{N().showPopup(`User ${i.value.username} deleted`,"info"),g.value=!1,s.value=!1},y=>{console.log(y),N().showPopup(y,"error")})}const m=w(!1),f=w(""),h=w(Pe[Math.floor(Math.random()*Pe.length)]),k=w(""),C=w(!1),D=w(""),_=w(100);function P(){m.value=!1,f.value="",h.value=Pe[Math.floor(Math.random()*Pe.length)],k.value="",C.value=!1,D.value=""}function S(){if(f.value===""){N().showPopup("Please enter the username","error");return}const y=D.value.split(";").map(b=>b.trim());y.length===1&&y[0]===""&&y.splice(0,1),n.createUser(f.value,h.value,k.value,C.value,y,_.value).then(b=>{N().showPopup(`User ${f.value} created`,"success"),P()},b=>{console.log(b),N().showPopup(b,"error")})}return he(()=>{n.reqUserList().then(y=>{t.value=y},y=>{console.log(y)})}),de("add_user",y=>{const b=y.user_info;t.value.push(b)}),de("update_user",y=>{const b=y.user_info;t.value.map((T,Z)=>{T.id===b.id&&(t.value[Z]=b)})}),de("delete_user",y=>{const b=y.username;t.value=t.value.filter(T=>T.username!==b)}),(y,b)=>(p(),v("div",su,[$(xe,{show:s.value,"onUpdate:show":b[4]||(b[4]=T=>s.value=T),title:"editor",onOnAccept:d,onOnCancel:b[5]||(b[5]=()=>s.value=!1)},{default:B(()=>[a("div",iu,[a("div",lu,[a("img",{src:`${x(qe)()}/user-avatar/${i.value.username}?size=128`,alt:"",class:"avatar-big"},null,8,ru),a("div",uu,[a("div",cu,[a("h2",null,I(i.value.name),1),q(" ("+I(i.value.username)+") ",1)]),a("div",du,[hu,$(Te,{checked:i.value.is_admin,"onUpdate:checked":b[0]||(b[0]=T=>i.value.is_admin=T)},null,8,["checked"])]),a("div",pu,[fu,mu,V(a("input",{type:"number","onUpdate:modelValue":b[1]||(b[1]=T=>i.value.max_storage=T)},null,512),[[X,i.value.max_storage]])]),i.value.is_admin?A("",!0):(p(),v("div",vu,[gu,a("div",_u,[$(x(ot),{style:{width:"100%"},"content-editable":!i.value.is_admin,onFinish:b[2]||(b[2]=T=>r(T))},{default:B(()=>[q(I(i.value.mandatory_tags.join("; ")),1)]),_:1},8,["content-editable"])])]))])]),a("input",{id:"delete-user-button",type:"button",value:"Delete user",onClick:b[3]||(b[3]=()=>{g.value=!0})})])]),_:1},8,["show"]),$(xe,{show:g.value,"onUpdate:show":b[7]||(b[7]=T=>g.value=T),title:"Delete user",onOnCancel:b[8]||(b[8]=()=>{g.value=!1,u.value=""}),onOnClose:b[9]||(b[9]=()=>{g.value=!1,u.value=""}),onOnAccept:c},{default:B(()=>[a("div",yu,[a("p",null,[q(" Are you sure to delete user "),a("b",null,I(i.value.name)+" ("+I(i.value.username)+")",1),q("? "),wu]),bu,q(" Type "),a("b",null,I(i.value.username),1),q(" to confirm: "),V(a("input",{type:"text",id:"delete-user-input","onUpdate:modelValue":b[6]||(b[6]=T=>u.value=T),autocomplete:"off"},null,512),[[X,u.value]])])]),_:1},8,["show"]),$(xe,{show:m.value,"onUpdate:show":b[16]||(b[16]=T=>m.value=T),onOnCancel:P,onOnAccept:S,onOnClose:P},{default:B(()=>[a("div",ku,[a("table",$u,[a("tr",null,[Su,a("td",null,[V(a("input",{type:"text","onUpdate:modelValue":b[10]||(b[10]=T=>f.value=T),autocomplete:"off",class:"create-user-input"},null,512),[[X,f.value]])])]),a("tr",null,[xu,a("td",null,[V(a("input",{type:"text","onUpdate:modelValue":b[11]||(b[11]=T=>h.value=T),autocomplete:"off",class:"create-user-input"},null,512),[[X,h.value]])])]),a("tr",null,[Du,a("td",null,[V(a("input",{type:"text","onUpdate:modelValue":b[12]||(b[12]=T=>k.value=T),autocomplete:"off",class:"create-user-input"},null,512),[[X,k.value]])])]),a("tr",null,[Cu,a("td",null,[V(a("input",{type:"text","onUpdate:modelValue":b[13]||(b[13]=T=>_.value=T),autocomplete:"off",class:"create-user-input"},null,512),[[X,_.value]])])]),a("tr",null,[Pu,a("td",null,[V(a("input",{type:"text","onUpdate:modelValue":b[14]||(b[14]=T=>D.value=T),autocomplete:"off",class:"create-user-input",placeholder:"Separate with semicolon ';'"},null,512),[[X,D.value]])])]),a("tr",null,[Iu,a("td",Tu,[$(Te,{checked:C.value,"onUpdate:checked":b[15]||(b[15]=T=>C.value=T)},null,8,["checked"])])])])])]),_:1},8,["show"]),a("div",Uu,[Ru,e.value?(p(),v("div",{key:0,id:"add-user-div",onClick:b[17]||(b[17]=()=>m.value=!0)},"+")):A("",!0)]),a("table",null,[a("tr",null,[e.value?(p(),v("th",Au)):A("",!0),Bu,Mu,Lu,qu,Eu]),(p(!0),v(H,null,te(t.value,T=>(p(),v("tr",zu,[e.value?(p(),v("td",Fu,[a("div",{class:"edit-button",onClick:()=>l(T)},[a("img",{src:x(ou),alt:"",class:"icon"},null,8,Hu)],8,Ou)])):A("",!0),a("td",null,[a("div",Nu,[a("img",{src:`${x(qe)()}/user-avatar/${T.username}?size=60`,alt:"",class:"avatar"},null,8,Wu)])]),a("td",ju,I(T.username),1),a("td",null,I(T.name),1),a("td",Vu,I(T.max_storage/1024/1024>1024?`${(T.max_storage/1024/1024/1024).toFixed(1)} G`:`${(T.max_storage/1024/1024).toFixed(0)} M`),1),a("td",null,[T.is_admin?(p(),v("label",Ku,"ADMIN")):(p(),Y(tt,{key:0,tags:T.mandatory_tags,"max-width":200,"middle-align":!0},null,8,["tags"]))])]))),256)),a("tr",null,[t.value.length===0?(p(),v("td",Zu," No users ")):A("",!0)])])]))}}),At=E(Gu,[["__scopeId","data-v-d5b9d887"]]),ce=o=>(se("data-v-2f65f22c"),o=o(),ie(),o),Ju={class:"toolbar"},Qu={id:"about-main",class:"slideIn"},Yu=ce(()=>a("h1",null,"About",-1)),Xu=ce(()=>a("div",{class:"content"},[a("p",null,[q(" Lires is a self-hosted web application for research literature management. "),a("br"),q(" It is open source and available at "),a("a",{href:"https://github.com/MenxLi/Lires",target:"_blank"},"GitHub - MenxLi/Lires"),q(". "),a("br")])],-1)),ec={class:"content"},tc=ce(()=>a("h2",null," Resources ",-1)),ac=["href"],nc=ce(()=>a("b",null,"User manual",-1)),oc=[nc],sc=["href"],ic=["href"],lc=["href"],rc={class:"content"},uc=ce(()=>a("h2",null," Dashboard ",-1)),cc=ce(()=>a("summary",null,"Server status ",-1)),dc=ce(()=>a("b",null,"Backend",-1)),hc=ce(()=>a("b",null,"Version",-1)),pc=ce(()=>a("b",null,"Uptime",-1)),fc=ce(()=>a("b",null,"Connection count",-1)),mc={key:0},vc=ce(()=>a("b",null,"Total connection count",-1)),gc={key:0},_c=ce(()=>a("summary",null," User management ",-1)),yc={style:{border:"1px solid var(--color-border)","border-radius":"10px",display:"flex","justify-content":"center","margin-block":"10px",padding:"10px",width:"100%"}},wc={class:"content link-container"},bc=["href"],kc=["href"],$c={id:"versionHistory",class:"content"},Sc=ce(()=>a("h1",{style:{"margin-bottom":"0px"}}," Version history ",-1)),xc={class:"block"},Dc={key:0},Cc={key:1},Pc=M({__name:"About",setup(o){const t=w([]),e=w(!1),n=ee().conn,s=J().user.is_admin,i=()=>{n.changelog().then(c=>{t.value=c},c=>{console.error(c)})},l=w(-1),r=U(()=>{if(l.value===-1)return"N/A";const c=Math.floor(l.value/3600),m=Math.floor((l.value-c*3600)/60),f=Math.floor(l.value-c*3600-m*60);return`${c}h ${m}m ${f}s`}),d=w({backend:qe(),version:"",uptime:r,_uptime:-1,numDocs:-1,numConnections:-1,numConnectionsAll:-1}),g=()=>{n.status().then(c=>{l.value=c.uptime,d.value.version=c.version,d.value.numDocs=c.n_data,d.value.numConnections=c.n_connections,d.value.numConnectionsAll=c.n_connections_all},c=>{console.error(c)})},u=U(()=>t.value.slice().reverse());return i(),g(),window.setInterval(()=>l.value++,1e3),de("login",c=>{d.value.numConnectionsAll++,c.user_info.id==J().user.id&&d.value.numConnections++}),de("logout",c=>{d.value.numConnectionsAll--,c.user_info.id==J().user.id&&d.value.numConnections--}),(c,m)=>(p(),v(H,null,[a("div",Ju,[$(ze)]),a("div",Qu,[Yu,Xu,a("div",ec,[tc,a("ul",null,[a("li",null,[a("a",{class:"resource",href:x(gs),target:"_blank"},oc,8,ac)]),a("li",null,[a("a",{class:"resource",onClick:m[0]||(m[0]=f=>e.value=!0),style:{cursor:"pointer"}},"Change log")]),a("li",null,[a("a",{class:"resource",href:x(W)().backend()+`/_resources/lires-obsidian-plugin.zip?key=${x(W)().encKey}`},"Obsidian plugin",8,sc)]),a("li",null,[a("a",{class:"resource",href:x(W)().backend()+`/_resources/api.zip?key=${x(W)().encKey}`},"API-Javascript",8,ic)]),a("li",null,[a("a",{class:"resource",href:x(W)().backend()+`/_resources/api.py?key=${x(W)().encKey}`},"API-Python",8,lc)])])]),a("div",rc,[uc,a("details",null,[cc,a("ul",null,[a("li",null,[dc,q(": "+I(d.value.backend),1)]),a("li",null,[hc,q(": "+I(d.value.version),1)]),a("li",null,[pc,q(": "+I(d.value.uptime),1)]),a("li",null,[fc,q(": "+I(d.value.numConnections),1)]),x(s)?(p(),v("li",mc,[vc,q(": "+I(d.value.numConnectionsAll),1)])):A("",!0)])]),x(s)?(p(),v("details",gc,[_c,a("div",yc,[$(At)])])):A("",!0)]),a("div",wc,[a("a",{href:x(n).resolve.databaseDownload(!1),target:"_blank"},"Download database index",8,bc),q(" | "),a("a",{href:x(n).resolve.databaseDownload(!0),target:"_blank"},"Download full database",8,kc)]),$(ke,{show:e.value,"onUpdate:show":m[1]||(m[1]=f=>e.value=f),title:"Change log"},{default:B(()=>[a("div",$c,[Sc,(p(!0),v(H,null,te(u.value.length,f=>(p(),v("div",xc,[a("h2",null,I(u.value[f-1][0].toString()),1),a("ul",null,[(p(!0),v(H,null,te(u.value[f-1][1],h=>(p(),v("li",null,[typeof h=="string"?(p(),v("div",Dc,I(h),1)):typeof h=="object"?(p(),v("div",Cc,[q(I(Object.keys(h)[0])+" ",1),a("ul",null,[(p(!0),v(H,null,te(h[Object.keys(h)[0]],k=>(p(),v("li",null,I(k),1))),256))])])):A("",!0)]))),256))])]))),256))])]),_:1},8,["show"])])],64))}}),Ic=E(Pc,[["__scopeId","data-v-2f65f22c"]]),Tc={},Uc={id:"widget-container-main"};function Rc(o,t){return p(),v("div",Uc,[fe(o.$slots,"default",{},void 0)])}const Ac=E(Tc,[["render",Rc],["__scopeId","data-v-257ac3c4"]]),Bc={id:"main-dashboard",class:"slideIn"},Mc=M({__name:"Dashboard",setup(o){return(t,e)=>(p(),v(H,null,[$(ze),a("div",Bc,[$(Ac,null,{default:B(()=>[$(At)]),_:1})])],64))}}),Lc=E(Mc,[["__scopeId","data-v-6b501763"]]),Fe=o=>(se("data-v-3b8741a7"),o=o(),ie(),o),qc={key:0,class:"test"},Ec=Fe(()=>a("td",null," Test API ",-1)),zc=Fe(()=>a("td",null," HTTP Method ",-1)),Fc=["value"],Oc=Fe(()=>a("td",null," Request Body ",-1)),Hc=["onUpdate:modelValue"],Nc=["onUpdate:modelValue"],Wc=["onClick"],jc=Fe(()=>a("button",{type:"submit"},"Send Request",-1)),Vc={key:0,style:{"text-align":"left"}},Kc=Fe(()=>a("h2",{style:{"font-weight":"bold"}},"Response",-1)),Zc={key:1},Gc=M({__name:"_Test",setup(o){const e=["get","post","put","delete"],n=w("post"),s=w(""),i=ee().conn.fetcher,l=w([{key:"",value:""}]),r=U(()=>{const u={};return l.value.forEach(c=>{c.key&&(u[c.key]=c.value)}),u}),d=w("");async function g(){if(n.value&&s.value)try{let u;switch(n.value){case"get":u=await i.get(s.value,r.value);break;case"post":u=await i.post(s.value,r.value);break;case"delete":u=await i.delete(s.value,r.value);break;case"put":throw new Error("PUT method is not implemented yet")}d.value=await(u==null?void 0:u.json())}catch(u){console.error("HTTP request failed:",u),d.value=u.toString()}}return(u,c)=>x(!1)?(p(),v("div",qc,[a("form",{onSubmit:He(g,["prevent"])},[a("table",null,[a("tr",null,[Ec,a("td",null,[V(a("input",{type:"text","onUpdate:modelValue":c[0]||(c[0]=m=>s.value=m),placeholder:"/api/xxx",autocomplete:"off",autocorrect:"off",autocapitalize:"off",spellcheck:"false"},null,512),[[X,s.value]])])]),a("tr",null,[zc,a("td",null,[V(a("select",{"onUpdate:modelValue":c[1]||(c[1]=m=>n.value=m),style:{width:"100%"}},[(p(),v(H,null,te(e,m=>a("option",{value:m},I(m.toUpperCase()),9,Fc)),64))],512),[[Le,n.value]])])]),a("tr",null,[Oc,a("td",null,[(p(!0),v(H,null,te(l.value,(m,f)=>(p(),v("div",{key:f,style:{display:"flex",gap:"0.5rem","margin-bottom":"0.5rem"}},[V(a("input",{type:"text","onUpdate:modelValue":h=>l.value[f].key=h,placeholder:"key",autocomplete:"off",autocorrect:"off",autocapitalize:"off",spellcheck:"false"},null,8,Hc),[[X,l.value[f].key]]),V(a("input",{type:"text","onUpdate:modelValue":h=>l.value[f].value=h,placeholder:"value",style:{"flex-grow":"1"},autocomplete:"off",autocorrect:"off",autocapitalize:"off",spellcheck:"false"},null,8,Nc),[[X,l.value[f].value]]),a("a",{onClick:He(h=>l.value.splice(f,1),["prevent"]),style:{cursor:"pointer","padding-inline":"0.5rem","border-radius":"0.5rem"}}," Remove ",8,Wc)]))),128)),a("button",{onClick:c[2]||(c[2]=He(m=>l.value.push({key:"",value:""}),["prevent"]))},"Add Field")])])]),jc],32),d.value?(p(),v("div",Vc,[Kc,a("pre",null,I(d.value),1)])):A("",!0)])):(p(),v("p",Zc," Test is not available in production "))}}),Jc=E(Gc,[["__scopeId","data-v-3b8741a7"]]),Qc=[{path:"/",component:xl},{path:"/feed",component:rr},{path:"/login",component:Nr},{path:"/reader/:id",component:nu},{path:"/about",component:Ic},{path:"/dashboard/:username",component:Lc},{path:"/_test",component:Jc}],Yc=Kt({history:Zt(),routes:Qc}),Xc=Vt();jt(xa).use(Xc).use(Yc).mount("#app");
