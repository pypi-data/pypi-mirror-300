{"version":3,"file":"c969572ba3fabb7eab5a.chunk.js","mappings":"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","sources":["webpack://superset/../../../src/lib/composite-layer.ts","webpack://superset/./plugins/legacy-preset-chart-deckgl/src/components/Tooltip.tsx","webpack://superset/./plugins/legacy-preset-chart-deckgl/src/DeckGLContainer.tsx","webpack://superset/./plugins/legacy-preset-chart-deckgl/src/TooltipRow.tsx","webpack://superset/./plugins/legacy-preset-chart-deckgl/src/layers/Geojson/Geojson.tsx","webpack://superset/./plugins/legacy-preset-chart-deckgl/src/layers/common.tsx","webpack://superset/./plugins/legacy-preset-chart-deckgl/src/utils/colors.ts","webpack://superset/./plugins/legacy-preset-chart-deckgl/src/utils/computeBoundsFromPoints.ts","webpack://superset/./plugins/legacy-preset-chart-deckgl/src/utils/fitViewport.ts","webpack://superset/./plugins/legacy-preset-chart-deckgl/src/utils/sandbox.ts"],"sourcesContent":["// Copyright (c) 2015 - 2017 Uber Technologies, Inc.\n//\n// Permission is hereby granted, free of charge, to any person obtaining a copy\n// of this software and associated documentation files (the \"Software\"), to deal\n// in the Software without restriction, including without limitation the rights\n// to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n// copies of the Software, and to permit persons to whom the Software is\n// furnished to do so, subject to the following conditions:\n//\n// The above copyright notice and this permission notice shall be included in\n// all copies or substantial portions of the Software.\n//\n// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n// IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n// FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n// AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n// LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n// OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n// THE SOFTWARE.\nimport Layer, {UpdateParameters} from './layer';\nimport debug from '../debug';\nimport {flatten} from '../utils/flatten';\n\nimport type AttributeManager from './attribute/attribute-manager';\nimport type {PickingInfo, GetPickingInfoParams} from './picking/pick-info';\nimport type {FilterContext} from '../passes/layers-pass';\nimport type {LayersList, LayerContext} from './layer-manager';\nimport type {CompositeLayerProps, Accessor, AccessorContext} from '../types/layer-props';\nimport {ConstructorOf} from '../types/types';\nimport {PROP_TYPES_SYMBOL} from '../lifecycle/constants';\n\nconst TRACE_RENDER_LAYERS = 'compositeLayer.renderLayers';\n\nexport default abstract class CompositeLayer<PropsT extends {} = {}> extends Layer<\n  PropsT & Required<CompositeLayerProps>\n> {\n  static layerName: string = 'CompositeLayer';\n\n  /** `true` if this layer renders other layers */\n  get isComposite(): boolean {\n    return true;\n  }\n\n  /** Returns true if all async resources are loaded */\n  get isLoaded(): boolean {\n    return super.isLoaded && this.getSubLayers().every(layer => layer.isLoaded);\n  }\n\n  /** Return last rendered sub layers */\n  getSubLayers(): Layer[] {\n    return (this.internalState && this.internalState.subLayers) || [];\n  }\n\n  // initializeState is usually not needed for composite layers\n  // Provide empty definition to disable check for missing definition\n  // eslint-disable-next-line @typescript-eslint/no-empty-function\n  initializeState(context: LayerContext): void {}\n\n  /** Updates selected state members and marks the composite layer to need rerender */\n  setState(updateObject: any): void {\n    super.setState(updateObject);\n    // Trigger a layer update\n    // Although conceptually layer.draw and compositeLayer.renderLayers are equivalent,\n    // they are executed during different lifecycles.\n    // draw can be called without calling updateState (e.g. most viewport changes),\n    // while renderLayers can only be called during a recursive layer update.\n    this.setNeedsUpdate();\n  }\n\n  /** called to augment the info object that is bubbled up from a sublayer\n      override Layer.getPickingInfo() because decoding / setting uniform do\n      not apply to a composite layer. */\n  getPickingInfo({info}: GetPickingInfoParams): PickingInfo {\n    const {object} = info;\n    const isDataWrapped =\n      object && object.__source && object.__source.parent && object.__source.parent.id === this.id;\n\n    if (!isDataWrapped) {\n      return info;\n    }\n\n    // override object with picked data\n    info.object = object.__source.object;\n    info.index = object.__source.index;\n\n    return info;\n  }\n\n  // Implement to generate subLayers\n  abstract renderLayers(): Layer | null | LayersList;\n\n  /**\n   * Filters sub layers at draw time. Return true if the sub layer should be drawn.\n   */\n  filterSubLayer(context: FilterContext): boolean {\n    return true;\n  }\n\n  /** Returns true if sub layer needs to be rendered */\n  protected shouldRenderSubLayer(subLayerId: string, data: any): boolean {\n    return data && data.length;\n  }\n\n  /** Returns sub layer class for a specific sublayer */\n  protected getSubLayerClass<T extends Layer>(\n    subLayerId: string,\n    DefaultLayerClass: ConstructorOf<T>\n  ): ConstructorOf<T> {\n    const {_subLayerProps: overridingProps} = this.props;\n\n    return (\n      (overridingProps &&\n        overridingProps[subLayerId] &&\n        (overridingProps[subLayerId].type as ConstructorOf<T>)) ||\n      DefaultLayerClass\n    );\n  }\n\n  /** When casting user data into another format to pass to sublayers,\n      add reference to the original object and object index */\n  protected getSubLayerRow<T>(row: T, sourceObject: any, sourceObjectIndex: number): T {\n    // @ts-ignore (TS2339) adding undefined property\n    row.__source = {\n      parent: this,\n      object: sourceObject,\n      index: sourceObjectIndex\n    };\n    return row;\n  }\n\n  /** Some composite layers cast user data into another format before passing to sublayers\n    We need to unwrap them before calling the accessor so that they see the original data\n    objects */\n  protected getSubLayerAccessor<In, Out>(accessor: Accessor<In, Out>): Accessor<In, Out> {\n    if (typeof accessor === 'function') {\n      const objectInfo: AccessorContext<In> = {\n        index: -1,\n        // @ts-ignore accessing resolved data\n        data: this.props.data,\n        target: []\n      };\n      return (x: any, i: AccessorContext<In>) => {\n        if (x && x.__source) {\n          objectInfo.index = x.__source.index;\n          // @ts-ignore (TS2349) Out is never a function\n          return accessor(x.__source.object as In, objectInfo);\n        }\n        // @ts-ignore (TS2349) Out is never a function\n        return accessor(x as In, i);\n      };\n    }\n    return accessor;\n  }\n\n  /** Returns sub layer props for a specific sublayer */\n  // eslint-disable-next-line complexity\n  protected getSubLayerProps(\n    sublayerProps: {\n      id?: string;\n      updateTriggers?: Record<string, any>;\n      [propName: string]: any;\n    } = {}\n  ): any {\n    const {\n      opacity,\n      pickable,\n      visible,\n      parameters,\n      getPolygonOffset,\n      highlightedObjectIndex,\n      autoHighlight,\n      highlightColor,\n      coordinateSystem,\n      coordinateOrigin,\n      wrapLongitude,\n      positionFormat,\n      modelMatrix,\n      extensions,\n      fetch,\n      operation,\n      _subLayerProps: overridingProps\n    } = this.props;\n    const newProps = {\n      id: '',\n      updateTriggers: {},\n      opacity,\n      pickable,\n      visible,\n      parameters,\n      getPolygonOffset,\n      highlightedObjectIndex,\n      autoHighlight,\n      highlightColor,\n      coordinateSystem,\n      coordinateOrigin,\n      wrapLongitude,\n      positionFormat,\n      modelMatrix,\n      extensions,\n      fetch,\n      operation\n    };\n\n    const overridingSublayerProps =\n      overridingProps && sublayerProps.id && overridingProps[sublayerProps.id];\n    const overridingSublayerTriggers =\n      overridingSublayerProps && overridingSublayerProps.updateTriggers;\n    const sublayerId = sublayerProps.id || 'sublayer';\n\n    if (overridingSublayerProps) {\n      const propTypes = this.props[PROP_TYPES_SYMBOL];\n      const subLayerPropTypes = sublayerProps.type ? sublayerProps.type._propTypes : {};\n      for (const key in overridingSublayerProps) {\n        const propType = subLayerPropTypes[key] || propTypes[key];\n        // eslint-disable-next-line\n        if (propType && propType.type === 'accessor') {\n          overridingSublayerProps[key] = this.getSubLayerAccessor(overridingSublayerProps[key]);\n        }\n      }\n    }\n\n    Object.assign(\n      newProps,\n      sublayerProps,\n      // experimental feature that allows users to override sublayer props via parent layer prop\n      overridingSublayerProps\n    );\n    newProps.id = `${this.props.id}-${sublayerId}`;\n    newProps.updateTriggers = {\n      all: this.props.updateTriggers?.all,\n      ...sublayerProps.updateTriggers,\n      ...overridingSublayerTriggers\n    };\n\n    // Pass through extension props\n    // @ts-ignore (TS2532) extensions is always defined after merging with default props\n    for (const extension of extensions) {\n      const passThroughProps = extension.getSubLayerProps.call(this, extension);\n      if (passThroughProps) {\n        Object.assign(newProps, passThroughProps, {\n          updateTriggers: Object.assign(newProps.updateTriggers, passThroughProps.updateTriggers)\n        });\n      }\n    }\n\n    return newProps;\n  }\n\n  /** Update sub layers to highlight the hovered object */\n  protected _updateAutoHighlight(info: PickingInfo): void {\n    for (const layer of this.getSubLayers()) {\n      layer.updateAutoHighlight(info);\n    }\n  }\n\n  /** Override base Layer method */\n  protected _getAttributeManager(): AttributeManager | null {\n    return null;\n  }\n\n  /** (Internal) Called after an update to rerender sub layers */\n  protected _postUpdate(updateParams: UpdateParameters<this>, forceUpdate: boolean) {\n    // @ts-ignore (TS2531) this method is only called internally when internalState is defined\n    let subLayers = this.internalState.subLayers as Layer[];\n    const shouldUpdate = !subLayers || this.needsUpdate();\n    if (shouldUpdate) {\n      const subLayersList = this.renderLayers();\n      // Flatten the returned array, removing any null, undefined or false\n      // this allows layers to render sublayers conditionally\n      // (see CompositeLayer.renderLayers docs)\n      subLayers = flatten(subLayersList, Boolean) as Layer[];\n      // @ts-ignore (TS2531) this method is only called internally when internalState is defined\n      this.internalState.subLayers = subLayers;\n    }\n    debug(TRACE_RENDER_LAYERS, this, shouldUpdate, subLayers);\n\n    // populate reference to parent layer (this layer)\n    // NOTE: needs to be done even when reusing layers as the parent may have changed\n    for (const layer of subLayers) {\n      layer.parent = this;\n    }\n  }\n}\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\n\nimport { styled, safeHtmlSpan } from '@superset-ui/core';\nimport React, { ReactNode } from 'react';\n\nexport type TooltipProps = {\n  tooltip:\n    | {\n        x: number;\n        y: number;\n        content: ReactNode;\n      }\n    | null\n    | undefined;\n};\n\nconst StyledDiv = styled.div<{ top: number; left: number }>`\n  ${({ theme, top, left }) => `\n    position: absolute;\n    top: ${top}px;\n    left: ${left}px;\n    padding: ${theme.gridUnit * 2}px;\n    margin: ${theme.gridUnit * 2}px;\n    background: ${theme.colors.grayscale.dark2};\n    color: ${theme.colors.grayscale.light5};\n    maxWidth: 300px;\n    fontSize: ${theme.typography.sizes.s}px;\n    zIndex: 9;\n    pointerEvents: none;\n  `}\n`;\n\nexport default function Tooltip(props: TooltipProps) {\n  const { tooltip } = props;\n  if (typeof tooltip === 'undefined' || tooltip === null) {\n    return null;\n  }\n\n  const { x, y, content } = tooltip;\n  const safeContent =\n    typeof content === 'string' ? safeHtmlSpan(content) : content;\n\n  return (\n    <StyledDiv top={y} left={x}>\n      {safeContent}\n    </StyledDiv>\n  );\n}\n","/* eslint-disable react/jsx-sort-default-props */\n/* eslint-disable react/sort-prop-types */\n/* eslint-disable react/jsx-handler-names */\n/* eslint-disable react/forbid-prop-types */\n/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport React, {\n  forwardRef,\n  memo,\n  ReactNode,\n  useCallback,\n  useEffect,\n  useImperativeHandle,\n  useState,\n} from 'react';\nimport { isEqual } from 'lodash';\nimport { StaticMap } from 'react-map-gl';\nimport DeckGL, { Layer } from 'deck.gl/typed';\nimport { JsonObject, JsonValue, styled, usePrevious } from '@superset-ui/core';\nimport Tooltip, { TooltipProps } from './components/Tooltip';\nimport 'mapbox-gl/dist/mapbox-gl.css';\nimport { Viewport } from './utils/fitViewport';\n\nconst TICK = 250; // milliseconds\n\nexport type DeckGLContainerProps = {\n  viewport: Viewport;\n  setControlValue?: (control: string, value: JsonValue) => void;\n  mapStyle?: string;\n  mapboxApiAccessToken: string;\n  children?: ReactNode;\n  width: number;\n  height: number;\n  layers: (Layer | (() => Layer))[];\n  onViewportChange?: (viewport: Viewport) => void;\n};\n\nexport const DeckGLContainer = memo(\n  forwardRef((props: DeckGLContainerProps, ref) => {\n    const [tooltip, setTooltip] = useState<TooltipProps['tooltip']>(null);\n    const [lastUpdate, setLastUpdate] = useState<number | null>(null);\n    const [viewState, setViewState] = useState(props.viewport);\n    const prevViewport = usePrevious(props.viewport);\n\n    useImperativeHandle(ref, () => ({ setTooltip }), []);\n\n    const tick = useCallback(() => {\n      // Rate limiting updating viewport controls as it triggers lots of renders\n      if (lastUpdate && Date.now() - lastUpdate > TICK) {\n        const setCV = props.setControlValue;\n        if (setCV) {\n          setCV('viewport', viewState);\n        }\n        setLastUpdate(null);\n      }\n    }, [lastUpdate, props.setControlValue, viewState]);\n\n    useEffect(() => {\n      const timer = setInterval(tick, TICK);\n      return clearInterval(timer);\n    }, [tick]);\n\n    useEffect(() => {\n      if (!isEqual(props.viewport, prevViewport)) {\n        setViewState(props.viewport);\n      }\n    }, [prevViewport, props.viewport]);\n\n    const onViewStateChange = useCallback(\n      ({ viewState }: { viewState: JsonObject }) => {\n        setViewState(viewState as Viewport);\n        setLastUpdate(Date.now());\n      },\n      [],\n    );\n\n    const layers = useCallback(() => {\n      // Support for layer factory\n      if (props.layers.some(l => typeof l === 'function')) {\n        return props.layers.map(l =>\n          typeof l === 'function' ? l() : l,\n        ) as Layer[];\n      }\n\n      return props.layers as Layer[];\n    }, [props.layers]);\n\n    const { children = null, height, width } = props;\n\n    return (\n      <>\n        <div style={{ position: 'relative', width, height }}>\n          <DeckGL\n            controller\n            width={width}\n            height={height}\n            layers={layers()}\n            viewState={viewState}\n            glOptions={{ preserveDrawingBuffer: true }}\n            onViewStateChange={onViewStateChange}\n          >\n            <StaticMap\n              preserveDrawingBuffer\n              mapStyle={props.mapStyle || 'light'}\n              mapboxApiAccessToken={props.mapboxApiAccessToken}\n            />\n          </DeckGL>\n          {children}\n        </div>\n        <Tooltip tooltip={tooltip} />\n      </>\n    );\n  }),\n);\n\nexport const DeckGLContainerStyledWrapper = styled(DeckGLContainer)`\n  .deckgl-tooltip > div {\n    overflow: hidden;\n    text-overflow: ellipsis;\n  }\n`;\n\nexport type DeckGLContainerHandle = typeof DeckGLContainer & {\n  setTooltip: (tooltip: ReactNode) => void;\n};\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport React from 'react';\n\ntype TooltipRowProps = {\n  label: string;\n  value: string;\n};\n\nconst TooltipRow = ({ label, value }: TooltipRowProps) => (\n  <div>\n    {label}\n    <strong>{value}</strong>\n  </div>\n);\n\nexport default TooltipRow;\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport React, { memo, useCallback, useMemo, useRef } from 'react';\nimport { GeoJsonLayer } from 'deck.gl/typed';\nimport geojsonExtent from '@mapbox/geojson-extent';\nimport {\n  HandlerFunction,\n  JsonObject,\n  JsonValue,\n  QueryFormData,\n} from '@superset-ui/core';\n\nimport {\n  DeckGLContainerHandle,\n  DeckGLContainerStyledWrapper,\n} from '../../DeckGLContainer';\nimport { hexToRGB } from '../../utils/colors';\nimport sandboxedEval from '../../utils/sandbox';\nimport { commonLayerProps } from '../common';\nimport TooltipRow from '../../TooltipRow';\nimport fitViewport, { Viewport } from '../../utils/fitViewport';\nimport { TooltipProps } from '../../components/Tooltip';\n\nconst propertyMap = {\n  fillColor: 'fillColor',\n  color: 'fillColor',\n  fill: 'fillColor',\n  'fill-color': 'fillColor',\n  strokeColor: 'strokeColor',\n  'stroke-color': 'strokeColor',\n  'stroke-width': 'strokeWidth',\n};\n\nconst alterProps = (props: JsonObject, propOverrides: JsonObject) => {\n  const newProps: JsonObject = {};\n  Object.keys(props).forEach(k => {\n    if (k in propertyMap) {\n      newProps[propertyMap[k]] = props[k];\n    } else {\n      newProps[k] = props[k];\n    }\n  });\n  if (typeof props.fillColor === 'string') {\n    newProps.fillColor = hexToRGB(props.fillColor);\n  }\n  if (typeof props.strokeColor === 'string') {\n    newProps.strokeColor = hexToRGB(props.strokeColor);\n  }\n\n  return {\n    ...newProps,\n    ...propOverrides,\n  };\n};\nlet features: JsonObject[];\nconst recurseGeoJson = (\n  node: JsonObject,\n  propOverrides: JsonObject,\n  extraProps?: JsonObject,\n) => {\n  if (node?.features) {\n    node.features.forEach((obj: JsonObject) => {\n      recurseGeoJson(obj, propOverrides, node.extraProps || extraProps);\n    });\n  }\n  if (node?.geometry) {\n    const newNode = {\n      ...node,\n      properties: alterProps(node.properties, propOverrides),\n    } as JsonObject;\n    if (!newNode.extraProps) {\n      newNode.extraProps = extraProps;\n    }\n    features.push(newNode);\n  }\n};\n\nfunction setTooltipContent(o: JsonObject) {\n  return (\n    o.object.extraProps && (\n      <div className=\"deckgl-tooltip\">\n        {Object.keys(o.object.extraProps).map((prop, index) => (\n          <TooltipRow\n            key={`prop-${index}`}\n            label={`${prop}: `}\n            value={`${o.object.extraProps[prop]}`}\n          />\n        ))}\n      </div>\n    )\n  );\n}\n\nconst getFillColor = (feature: JsonObject) => feature?.properties?.fillColor;\nconst getLineColor = (feature: JsonObject) => feature?.properties?.strokeColor;\n\nexport function getLayer(\n  formData: QueryFormData,\n  payload: JsonObject,\n  onAddFilter: HandlerFunction,\n  setTooltip: (tooltip: TooltipProps['tooltip']) => void,\n) {\n  const fd = formData;\n  const fc = fd.fill_color_picker;\n  const sc = fd.stroke_color_picker;\n  const fillColor = [fc.r, fc.g, fc.b, 255 * fc.a];\n  const strokeColor = [sc.r, sc.g, sc.b, 255 * sc.a];\n  const propOverrides: JsonObject = {};\n  if (fillColor[3] > 0) {\n    propOverrides.fillColor = fillColor;\n  }\n  if (strokeColor[3] > 0) {\n    propOverrides.strokeColor = strokeColor;\n  }\n\n  features = [];\n  recurseGeoJson(payload.data, propOverrides);\n\n  let jsFnMutator;\n  if (fd.js_data_mutator) {\n    // Applying user defined data mutator if defined\n    jsFnMutator = sandboxedEval(fd.js_data_mutator);\n    features = jsFnMutator(features);\n  }\n\n  return new GeoJsonLayer({\n    id: `geojson-layer-${fd.slice_id}` as const,\n    data: features,\n    extruded: fd.extruded,\n    filled: fd.filled,\n    stroked: fd.stroked,\n    getFillColor,\n    getLineColor,\n    getLineWidth: fd.line_width || 1,\n    pointRadiusScale: fd.point_radius_scale,\n    lineWidthUnits: fd.line_width_unit,\n    ...commonLayerProps(fd, setTooltip, setTooltipContent),\n  });\n}\n\nexport type DeckGLGeoJsonProps = {\n  formData: QueryFormData;\n  payload: JsonObject;\n  setControlValue: (control: string, value: JsonValue) => void;\n  viewport: Viewport;\n  onAddFilter: HandlerFunction;\n  height: number;\n  width: number;\n};\n\nconst DeckGLGeoJson = (props: DeckGLGeoJsonProps) => {\n  const containerRef = useRef<DeckGLContainerHandle>();\n  const setTooltip = useCallback((tooltip: TooltipProps['tooltip']) => {\n    const { current } = containerRef;\n    if (current) {\n      current.setTooltip(tooltip);\n    }\n  }, []);\n\n  const { formData, payload, setControlValue, onAddFilter, height, width } =\n    props;\n\n  const viewport: Viewport = useMemo(() => {\n    if (formData.autozoom) {\n      const points =\n        payload?.data?.features?.reduce?.(\n          (acc: [number, number, number, number][], feature: any) => {\n            const bounds = geojsonExtent(feature);\n            if (bounds) {\n              return [...acc, [bounds[0], bounds[1]], [bounds[2], bounds[3]]];\n            }\n\n            return acc;\n          },\n          [],\n        ) || [];\n\n      if (points.length) {\n        return fitViewport(props.viewport, {\n          width,\n          height,\n          points,\n        });\n      }\n    }\n    return props.viewport;\n  }, [\n    formData.autozoom,\n    height,\n    payload?.data?.features,\n    props.viewport,\n    width,\n  ]);\n\n  const layer = getLayer(formData, payload, onAddFilter, setTooltip);\n\n  return (\n    <DeckGLContainerStyledWrapper\n      ref={containerRef}\n      mapboxApiAccessToken={payload.data.mapboxApiKey}\n      viewport={viewport}\n      layers={[layer]}\n      mapStyle={formData.mapbox_style}\n      setControlValue={setControlValue}\n      height={height}\n      width={width}\n    />\n  );\n};\n\nexport default memo(DeckGLGeoJson);\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport { ReactNode } from 'react';\nimport * as d3array from 'd3-array';\nimport { JsonObject, JsonValue, QueryFormData } from '@superset-ui/core';\nimport sandboxedEval from '../utils/sandbox';\nimport { TooltipProps } from '../components/Tooltip';\n\nexport function commonLayerProps(\n  formData: QueryFormData,\n  setTooltip: (tooltip: TooltipProps['tooltip']) => void,\n  setTooltipContent: (content: JsonObject) => ReactNode,\n  onSelect?: (value: JsonValue) => void,\n) {\n  const fd = formData;\n  let onHover;\n  let tooltipContentGenerator = setTooltipContent;\n  if (fd.js_tooltip) {\n    tooltipContentGenerator = sandboxedEval(fd.js_tooltip);\n  }\n  if (tooltipContentGenerator) {\n    onHover = (o: JsonObject) => {\n      if (o.picked) {\n        setTooltip({\n          content: tooltipContentGenerator(o),\n          x: o.x,\n          y: o.y,\n        });\n      } else {\n        setTooltip(null);\n      }\n      return true;\n    };\n  }\n  let onClick;\n  if (fd.js_onclick_href) {\n    onClick = (o: any) => {\n      const href = sandboxedEval(fd.js_onclick_href)(o);\n      window.open(href);\n      return true;\n    };\n  } else if (fd.table_filter && onSelect !== undefined) {\n    onClick = (o: any) => {\n      onSelect(o.object[fd.line_column]);\n      return true;\n    };\n  }\n\n  return {\n    onClick,\n    onHover,\n    pickable: Boolean(onHover),\n  };\n}\n\nconst percentiles = {\n  p1: 0.01,\n  p5: 0.05,\n  p95: 0.95,\n  p99: 0.99,\n};\n\n/* Get a stat function that operates on arrays, aligns with control=js_agg_function  */\nexport function getAggFunc(\n  type = 'sum',\n  accessor: ((object: any) => number | undefined) | null = null,\n) {\n  if (type === 'count') {\n    return (arr: number[]) => arr.length;\n  }\n  let d3func: (\n    iterable: Array<unknown>,\n    accessor?: (object: JsonObject) => number | undefined,\n  ) => number[] | number | undefined;\n  if (type in percentiles) {\n    d3func = (arr, acc: (object: JsonObject) => number | undefined) => {\n      let sortedArr;\n      if (accessor) {\n        sortedArr = arr.sort((o1: JsonObject, o2: JsonObject) =>\n          d3array.ascending(accessor(o1), accessor(o2)),\n        );\n      } else {\n        sortedArr = arr.sort(d3array.ascending);\n      }\n\n      return d3array.quantile(sortedArr, percentiles[type], acc);\n    };\n  } else {\n    d3func = d3array[type];\n  }\n  if (!accessor) {\n    return (arr: JsonObject[]) => d3func(arr);\n  }\n\n  return (arr: JsonObject[]) => d3func(arr.map(x => accessor(x)));\n}\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport { rgb } from 'd3-color';\n\n// eslint-disable-next-line import/prefer-default-export\nexport function hexToRGB(\n  hex: string | undefined,\n  alpha = 255,\n): [number, number, number, number] {\n  if (!hex) {\n    return [0, 0, 0, alpha];\n  }\n  const { r, g, b } = rgb(hex);\n\n  return [r, g, b, alpha];\n}\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport { extent as d3Extent } from 'd3-array';\nimport { Point, Range } from '../types';\n\nconst LAT_LIMIT: Range = [-90, 90];\nconst LNG_LIMIT: Range = [-180, 180];\n\n/**\n * Expand a coordinate range by `padding` and within limits, if needed\n */\nfunction expandIfNeeded(\n  [curMin, curMax]: Range,\n  [minBound, maxBound]: Range,\n  padding = 0.25,\n) {\n  return curMin < curMax\n    ? [curMin, curMax]\n    : [\n        Math.max(minBound, curMin - padding),\n        Math.min(maxBound, curMax + padding),\n      ];\n}\n\nexport default function computeBoundsFromPoints(\n  points: Point[],\n): [Point, Point] {\n  const latBounds = expandIfNeeded(\n    d3Extent(points, (x: Point) => x[1]) as Range,\n    LAT_LIMIT,\n  );\n  const lngBounds = expandIfNeeded(\n    d3Extent(points, (x: Point) => x[0]) as Range,\n    LNG_LIMIT,\n  );\n  return [\n    [lngBounds[0], latBounds[0]],\n    [lngBounds[1], latBounds[1]],\n  ];\n}\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport { fitBounds } from '@math.gl/web-mercator';\nimport computeBoundsFromPoints from './computeBoundsFromPoints';\nimport { Point } from '../types';\n\nexport type Viewport = {\n  longitude: number;\n  latitude: number;\n  zoom: number;\n  bearing?: number;\n  pitch?: number;\n};\n\nexport type FitViewportOptions = {\n  points: Point[];\n  width: number;\n  height: number;\n  minExtent?: number;\n  maxZoom?: number;\n  offset?: [number, number];\n  padding?: number;\n};\n\nexport default function fitViewport(\n  originalViewPort: Viewport,\n  {\n    points,\n    width,\n    height,\n    minExtent,\n    maxZoom,\n    offset,\n    padding = 20,\n  }: FitViewportOptions,\n): Viewport {\n  const { bearing, pitch } = originalViewPort;\n  const bounds = computeBoundsFromPoints(points);\n\n  try {\n    return {\n      ...fitBounds({\n        bounds,\n        width,\n        height,\n        minExtent,\n        maxZoom,\n        offset,\n        padding,\n      }),\n      bearing,\n      pitch,\n    };\n  } catch (error) {\n    // eslint-disable-next-line no-console\n    console.error('Could not fit viewport', error);\n  }\n\n  return originalViewPort;\n}\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\n// A safe alternative to JS's eval\nimport vm, { Context, RunningScriptOptions } from 'vm';\nimport _ from 'underscore';\nimport * as d3array from 'd3-array';\nimport * as colors from './colors';\n\n// Objects exposed here should be treated like a public API\n// if `underscore` had backwards incompatible changes in a future release, we'd\n// have to be careful about bumping the library as those changes could break user charts\nconst GLOBAL_CONTEXT = {\n  console,\n  _,\n  colors,\n  d3array,\n};\n\n// Copied/modified from https://github.com/hacksparrow/safe-eval/blob/master/index.js\nexport default function sandboxedEval(\n  code: string,\n  context?: Context,\n  opts?: RunningScriptOptions | string,\n) {\n  const sandbox = {};\n  const resultKey = `SAFE_EVAL_${Math.floor(Math.random() * 1000000)}`;\n  sandbox[resultKey] = {};\n  const codeToEval = `${resultKey}=${code}`;\n  const sandboxContext = { ...GLOBAL_CONTEXT, ...context };\n  Object.keys(sandboxContext).forEach(key => {\n    sandbox[key] = sandboxContext[key];\n  });\n  try {\n    vm.runInNewContext(codeToEval, sandbox, opts);\n\n    return sandbox[resultKey];\n  } catch (error) {\n    return () => error;\n  }\n}\n"],"names":["CompositeLayer","Layer","isComposite","isLoaded","super","this","getSubLayers","every","layer","internalState","subLayers","initializeState","context","setState","updateObject","setNeedsUpdate","getPickingInfo","_ref","info","object","__source","parent","id","index","filterSubLayer","shouldRenderSubLayer","subLayerId","data","length","getSubLayerClass","DefaultLayerClass","_subLayerProps","overridingProps","props","type","getSubLayerRow","row","sourceObject","sourceObjectIndex","getSubLayerAccessor","accessor","objectInfo","target","x","i","getSubLayerProps","sublayerProps","_this$props$updateTri","opacity","pickable","visible","parameters","getPolygonOffset","highlightedObjectIndex","autoHighlight","highlightColor","coordinateSystem","coordinateOrigin","wrapLongitude","positionFormat","modelMatrix","extensions","fetch","operation","newProps","updateTriggers","overridingSublayerProps","overridingSublayerTriggers","sublayerId","propTypes","PROP_TYPES_SYMBOL","subLayerPropTypes","_propTypes","key","propType","Object","assign","concat","all","extension","passThroughProps","call","_updateAutoHighlight","updateAutoHighlight","_getAttributeManager","_postUpdate","updateParams","forceUpdate","shouldUpdate","needsUpdate","subLayersList","renderLayers","flatten","Boolean","debug","StyledDiv","styled","div","theme","top","left","gridUnit","colors","grayscale","dark2","light5","typography","sizes","s","Tooltip","tooltip","y","content","safeContent","safeHtmlSpan","___EmotionJSX","DeckGLContainer","memo","forwardRef","ref","setTooltip","useState","lastUpdate","setLastUpdate","viewState","setViewState","viewport","prevViewport","usePrevious","useImperativeHandle","tick","useCallback","Date","now","setCV","setControlValue","useEffect","timer","setInterval","clearInterval","_isEqual","onViewStateChange","layers","some","l","map","children","height","width","React","style","position","DeckGL","controller","glOptions","preserveDrawingBuffer","StaticMap","mapStyle","mapboxApiAccessToken","DeckGLContainerStyledWrapper","label","value","propertyMap","fillColor","color","fill","strokeColor","alterProps","propOverrides","keys","forEach","k","hexToRGB","features","recurseGeoJson","node","extraProps","obj","geometry","newNode","properties","push","setTooltipContent","o","className","prop","TooltipRow","getFillColor","feature","_feature$properties","getLineColor","_feature$properties2","getLayer","formData","payload","onAddFilter","fd","fc","fill_color_picker","sc","stroke_color_picker","r","g","b","a","jsFnMutator","js_data_mutator","sandboxedEval","GeoJsonLayer","slice_id","extruded","filled","stroked","getLineWidth","line_width","pointRadiusScale","point_radius_scale","lineWidthUnits","line_width_unit","commonLayerProps","DeckGLGeoJson","_payload$data2","containerRef","useRef","current","useMemo","autozoom","_payload$data","_payload$data$feature","points","reduce","acc","bounds","geojsonExtent","fitViewport","mapboxApiKey","mapbox_style","onSelect","onHover","onClick","tooltipContentGenerator","js_tooltip","picked","js_onclick_href","href","window","open","table_filter","undefined","line_column","percentiles","p1","p5","p95","p99","getAggFunc","arr","d3func","sortedArr","sort","o1","o2","d3array","hex","alpha","rgb","LAT_LIMIT","LNG_LIMIT","expandIfNeeded","_ref2","padding","curMin","curMax","minBound","maxBound","Math","max","min","originalViewPort","minExtent","maxZoom","offset","bearing","pitch","latBounds","d3Extent","lngBounds","computeBoundsFromPoints","fitBounds","error","console","GLOBAL_CONTEXT","_","code","opts","sandbox","resultKey","floor","random","codeToEval","sandboxContext","vm"],"sourceRoot":""}