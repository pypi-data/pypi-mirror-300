{"version":3,"file":"7ec54f99b15e81ff908d.chunk.js","mappings":"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","sources":["webpack://superset/./packages/superset-ui-core/src/time-format/formatters/finestTemporalGrain.ts","webpack://superset/./src/filters/components/Select/SelectFilterPlugin.tsx","webpack://superset/./src/filters/components/common.ts","webpack://superset/./src/filters/utils.ts","webpack://superset/./node_modules/use-immer/dist/use-immer.module.js"],"sourcesContent":["/*\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\n\nimport { utcFormat, timeFormat } from 'd3-time-format';\nimport { utcUtils, localTimeUtils } from '../utils/d3Time';\nimport TimeFormatter from '../TimeFormatter';\n\n/*\n * A formatter that examines all the values, and uses the finest temporal grain.\n */\nexport default function finestTemporalGrain(\n  values: any[],\n  useLocalTime = false,\n) {\n  const format = useLocalTime ? timeFormat : utcFormat;\n\n  const formatMillisecond = format('%Y-%m-%d %H:%M:%S.%L');\n  const formatSecond = format('%Y-%m-%d %H:%M:%S');\n  const formatMinute = format('%Y-%m-%d %H:%M');\n  const formatHour = format('%Y-%m-%d %H:%M');\n  const formatDay = format('%Y-%m-%d');\n  const formatMonth = format('%Y-%m-%d');\n  const formatYear = format('%Y');\n\n  const {\n    hasMillisecond,\n    hasSecond,\n    hasMinute,\n    hasHour,\n    isNotFirstDayOfMonth,\n    isNotFirstMonth,\n  } = useLocalTime ? localTimeUtils : utcUtils;\n\n  let formatFunc = formatYear;\n  values.forEach((value: any) => {\n    if (formatFunc === formatYear && isNotFirstMonth(value)) {\n      formatFunc = formatMonth;\n    }\n    if (formatFunc === formatMonth && isNotFirstDayOfMonth(value)) {\n      formatFunc = formatDay;\n    }\n    if (formatFunc === formatDay && hasHour(value)) {\n      formatFunc = formatHour;\n    }\n    if (formatFunc === formatHour && hasMinute(value)) {\n      formatFunc = formatMinute;\n    }\n    if (formatFunc === formatMinute && hasSecond(value)) {\n      formatFunc = formatSecond;\n    }\n    if (formatFunc === formatSecond && hasMillisecond(value)) {\n      formatFunc = formatMillisecond;\n    }\n  });\n\n  return new TimeFormatter({\n    description:\n      'Use the finest grain in an array of dates to format all dates in the array',\n    formatFunc,\n    id: 'finest_temporal_grain',\n    label: 'Format temporal columns with the finest grain',\n    useLocalTime,\n  });\n}\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\n/* eslint-disable no-param-reassign */\nimport React, { useCallback, useEffect, useMemo, useState } from 'react';\nimport {\n  AppSection,\n  DataMask,\n  ensureIsArray,\n  ExtraFormData,\n  GenericDataType,\n  getColumnLabel,\n  JsonObject,\n  finestTemporalGrainFormatter,\n  t,\n  tn,\n} from '@superset-ui/core';\nimport { LabeledValue as AntdLabeledValue } from 'antd/lib/select';\nimport debounce from 'lodash/debounce';\nimport { useImmerReducer } from 'use-immer';\nimport { Select } from 'src/components';\nimport { SLOW_DEBOUNCE } from 'src/constants';\nimport { hasOption, propertyComparator } from 'src/components/Select/utils';\nimport { FilterBarOrientation } from 'src/dashboard/types';\nimport { PluginFilterSelectProps, SelectValue } from './types';\nimport { FilterPluginStyle, StatusMessage, StyledFormItem } from '../common';\nimport { getDataRecordFormatter, getSelectExtraFormData } from '../../utils';\n\ntype DataMaskAction =\n  | { type: 'ownState'; ownState: JsonObject }\n  | {\n      type: 'filterState';\n      extraFormData: ExtraFormData;\n      filterState: { value: SelectValue; label?: string };\n    };\n\nfunction reducer(draft: DataMask, action: DataMaskAction) {\n  switch (action.type) {\n    case 'ownState':\n      draft.ownState = {\n        ...draft.ownState,\n        ...action.ownState,\n      };\n      return draft;\n    case 'filterState':\n      if (\n        JSON.stringify(draft.extraFormData) !==\n        JSON.stringify(action.extraFormData)\n      ) {\n        draft.extraFormData = action.extraFormData;\n      }\n      if (\n        JSON.stringify(draft.filterState) !== JSON.stringify(action.filterState)\n      ) {\n        draft.filterState = { ...draft.filterState, ...action.filterState };\n      }\n\n      return draft;\n    default:\n      return draft;\n  }\n}\n\nexport default function PluginFilterSelect(props: PluginFilterSelectProps) {\n  const {\n    coltypeMap,\n    data,\n    filterState,\n    formData,\n    height,\n    isRefreshing,\n    width,\n    setDataMask,\n    setHoveredFilter,\n    unsetHoveredFilter,\n    setFocusedFilter,\n    unsetFocusedFilter,\n    setFilterActive,\n    appSection,\n    showOverflow,\n    parentRef,\n    inputRef,\n    filterBarOrientation,\n  } = props;\n  const {\n    enableEmptyFilter,\n    multiSelect,\n    showSearch,\n    inverseSelection,\n    defaultToFirstItem,\n    searchAllOptions,\n  } = formData;\n  const groupby = useMemo(\n    () => ensureIsArray(formData.groupby).map(getColumnLabel),\n    [formData.groupby],\n  );\n  const [col] = groupby;\n  const [initialColtypeMap] = useState(coltypeMap);\n  const [search, setSearch] = useState('');\n  const [dataMask, dispatchDataMask] = useImmerReducer(reducer, {\n    extraFormData: {},\n    filterState,\n  });\n  const datatype: GenericDataType = coltypeMap[col];\n  const labelFormatter = useMemo(\n    () =>\n      getDataRecordFormatter({\n        timeFormatter: finestTemporalGrainFormatter(data.map(el => el[col])),\n      }),\n    [data, col],\n  );\n\n  const updateDataMask = useCallback(\n    (values: SelectValue) => {\n      const emptyFilter =\n        enableEmptyFilter && !inverseSelection && !values?.length;\n\n      const suffix = inverseSelection && values?.length ? t(' (excluded)') : '';\n      dispatchDataMask({\n        type: 'filterState',\n        extraFormData: getSelectExtraFormData(\n          col,\n          values,\n          emptyFilter,\n          inverseSelection,\n        ),\n        filterState: {\n          ...filterState,\n          label: values?.length\n            ? `${(values || [])\n                .map(value => labelFormatter(value, datatype))\n                .join(', ')}${suffix}`\n            : undefined,\n          value:\n            appSection === AppSection.FILTER_CONFIG_MODAL && defaultToFirstItem\n              ? undefined\n              : values,\n        },\n      });\n    },\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n    [\n      appSection,\n      col,\n      datatype,\n      defaultToFirstItem,\n      dispatchDataMask,\n      enableEmptyFilter,\n      inverseSelection,\n      JSON.stringify(filterState),\n      labelFormatter,\n    ],\n  );\n\n  const isDisabled =\n    appSection === AppSection.FILTER_CONFIG_MODAL && defaultToFirstItem;\n\n  const onSearch = useMemo(\n    () =>\n      debounce((search: string) => {\n        setSearch(search);\n        if (searchAllOptions) {\n          dispatchDataMask({\n            type: 'ownState',\n            ownState: {\n              coltypeMap: initialColtypeMap,\n              search,\n            },\n          });\n        }\n      }, SLOW_DEBOUNCE),\n    [dispatchDataMask, initialColtypeMap, searchAllOptions],\n  );\n\n  const handleBlur = useCallback(() => {\n    unsetFocusedFilter();\n  }, [unsetFocusedFilter]);\n\n  const handleChange = useCallback(\n    (value?: SelectValue | number | string) => {\n      const values = value === null ? [null] : ensureIsArray(value);\n\n      if (values.length === 0) {\n        updateDataMask(null);\n      } else {\n        updateDataMask(values);\n      }\n    },\n    [updateDataMask],\n  );\n\n  const placeholderText =\n    data.length === 0\n      ? t('No data')\n      : tn('%s option', '%s options', data.length, data.length);\n\n  const formItemExtra = useMemo(() => {\n    if (filterState.validateMessage) {\n      return (\n        <StatusMessage status={filterState.validateStatus}>\n          {filterState.validateMessage}\n        </StatusMessage>\n      );\n    }\n    return undefined;\n  }, [filterState.validateMessage, filterState.validateStatus]);\n\n  const uniqueOptions = useMemo(() => {\n    const allOptions = new Set([...data.map(el => el[col])]);\n    return [...allOptions].map((value: string) => ({\n      label: labelFormatter(value, datatype),\n      value,\n      isNewOption: false,\n    }));\n  }, [data, datatype, col, labelFormatter]);\n\n  const options = useMemo(() => {\n    if (search && !multiSelect && !hasOption(search, uniqueOptions, true)) {\n      uniqueOptions.unshift({\n        label: search,\n        value: search,\n        isNewOption: true,\n      });\n    }\n    return uniqueOptions;\n  }, [multiSelect, search, uniqueOptions]);\n\n  const sortComparator = useCallback(\n    (a: AntdLabeledValue, b: AntdLabeledValue) => {\n      const labelComparator = propertyComparator('label');\n      if (formData.sortAscending) {\n        return labelComparator(a, b);\n      }\n      return labelComparator(b, a);\n    },\n    [formData.sortAscending],\n  );\n\n  useEffect(() => {\n    if (defaultToFirstItem && filterState.value === undefined) {\n      // initialize to first value if set to default to first item\n      const firstItem: SelectValue = data[0]\n        ? (groupby.map(col => data[0][col]) as string[])\n        : null;\n      // firstItem[0] !== undefined for a case when groupby changed but new data still not fetched\n      // TODO: still need repopulate default value in config modal when column changed\n      if (firstItem?.[0] !== undefined) {\n        updateDataMask(firstItem);\n      }\n    } else if (isDisabled) {\n      // empty selection if filter is disabled\n      updateDataMask(null);\n    } else {\n      // reset data mask based on filter state\n      updateDataMask(filterState.value);\n    }\n  }, [\n    col,\n    isDisabled,\n    defaultToFirstItem,\n    enableEmptyFilter,\n    inverseSelection,\n    updateDataMask,\n    data,\n    groupby,\n    JSON.stringify(filterState.value),\n  ]);\n\n  useEffect(() => {\n    setDataMask(dataMask);\n  }, [JSON.stringify(dataMask)]);\n\n  return (\n    <FilterPluginStyle height={height} width={width}>\n      <StyledFormItem\n        validateStatus={filterState.validateStatus}\n        extra={formItemExtra}\n      >\n        <Select\n          allowClear\n          allowNewOptions\n          allowSelectAll={!searchAllOptions}\n          // @ts-ignore\n          value={filterState.value || []}\n          disabled={isDisabled}\n          getPopupContainer={\n            showOverflow\n              ? () => (parentRef?.current as HTMLElement) || document.body\n              : (trigger: HTMLElement) =>\n                  (trigger?.parentNode as HTMLElement) || document.body\n          }\n          showSearch={showSearch}\n          mode={multiSelect ? 'multiple' : 'single'}\n          placeholder={placeholderText}\n          onSearch={onSearch}\n          onBlur={handleBlur}\n          onFocus={setFocusedFilter}\n          onMouseEnter={setHoveredFilter}\n          onMouseLeave={unsetHoveredFilter}\n          // @ts-ignore\n          onChange={handleChange}\n          ref={inputRef}\n          loading={isRefreshing}\n          oneLine={filterBarOrientation === FilterBarOrientation.HORIZONTAL}\n          invertSelection={inverseSelection}\n          options={options}\n          sortComparator={sortComparator}\n          onDropdownVisibleChange={setFilterActive}\n        />\n      </StyledFormItem>\n    </FilterPluginStyle>\n  );\n}\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport { styled } from '@superset-ui/core';\nimport { PluginFilterStylesProps } from './types';\nimport FormItem from '../../components/Form/FormItem';\n\nexport const RESPONSIVE_WIDTH = 0;\n\nexport const FilterPluginStyle = styled.div<PluginFilterStylesProps>`\n  min-height: ${({ height }) => height}px;\n  width: ${({ width }) => (width === RESPONSIVE_WIDTH ? '100%' : `${width}px`)};\n`;\n\nexport const StyledFormItem = styled(FormItem)`\n  &.ant-row.ant-form-item {\n    margin: 0;\n  }\n`;\n\nexport const StatusMessage = styled.div<{\n  status?: 'error' | 'warning' | 'info';\n}>`\n  color: ${({ theme, status = 'error' }) => theme.colors[status]?.base};\n`;\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport {\n  DataRecordValue,\n  GenericDataType,\n  NumberFormatter,\n  QueryObjectFilterClause,\n  TimeFormatter,\n  ExtraFormData,\n} from '@superset-ui/core';\nimport { FALSE_STRING, NULL_STRING, TRUE_STRING } from 'src/utils/common';\nimport {\n  CLAUSES,\n  EXPRESSION_TYPES,\n} from '../explore/components/controls/FilterControl/types';\n\nexport const getSelectExtraFormData = (\n  col: string,\n  value?: null | (string | number | boolean | null)[],\n  emptyFilter = false,\n  inverseSelection = false,\n): ExtraFormData => {\n  const extra: ExtraFormData = {};\n  if (emptyFilter) {\n    extra.adhoc_filters = [\n      {\n        expressionType: EXPRESSION_TYPES.SQL,\n        clause: CLAUSES.WHERE,\n        sqlExpression: '1 = 0',\n      },\n    ];\n  } else if (value !== undefined && value !== null && value.length !== 0) {\n    extra.filters = [\n      {\n        col,\n        op: inverseSelection ? ('NOT IN' as const) : ('IN' as const),\n        // @ts-ignore\n        val: value,\n      },\n    ];\n  }\n  return extra;\n};\n\nexport const getRangeExtraFormData = (\n  col: string,\n  lower?: number | null,\n  upper?: number | null,\n) => {\n  const filters: QueryObjectFilterClause[] = [];\n  if (lower !== undefined && lower !== null && lower !== upper) {\n    filters.push({ col, op: '>=', val: lower });\n  }\n  if (upper !== undefined && upper !== null && upper !== lower) {\n    filters.push({ col, op: '<=', val: upper });\n  }\n  if (\n    upper !== undefined &&\n    upper !== null &&\n    lower !== undefined &&\n    lower !== null &&\n    upper === lower\n  ) {\n    filters.push({ col, op: '==', val: upper });\n  }\n\n  return filters.length\n    ? {\n        filters,\n      }\n    : {};\n};\n\nexport interface DataRecordValueFormatter {\n  (value: DataRecordValue, dtype: GenericDataType): string;\n}\n\nexport function getDataRecordFormatter({\n  timeFormatter,\n  numberFormatter,\n}: {\n  timeFormatter?: TimeFormatter;\n  numberFormatter?: NumberFormatter;\n} = {}): DataRecordValueFormatter {\n  return (value, dtype) => {\n    if (value === null || value === undefined) {\n      return NULL_STRING;\n    }\n    if (typeof value === 'boolean') {\n      return value ? TRUE_STRING : FALSE_STRING;\n    }\n    if (dtype === GenericDataType.BOOLEAN) {\n      try {\n        return JSON.parse(String(value).toLowerCase())\n          ? TRUE_STRING\n          : FALSE_STRING;\n      } catch {\n        return FALSE_STRING;\n      }\n    }\n    if (typeof value === 'string') {\n      return value;\n    }\n    if (timeFormatter && dtype === GenericDataType.TEMPORAL) {\n      return timeFormatter(value);\n    }\n    if (\n      numberFormatter &&\n      typeof value === 'number' &&\n      dtype === GenericDataType.NUMERIC\n    ) {\n      return numberFormatter(value);\n    }\n    return String(value);\n  };\n}\n","import n,{freeze as r}from\"immer\";import{useState as t,useCallback as o,useMemo as f,useReducer as u}from\"react\";function i(f){var u=t(function(){return r(\"function\"==typeof f?f():f,!0)}),i=u[1];return[u[0],o(function(t){i(\"function\"==typeof t?n(t):r(t))},[])]}function e(r,t,o){var i=f(function(){return n(r)},[r]);return u(i,t,o)}export{i as useImmer,e as useImmerReducer};\n//# sourceMappingURL=use-immer.module.js.map\n"],"names":["finestTemporalGrain","values","useLocalTime","format","timeFormat","utcFormat","formatMillisecond","formatSecond","formatMinute","formatHour","formatDay","formatMonth","formatYear","hasMillisecond","hasSecond","hasMinute","hasHour","isNotFirstDayOfMonth","isNotFirstMonth","localTimeUtils","utcUtils","formatFunc","forEach","value","TimeFormatter","description","id","label","reducer","draft","action","type","ownState","JSON","stringify","extraFormData","filterState","PluginFilterSelect","props","coltypeMap","data","formData","height","isRefreshing","width","setDataMask","setHoveredFilter","unsetHoveredFilter","setFocusedFilter","unsetFocusedFilter","setFilterActive","appSection","showOverflow","parentRef","inputRef","filterBarOrientation","enableEmptyFilter","multiSelect","showSearch","inverseSelection","defaultToFirstItem","searchAllOptions","groupby","useMemo","ensureIsArray","map","getColumnLabel","col","initialColtypeMap","useState","search","setSearch","dataMask","dispatchDataMask","useImmerReducer","datatype","labelFormatter","getDataRecordFormatter","timeFormatter","finestTemporalGrainFormatter","el","updateDataMask","useCallback","emptyFilter","length","suffix","t","getSelectExtraFormData","join","undefined","AppSection","FILTER_CONFIG_MODAL","isDisabled","onSearch","debounce","SLOW_DEBOUNCE","handleBlur","handleChange","placeholderText","tn","formItemExtra","validateMessage","___EmotionJSX","StatusMessage","status","validateStatus","uniqueOptions","Set","isNewOption","options","hasOption","unshift","sortComparator","a","b","labelComparator","propertyComparator","sortAscending","useEffect","firstItem","FilterPluginStyle","StyledFormItem","extra","Select","allowClear","allowNewOptions","allowSelectAll","disabled","getPopupContainer","current","document","body","trigger","parentNode","mode","placeholder","onBlur","onFocus","onMouseEnter","onMouseLeave","onChange","ref","loading","oneLine","FilterBarOrientation","HORIZONTAL","invertSelection","onDropdownVisibleChange","RESPONSIVE_WIDTH","styled","div","_ref","_ref2","FormItem","_ref3","_theme$colors$status","theme","colors","base","adhoc_filters","expressionType","EXPRESSION_TYPES","SQL","clause","CLAUSES","WHERE","sqlExpression","filters","op","val","getRangeExtraFormData","lower","upper","push","_temp","numberFormatter","dtype","NULL_STRING","TRUE_STRING","FALSE_STRING","GenericDataType","BOOLEAN","parse","String","toLowerCase","TEMPORAL","NUMERIC","i","f","u","e","r","o"],"sourceRoot":""}