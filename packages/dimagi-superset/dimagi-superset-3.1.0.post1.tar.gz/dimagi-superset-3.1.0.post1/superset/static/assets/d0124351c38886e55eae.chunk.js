"use strict";(globalThis.webpackChunksuperset=globalThis.webpackChunksuperset||[]).push([[4502],{54070:(e,a,t)=>{t.d(a,{w:()=>d}),t(67294);var l=t(58593),n=t(83379),o=t(61988),s=t(11965);const d=e=>{let{user:a,date:t}=e;const d=(0,s.tZ)("span",{className:"no-wrap"},t);if(a){const e=(0,n.Z)(a),t=(0,o.t)("Modified by: %s",e);return(0,s.tZ)(l.u,{title:t,placement:"bottom"},d)}return d}},95731:(e,a,t)=>{t.r(a),t.d(a,{default:()=>z});var l=t(75049),n=t(51995),o=t(61988),s=t(31069),d=t(93185),r=t(67294),i=t(15926),c=t.n(i),u=t(28216),b=t(35755),p=t(61337),h=t(38703),m=t(34858),_=t(40768),Z=t(14114),f=t(86074),g=t(17198),v=t(23525),w=t(27600),y=t(58593),S=t(70707),C=t(22318),E=t(93139),D=t(32228),x=t(1315),N=t(54070),k=t(12),A=t(11965);const L=(0,l.I)(),T=L.get("database.delete.related"),H=L.get("databaseconnection.extraOption"),O=(0,n.iK)(S.Z.Check)`
  color: ${e=>{let{theme:a}=e;return a.colors.grayscale.dark1}};
`,q=(0,n.iK)(S.Z.CancelX)`
  color: ${e=>{let{theme:a}=e;return a.colors.grayscale.light1}};
`,U=n.iK.div`
  color: ${e=>{let{theme:a}=e;return a.colors.grayscale.base}};

  .action-button {
    display: inline-block;
    height: 100%;
  }
`;function $(e){let{value:a}=e;return a?(0,A.tZ)(O,null):(0,A.tZ)(q,null)}const z=(0,Z.ZP)((function(e){let{addDangerToast:a,addSuccessToast:t,user:l}=e;const{state:{loading:n,resourceCount:i,resourceCollection:Z},hasPerm:L,fetchData:O,refreshData:q}=(0,m.Yi)("database",(0,o.t)("database"),a),z=(0,u.v9)((e=>e.user)),I=(0,v.eY)(w.KD.showDatabaseModal),[M,X]=(0,b.Kx)({databaseAdded:b.dJ}),[V,K]=(0,r.useState)(I||!1),[Q,j]=(0,r.useState)(null),[P,R]=(0,r.useState)(null),[Y,B]=(0,r.useState)(!1),F=(0,C.i5)(z),J=Y||F,[W,G]=(0,r.useState)(!1),{roles:ee}=z,{CSV_EXTENSIONS:ae,COLUMNAR_EXTENSIONS:te,EXCEL_EXTENSIONS:le,ALLOWED_EXTENSIONS:ne}=(0,u.v9)((e=>e.common.conf));function oe(e){let{database:a=null,modalOpen:t=!1}=void 0===e?{}:e;R(a),K(t)}(0,r.useEffect)((()=>{null!=M&&M.databaseAdded&&(X({databaseAdded:void 0}),q())}),[M,X,q]);const se=L("can_write"),de=L("can_write"),re=L("can_write"),ie=L("can_export")&&(0,d.cr)(d.TT.VERSIONED_EXPORT),{canUploadCSV:ce,canUploadColumnar:ue,canUploadExcel:be}=(0,_.Mc)(ee,ae,te,le,ne),pe=F&&!Y,he=[{label:(0,o.t)("Upload file to database"),childs:[{label:(0,o.t)("Upload CSV"),name:"Upload CSV file",url:"/csvtodatabaseview/form",perm:ce&&J,disable:pe},{label:(0,o.t)("Upload columnar file"),name:"Upload columnar file",url:"/columnartodatabaseview/form",perm:ue&&J,disable:pe},{label:(0,o.t)("Upload Excel file"),name:"Upload Excel file",url:"/exceltodatabaseview/form",perm:be&&J,disable:pe}]}];(0,r.useEffect)((()=>{s.Z.get({endpoint:`/api/v1/database/?q=${c().encode({filters:[{col:"allow_file_upload",opr:"upload_is_enabled",value:!0}]})}`}).then((e=>{var a;let{json:t}=e;const l=(null==t||null==(a=t.result)?void 0:a.filter((e=>{var a;return null==e||null==(a=e.engine_information)?void 0:a.supports_file_upload})))||[];B((null==l?void 0:l.length)>=1)}))}),[V]);const me={activeChild:"Databases",dropDownLinks:he.reduce(((e,a)=>(a.childs=a.childs.filter((e=>e.perm)),a.childs.length?(e.push(a),e):e)),[]),name:(0,o.t)("Databases")};se&&(me.buttons=[{"data-test":"btn-create-database",name:(0,A.tZ)(r.Fragment,null,(0,A.tZ)("i",{className:"fa fa-plus"})," ",(0,o.t)("Database")," "),buttonStyle:"primary",onClick:()=>{oe({modalOpen:!0})}}]);const _e=(0,r.useMemo)((()=>[{accessor:"database_name",Header:(0,o.t)("Name")},{accessor:"backend",Header:(0,o.t)("Backend"),size:"lg",disableSortBy:!0},{accessor:"allow_run_async",Header:(0,A.tZ)(y.u,{id:"allow-run-async-header-tooltip",title:(0,o.t)("Asynchronous query execution"),placement:"top"},(0,A.tZ)("span",null,(0,o.t)("AQE"))),Cell:e=>{let{row:{original:{allow_run_async:a}}}=e;return(0,A.tZ)($,{value:a})},size:"sm"},{accessor:"allow_dml",Header:(0,A.tZ)(y.u,{id:"allow-dml-header-tooltip",title:(0,o.t)("Allow data manipulation language"),placement:"top"},(0,A.tZ)("span",null,(0,o.t)("DML"))),Cell:e=>{let{row:{original:{allow_dml:a}}}=e;return(0,A.tZ)($,{value:a})},size:"sm"},{accessor:"allow_file_upload",Header:(0,o.t)("CSV upload"),Cell:e=>{let{row:{original:{allow_file_upload:a}}}=e;return(0,A.tZ)($,{value:a})},size:"md"},{accessor:"expose_in_sqllab",Header:(0,o.t)("Expose in SQL Lab"),Cell:e=>{let{row:{original:{expose_in_sqllab:a}}}=e;return(0,A.tZ)($,{value:a})},size:"md"},{Cell:e=>{let{row:{original:{changed_by:a,changed_on_delta_humanized:t}}}=e;return(0,A.tZ)(N.w,{date:t,user:a})},Header:(0,o.t)("Last modified"),accessor:"changed_on_delta_humanized",size:"xl"},{Cell:e=>{let{row:{original:a}}=e;return de||re||ie?(0,A.tZ)(U,{className:"actions"},re&&(0,A.tZ)("span",{role:"button",tabIndex:0,className:"action-button",onClick:()=>{return e=a,s.Z.get({endpoint:`/api/v1/database/${e.id}/related_objects/`}).then((a=>{let{json:t={}}=a;j({...e,chart_count:t.charts.count,dashboard_count:t.dashboards.count,sqllab_tab_count:t.sqllab_tab_states.count})})).catch((0,_.v$)((e=>(0,o.t)("An error occurred while fetching database related data: %s",e))));var e}},(0,A.tZ)(y.u,{id:"delete-action-tooltip",title:(0,o.t)("Delete database"),placement:"bottom"},(0,A.tZ)(S.Z.Trash,null))),ie&&(0,A.tZ)(y.u,{id:"export-action-tooltip",title:(0,o.t)("Export"),placement:"bottom"},(0,A.tZ)("span",{role:"button",tabIndex:0,className:"action-button",onClick:()=>{var e;void 0!==(e=a).id&&((0,D.Z)("database",[e.id],(()=>{G(!1)})),G(!0))}},(0,A.tZ)(S.Z.Share,null))),de&&(0,A.tZ)(y.u,{id:"edit-action-tooltip",title:(0,o.t)("Edit"),placement:"bottom"},(0,A.tZ)("span",{role:"button",tabIndex:0,className:"action-button",onClick:()=>oe({database:a,modalOpen:!0})},(0,A.tZ)(S.Z.EditAlt,null)))):null},Header:(0,o.t)("Actions"),id:"actions",hidden:!de&&!re,disableSortBy:!0},{accessor:k.J.changed_by,hidden:!0}]),[re,de,ie]),Ze=(0,r.useMemo)((()=>[{Header:(0,o.t)("Name"),key:"search",id:"database_name",input:"search",operator:E.p.contains},{Header:(0,o.t)("Expose in SQL Lab"),key:"expose_in_sql_lab",id:"expose_in_sqllab",input:"select",operator:E.p.equals,unfilteredLabel:(0,o.t)("All"),selects:[{label:(0,o.t)("Yes"),value:!0},{label:(0,o.t)("No"),value:!1}]},{Header:(0,A.tZ)(y.u,{id:"allow-run-async-filter-header-tooltip",title:(0,o.t)("Asynchronous query execution"),placement:"top"},(0,A.tZ)("span",null,(0,o.t)("AQE"))),key:"allow_run_async",id:"allow_run_async",input:"select",operator:E.p.equals,unfilteredLabel:(0,o.t)("All"),selects:[{label:(0,o.t)("Yes"),value:!0},{label:(0,o.t)("No"),value:!1}]},{Header:(0,o.t)("Modified by"),key:"changed_by",id:"changed_by",input:"select",operator:E.p.relationOneMany,unfilteredLabel:(0,o.t)("All"),fetchSelects:(0,_.tm)("database","changed_by",(0,_.v$)((e=>(0,o.t)("An error occurred while fetching dataset datasource values: %s",e))),l),paginate:!0}]),[]);return(0,A.tZ)(r.Fragment,null,(0,A.tZ)(f.Z,me),(0,A.tZ)(x.ZP,{databaseId:null==P?void 0:P.id,show:V,onHide:oe,onDatabaseAdd:()=>{q()}}),Q&&(0,A.tZ)(g.Z,{description:(0,A.tZ)(r.Fragment,null,(0,A.tZ)("p",null,(0,o.t)("The database %s is linked to %s charts that appear on %s dashboards and users have %s SQL Lab tabs using this database open. Are you sure you want to continue? Deleting the database will break those objects.",Q.database_name,Q.chart_count,Q.dashboard_count,Q.sqllab_tab_count)),T&&(0,A.tZ)(T,{database:Q})),onConfirm:()=>{Q&&function(e){const{id:l,database_name:n}=e;s.Z.delete({endpoint:`/api/v1/database/${l}`}).then((()=>{q(),t((0,o.t)("Deleted: %s",n)),null!=H&&H.onDelete&&H.onDelete(e),(0,p.LS)(p.dR.db,null),j(null)}),(0,_.v$)((e=>a((0,o.t)("There was an issue deleting %s: %s",n,e)))))}(Q)},onHide:()=>j(null),open:!0,title:(0,o.t)("Delete Database?")}),(0,A.tZ)(E.Z,{className:"database-list-view",columns:_e,count:i,data:Z,fetchData:O,filters:Ze,initialSort:[{id:"changed_on_delta_humanized",desc:!0}],loading:n,addDangerToast:a,addSuccessToast:t,refreshData:()=>{},pageSize:25}),W&&(0,A.tZ)(h.Z,null))}))},83379:(e,a,t)=>{function l(e){return e?`${e.first_name} ${e.last_name}`:""}t.d(a,{Z:()=>l})}}]);
//# sourceMappingURL=d0124351c38886e55eae.chunk.js.map