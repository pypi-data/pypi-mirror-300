import{s as re,e as W,t as L,a as G,c as T,b as S,d as R,g as J,f as k,r as b,v as y,i as V,h as w,j as H,n as le,y as ae,J as Fe,O as Oe,E as j,z as K,M as O,w as De,l as se,F as E,V as D,G as I,u as oe,m as ue,o as fe,R as Ie,W as qe}from"./scheduler.C_sdfy-5.js";import{S as de,i as _e,g as ce,b as q,e as he,t as F,c as Ce,a as Le,m as Re,d as Ve}from"./index.D_Dnc2IG.js";import{p as Me}from"./2.CFhpxp2a.js";/* empty css                                             */function ne(n){let e,l,t,r,d=M(n[2])+"",u,f,a,s,p=n[2].orig_name+"",c;return{c(){e=W("div"),l=W("span"),t=W("div"),r=W("progress"),u=L(d),a=G(),s=W("span"),c=L(p),this.h()},l(g){e=T(g,"DIV",{class:!0});var _=S(e);l=T(_,"SPAN",{});var o=S(l);t=T(o,"DIV",{class:!0});var h=S(t);r=T(h,"PROGRESS",{style:!0,max:!0,class:!0});var z=S(r);u=R(z,d),z.forEach(k),h.forEach(k),o.forEach(k),a=J(_),s=T(_,"SPAN",{class:!0});var P=S(s);c=R(P,p),P.forEach(k),_.forEach(k),this.h()},h(){j(r,"visibility","hidden"),j(r,"height","0"),j(r,"width","0"),r.value=f=M(n[2]),b(r,"max","100"),b(r,"class","svelte-1vsfomn"),b(t,"class","progress-bar svelte-1vsfomn"),b(s,"class","file-name svelte-1vsfomn"),b(e,"class","file svelte-1vsfomn")},m(g,_){V(g,e,_),w(e,l),w(l,t),w(t,r),w(r,u),w(e,a),w(e,s),w(s,c)},p(g,_){_&4&&d!==(d=M(g[2])+"")&&H(u,d),_&4&&f!==(f=M(g[2]))&&(r.value=f),_&4&&p!==(p=g[2].orig_name+"")&&H(c,p)},d(g){g&&k(e)}}}function je(n){let e,l,t,r=n[0].length+"",d,u,f=n[0].length>1?"files":"file",a,s,p,c=n[2]&&ne(n);return{c(){e=W("div"),l=W("span"),t=L("Uploading "),d=L(r),u=G(),a=L(f),s=L("..."),p=G(),c&&c.c(),this.h()},l(g){e=T(g,"DIV",{class:!0});var _=S(e);l=T(_,"SPAN",{class:!0});var o=S(l);t=R(o,"Uploading "),d=R(o,r),u=J(o),a=R(o,f),s=R(o,"..."),o.forEach(k),p=J(_),c&&c.l(_),_.forEach(k),this.h()},h(){b(l,"class","uploading svelte-1vsfomn"),b(e,"class","wrap svelte-1vsfomn"),y(e,"progress",n[1])},m(g,_){V(g,e,_),w(e,l),w(l,t),w(l,d),w(l,u),w(l,a),w(l,s),w(e,p),c&&c.m(e,null)},p(g,[_]){_&1&&r!==(r=g[0].length+"")&&H(d,r),_&1&&f!==(f=g[0].length>1?"files":"file")&&H(a,f),g[2]?c?c.p(g,_):(c=ne(g),c.c(),c.m(e,null)):c&&(c.d(1),c=null),_&2&&y(e,"progress",g[1])},i:le,o:le,d(g){g&&k(e),c&&c.d()}}}function M(n){return n.progress*100/(n.size||0)||0}function Be(n){let e=0;return n.forEach(l=>{e+=M(l)}),document.documentElement.style.setProperty("--upload-progress-width",(e/n.length).toFixed(2)+"%"),e/n.length}function Ge(n,e,l){let{upload_id:t}=e,{root:r}=e,{files:d}=e,{stream_handler:u}=e,f,a=!1,s,p,c=d.map(o=>({...o,progress:0}));const g=ae();function _(o,h){l(0,c=c.map(z=>(z.orig_name===o&&(z.progress+=h),z)))}return Fe(async()=>{if(f=await u(new URL(`${r}/gradio_api/upload_progress?upload_id=${t}`)),f==null)throw new Error("Event source is not defined");f.onmessage=async function(o){const h=JSON.parse(o.data);a||l(1,a=!0),h.msg==="done"?(f==null||f.close(),g("done")):(l(7,s=h),_(h.orig_name,h.chunk_size))}}),Oe(()=>{(f!=null||f!=null)&&f.close()}),n.$$set=o=>{"upload_id"in o&&l(3,t=o.upload_id),"root"in o&&l(4,r=o.root),"files"in o&&l(5,d=o.files),"stream_handler"in o&&l(6,u=o.stream_handler)},n.$$.update=()=>{n.$$.dirty&1&&Be(c),n.$$.dirty&129&&l(2,p=s||c[0])},[c,a,p,t,r,d,u,s]}class Je extends de{constructor(e){super(),_e(this,e,Ge,je,re,{upload_id:3,root:4,files:5,stream_handler:6})}}function He(n){let e,l,t,r,d,u,f,a,s,p,c;const g=n[27].default,_=se(g,n,n[26],null);return{c(){e=W("button"),_&&_.c(),l=G(),t=W("input"),this.h()},l(o){e=T(o,"BUTTON",{tabindex:!0,class:!0});var h=S(e);_&&_.l(h),l=J(h),t=T(h,"INPUT",{"aria-label":!0,"data-testid":!0,type:!0,accept:!0,webkitdirectory:!0,mozdirectory:!0,class:!0}),h.forEach(k),this.h()},h(){b(t,"aria-label","file upload"),b(t,"data-testid","file-upload"),b(t,"type","file"),b(t,"accept",r=n[16]||void 0),t.multiple=d=n[6]==="multiple"||void 0,b(t,"webkitdirectory",u=n[6]==="directory"||void 0),b(t,"mozdirectory",f=n[6]==="directory"||void 0),b(t,"class","svelte-1x5qevo"),b(e,"tabindex",a=n[9]?-1:0),b(e,"class","svelte-1x5qevo"),y(e,"hidden",n[9]),y(e,"center",n[4]),y(e,"boundedheight",n[3]),y(e,"flex",n[5]),y(e,"disable_click",n[7]),j(e,"height","100%")},m(o,h){V(o,e,h),_&&_.m(e,null),w(e,l),w(e,t),n[35](t),s=!0,p||(c=[E(t,"change",n[18]),E(e,"drag",D(I(n[28]))),E(e,"dragstart",D(I(n[29]))),E(e,"dragend",D(I(n[30]))),E(e,"dragover",D(I(n[31]))),E(e,"dragenter",D(I(n[32]))),E(e,"dragleave",D(I(n[33]))),E(e,"drop",D(I(n[34]))),E(e,"click",n[13]),E(e,"drop",n[19]),E(e,"dragenter",n[17]),E(e,"dragleave",n[17])],p=!0)},p(o,h){_&&_.p&&(!s||h[0]&67108864)&&oe(_,g,o,o[26],s?fe(g,o[26],h,null):ue(o[26]),null),(!s||h[0]&65536&&r!==(r=o[16]||void 0))&&b(t,"accept",r),(!s||h[0]&64&&d!==(d=o[6]==="multiple"||void 0))&&(t.multiple=d),(!s||h[0]&64&&u!==(u=o[6]==="directory"||void 0))&&b(t,"webkitdirectory",u),(!s||h[0]&64&&f!==(f=o[6]==="directory"||void 0))&&b(t,"mozdirectory",f),(!s||h[0]&512&&a!==(a=o[9]?-1:0))&&b(e,"tabindex",a),(!s||h[0]&512)&&y(e,"hidden",o[9]),(!s||h[0]&16)&&y(e,"center",o[4]),(!s||h[0]&8)&&y(e,"boundedheight",o[3]),(!s||h[0]&32)&&y(e,"flex",o[5]),(!s||h[0]&128)&&y(e,"disable_click",o[7])},i(o){s||(F(_,o),s=!0)},o(o){q(_,o),s=!1},d(o){o&&k(e),_&&_.d(o),n[35](null),p=!1,Ie(c)}}}function Ke(n){let e,l,t=!n[9]&&ie(n);return{c(){t&&t.c(),e=K()},l(r){t&&t.l(r),e=K()},m(r,d){t&&t.m(r,d),V(r,e,d),l=!0},p(r,d){r[9]?t&&(ce(),q(t,1,1,()=>{t=null}),he()):t?(t.p(r,d),d[0]&512&&F(t,1)):(t=ie(r),t.c(),F(t,1),t.m(e.parentNode,e))},i(r){l||(F(t),l=!0)},o(r){q(t),l=!1},d(r){r&&k(e),t&&t.d(r)}}}function Qe(n){let e,l,t,r,d;const u=n[27].default,f=se(u,n,n[26],null);return{c(){e=W("button"),f&&f.c(),this.h()},l(a){e=T(a,"BUTTON",{tabindex:!0,class:!0});var s=S(e);f&&f.l(s),s.forEach(k),this.h()},h(){b(e,"tabindex",l=n[9]?-1:0),b(e,"class","svelte-1x5qevo"),y(e,"hidden",n[9]),y(e,"center",n[4]),y(e,"boundedheight",n[3]),y(e,"flex",n[5]),j(e,"height","100%")},m(a,s){V(a,e,s),f&&f.m(e,null),t=!0,r||(d=E(e,"click",n[12]),r=!0)},p(a,s){f&&f.p&&(!t||s[0]&67108864)&&oe(f,u,a,a[26],t?fe(u,a[26],s,null):ue(a[26]),null),(!t||s[0]&512&&l!==(l=a[9]?-1:0))&&b(e,"tabindex",l),(!t||s[0]&512)&&y(e,"hidden",a[9]),(!t||s[0]&16)&&y(e,"center",a[4]),(!t||s[0]&8)&&y(e,"boundedheight",a[3]),(!t||s[0]&32)&&y(e,"flex",a[5])},i(a){t||(F(f,a),t=!0)},o(a){q(f,a),t=!1},d(a){a&&k(e),f&&f.d(a),r=!1,d()}}}function ie(n){let e,l;return e=new Je({props:{root:n[8],upload_id:n[14],files:n[15],stream_handler:n[11]}}),{c(){Ce(e.$$.fragment)},l(t){Le(e.$$.fragment,t)},m(t,r){Re(e,t,r),l=!0},p(t,r){const d={};r[0]&256&&(d.root=t[8]),r[0]&16384&&(d.upload_id=t[14]),r[0]&32768&&(d.files=t[15]),r[0]&2048&&(d.stream_handler=t[11]),e.$set(d)},i(t){l||(F(e.$$.fragment,t),l=!0)},o(t){q(e.$$.fragment,t),l=!1},d(t){Ve(e,t)}}}function Xe(n){let e,l,t,r;const d=[Qe,Ke,He],u=[];function f(a,s){return a[0]==="clipboard"?0:a[1]&&a[10]?1:2}return e=f(n),l=u[e]=d[e](n),{c(){l.c(),t=K()},l(a){l.l(a),t=K()},m(a,s){u[e].m(a,s),V(a,t,s),r=!0},p(a,s){let p=e;e=f(a),e===p?u[e].p(a,s):(ce(),q(u[p],1,1,()=>{u[p]=null}),he(),l=u[e],l?l.p(a,s):(l=u[e]=d[e](a),l.c()),F(l,1),l.m(t.parentNode,t))},i(a){r||(F(l),r=!0)},o(a){q(l),r=!1},d(a){a&&k(t),u[e].d(a)}}}function Ye(n,e,l){if(!n||n==="*"||n==="file/*"||Array.isArray(n)&&n.some(r=>r==="*"||r==="file/*"))return!0;let t;if(typeof n=="string")t=n.split(",").map(r=>r.trim());else if(Array.isArray(n))t=n;else return!1;return t.includes(e)||t.some(r=>{const[d]=r.split("/").map(u=>u.trim());return r.endsWith("/*")&&l.startsWith(d+"/")})}function Ze(n,e,l){let t,{$$slots:r={},$$scope:d}=e,{filetype:u=null}=e,{dragging:f=!1}=e,{boundedheight:a=!0}=e,{center:s=!0}=e,{flex:p=!0}=e,{file_count:c="single"}=e,{disable_click:g=!1}=e,{root:_}=e,{hidden:o=!1}=e,{format:h="file"}=e,{uploading:z=!1}=e,{hidden_upload:P=null}=e,{show_progress:$=!0}=e,{max_file_size:Q=null}=e,{upload:X}=e,{stream_handler:ee}=e,Y,Z,C,te=null;const ge=()=>{if(typeof navigator<"u"){const i=navigator.userAgent.toLowerCase();return i.indexOf("iphone")>-1||i.indexOf("ipad")>-1}return!1},U=ae(),me=["image","video","audio","text","file"],x=i=>t&&i.startsWith(".")?(te=!0,i):t&&i.includes("file/*")?"*":i.startsWith(".")||i.endsWith("/*")?i:me.includes(i)?i+"/*":"."+i;function pe(){l(20,f=!f)}function be(){navigator.clipboard.read().then(async i=>{for(let m=0;m<i.length;m++){const v=i[m].types.find(A=>A.startsWith("image/"));if(v){i[m].getType(v).then(async A=>{const N=new File([A],`clipboard.${v.replace("image/","")}`);await B([N])});break}}})}function ye(){g||P&&(l(2,P.value="",P),P.click())}async function ve(i){await qe(),l(14,Y=Math.random().toString(36).substring(2,15)),l(1,z=!0);try{const m=await X(i,_,Y,Q??1/0);return U("load",c==="single"?m==null?void 0:m[0]:m),l(1,z=!1),m||[]}catch(m){return U("error",m.message),l(1,z=!1),[]}}async function B(i){if(!i.length)return;let m=i.map(v=>new File([v],v instanceof File?v.name:"file",{type:v.type}));return t&&te&&(m=m.filter(v=>we(v)?!0:(U("error",`Invalid file type: ${v.name}. Only ${u} allowed.`),!1)),m.length===0)?[]:(l(15,Z=await Me(m)),await ve(Z))}function we(i){return u?(Array.isArray(u)?u:[u]).some(v=>{const A=x(v);if(A.startsWith("."))return i.name.toLowerCase().endsWith(A.toLowerCase());if(A==="*")return!0;if(A.endsWith("/*")){const[N]=A.split("/");return i.type.startsWith(N+"/")}return i.type===A}):!0}async function ke(i){const m=i.target;if(m.files)if(h!="blob")await B(Array.from(m.files));else{if(c==="single"){U("load",m.files[0]);return}U("load",m.files)}}async function Ae(i){var v;if(l(20,f=!1),!((v=i.dataTransfer)!=null&&v.files))return;const m=Array.from(i.dataTransfer.files).filter(A=>{const N="."+A.name.split(".").pop();return N&&Ye(C,N,A.type)||(N&&Array.isArray(u)?u.includes(N):N===u)?!0:(U("error",`Invalid file type only ${u} allowed.`),!1)});if(h!="blob")await B(m);else{if(c==="single"){U("load",m[0]);return}U("load",m)}}function Ee(i){O.call(this,n,i)}function ze(i){O.call(this,n,i)}function Pe(i){O.call(this,n,i)}function We(i){O.call(this,n,i)}function Te(i){O.call(this,n,i)}function Ne(i){O.call(this,n,i)}function Se(i){O.call(this,n,i)}function Ue(i){De[i?"unshift":"push"](()=>{P=i,l(2,P)})}return n.$$set=i=>{"filetype"in i&&l(0,u=i.filetype),"dragging"in i&&l(20,f=i.dragging),"boundedheight"in i&&l(3,a=i.boundedheight),"center"in i&&l(4,s=i.center),"flex"in i&&l(5,p=i.flex),"file_count"in i&&l(6,c=i.file_count),"disable_click"in i&&l(7,g=i.disable_click),"root"in i&&l(8,_=i.root),"hidden"in i&&l(9,o=i.hidden),"format"in i&&l(21,h=i.format),"uploading"in i&&l(1,z=i.uploading),"hidden_upload"in i&&l(2,P=i.hidden_upload),"show_progress"in i&&l(10,$=i.show_progress),"max_file_size"in i&&l(22,Q=i.max_file_size),"upload"in i&&l(23,X=i.upload),"stream_handler"in i&&l(11,ee=i.stream_handler),"$$scope"in i&&l(26,d=i.$$scope)},n.$$.update=()=>{n.$$.dirty[0]&33554433&&(u==null?l(16,C=null):typeof u=="string"?l(16,C=x(u)):t&&u.includes("file/*")?l(16,C="*"):(l(0,u=u.map(x)),l(16,C=u.join(", "))))},l(25,t=ge()),[u,z,P,a,s,p,c,g,_,o,$,ee,be,ye,Y,Z,C,pe,ke,Ae,f,h,Q,X,B,t,d,r,Ee,ze,Pe,We,Te,Ne,Se,Ue]}class lt extends de{constructor(e){super(),_e(this,e,Ze,Xe,re,{filetype:0,dragging:20,boundedheight:3,center:4,flex:5,file_count:6,disable_click:7,root:8,hidden:9,format:21,uploading:1,hidden_upload:2,show_progress:10,max_file_size:22,upload:23,stream_handler:11,paste_clipboard:12,open_file_upload:13,load_files:24},null,[-1,-1])}get paste_clipboard(){return this.$$.ctx[12]}get open_file_upload(){return this.$$.ctx[13]}get load_files(){return this.$$.ctx[24]}}export{lt as U};
