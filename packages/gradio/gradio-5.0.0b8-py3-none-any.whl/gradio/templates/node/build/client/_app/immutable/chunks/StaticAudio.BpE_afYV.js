import{s as ue,p as K,q as Q,b as P,f as b,r as c,i as j,h as E,n as q,t as ye,d as ke,z as ae,e as U,c as F,F as ee,R as Re,J as Ke,w as se,a as x,g as $,E as Me,v as De,j as Qe,L as Ce,T as Se,y as xe,M as pe}from"./scheduler.C_sdfy-5.js";import{S as de,i as he,g as oe,b as R,e as le,t as L,c as X,a as G,m as Z,d as Y,f as Ee}from"./index.D_Dnc2IG.js";import{x as Te,u as tt,I as it}from"./2.CFhpxp2a.js";import{D as nt}from"./Download.CWyupjtW.js";import{M as ze}from"./Music.Dh1RIrwb.js";import{B as rt}from"./BlockLabel.RrZy2lJ2.js";import{E as $e}from"./Empty.DFzkRrVJ.js";import{S as st}from"./ShareButton.DwcGqZjK.js";import{I as ot}from"./IconButtonWrapper.ByxIRnez.js";import{P as lt,T as at}from"./Trim.BWHYy-T0.js";import{P as ut}from"./Play.DqfTz1xW.js";import{U as dt}from"./Undo.DAMNIz45.js";import{r as He}from"./file-url.u58BABrD.js";/* empty css                                                   */import{H as _e}from"./hls.C_AVPmGC.js";import{D as ht}from"./DownloadLink.D7iokOPQ.js";function ct(s){let e,t;return{c(){e=K("svg"),t=K("path"),this.h()},l(i){e=Q(i,"svg",{xmlns:!0,width:!0,height:!0,fill:!0,"stroke-width":!0,viewBox:!0,color:!0});var n=P(e);t=Q(n,"path",{stroke:!0,"stroke-width":!0,"stroke-linecap":!0,"stroke-linejoin":!0,d:!0}),P(t).forEach(b),n.forEach(b),this.h()},h(){c(t,"stroke","currentColor"),c(t,"stroke-width","1.5"),c(t,"stroke-linecap","round"),c(t,"stroke-linejoin","round"),c(t,"d","M21.044 5.704a.6.6 0 0 1 .956.483v11.626a.6.6 0 0 1-.956.483l-7.889-5.813a.6.6 0 0 1 0-.966l7.89-5.813ZM10.044 5.704a.6.6 0 0 1 .956.483v11.626a.6.6 0 0 1-.956.483l-7.888-5.813a.6.6 0 0 1 0-.966l7.888-5.813Z"),c(e,"xmlns","http://www.w3.org/2000/svg"),c(e,"width","24px"),c(e,"height","24px"),c(e,"fill","currentColor"),c(e,"stroke-width","1.5"),c(e,"viewBox","0 0 24 24"),c(e,"color","currentColor")},m(i,n){j(i,e,n),E(e,t)},p:q,i:q,o:q,d(i){i&&b(e)}}}class ft extends de{constructor(e){super(),he(this,e,null,ct,ue,{})}}function mt(s){let e,t;return{c(){e=K("svg"),t=K("path"),this.h()},l(i){e=Q(i,"svg",{xmlns:!0,width:!0,height:!0,fill:!0,"stroke-width":!0,viewBox:!0,color:!0});var n=P(e);t=Q(n,"path",{stroke:!0,"stroke-width":!0,"stroke-linecap":!0,"stroke-linejoin":!0,d:!0}),P(t).forEach(b),n.forEach(b),this.h()},h(){c(t,"stroke","currentColor"),c(t,"stroke-width","1.5"),c(t,"stroke-linecap","round"),c(t,"stroke-linejoin","round"),c(t,"d","M2.956 5.704A.6.6 0 0 0 2 6.187v11.626a.6.6 0 0 0 .956.483l7.889-5.813a.6.6 0 0 0 0-.966l-7.89-5.813ZM13.956 5.704a.6.6 0 0 0-.956.483v11.626a.6.6 0 0 0 .956.483l7.889-5.813a.6.6 0 0 0 0-.966l-7.89-5.813Z"),c(e,"xmlns","http://www.w3.org/2000/svg"),c(e,"width","24px"),c(e,"height","24px"),c(e,"fill","currentColor"),c(e,"stroke-width","1.5"),c(e,"viewBox","0 0 24 24"),c(e,"color","currentColor")},m(i,n){j(i,e,n),E(e,t)},p:q,i:q,o:q,d(i){i&&b(e)}}}class pt extends de{constructor(e){super(),he(this,e,null,mt,ue,{})}}function gt(s){let e,t,i,n,r;return{c(){e=K("svg"),t=K("title"),i=ye("Low volume"),n=K("path"),r=K("path"),this.h()},l(o){e=Q(o,"svg",{width:!0,height:!0,viewBox:!0,"stroke-width":!0,fill:!0,xmlns:!0,stroke:!0,color:!0});var a=P(e);t=Q(a,"title",{});var u=P(t);i=ke(u,"Low volume"),u.forEach(b),n=Q(a,"path",{d:!0,"stroke-width":!0,"stroke-linecap":!0,"stroke-linejoin":!0}),P(n).forEach(b),r=Q(a,"path",{d:!0,"stroke-width":!0}),P(r).forEach(b),a.forEach(b),this.h()},h(){c(n,"d","M19.5 7.5C19.5 7.5 21 9 21 11.5C21 14 19.5 15.5 19.5 15.5"),c(n,"stroke-width","1.5"),c(n,"stroke-linecap","round"),c(n,"stroke-linejoin","round"),c(r,"d","M2 13.8571V10.1429C2 9.03829 2.89543 8.14286 4 8.14286H6.9C7.09569 8.14286 7.28708 8.08544 7.45046 7.97772L13.4495 4.02228C14.1144 3.5839 15 4.06075 15 4.85714V19.1429C15 19.9392 14.1144 20.4161 13.4495 19.9777L7.45046 16.0223C7.28708 15.9146 7.09569 15.8571 6.9 15.8571H4C2.89543 15.8571 2 14.9617 2 13.8571Z"),c(r,"stroke-width","1.5"),c(e,"width","100%"),c(e,"height","100%"),c(e,"viewBox","0 0 24 24"),c(e,"stroke-width","1.5"),c(e,"fill","none"),c(e,"xmlns","http://www.w3.org/2000/svg"),c(e,"stroke","currentColor"),c(e,"color","currentColor")},m(o,a){j(o,e,a),E(e,t),E(t,i),E(e,n),E(e,r)},p:q,i:q,o:q,d(o){o&&b(e)}}}class vt extends de{constructor(e){super(),he(this,e,null,gt,ue,{})}}function _t(s){let e,t,i,n,r,o;return{c(){e=K("svg"),t=K("title"),i=ye("High volume"),n=K("path"),r=K("path"),o=K("path"),this.h()},l(a){e=Q(a,"svg",{width:!0,height:!0,viewBox:!0,"stroke-width":!0,fill:!0,stroke:!0,xmlns:!0,color:!0});var u=P(e);t=Q(u,"title",{});var h=P(t);i=ke(h,"High volume"),h.forEach(b),n=Q(u,"path",{d:!0,"stroke-width":!0}),P(n).forEach(b),r=Q(u,"path",{d:!0,"stroke-width":!0,"stroke-linecap":!0,"stroke-linejoin":!0}),P(r).forEach(b),o=Q(u,"path",{d:!0,"stroke-width":!0,"stroke-linecap":!0,"stroke-linejoin":!0}),P(o).forEach(b),u.forEach(b),this.h()},h(){c(n,"d","M1 13.8571V10.1429C1 9.03829 1.89543 8.14286 3 8.14286H5.9C6.09569 8.14286 6.28708 8.08544 6.45046 7.97772L12.4495 4.02228C13.1144 3.5839 14 4.06075 14 4.85714V19.1429C14 19.9392 13.1144 20.4161 12.4495 19.9777L6.45046 16.0223C6.28708 15.9146 6.09569 15.8571 5.9 15.8571H3C1.89543 15.8571 1 14.9617 1 13.8571Z"),c(n,"stroke-width","1.5"),c(r,"d","M17.5 7.5C17.5 7.5 19 9 19 11.5C19 14 17.5 15.5 17.5 15.5"),c(r,"stroke-width","1.5"),c(r,"stroke-linecap","round"),c(r,"stroke-linejoin","round"),c(o,"d","M20.5 4.5C20.5 4.5 23 7 23 11.5C23 16 20.5 18.5 20.5 18.5"),c(o,"stroke-width","1.5"),c(o,"stroke-linecap","round"),c(o,"stroke-linejoin","round"),c(e,"width","100%"),c(e,"height","100%"),c(e,"viewBox","0 0 24 24"),c(e,"stroke-width","1.5"),c(e,"fill","none"),c(e,"stroke","currentColor"),c(e,"xmlns","http://www.w3.org/2000/svg"),c(e,"color","currentColor")},m(a,u){j(a,e,u),E(e,t),E(t,i),E(e,n),E(e,r),E(e,o)},p:q,i:q,o:q,d(a){a&&b(e)}}}class bt extends de{constructor(e){super(),he(this,e,null,_t,ue,{})}}function wt(s){let e,t,i,n,r,o,a,u,h;return{c(){e=K("svg"),t=K("title"),i=ye("Muted volume"),n=K("g"),r=K("path"),o=K("path"),a=K("defs"),u=K("clipPath"),h=K("rect"),this.h()},l(l){e=Q(l,"svg",{width:!0,height:!0,viewBox:!0,"stroke-width":!0,fill:!0,xmlns:!0,stroke:!0,color:!0});var d=P(e);t=Q(d,"title",{});var y=P(t);i=ke(y,"Muted volume"),y.forEach(b),n=Q(d,"g",{"clip-path":!0});var f=P(n);r=Q(f,"path",{d:!0,"stroke-width":!0,"stroke-linecap":!0,"stroke-linejoin":!0}),P(r).forEach(b),o=Q(f,"path",{d:!0,"stroke-width":!0}),P(o).forEach(b),f.forEach(b),a=Q(d,"defs",{});var m=P(a);u=Q(m,"clipPath",{id:!0});var C=P(u);h=Q(C,"rect",{width:!0,height:!0,fill:!0}),P(h).forEach(b),C.forEach(b),m.forEach(b),d.forEach(b),this.h()},h(){c(r,"d","M18 14L20.0005 12M22 10L20.0005 12M20.0005 12L18 10M20.0005 12L22 14"),c(r,"stroke-width","1.5"),c(r,"stroke-linecap","round"),c(r,"stroke-linejoin","round"),c(o,"d","M2 13.8571V10.1429C2 9.03829 2.89543 8.14286 4 8.14286H6.9C7.09569 8.14286 7.28708 8.08544 7.45046 7.97772L13.4495 4.02228C14.1144 3.5839 15 4.06075 15 4.85714V19.1429C15 19.9392 14.1144 20.4161 13.4495 19.9777L7.45046 16.0223C7.28708 15.9146 7.09569 15.8571 6.9 15.8571H4C2.89543 15.8571 2 14.9617 2 13.8571Z"),c(o,"stroke-width","1.5"),c(n,"clip-path","url(#clip0_3173_16686)"),c(h,"width","24"),c(h,"height","24"),c(h,"fill","white"),c(u,"id","clip0_3173_16686"),c(e,"width","100%"),c(e,"height","100%"),c(e,"viewBox","0 0 24 24"),c(e,"stroke-width","1.5"),c(e,"fill","none"),c(e,"xmlns","http://www.w3.org/2000/svg"),c(e,"stroke","currentColor"),c(e,"color","currentColor")},m(l,d){j(l,e,d),E(e,t),E(t,i),E(e,n),E(n,r),E(n,o),E(e,a),E(a,u),E(u,h)},p:q,i:q,o:q,d(l){l&&b(e)}}}class yt extends de{constructor(e){super(),he(this,e,null,wt,ue,{})}}var kt=function(s,e,t,i){function n(r){return r instanceof t?r:new t(function(o){o(r)})}return new(t||(t=Promise))(function(r,o){function a(l){try{h(i.next(l))}catch(d){o(d)}}function u(l){try{h(i.throw(l))}catch(d){o(d)}}function h(l){l.done?r(l.value):n(l.value).then(a,u)}h((i=i.apply(s,e||[])).next())})};function Ct(s,e){return kt(this,void 0,void 0,function*(){const t=new AudioContext({sampleRate:e});return t.decodeAudioData(s).finally(()=>t.close())})}function Et(s){const e=s[0];if(e.some(t=>t>1||t<-1)){const t=e.length;let i=0;for(let n=0;n<t;n++){const r=Math.abs(e[n]);r>i&&(i=r)}for(const n of s)for(let r=0;r<t;r++)n[r]/=i}return s}function Lt(s,e){return typeof s[0]=="number"&&(s=[s]),Et(s),{duration:e,length:s[0].length,sampleRate:s[0].length/e,numberOfChannels:s.length,getChannelData:t=>s==null?void 0:s[t],copyFromChannel:AudioBuffer.prototype.copyFromChannel,copyToChannel:AudioBuffer.prototype.copyToChannel}}const We={decode:Ct,createBuffer:Lt};var Ie=function(s,e,t,i){function n(r){return r instanceof t?r:new t(function(o){o(r)})}return new(t||(t=Promise))(function(r,o){function a(l){try{h(i.next(l))}catch(d){o(d)}}function u(l){try{h(i.throw(l))}catch(d){o(d)}}function h(l){l.done?r(l.value):n(l.value).then(a,u)}h((i=i.apply(s,e||[])).next())})};function Mt(s,e,t){var i,n;return Ie(this,void 0,void 0,function*(){const r=yield fetch(s,t);{const o=(i=r.clone().body)===null||i===void 0?void 0:i.getReader(),a=Number((n=r.headers)===null||n===void 0?void 0:n.get("Content-Length"));let u=0;const h=(l,d)=>Ie(this,void 0,void 0,function*(){if(l)return;u+=(d==null?void 0:d.length)||0;const y=Math.round(u/a*100);return e(y),o==null?void 0:o.read().then(({done:f,value:m})=>h(f,m))});o==null||o.read().then(({done:l,value:d})=>h(l,d))}return r.blob()})}const Dt={fetchBlob:Mt};class Pe{constructor(){this.listeners={},this.on=this.addEventListener,this.un=this.removeEventListener}addEventListener(e,t,i){if(this.listeners[e]||(this.listeners[e]=new Set),this.listeners[e].add(t),i!=null&&i.once){const n=()=>{this.removeEventListener(e,n),this.removeEventListener(e,t)};return this.addEventListener(e,n),n}return()=>this.removeEventListener(e,t)}removeEventListener(e,t){var i;(i=this.listeners[e])===null||i===void 0||i.delete(t)}once(e,t){return this.on(e,t,{once:!0})}unAll(){this.listeners={}}emit(e,...t){this.listeners[e]&&this.listeners[e].forEach(i=>i(...t))}}class St extends Pe{constructor(e){super(),this.isExternalMedia=!1,e.media?(this.media=e.media,this.isExternalMedia=!0):this.media=document.createElement("audio"),e.mediaControls&&(this.media.controls=!0),e.autoplay&&(this.media.autoplay=!0),e.playbackRate!=null&&this.onceMediaEvent("canplay",()=>{e.playbackRate!=null&&(this.media.playbackRate=e.playbackRate)})}onMediaEvent(e,t,i){return this.media.addEventListener(e,t,i),()=>this.media.removeEventListener(e,t)}onceMediaEvent(e,t){return this.onMediaEvent(e,t,{once:!0})}getSrc(){return this.media.currentSrc||this.media.src||""}revokeSrc(){const e=this.getSrc();e.startsWith("blob:")&&URL.revokeObjectURL(e)}setSrc(e,t){if(this.getSrc()===e)return;this.revokeSrc();const n=t instanceof Blob?URL.createObjectURL(t):e;this.media.src=n,this.media.load()}destroy(){this.media.pause(),!this.isExternalMedia&&(this.media.remove(),this.revokeSrc(),this.media.src="",this.media.load())}setMediaElement(e){this.media=e}play(){return this.media.play()}pause(){this.media.pause()}isPlaying(){return!this.media.paused&&!this.media.ended}setTime(e){this.media.currentTime=e}getDuration(){return this.media.duration}getCurrentTime(){return this.media.currentTime}getVolume(){return this.media.volume}setVolume(e){this.media.volume=e}getMuted(){return this.media.muted}setMuted(e){this.media.muted=e}getPlaybackRate(){return this.media.playbackRate}setPlaybackRate(e,t){t!=null&&(this.media.preservesPitch=t),this.media.playbackRate=e}getMediaElement(){return this.media}setSinkId(e){return this.media.setSinkId(e)}}function Tt(s,e,t,i,n=5){let r=()=>{};if(!s)return r;const o=a=>{if(a.button===2)return;a.preventDefault(),a.stopPropagation(),s.style.touchAction="none";let u=a.clientX,h=a.clientY,l=!1;const d=m=>{m.preventDefault(),m.stopPropagation();const C=m.clientX,T=m.clientY;if(l||Math.abs(C-u)>=n||Math.abs(T-h)>=n){const{left:g,top:M}=s.getBoundingClientRect();l||(l=!0,t==null||t(u-g,h-M)),e(C-u,T-h,C-g,T-M),u=C,h=T}},y=m=>{l&&(m.preventDefault(),m.stopPropagation())},f=()=>{s.style.touchAction="",l&&(i==null||i()),r()};document.addEventListener("pointermove",d),document.addEventListener("pointerup",f),document.addEventListener("pointerleave",f),document.addEventListener("click",y,!0),r=()=>{document.removeEventListener("pointermove",d),document.removeEventListener("pointerup",f),document.removeEventListener("pointerleave",f),setTimeout(()=>{document.removeEventListener("click",y,!0)},10)}};return s.addEventListener("pointerdown",o),()=>{r(),s.removeEventListener("pointerdown",o)}}class Ae extends Pe{constructor(e,t){super(),this.timeouts=[],this.isScrolling=!1,this.audioData=null,this.resizeObserver=null,this.isDragging=!1,this.options=e;const i=this.parentFromOptionsContainer(e.container);this.parent=i;const[n,r]=this.initHtml();i.appendChild(n),this.container=n,this.scrollContainer=r.querySelector(".scroll"),this.wrapper=r.querySelector(".wrapper"),this.canvasWrapper=r.querySelector(".canvases"),this.progressWrapper=r.querySelector(".progress"),this.cursor=r.querySelector(".cursor"),t&&r.appendChild(t),this.initEvents()}parentFromOptionsContainer(e){let t;if(typeof e=="string"?t=document.querySelector(e):e instanceof HTMLElement&&(t=e),!t)throw new Error("Container not found");return t}initEvents(){const e=i=>{const n=this.wrapper.getBoundingClientRect(),r=i.clientX-n.left,o=i.clientX-n.left,a=r/n.width,u=o/n.height;return[a,u]};this.wrapper.addEventListener("click",i=>{const[n,r]=e(i);this.emit("click",n,r)}),this.wrapper.addEventListener("dblclick",i=>{const[n,r]=e(i);this.emit("dblclick",n,r)}),this.options.dragToSeek&&this.initDrag(),this.scrollContainer.addEventListener("scroll",()=>{const{scrollLeft:i,scrollWidth:n,clientWidth:r}=this.scrollContainer,o=i/n,a=(i+r)/n;this.emit("scroll",o,a)});const t=this.createDelay(100);this.resizeObserver=new ResizeObserver(()=>{t(()=>this.reRender())}),this.resizeObserver.observe(this.scrollContainer)}initDrag(){Tt(this.wrapper,(e,t,i)=>{this.emit("drag",Math.max(0,Math.min(1,i/this.wrapper.getBoundingClientRect().width)))},()=>this.isDragging=!0,()=>this.isDragging=!1)}getHeight(){return this.options.height==null?128:isNaN(Number(this.options.height))?this.options.height==="auto"&&this.parent.clientHeight||128:Number(this.options.height)}initHtml(){const e=document.createElement("div"),t=e.attachShadow({mode:"open"});return t.innerHTML=`
      <style>
        :host {
          user-select: none;
          min-width: 1px;
        }
        :host audio {
          display: block;
          width: 100%;
        }
        :host .scroll {
          overflow-x: auto;
          overflow-y: hidden;
          width: 100%;
          position: relative;
        }
        :host .noScrollbar {
          scrollbar-color: transparent;
          scrollbar-width: none;
        }
        :host .noScrollbar::-webkit-scrollbar {
          display: none;
          -webkit-appearance: none;
        }
        :host .wrapper {
          position: relative;
          overflow: visible;
          z-index: 2;
        }
        :host .canvases {
          min-height: ${this.getHeight()}px;
        }
        :host .canvases > div {
          position: relative;
        }
        :host canvas {
          display: block;
          position: absolute;
          top: 0;
          image-rendering: pixelated;
        }
        :host .progress {
          pointer-events: none;
          position: absolute;
          z-index: 2;
          top: 0;
          left: 0;
          width: 0;
          height: 100%;
          overflow: hidden;
        }
        :host .progress > div {
          position: relative;
        }
        :host .cursor {
          pointer-events: none;
          position: absolute;
          z-index: 5;
          top: 0;
          left: 0;
          height: 100%;
          border-radius: 2px;
        }
      </style>

      <div class="scroll" part="scroll">
        <div class="wrapper" part="wrapper">
          <div class="canvases"></div>
          <div class="progress" part="progress"></div>
          <div class="cursor" part="cursor"></div>
        </div>
      </div>
    `,[e,t]}setOptions(e){if(this.options.container!==e.container){const t=this.parentFromOptionsContainer(e.container);t.appendChild(this.container),this.parent=t}e.dragToSeek&&!this.options.dragToSeek&&this.initDrag(),this.options=e,this.reRender()}getWrapper(){return this.wrapper}getScroll(){return this.scrollContainer.scrollLeft}destroy(){var e;this.container.remove(),(e=this.resizeObserver)===null||e===void 0||e.disconnect()}createDelay(e=10){const t={};return this.timeouts.push(t),i=>{t.timeout&&clearTimeout(t.timeout),t.timeout=setTimeout(i,e)}}convertColorValues(e){if(!Array.isArray(e))return e||"";if(e.length<2)return e[0]||"";const t=document.createElement("canvas"),n=t.getContext("2d").createLinearGradient(0,0,0,t.height),r=1/(e.length-1);return e.forEach((o,a)=>{const u=a*r;n.addColorStop(u,o)}),n}renderBarWaveform(e,t,i,n){const r=e[0],o=e[1]||e[0],a=r.length,{width:u,height:h}=i.canvas,l=h/2,d=window.devicePixelRatio||1,y=t.barWidth?t.barWidth*d:1,f=t.barGap?t.barGap*d:t.barWidth?y/2:0,m=t.barRadius||0,C=u/(y+f)/a,T=m&&"roundRect"in i?"roundRect":"rect";i.beginPath();let g=0,M=0,A=0;for(let _=0;_<=a;_++){const p=Math.round(_*C);if(p>g){const N=Math.round(M*l*n),k=Math.round(A*l*n),D=N+k||1;let z=l-N;t.barAlign==="top"?z=0:t.barAlign==="bottom"&&(z=h-D),i[T](g*(y+f),z,y,D,m),g=p,M=0,A=0}const W=Math.abs(r[_]||0),O=Math.abs(o[_]||0);W>M&&(M=W),O>A&&(A=O)}i.fill(),i.closePath()}renderLineWaveform(e,t,i,n){const r=o=>{const a=e[o]||e[0],u=a.length,{height:h}=i.canvas,l=h/2,d=i.canvas.width/u;i.moveTo(0,l);let y=0,f=0;for(let m=0;m<=u;m++){const C=Math.round(m*d);if(C>y){const g=Math.round(f*l*n)||1,M=l+g*(o===0?-1:1);i.lineTo(y,M),y=C,f=0}const T=Math.abs(a[m]||0);T>f&&(f=T)}i.lineTo(y,l)};i.beginPath(),r(0),r(1),i.fill(),i.closePath()}renderWaveform(e,t,i){if(i.fillStyle=this.convertColorValues(t.waveColor),t.renderFunction){t.renderFunction(e,i);return}let n=t.barHeight||1;if(t.normalize){const r=Array.from(e[0]).reduce((o,a)=>Math.max(o,Math.abs(a)),0);n=r?1/r:1}if(t.barWidth||t.barGap||t.barAlign){this.renderBarWaveform(e,t,i,n);return}this.renderLineWaveform(e,t,i,n)}renderSingleCanvas(e,t,i,n,r,o,a,u){const h=window.devicePixelRatio||1,l=document.createElement("canvas"),d=e[0].length;l.width=Math.round(i*(o-r)/d),l.height=n*h,l.style.width=`${Math.floor(l.width/h)}px`,l.style.height=`${n}px`,l.style.left=`${Math.floor(r*i/h/d)}px`,a.appendChild(l);const y=l.getContext("2d");if(this.renderWaveform(e.map(f=>f.slice(r,o)),t,y),l.width>0&&l.height>0){const f=l.cloneNode(),m=f.getContext("2d");m.drawImage(l,0,0),m.globalCompositeOperation="source-in",m.fillStyle=this.convertColorValues(t.progressColor),m.fillRect(0,0,l.width,l.height),u.appendChild(f)}}renderChannel(e,t,i){const n=document.createElement("div"),r=this.getHeight();n.style.height=`${r}px`,this.canvasWrapper.style.minHeight=`${r}px`,this.canvasWrapper.appendChild(n);const o=n.cloneNode();this.progressWrapper.appendChild(o);const{scrollLeft:a,scrollWidth:u,clientWidth:h}=this.scrollContainer,l=e[0].length,d=l/u;let y=Math.min(Ae.MAX_CANVAS_WIDTH,h);if(t.barWidth||t.barGap){const p=t.barWidth||.5,W=t.barGap||p/2,O=p+W;y%O!==0&&(y=Math.floor(y/O)*O)}const f=Math.floor(Math.abs(a)*d),m=Math.floor(f+y*d),C=m-f,T=(p,W)=>{this.renderSingleCanvas(e,t,i,r,Math.max(0,p),Math.min(W,l),n,o)},g=this.createDelay(),M=this.createDelay(),A=(p,W)=>{T(p,W),p>0&&g(()=>{A(p-C,W-C)})},_=(p,W)=>{T(p,W),W<l&&M(()=>{_(p+C,W+C)})};A(f,m),m<l&&_(m,m+C)}render(e){this.timeouts.forEach(a=>a.timeout&&clearTimeout(a.timeout)),this.timeouts=[],this.canvasWrapper.innerHTML="",this.progressWrapper.innerHTML="",this.wrapper.style.width="",this.options.width!=null&&(this.scrollContainer.style.width=typeof this.options.width=="number"?`${this.options.width}px`:this.options.width);const t=window.devicePixelRatio||1,i=this.scrollContainer.clientWidth,n=Math.ceil(e.duration*(this.options.minPxPerSec||0));this.isScrolling=n>i;const r=this.options.fillParent&&!this.isScrolling,o=(r?i:n)*t;if(this.wrapper.style.width=r?"100%":`${n}px`,this.scrollContainer.style.overflowX=this.isScrolling?"auto":"hidden",this.scrollContainer.classList.toggle("noScrollbar",!!this.options.hideScrollbar),this.cursor.style.backgroundColor=`${this.options.cursorColor||this.options.progressColor}`,this.cursor.style.width=`${this.options.cursorWidth}px`,this.options.splitChannels)for(let a=0;a<e.numberOfChannels;a++){const u=Object.assign(Object.assign({},this.options),this.options.splitChannels[a]);this.renderChannel([e.getChannelData(a)],u,o)}else{const a=[e.getChannelData(0)];e.numberOfChannels>1&&a.push(e.getChannelData(1)),this.renderChannel(a,this.options,o)}this.audioData=e,this.emit("render")}reRender(){if(!this.audioData)return;const e=this.progressWrapper.clientWidth;this.render(this.audioData);const t=this.progressWrapper.clientWidth;this.scrollContainer.scrollLeft+=t-e}zoom(e){this.options.minPxPerSec=e,this.reRender()}scrollIntoView(e,t=!1){const{clientWidth:i,scrollLeft:n,scrollWidth:r}=this.scrollContainer,o=r*e,a=i/2,u=t&&this.options.autoCenter&&!this.isDragging?a:i;if(o>n+u||o<n)if(this.options.autoCenter&&!this.isDragging){const h=a/20;o-(n+a)>=h&&o<n+i?this.scrollContainer.scrollLeft+=h:this.scrollContainer.scrollLeft=o-a}else this.isDragging?this.scrollContainer.scrollLeft=o<n?o-10:o-i+10:this.scrollContainer.scrollLeft=o;{const{scrollLeft:h}=this.scrollContainer,l=h/r,d=(h+i)/r;this.emit("scroll",l,d)}}renderProgress(e,t){if(isNaN(e))return;const i=e*100;this.canvasWrapper.style.clipPath=`polygon(${i}% 0, 100% 0, 100% 100%, ${i}% 100%)`,this.progressWrapper.style.width=`${i}%`,this.cursor.style.left=`${i}%`,this.cursor.style.marginLeft=Math.round(i)===100?`-${this.options.cursorWidth}px`:"",this.isScrolling&&this.options.autoScroll&&this.scrollIntoView(e,t)}}Ae.MAX_CANVAS_WIDTH=4e3;class Rt extends Pe{constructor(){super(...arguments),this.unsubscribe=()=>{}}start(){this.unsubscribe=this.on("tick",()=>{requestAnimationFrame(()=>{this.emit("tick")})}),this.emit("tick")}stop(){this.unsubscribe()}destroy(){this.unsubscribe()}}var Oe=function(s,e,t,i){function n(r){return r instanceof t?r:new t(function(o){o(r)})}return new(t||(t=Promise))(function(r,o){function a(l){try{h(i.next(l))}catch(d){o(d)}}function u(l){try{h(i.throw(l))}catch(d){o(d)}}function h(l){l.done?r(l.value):n(l.value).then(a,u)}h((i=i.apply(s,e||[])).next())})};class Pt extends Pe{constructor(e=new AudioContext){super(),this.bufferNode=null,this.autoplay=!1,this.playStartTime=0,this.playedDuration=0,this._muted=!1,this.buffer=null,this.currentSrc="",this.paused=!0,this.crossOrigin=null,this.audioContext=e,this.gainNode=this.audioContext.createGain(),this.gainNode.connect(this.audioContext.destination)}load(){return Oe(this,void 0,void 0,function*(){})}get src(){return this.currentSrc}set src(e){this.currentSrc=e,fetch(e).then(t=>t.arrayBuffer()).then(t=>this.audioContext.decodeAudioData(t)).then(t=>{this.buffer=t,this.emit("loadedmetadata"),this.emit("canplay"),this.autoplay&&this.play()})}_play(){var e;this.paused&&(this.paused=!1,(e=this.bufferNode)===null||e===void 0||e.disconnect(),this.bufferNode=this.audioContext.createBufferSource(),this.bufferNode.buffer=this.buffer,this.bufferNode.connect(this.gainNode),this.playedDuration>=this.duration&&(this.playedDuration=0),this.bufferNode.start(this.audioContext.currentTime,this.playedDuration),this.playStartTime=this.audioContext.currentTime,this.bufferNode.onended=()=>{this.currentTime>=this.duration&&(this.pause(),this.emit("ended"))})}_pause(){var e;this.paused||(this.paused=!0,(e=this.bufferNode)===null||e===void 0||e.stop(),this.playedDuration+=this.audioContext.currentTime-this.playStartTime)}play(){return Oe(this,void 0,void 0,function*(){this._play(),this.emit("play")})}pause(){this._pause(),this.emit("pause")}setSinkId(e){return Oe(this,void 0,void 0,function*(){return this.audioContext.setSinkId(e)})}get playbackRate(){var e,t;return(t=(e=this.bufferNode)===null||e===void 0?void 0:e.playbackRate.value)!==null&&t!==void 0?t:1}set playbackRate(e){this.bufferNode&&(this.bufferNode.playbackRate.value=e)}get currentTime(){return this.paused?this.playedDuration:this.playedDuration+this.audioContext.currentTime-this.playStartTime}set currentTime(e){this.emit("seeking"),this.paused?this.playedDuration=e:(this._pause(),this.playedDuration=e,this._play()),this.emit("timeupdate")}get duration(){var e;return((e=this.buffer)===null||e===void 0?void 0:e.duration)||0}get volume(){return this.gainNode.gain.value}set volume(e){this.gainNode.gain.value=e,this.emit("volumechange")}get muted(){return this._muted}set muted(e){this._muted!==e&&(this._muted=e,this._muted?this.gainNode.disconnect():this.gainNode.connect(this.audioContext.destination))}getGainNode(){return this.gainNode}}var be=function(s,e,t,i){function n(r){return r instanceof t?r:new t(function(o){o(r)})}return new(t||(t=Promise))(function(r,o){function a(l){try{h(i.next(l))}catch(d){o(d)}}function u(l){try{h(i.throw(l))}catch(d){o(d)}}function h(l){l.done?r(l.value):n(l.value).then(a,u)}h((i=i.apply(s,e||[])).next())})};const At={waveColor:"#999",progressColor:"#555",cursorWidth:1,minPxPerSec:0,fillParent:!0,interact:!0,dragToSeek:!1,autoScroll:!0,autoCenter:!0,sampleRate:8e3};class Ne extends St{static create(e){return new Ne(e)}constructor(e){const t=e.media||(e.backend==="WebAudio"?new Pt:void 0);super({media:t,mediaControls:e.mediaControls,autoplay:e.autoplay,playbackRate:e.audioRate}),this.plugins=[],this.decodedData=null,this.subscriptions=[],this.mediaSubscriptions=[],this.options=Object.assign({},At,e),this.timer=new Rt;const i=t?void 0:this.getMediaElement();this.renderer=new Ae(this.options,i),this.initPlayerEvents(),this.initRendererEvents(),this.initTimerEvents(),this.initPlugins();const n=this.options.url||this.getSrc();n?this.load(n,this.options.peaks,this.options.duration):this.options.peaks&&this.options.duration&&this.loadPredecoded()}initTimerEvents(){this.subscriptions.push(this.timer.on("tick",()=>{const e=this.getCurrentTime();this.renderer.renderProgress(e/this.getDuration(),!0),this.emit("timeupdate",e),this.emit("audioprocess",e)}))}initPlayerEvents(){this.mediaSubscriptions.push(this.onMediaEvent("timeupdate",()=>{const e=this.getCurrentTime();this.renderer.renderProgress(e/this.getDuration(),this.isPlaying()),this.emit("timeupdate",e)}),this.onMediaEvent("play",()=>{this.emit("play"),this.timer.start()}),this.onMediaEvent("pause",()=>{this.emit("pause"),this.timer.stop()}),this.onMediaEvent("emptied",()=>{this.timer.stop()}),this.onMediaEvent("ended",()=>{this.emit("finish")}),this.onMediaEvent("seeking",()=>{this.emit("seeking",this.getCurrentTime())}))}initRendererEvents(){this.subscriptions.push(this.renderer.on("click",(e,t)=>{this.options.interact&&(this.seekTo(e),this.emit("interaction",e*this.getDuration()),this.emit("click",e,t))}),this.renderer.on("dblclick",(e,t)=>{this.emit("dblclick",e,t)}),this.renderer.on("scroll",(e,t)=>{const i=this.getDuration();this.emit("scroll",e*i,t*i)}),this.renderer.on("render",()=>{this.emit("redraw")}));{let e;this.subscriptions.push(this.renderer.on("drag",t=>{this.options.interact&&(this.renderer.renderProgress(t),clearTimeout(e),e=setTimeout(()=>{this.seekTo(t)},this.isPlaying()?0:200),this.emit("interaction",t*this.getDuration()),this.emit("drag",t))}))}}initPlugins(){var e;!((e=this.options.plugins)===null||e===void 0)&&e.length&&this.options.plugins.forEach(t=>{this.registerPlugin(t)})}unsubscribePlayerEvents(){this.mediaSubscriptions.forEach(e=>e()),this.mediaSubscriptions=[]}setOptions(e){this.options=Object.assign({},this.options,e),this.renderer.setOptions(this.options),e.audioRate&&this.setPlaybackRate(e.audioRate),e.mediaControls!=null&&(this.getMediaElement().controls=e.mediaControls)}registerPlugin(e){return e.init(this),this.plugins.push(e),this.subscriptions.push(e.once("destroy",()=>{this.plugins=this.plugins.filter(t=>t!==e)})),e}getWrapper(){return this.renderer.getWrapper()}getScroll(){return this.renderer.getScroll()}getActivePlugins(){return this.plugins}loadPredecoded(){return be(this,void 0,void 0,function*(){this.options.peaks&&this.options.duration&&(this.decodedData=We.createBuffer(this.options.peaks,this.options.duration),yield Promise.resolve(),this.renderDecoded())})}renderDecoded(){return be(this,void 0,void 0,function*(){this.decodedData&&(this.emit("decode",this.getDuration()),this.renderer.render(this.decodedData))})}loadAudio(e,t,i,n){return be(this,void 0,void 0,function*(){if(this.emit("load",e),!this.options.media&&this.isPlaying()&&this.pause(),this.decodedData=null,!t&&!i){const r=o=>this.emit("loading",o);t=yield Dt.fetchBlob(e,r,this.options.fetchParams)}if(this.setSrc(e,t),n=(yield Promise.resolve(n||this.getDuration()))||(yield new Promise(r=>{this.onceMediaEvent("loadedmetadata",()=>r(this.getDuration()))}))||(yield Promise.resolve(0)),i)this.decodedData=We.createBuffer(i,n);else if(t){const r=yield t.arrayBuffer();this.decodedData=yield We.decode(r,this.options.sampleRate)}this.renderDecoded(),this.emit("ready",this.getDuration())})}load(e,t,i){return be(this,void 0,void 0,function*(){yield this.loadAudio(e,void 0,t,i)})}loadBlob(e,t,i){return be(this,void 0,void 0,function*(){yield this.loadAudio("blob",e,t,i)})}zoom(e){if(!this.decodedData)throw new Error("No audio loaded");this.renderer.zoom(e),this.emit("zoom",e)}getDecodedData(){return this.decodedData}exportPeaks({channels:e=2,maxLength:t=8e3,precision:i=1e4}={}){if(!this.decodedData)throw new Error("The audio has not been decoded yet");const n=Math.min(e,this.decodedData.numberOfChannels),r=[];for(let o=0;o<n;o++){const a=this.decodedData.getChannelData(o),u=[],h=Math.round(a.length/t);for(let l=0;l<t;l++){const d=a.slice(l*h,(l+1)*h),y=Math.max(...d);u.push(Math.round(y*i)/i)}r.push(u)}return r}getDuration(){let e=super.getDuration()||0;return(e===0||e===1/0)&&this.decodedData&&(e=this.decodedData.duration),e}toggleInteraction(e){this.options.interact=e}seekTo(e){const t=this.getDuration()*e;this.setTime(t)}playPause(){return be(this,void 0,void 0,function*(){return this.isPlaying()?this.pause():this.play()})}stop(){this.pause(),this.setTime(0)}skip(e){this.setTime(this.getCurrentTime()+e)}empty(){this.load("",[[0]],.001)}setMediaElement(e){this.unsubscribePlayerEvents(),super.setMediaElement(e),this.initPlayerEvents()}destroy(){this.emit("destroy"),this.plugins.forEach(e=>e.destroy()),this.subscriptions.forEach(e=>e()),this.unsubscribePlayerEvents(),this.timer.destroy(),this.renderer.destroy(),super.destroy()}}function Wt(s){const e=s.numberOfChannels,t=s.length*e*2+44,i=new ArrayBuffer(t),n=new DataView(i);let r=0;const o=function(a,u,h){for(let l=0;l<h.length;l++)a.setUint8(u+l,h.charCodeAt(l))};o(n,r,"RIFF"),r+=4,n.setUint32(r,t-8,!0),r+=4,o(n,r,"WAVE"),r+=4,o(n,r,"fmt "),r+=4,n.setUint32(r,16,!0),r+=4,n.setUint16(r,1,!0),r+=2,n.setUint16(r,e,!0),r+=2,n.setUint32(r,s.sampleRate,!0),r+=4,n.setUint32(r,s.sampleRate*2*e,!0),r+=4,n.setUint16(r,e*2,!0),r+=2,n.setUint16(r,16,!0),r+=2,o(n,r,"data"),r+=4,n.setUint32(r,s.length*e*2,!0),r+=4;for(let a=0;a<s.length;a++)for(let u=0;u<e;u++){const h=Math.max(-1,Math.min(1,s.getChannelData(u)[a]));n.setInt16(r,h*32767,!0),r+=2}return new Uint8Array(i)}const Ot=async(s,e,t,i)=>{const n=new AudioContext({sampleRate:i||s.sampleRate}),r=s.numberOfChannels,o=i||s.sampleRate;let a=s.length,u=0;e&&t&&(u=Math.round(e*o),a=Math.round(t*o)-u);const h=n.createBuffer(r,a,o);for(let l=0;l<r;l++){const d=s.getChannelData(l),y=h.getChannelData(l);for(let f=0;f<a;f++)y[f]=d[u+f]}return Wt(h)},Ue=(s,e)=>{s&&s.skip(e)},we=(s,e)=>(e||(e=5),s/100*e||5);class et{constructor(){this.listeners={},this.on=this.addEventListener,this.un=this.removeEventListener}addEventListener(e,t,i){if(this.listeners[e]||(this.listeners[e]=new Set),this.listeners[e].add(t),i==null?void 0:i.once){const n=()=>{this.removeEventListener(e,n),this.removeEventListener(e,t)};return this.addEventListener(e,n),n}return()=>this.removeEventListener(e,t)}removeEventListener(e,t){var i;(i=this.listeners[e])===null||i===void 0||i.delete(t)}once(e,t){return this.on(e,t,{once:!0})}unAll(){this.listeners={}}emit(e,...t){this.listeners[e]&&this.listeners[e].forEach(i=>i(...t))}}class zt extends et{constructor(e){super(),this.subscriptions=[],this.options=e}onInit(){}init(e){this.wavesurfer=e,this.onInit()}destroy(){this.emit("destroy"),this.subscriptions.forEach(e=>e())}}function Le(s,e,t,i,n=5){let r=()=>{};if(!s)return r;const o=a=>{if(a.button===2)return;a.preventDefault(),a.stopPropagation(),s.style.touchAction="none";let u=a.clientX,h=a.clientY,l=!1;const d=m=>{m.preventDefault(),m.stopPropagation();const C=m.clientX,T=m.clientY;if(l||Math.abs(C-u)>=n||Math.abs(T-h)>=n){const{left:g,top:M}=s.getBoundingClientRect();l||(l=!0,t==null||t(u-g,h-M)),e(C-u,T-h,C-g,T-M),u=C,h=T}},y=m=>{l&&(m.preventDefault(),m.stopPropagation())},f=()=>{s.style.touchAction="",l&&(i==null||i()),r()};document.addEventListener("pointermove",d),document.addEventListener("pointerup",f),document.addEventListener("pointerleave",f),document.addEventListener("click",y,!0),r=()=>{document.removeEventListener("pointermove",d),document.removeEventListener("pointerup",f),document.removeEventListener("pointerleave",f),setTimeout(()=>{document.removeEventListener("click",y,!0)},10)}};return s.addEventListener("pointerdown",o),()=>{r(),s.removeEventListener("pointerdown",o)}}class Fe extends et{constructor(e,t,i=0){var n,r,o,a,u,h,l;super(),this.totalDuration=t,this.numberOfChannels=i,this.minLength=0,this.maxLength=1/0,this.id=e.id||`region-${Math.random().toString(32).slice(2)}`,this.start=this.clampPosition(e.start),this.end=this.clampPosition((n=e.end)!==null&&n!==void 0?n:e.start),this.drag=(r=e.drag)===null||r===void 0||r,this.resize=(o=e.resize)===null||o===void 0||o,this.color=(a=e.color)!==null&&a!==void 0?a:"rgba(0, 0, 0, 0.1)",this.minLength=(u=e.minLength)!==null&&u!==void 0?u:this.minLength,this.maxLength=(h=e.maxLength)!==null&&h!==void 0?h:this.maxLength,this.channelIdx=(l=e.channelIdx)!==null&&l!==void 0?l:-1,this.element=this.initElement(),this.setContent(e.content),this.setPart(),this.renderPosition(),this.initMouseEvents()}clampPosition(e){return Math.max(0,Math.min(this.totalDuration,e))}setPart(){const e=this.start===this.end;this.element.setAttribute("part",`${e?"marker":"region"} ${this.id}`)}addResizeHandles(e){const t=document.createElement("div");t.setAttribute("data-resize","left"),t.setAttribute("style",`
        position: absolute;
        z-index: 2;
        width: 6px;
        height: 100%;
        top: 0;
        left: 0;
        border-left: 2px solid rgba(0, 0, 0, 0.5);
        border-radius: 2px 0 0 2px;
        cursor: ew-resize;
        word-break: keep-all;
      `),t.setAttribute("part","region-handle region-handle-left");const i=t.cloneNode();i.setAttribute("data-resize","right"),i.style.left="",i.style.right="0",i.style.borderRight=i.style.borderLeft,i.style.borderLeft="",i.style.borderRadius="0 2px 2px 0",i.setAttribute("part","region-handle region-handle-right"),e.appendChild(t),e.appendChild(i),Le(t,n=>this.onResize(n,"start"),()=>null,()=>this.onEndResizing(),1),Le(i,n=>this.onResize(n,"end"),()=>null,()=>this.onEndResizing(),1)}removeResizeHandles(e){const t=e.querySelector('[data-resize="left"]'),i=e.querySelector('[data-resize="right"]');t&&e.removeChild(t),i&&e.removeChild(i)}initElement(){const e=document.createElement("div"),t=this.start===this.end;let i=0,n=100;return this.channelIdx>=0&&this.channelIdx<this.numberOfChannels&&(n=100/this.numberOfChannels,i=n*this.channelIdx),e.setAttribute("style",`
      position: absolute;
      top: ${i}%;
      height: ${n}%;
      background-color: ${t?"none":this.color};
      border-left: ${t?"2px solid "+this.color:"none"};
      border-radius: 2px;
      box-sizing: border-box;
      transition: background-color 0.2s ease;
      cursor: ${this.drag?"grab":"default"};
      pointer-events: all;
    `),!t&&this.resize&&this.addResizeHandles(e),e}renderPosition(){const e=this.start/this.totalDuration,t=(this.totalDuration-this.end)/this.totalDuration;this.element.style.left=100*e+"%",this.element.style.right=100*t+"%"}initMouseEvents(){const{element:e}=this;e&&(e.addEventListener("click",t=>this.emit("click",t)),e.addEventListener("mouseenter",t=>this.emit("over",t)),e.addEventListener("mouseleave",t=>this.emit("leave",t)),e.addEventListener("dblclick",t=>this.emit("dblclick",t)),Le(e,t=>this.onMove(t),()=>this.onStartMoving(),()=>this.onEndMoving()))}onStartMoving(){this.drag&&(this.element.style.cursor="grabbing")}onEndMoving(){this.drag&&(this.element.style.cursor="grab",this.emit("update-end"))}_onUpdate(e,t){if(!this.element.parentElement)return;const i=e/this.element.parentElement.clientWidth*this.totalDuration,n=t&&t!=="start"?this.start:this.start+i,r=t&&t!=="end"?this.end:this.end+i,o=r-n;n>=0&&r<=this.totalDuration&&n<=r&&o>=this.minLength&&o<=this.maxLength&&(this.start=n,this.end=r,this.renderPosition(),this.emit("update"))}onMove(e){this.drag&&this._onUpdate(e)}onResize(e,t){this.resize&&this._onUpdate(e,t)}onEndResizing(){this.resize&&this.emit("update-end")}_setTotalDuration(e){this.totalDuration=e,this.renderPosition()}play(){this.emit("play")}setContent(e){var t;if((t=this.content)===null||t===void 0||t.remove(),e){if(typeof e=="string"){this.content=document.createElement("div");const i=this.start===this.end;this.content.style.padding=`0.2em ${i?.2:.4}em`,this.content.textContent=e}else this.content=e;this.content.setAttribute("part","region-content"),this.element.appendChild(this.content)}else this.content=void 0}setOptions(e){var t,i;if(e.color&&(this.color=e.color,this.element.style.backgroundColor=this.color),e.drag!==void 0&&(this.drag=e.drag,this.element.style.cursor=this.drag?"grab":"default"),e.start!==void 0||e.end!==void 0){const n=this.start===this.end;this.start=this.clampPosition((t=e.start)!==null&&t!==void 0?t:this.start),this.end=this.clampPosition((i=e.end)!==null&&i!==void 0?i:n?this.start:this.end),this.renderPosition(),this.setPart()}if(e.content&&this.setContent(e.content),e.id&&(this.id=e.id,this.setPart()),e.resize!==void 0&&e.resize!==this.resize){const n=this.start===this.end;this.resize=e.resize,this.resize&&!n?this.addResizeHandles(this.element):this.removeResizeHandles(this.element)}}remove(){this.emit("remove"),this.element.remove(),this.element=null}}class Ve extends zt{constructor(e){super(e),this.regions=[],this.regionsContainer=this.initRegionsContainer()}static create(e){return new Ve(e)}onInit(){if(!this.wavesurfer)throw Error("WaveSurfer is not initialized");this.wavesurfer.getWrapper().appendChild(this.regionsContainer);let e=[];this.subscriptions.push(this.wavesurfer.on("timeupdate",t=>{const i=this.regions.filter(n=>n.start<=t&&n.end>=t);i.forEach(n=>{e.includes(n)||this.emit("region-in",n)}),e.forEach(n=>{i.includes(n)||this.emit("region-out",n)}),e=i}))}initRegionsContainer(){const e=document.createElement("div");return e.setAttribute("style",`
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      z-index: 3;
      pointer-events: none;
    `),e}getRegions(){return this.regions}avoidOverlapping(e){if(!e.content)return;const t=e.content,i=t.getBoundingClientRect().left,n=e.element.scrollWidth,r=this.regions.filter(o=>{if(o===e||!o.content)return!1;const a=o.content.getBoundingClientRect().left,u=o.element.scrollWidth;return i<a+u&&a<i+n}).map(o=>{var a;return((a=o.content)===null||a===void 0?void 0:a.getBoundingClientRect().height)||0}).reduce((o,a)=>o+a,0);t.style.marginTop=`${r}px`}saveRegion(e){this.regionsContainer.appendChild(e.element),this.avoidOverlapping(e),this.regions.push(e);const t=[e.on("update-end",()=>{this.avoidOverlapping(e),this.emit("region-updated",e)}),e.on("play",()=>{var i,n;(i=this.wavesurfer)===null||i===void 0||i.play(),(n=this.wavesurfer)===null||n===void 0||n.setTime(e.start)}),e.on("click",i=>{this.emit("region-clicked",e,i)}),e.on("dblclick",i=>{this.emit("region-double-clicked",e,i)}),e.once("remove",()=>{t.forEach(i=>i()),this.regions=this.regions.filter(i=>i!==e)})];this.subscriptions.push(...t),this.emit("region-created",e)}addRegion(e){var t,i;if(!this.wavesurfer)throw Error("WaveSurfer is not initialized");const n=this.wavesurfer.getDuration(),r=(i=(t=this.wavesurfer)===null||t===void 0?void 0:t.getDecodedData())===null||i===void 0?void 0:i.numberOfChannels,o=new Fe(e,n,r);return n?this.saveRegion(o):this.subscriptions.push(this.wavesurfer.once("ready",a=>{o._setTotalDuration(a),this.saveRegion(o)})),o}enableDragSelection(e){var t,i;const n=(i=(t=this.wavesurfer)===null||t===void 0?void 0:t.getWrapper())===null||i===void 0?void 0:i.querySelector("div");if(!n)return()=>{};let r=null,o=0;return Le(n,(a,u,h)=>{r&&r._onUpdate(a,h>o?"end":"start")},a=>{var u,h;if(o=a,!this.wavesurfer)return;const l=this.wavesurfer.getDuration(),d=(h=(u=this.wavesurfer)===null||u===void 0?void 0:u.getDecodedData())===null||h===void 0?void 0:h.numberOfChannels,y=this.wavesurfer.getWrapper().clientWidth,f=a/y*l,m=(a+5)/y*l;r=new Fe(Object.assign(Object.assign({},e),{start:f,end:m}),l,d),this.regionsContainer.appendChild(r.element)},()=>{r&&(this.saveRegion(r),r=null)})}clearRegions(){this.regions.forEach(e=>e.remove())}destroy(){this.clearRegions(),super.destroy()}}function Nt(s){let e,t;return e=new bt({}),{c(){X(e.$$.fragment)},l(i){G(e.$$.fragment,i)},m(i,n){Z(e,i,n),t=!0},i(i){t||(L(e.$$.fragment,i),t=!0)},o(i){R(e.$$.fragment,i),t=!1},d(i){Y(e,i)}}}function Vt(s){let e,t;return e=new vt({}),{c(){X(e.$$.fragment)},l(i){G(e.$$.fragment,i)},m(i,n){Z(e,i,n),t=!0},i(i){t||(L(e.$$.fragment,i),t=!0)},o(i){R(e.$$.fragment,i),t=!1},d(i){Y(e,i)}}}function Bt(s){let e,t;return e=new yt({}),{c(){X(e.$$.fragment)},l(i){G(e.$$.fragment,i)},m(i,n){Z(e,i,n),t=!0},i(i){t||(L(e.$$.fragment,i),t=!0)},o(i){R(e.$$.fragment,i),t=!1},d(i){Y(e,i)}}}function jt(s){let e,t,i,n;const r=[Bt,Vt,Nt],o=[];function a(u,h){return u[0]==0?0:u[0]<.5?1:u[0]>=.5?2:-1}return~(e=a(s))&&(t=o[e]=r[e](s)),{c(){t&&t.c(),i=ae()},l(u){t&&t.l(u),i=ae()},m(u,h){~e&&o[e].m(u,h),j(u,i,h),n=!0},p(u,[h]){let l=e;e=a(u),e!==l&&(t&&(oe(),R(o[l],1,1,()=>{o[l]=null}),le()),~e?(t=o[e],t||(t=o[e]=r[e](u),t.c()),L(t,1),t.m(i.parentNode,i)):t=null)},i(u){n||(L(t),n=!0)},o(u){R(t),n=!1},d(u){u&&b(i),~e&&o[e].d(u)}}}function Ht(s,e,t){let{currentVolume:i}=e;return s.$$set=n=>{"currentVolume"in n&&t(0,i=n.currentVolume)},[i]}class It extends de{constructor(e){super(),he(this,e,Ht,jt,ue,{currentVolume:0})}}function Ut(s){let e,t,i;return{c(){e=U("input"),this.h()},l(n){e=F(n,"INPUT",{id:!0,class:!0,type:!0,min:!0,max:!0,step:!0}),this.h()},h(){c(e,"id","volume"),c(e,"class","volume-slider svelte-wuo8j5"),c(e,"type","range"),c(e,"min","0"),c(e,"max","1"),c(e,"step","0.01"),e.value=s[0]},m(n,r){j(n,e,r),s[4](e),t||(i=[ee(e,"focusout",s[5]),ee(e,"input",s[6])],t=!0)},p(n,[r]){r&1&&(e.value=n[0])},i:q,o:q,d(n){n&&b(e),s[4](null),t=!1,Re(i)}}}function Ft(s,e,t){let{currentVolume:i=1}=e,{show_volume_slider:n=!1}=e,{waveform:r}=e,o;Ke(()=>{a()});const a=()=>{let d=o;d&&(d.style.background=`linear-gradient(to right, var(--color-accent) ${i*100}%, var(--neutral-400) ${i*100}%)`)};function u(d){se[d?"unshift":"push"](()=>{o=d,t(3,o)})}const h=()=>t(1,n=!1),l=d=>{d.target instanceof HTMLInputElement&&(t(0,i=parseFloat(d.target.value)),r==null||r.setVolume(i))};return s.$$set=d=>{"currentVolume"in d&&t(0,i=d.currentVolume),"show_volume_slider"in d&&t(1,n=d.show_volume_slider),"waveform"in d&&t(2,r=d.waveform)},s.$$.update=()=>{s.$$.dirty&1&&a()},[i,n,r,o,u,h,l]}class qt extends de{constructor(e){super(),he(this,e,Ft,Ut,ue,{currentVolume:0,show_volume_slider:1,waveform:2})}}function qe(s){let e,t,i,n;function r(u){s[27](u)}function o(u){s[28](u)}let a={waveform:s[2]};return s[12]!==void 0&&(a.currentVolume=s[12]),s[1]!==void 0&&(a.show_volume_slider=s[1]),e=new qt({props:a}),se.push(()=>Ee(e,"currentVolume",r)),se.push(()=>Ee(e,"show_volume_slider",o)),{c(){X(e.$$.fragment)},l(u){G(e.$$.fragment,u)},m(u,h){Z(e,u,h),n=!0},p(u,h){const l={};h[0]&4&&(l.waveform=u[2]),!t&&h[0]&4096&&(t=!0,l.currentVolume=u[12],Ce(()=>t=!1)),!i&&h[0]&2&&(i=!0,l.show_volume_slider=u[1],Ce(()=>i=!1)),e.$set(l)},i(u){n||(L(e.$$.fragment,u),n=!0)},o(u){R(e.$$.fragment,u),n=!1},d(u){Y(e,u)}}}function Xt(s){let e,t;return e=new ut({}),{c(){X(e.$$.fragment)},l(i){G(e.$$.fragment,i)},m(i,n){Z(e,i,n),t=!0},i(i){t||(L(e.$$.fragment,i),t=!0)},o(i){R(e.$$.fragment,i),t=!1},d(i){Y(e,i)}}}function Gt(s){let e,t;return e=new lt({}),{c(){X(e.$$.fragment)},l(i){G(e.$$.fragment,i)},m(i,n){Z(e,i,n),t=!0},i(i){t||(L(e.$$.fragment,i),t=!0)},o(i){R(e.$$.fragment,i),t=!1},d(i){Y(e,i)}}}function Xe(s){let e,t,i,n,r,o=s[6]&&s[0]===""&&Ge(s);const a=[Yt,Zt],u=[];function h(l,d){return l[0]===""?0:1}return t=h(s),i=u[t]=a[t](s),{c(){o&&o.c(),e=x(),i.c(),n=ae()},l(l){o&&o.l(l),e=$(l),i.l(l),n=ae()},m(l,d){o&&o.m(l,d),j(l,e,d),u[t].m(l,d),j(l,n,d),r=!0},p(l,d){l[6]&&l[0]===""?o?(o.p(l,d),d[0]&65&&L(o,1)):(o=Ge(l),o.c(),L(o,1),o.m(e.parentNode,e)):o&&(oe(),R(o,1,1,()=>{o=null}),le());let y=t;t=h(l),t===y?u[t].p(l,d):(oe(),R(u[y],1,1,()=>{u[y]=null}),le(),i=u[t],i?i.p(l,d):(i=u[t]=a[t](l),i.c()),L(i,1),i.m(n.parentNode,n))},i(l){r||(L(o),L(i),r=!0)},o(l){R(o),R(i),r=!1},d(l){l&&(b(e),b(n)),o&&o.d(l),u[t].d(l)}}}function Ge(s){let e,t,i,n,r;return t=new dt({}),{c(){e=U("button"),X(t.$$.fragment),this.h()},l(o){e=F(o,"BUTTON",{class:!0,"aria-label":!0});var a=P(e);G(t.$$.fragment,a),a.forEach(b),this.h()},h(){c(e,"class","action icon svelte-ije4bl"),c(e,"aria-label","Reset audio")},m(o,a){j(o,e,a),Z(t,e,null),i=!0,n||(r=ee(e,"click",s[33]),n=!0)},p:q,i(o){i||(L(t.$$.fragment,o),i=!0)},o(o){R(t.$$.fragment,o),i=!1},d(o){o&&b(e),Y(t),n=!1,r()}}}function Zt(s){let e,t="Trim",i,n,r="Cancel",o,a;return{c(){e=U("button"),e.textContent=t,i=x(),n=U("button"),n.textContent=r,this.h()},l(u){e=F(u,"BUTTON",{class:!0,"data-svelte-h":!0}),Se(e)!=="svelte-1brf00d"&&(e.textContent=t),i=$(u),n=F(u,"BUTTON",{class:!0,"data-svelte-h":!0}),Se(n)!=="svelte-1r0ma01"&&(n.textContent=r),this.h()},h(){c(e,"class","text-button svelte-ije4bl"),c(n,"class","text-button svelte-ije4bl")},m(u,h){j(u,e,h),j(u,i,h),j(u,n,h),o||(a=[ee(e,"click",s[14]),ee(n,"click",s[16])],o=!0)},p:q,i:q,o:q,d(u){u&&(b(e),b(i),b(n)),o=!1,Re(a)}}}function Yt(s){let e,t,i,n,r;return t=new at({}),{c(){e=U("button"),X(t.$$.fragment),this.h()},l(o){e=F(o,"BUTTON",{class:!0,"aria-label":!0});var a=P(e);G(t.$$.fragment,a),a.forEach(b),this.h()},h(){c(e,"class","action icon svelte-ije4bl"),c(e,"aria-label","Trim audio to selection")},m(o,a){j(o,e,a),Z(t,e,null),i=!0,n||(r=ee(e,"click",s[16]),n=!0)},p:q,i(o){i||(L(t.$$.fragment,o),i=!0)},o(o){R(t.$$.fragment,o),i=!1},d(o){o&&b(e),Y(t),n=!1,r()}}}function Jt(s){let e,t,i,n,r,o,a,u,h,l,d,y,f,m,C,T,g,M,A,_,p,W,O,N,k,D,z,J,ie,fe;n=new It({props:{currentVolume:s[12]}});let H=s[1]&&qe(s);C=new ft({});const ge=[Gt,Xt],ne=[];function ve(S,V){return S[5]?0:1}A=ve(s),_=ne[A]=ge[A](s),N=new pt({});let I=s[10]&&s[7]&&Xe(s);return{c(){e=U("div"),t=U("div"),i=U("button"),X(n.$$.fragment),r=x(),H&&H.c(),o=x(),a=U("button"),u=U("span"),h=ye(s[11]),l=ye("x"),y=x(),f=U("div"),m=U("button"),X(C.$$.fragment),g=x(),M=U("button"),_.c(),W=x(),O=U("button"),X(N.$$.fragment),D=x(),z=U("div"),I&&I.c(),this.h()},l(S){e=F(S,"DIV",{class:!0,"data-testid":!0});var V=P(e);t=F(V,"DIV",{class:!0});var te=P(t);i=F(te,"BUTTON",{class:!0,"aria-label":!0});var w=P(i);G(n.$$.fragment,w),w.forEach(b),r=$(te),H&&H.l(te),o=$(te),a=F(te,"BUTTON",{class:!0,"aria-label":!0});var re=P(a);u=F(re,"SPAN",{});var v=P(u);h=ke(v,s[11]),l=ke(v,"x"),v.forEach(b),re.forEach(b),te.forEach(b),y=$(V),f=F(V,"DIV",{class:!0});var B=P(f);m=F(B,"BUTTON",{class:!0,"aria-label":!0});var me=P(m);G(C.$$.fragment,me),me.forEach(b),g=$(B),M=F(B,"BUTTON",{class:!0,"aria-label":!0});var ce=P(M);_.l(ce),ce.forEach(b),W=$(B),O=F(B,"BUTTON",{class:!0,"aria-label":!0});var Be=P(O);G(N.$$.fragment,Be),Be.forEach(b),B.forEach(b),D=$(V),z=F(V,"DIV",{class:!0});var je=P(z);I&&I.l(je),je.forEach(b),V.forEach(b),this.h()},h(){c(i,"class","action icon volume svelte-ije4bl"),c(i,"aria-label","Adjust volume"),Me(i,"color",s[1]?"var(--color-accent)":"var(--neutral-400)"),c(a,"class","playback icon svelte-ije4bl"),c(a,"aria-label",d=`Adjust playback speed to ${s[13][(s[13].indexOf(s[11])+1)%s[13].length]}x`),De(a,"hidden",s[1]),c(t,"class","control-wrapper svelte-ije4bl"),c(m,"class","rewind icon svelte-ije4bl"),c(m,"aria-label",T=`Skip backwards by ${we(s[3],s[9].skip_length)} seconds`),c(M,"class","play-pause-button icon svelte-ije4bl"),c(M,"aria-label",p=s[5]?s[4]("audio.pause"):s[4]("audio.play")),c(O,"class","skip icon svelte-ije4bl"),c(O,"aria-label",k="Skip forward by "+we(s[3],s[9].skip_length)+" seconds"),c(f,"class","play-pause-wrapper svelte-ije4bl"),c(z,"class","settings-wrapper svelte-ije4bl"),c(e,"class","controls svelte-ije4bl"),c(e,"data-testid","waveform-controls")},m(S,V){j(S,e,V),E(e,t),E(t,i),Z(n,i,null),E(t,r),H&&H.m(t,null),E(t,o),E(t,a),E(a,u),E(u,h),E(u,l),E(e,y),E(e,f),E(f,m),Z(C,m,null),E(f,g),E(f,M),ne[A].m(M,null),E(f,W),E(f,O),Z(N,O,null),E(e,D),E(e,z),I&&I.m(z,null),J=!0,ie||(fe=[ee(i,"click",s[26]),ee(a,"click",s[29]),ee(m,"click",s[30]),ee(M,"click",s[31]),ee(O,"click",s[32])],ie=!0)},p(S,V){const te={};V[0]&4096&&(te.currentVolume=S[12]),n.$set(te),V[0]&2&&Me(i,"color",S[1]?"var(--color-accent)":"var(--neutral-400)"),S[1]?H?(H.p(S,V),V[0]&2&&L(H,1)):(H=qe(S),H.c(),L(H,1),H.m(t,o)):H&&(oe(),R(H,1,1,()=>{H=null}),le()),(!J||V[0]&2048)&&Qe(h,S[11]),(!J||V[0]&2048&&d!==(d=`Adjust playback speed to ${S[13][(S[13].indexOf(S[11])+1)%S[13].length]}x`))&&c(a,"aria-label",d),(!J||V[0]&2)&&De(a,"hidden",S[1]),(!J||V[0]&520&&T!==(T=`Skip backwards by ${we(S[3],S[9].skip_length)} seconds`))&&c(m,"aria-label",T);let w=A;A=ve(S),A!==w&&(oe(),R(ne[w],1,1,()=>{ne[w]=null}),le(),_=ne[A],_||(_=ne[A]=ge[A](S),_.c()),L(_,1),_.m(M,null)),(!J||V[0]&48&&p!==(p=S[5]?S[4]("audio.pause"):S[4]("audio.play")))&&c(M,"aria-label",p),(!J||V[0]&520&&k!==(k="Skip forward by "+we(S[3],S[9].skip_length)+" seconds"))&&c(O,"aria-label",k),S[10]&&S[7]?I?(I.p(S,V),V[0]&1152&&L(I,1)):(I=Xe(S),I.c(),L(I,1),I.m(z,null)):I&&(oe(),R(I,1,1,()=>{I=null}),le())},i(S){J||(L(n.$$.fragment,S),L(H),L(C.$$.fragment,S),L(_),L(N.$$.fragment,S),L(I),J=!0)},o(S){R(n.$$.fragment,S),R(H),R(C.$$.fragment,S),R(_),R(N.$$.fragment,S),R(I),J=!1},d(S){S&&b(e),Y(n),H&&H.d(),Y(C),ne[A].d(),Y(N),I&&I.d(),ie=!1,Re(fe)}}}function Kt(s,e,t){let{waveform:i}=e,{audio_duration:n}=e,{i18n:r}=e,{playing:o}=e,{show_redo:a=!1}=e,{interactive:u=!1}=e,{handle_trim_audio:h}=e,{mode:l=""}=e,{container:d}=e,{handle_reset_value:y}=e,{waveform_options:f={}}=e,{trim_region_settings:m={}}=e,{show_volume_slider:C=!1}=e,{editable:T=!0}=e,{trimDuration:g=0}=e,M=[.5,1,1.5,2],A=M[1],_=null,p=null,W,O,N="",k=1;const D=()=>{_&&(t(22,p=_==null?void 0:_.addRegion({start:n/4,end:n/2,...m})),t(17,g=p.end-p.start))},z=()=>{if(i&&_&&p){const w=p.start,re=p.end;h(w,re),t(0,l=""),t(22,p=null)}},J=()=>{_==null||_.getRegions().forEach(w=>{w.remove()}),_==null||_.clearRegions()},ie=()=>{J(),l==="edit"?t(0,l=""):(t(0,l="edit"),D())},fe=(w,re)=>{let v,B;p&&(w==="left"?re==="ArrowLeft"?(v=p.start-.05,B=p.end):(v=p.start+.05,B=p.end):re==="ArrowLeft"?(v=p.start,B=p.end-.05):(v=p.start,B=p.end+.05),p.setOptions({start:v,end:B}),t(17,g=p.end-p.start))},H=()=>t(1,C=!C);function ge(w){k=w,t(12,k)}function ne(w){C=w,t(1,C)}const ve=()=>{t(11,A=M[(M.indexOf(A)+1)%M.length]),i==null||i.setPlaybackRate(A)},I=()=>i==null?void 0:i.skip(we(n,f.skip_length)*-1),S=()=>i==null?void 0:i.playPause(),V=()=>i==null?void 0:i.skip(we(n,f.skip_length)),te=()=>{y(),J(),t(0,l="")};return s.$$set=w=>{"waveform"in w&&t(2,i=w.waveform),"audio_duration"in w&&t(3,n=w.audio_duration),"i18n"in w&&t(4,r=w.i18n),"playing"in w&&t(5,o=w.playing),"show_redo"in w&&t(6,a=w.show_redo),"interactive"in w&&t(7,u=w.interactive),"handle_trim_audio"in w&&t(18,h=w.handle_trim_audio),"mode"in w&&t(0,l=w.mode),"container"in w&&t(19,d=w.container),"handle_reset_value"in w&&t(8,y=w.handle_reset_value),"waveform_options"in w&&t(9,f=w.waveform_options),"trim_region_settings"in w&&t(20,m=w.trim_region_settings),"show_volume_slider"in w&&t(1,C=w.show_volume_slider),"editable"in w&&t(10,T=w.editable),"trimDuration"in w&&t(17,g=w.trimDuration)},s.$$.update=()=>{if(s.$$.dirty[0]&524292&&t(21,_=d&&i?i.registerPlugin(Ve.create()):null),s.$$.dirty[0]&2097152&&(_==null||_.on("region-out",w=>{w.play()})),s.$$.dirty[0]&2097152&&(_==null||_.on("region-updated",w=>{t(17,g=w.end-w.start)})),s.$$.dirty[0]&2097152&&(_==null||_.on("region-clicked",(w,re)=>{re.stopPropagation(),t(22,p=w),w.play()})),s.$$.dirty[0]&31981568&&p){const w=d.children[0].shadowRoot;t(24,O=w.querySelector('[data-resize="right"]')),t(23,W=w.querySelector('[data-resize="left"]')),W&&O&&(W.setAttribute("role","button"),O.setAttribute("role","button"),W==null||W.setAttribute("aria-label","Drag to adjust start time"),O==null||O.setAttribute("aria-label","Drag to adjust end time"),W==null||W.setAttribute("tabindex","0"),O==null||O.setAttribute("tabindex","0"),W.addEventListener("focus",()=>{_&&t(25,N="left")}),O.addEventListener("focus",()=>{_&&t(25,N="right")}))}s.$$.dirty[0]&35651584&&_&&window.addEventListener("keydown",w=>{w.key==="ArrowLeft"?fe(N,"ArrowLeft"):w.key==="ArrowRight"&&fe(N,"ArrowRight")})},[l,C,i,n,r,o,a,u,y,f,T,A,k,M,z,J,ie,g,h,d,m,_,p,W,O,N,H,ge,ne,ve,I,S,V,te]}class Qt extends de{constructor(e){super(),he(this,e,Kt,Jt,ue,{waveform:2,audio_duration:3,i18n:4,playing:5,show_redo:6,interactive:7,handle_trim_audio:18,mode:0,container:19,handle_reset_value:8,waveform_options:9,trim_region_settings:20,show_volume_slider:1,editable:10,trimDuration:17},null,[-1,-1])}}function xt(s){let e,t,i,n,r,o,a="0:00",u,h,l,d,y="0:00",f,m,C,T,g,M,A,_=s[0]==="edit"&&s[16]>0&&Ze(s);function p(k){s[31](k)}function W(k){s[32](k)}function O(k){s[33](k)}let N={container:s[10],waveform:s[11],playing:s[14],audio_duration:s[15],i18n:s[3],interactive:s[4],handle_trim_audio:s[20],show_redo:s[4],handle_reset_value:s[9],waveform_options:s[8],trim_region_settings:s[6],editable:s[5]};return s[0]!==void 0&&(N.mode=s[0]),s[16]!==void 0&&(N.trimDuration=s[16]),s[17]!==void 0&&(N.show_volume_slider=s[17]),m=new Qt({props:N}),se.push(()=>Ee(m,"mode",p)),se.push(()=>Ee(m,"trimDuration",W)),se.push(()=>Ee(m,"show_volume_slider",O)),{c(){e=U("div"),t=U("div"),i=U("div"),n=x(),r=U("div"),o=U("time"),o.textContent=a,u=x(),h=U("div"),_&&_.c(),l=x(),d=U("time"),d.textContent=y,f=x(),X(m.$$.fragment),this.h()},l(k){e=F(k,"DIV",{class:!0,"data-testid":!0});var D=P(e);t=F(D,"DIV",{class:!0});var z=P(t);i=F(z,"DIV",{id:!0,class:!0}),P(i).forEach(b),z.forEach(b),n=$(D),r=F(D,"DIV",{class:!0});var J=P(r);o=F(J,"TIME",{id:!0,class:!0,"data-svelte-h":!0}),Se(o)!=="svelte-lp3mlp"&&(o.textContent=a),u=$(J),h=F(J,"DIV",{});var ie=P(h);_&&_.l(ie),l=$(ie),d=F(ie,"TIME",{id:!0,class:!0,"data-svelte-h":!0}),Se(d)!=="svelte-1jd0owv"&&(d.textContent=y),ie.forEach(b),J.forEach(b),f=$(D),G(m.$$.fragment,D),D.forEach(b),this.h()},h(){c(i,"id","waveform"),c(i,"class","svelte-19usgod"),Me(i,"height",s[10]?null:"58px"),c(t,"class","waveform-container svelte-19usgod"),c(o,"id","time"),c(o,"class","svelte-19usgod"),c(d,"id","duration"),c(d,"class","svelte-19usgod"),c(r,"class","timestamps svelte-19usgod"),c(e,"class","component-wrapper svelte-19usgod"),c(e,"data-testid",M=s[2]?"waveform-"+s[2]:"unlabelled-audio")},m(k,D){j(k,e,D),E(e,t),E(t,i),s[28](i),E(e,n),E(e,r),E(r,o),s[29](o),E(r,u),E(r,h),_&&_.m(h,null),E(h,l),E(h,d),s[30](d),E(e,f),Z(m,e,null),A=!0},p(k,D){D[0]&1024&&Me(i,"height",k[10]?null:"58px"),k[0]==="edit"&&k[16]>0?_?_.p(k,D):(_=Ze(k),_.c(),_.m(h,l)):_&&(_.d(1),_=null);const z={};D[0]&1024&&(z.container=k[10]),D[0]&2048&&(z.waveform=k[11]),D[0]&16384&&(z.playing=k[14]),D[0]&32768&&(z.audio_duration=k[15]),D[0]&8&&(z.i18n=k[3]),D[0]&16&&(z.interactive=k[4]),D[0]&16&&(z.show_redo=k[4]),D[0]&512&&(z.handle_reset_value=k[9]),D[0]&256&&(z.waveform_options=k[8]),D[0]&64&&(z.trim_region_settings=k[6]),D[0]&32&&(z.editable=k[5]),!C&&D[0]&1&&(C=!0,z.mode=k[0],Ce(()=>C=!1)),!T&&D[0]&65536&&(T=!0,z.trimDuration=k[16],Ce(()=>T=!1)),!g&&D[0]&131072&&(g=!0,z.show_volume_slider=k[17],Ce(()=>g=!1)),m.$set(z),(!A||D[0]&4&&M!==(M=k[2]?"waveform-"+k[2]:"unlabelled-audio"))&&c(e,"data-testid",M)},i(k){A||(L(m.$$.fragment,k),A=!0)},o(k){R(m.$$.fragment,k),A=!1},d(k){k&&b(e),s[28](null),s[29](null),_&&_.d(),s[30](null),Y(m)}}}function $t(s){let e,t;return e=new $e({props:{size:"small",$$slots:{default:[ei]},$$scope:{ctx:s}}}),{c(){X(e.$$.fragment)},l(i){G(e.$$.fragment,i)},m(i,n){Z(e,i,n),t=!0},p(i,n){const r={};n[1]&128&&(r.$$scope={dirty:n,ctx:i}),e.$set(r)},i(i){t||(L(e.$$.fragment,i),t=!0)},o(i){R(e.$$.fragment,i),t=!1},d(i){Y(e,i)}}}function Ze(s){let e,t=Te(s[16])+"",i;return{c(){e=U("time"),i=ye(t),this.h()},l(n){e=F(n,"TIME",{id:!0,class:!0});var r=P(e);i=ke(r,t),r.forEach(b),this.h()},h(){c(e,"id","trim-duration"),c(e,"class","svelte-19usgod")},m(n,r){j(n,e,r),E(e,i)},p(n,r){r[0]&65536&&t!==(t=Te(n[16])+"")&&Qe(i,t)},d(n){n&&b(e)}}}function ei(s){let e,t;return e=new ze({}),{c(){X(e.$$.fragment)},l(i){G(e.$$.fragment,i)},m(i,n){Z(e,i,n),t=!0},i(i){t||(L(e.$$.fragment,i),t=!0)},o(i){R(e.$$.fragment,i),t=!1},d(i){Y(e,i)}}}function ti(s){let e,t,i,n,r,o,a,u,h;const l=[$t,xt],d=[];function y(f,m){return f[1]===null?0:f[1].is_stream?-1:1}return~(n=y(s))&&(r=d[n]=l[n](s)),{c(){e=U("audio"),i=x(),r&&r.c(),o=ae(),this.h()},l(f){e=F(f,"AUDIO",{class:!0}),P(e).forEach(b),i=$(f),r&&r.l(f),o=ae(),this.h()},h(){c(e,"class","standard-player svelte-19usgod"),e.controls=!0,e.autoplay=t=s[7].autoplay,De(e,"hidden",!(s[1]&&s[1].is_stream))},m(f,m){j(f,e,m),s[25](e),j(f,i,m),~n&&d[n].m(f,m),j(f,o,m),a=!0,u||(h=[ee(e,"load",s[24]),ee(e,"ended",s[26]),ee(e,"play",s[27])],u=!0)},p(f,m){(!a||m[0]&128&&t!==(t=f[7].autoplay))&&(e.autoplay=t),(!a||m[0]&2)&&De(e,"hidden",!(f[1]&&f[1].is_stream));let C=n;n=y(f),n===C?~n&&d[n].p(f,m):(r&&(oe(),R(d[C],1,1,()=>{d[C]=null}),le()),~n?(r=d[n],r?r.p(f,m):(r=d[n]=l[n](f),r.c()),L(r,1),r.m(o.parentNode,o)):r=null)},i(f){a||(L(r),a=!0)},o(f){R(r),a=!1},d(f){f&&(b(e),b(i),b(o)),s[25](null),~n&&d[n].d(f),u=!1,Re(h)}}}function ii(s,e,t){let i,{value:n=null}=e,{label:r}=e,{i18n:o}=e,{dispatch_blob:a=()=>Promise.resolve()}=e,{interactive:u=!1}=e,{editable:h=!0}=e,{trim_region_settings:l={}}=e,{waveform_settings:d}=e,{waveform_options:y}=e,{mode:f=""}=e,{loop:m}=e,{handle_reset_value:C=()=>{}}=e,T,g,M=!1,A,_,p,W=0,O=!1,N,k=!1;const D=xe(),z=()=>{t(11,g=Ne.create({container:T,...d})),He(n==null?void 0:n.url).then(v=>{if(v&&g)return g.load(v)})},J=async(v,B)=>{t(0,f="");const me=g==null?void 0:g.getDecodedData();me&&await Ot(me,v,B,d.sampleRate).then(async ce=>{await a([ce],"change"),g==null||g.destroy(),t(10,T.innerHTML="",T)}),D("edit")};async function ie(v){k=!1,await He(v).then(B=>{if(!(!B||n!=null&&n.is_stream))return g==null?void 0:g.load(B)})}function fe(v){if(!(!v||!v.is_stream||!v.url)&&N)if(_e.isSupported()&&!k){const B=new _e({maxBufferLength:1,maxMaxBufferLength:1,lowLatencyMode:!0});B.loadSource(v.url),B.attachMedia(N),B.on(_e.Events.MANIFEST_PARSED,function(){d.autoplay&&N.play()}),B.on(_e.Events.ERROR,function(me,ce){if(console.error("HLS error:",me,ce),ce.fatal)switch(ce.type){case _e.ErrorTypes.NETWORK_ERROR:console.error("Fatal network error encountered, trying to recover"),B.startLoad();break;case _e.ErrorTypes.MEDIA_ERROR:console.error("Fatal media error encountered, trying to recover"),B.recoverMediaError();break;default:console.error("Fatal error, cannot recover"),B.destroy();break}}),k=!0}else k||(t(18,N.src=v.url,N),d.autoplay&&N.play(),k=!0)}Ke(()=>{window.addEventListener("keydown",v=>{!g||O||(v.key==="ArrowRight"&&f!=="edit"?Ue(g,.1):v.key==="ArrowLeft"&&f!=="edit"&&Ue(g,-.1))})});function H(v){pe.call(this,s,v)}function ge(v){se[v?"unshift":"push"](()=>{N=v,t(18,N)})}const ne=()=>D("stop"),ve=()=>D("play");function I(v){se[v?"unshift":"push"](()=>{T=v,t(10,T),t(1,n),t(11,g)})}function S(v){se[v?"unshift":"push"](()=>{A=v,t(12,A),t(11,g)})}function V(v){se[v?"unshift":"push"](()=>{_=v,t(13,_),t(11,g)})}function te(v){f=v,t(0,f)}function w(v){W=v,t(16,W)}function re(v){O=v,t(17,O)}return s.$$set=v=>{"value"in v&&t(1,n=v.value),"label"in v&&t(2,r=v.label),"i18n"in v&&t(3,o=v.i18n),"dispatch_blob"in v&&t(21,a=v.dispatch_blob),"interactive"in v&&t(4,u=v.interactive),"editable"in v&&t(5,h=v.editable),"trim_region_settings"in v&&t(6,l=v.trim_region_settings),"waveform_settings"in v&&t(7,d=v.waveform_settings),"waveform_options"in v&&t(8,y=v.waveform_options),"mode"in v&&t(0,f=v.mode),"loop"in v&&t(22,m=v.loop),"handle_reset_value"in v&&t(9,C=v.handle_reset_value)},s.$$.update=()=>{s.$$.dirty[0]&2&&t(23,i=n==null?void 0:n.url),s.$$.dirty[0]&3074&&!(n!=null&&n.is_stream)&&T!==void 0&&T!==null&&(g!==void 0&&g.destroy(),t(10,T.innerHTML="",T),z(),t(14,M=!1)),s.$$.dirty[0]&10240&&(g==null||g.on("decode",v=>{t(15,p=v),_&&t(13,_.textContent=Te(v),_)})),s.$$.dirty[0]&6144&&(g==null||g.on("timeupdate",v=>A&&t(12,A.textContent=Te(v),A))),s.$$.dirty[0]&2176&&(g==null||g.on("ready",()=>{d.autoplay?g==null||g.play():g==null||g.stop()})),s.$$.dirty[0]&4196352&&(g==null||g.on("finish",()=>{m?g==null||g.play():(t(14,M=!1),D("stop"))})),s.$$.dirty[0]&2048&&(g==null||g.on("pause",()=>{t(14,M=!1),D("pause")})),s.$$.dirty[0]&2048&&(g==null||g.on("play",()=>{t(14,M=!0),D("play")})),s.$$.dirty[0]&2048&&(g==null||g.on("load",()=>{D("load")})),s.$$.dirty[0]&8388608&&i&&ie(i),s.$$.dirty[0]&2&&fe(n)},[f,n,r,o,u,h,l,d,y,C,T,g,A,_,M,p,W,O,N,D,J,a,m,i,H,ge,ne,ve,I,S,V,te,w,re]}class ni extends de{constructor(e){super(),he(this,e,ii,ti,ue,{value:1,label:2,i18n:3,dispatch_blob:21,interactive:4,editable:5,trim_region_settings:6,waveform_settings:7,waveform_options:8,mode:0,loop:22,handle_reset_value:9},null,[-1,-1])}}const ri=ni;function si(s){let e,t;return e=new $e({props:{size:"small",$$slots:{default:[li]},$$scope:{ctx:s}}}),{c(){X(e.$$.fragment)},l(i){G(e.$$.fragment,i)},m(i,n){Z(e,i,n),t=!0},p(i,n){const r={};n&262144&&(r.$$scope={dirty:n,ctx:i}),e.$set(r)},i(i){t||(L(e.$$.fragment,i),t=!0)},o(i){R(e.$$.fragment,i),t=!1},d(i){Y(e,i)}}}function oi(s){let e,t,i,n;return e=new ot({props:{$$slots:{default:[ui]},$$scope:{ctx:s}}}),i=new ri({props:{value:s[0],label:s[1],i18n:s[5],waveform_settings:s[6],waveform_options:s[7],editable:s[8],loop:s[9]}}),i.$on("pause",s[13]),i.$on("play",s[14]),i.$on("stop",s[15]),i.$on("load",s[16]),{c(){X(e.$$.fragment),t=x(),X(i.$$.fragment)},l(r){G(e.$$.fragment,r),t=$(r),G(i.$$.fragment,r)},m(r,o){Z(e,r,o),j(r,t,o),Z(i,r,o),n=!0},p(r,o){const a={};o&262201&&(a.$$scope={dirty:o,ctx:r}),e.$set(a);const u={};o&1&&(u.value=r[0]),o&2&&(u.label=r[1]),o&32&&(u.i18n=r[5]),o&64&&(u.waveform_settings=r[6]),o&128&&(u.waveform_options=r[7]),o&256&&(u.editable=r[8]),o&512&&(u.loop=r[9]),i.$set(u)},i(r){n||(L(e.$$.fragment,r),L(i.$$.fragment,r),n=!0)},o(r){R(e.$$.fragment,r),R(i.$$.fragment,r),n=!1},d(r){r&&b(t),Y(e,r),Y(i,r)}}}function li(s){let e,t;return e=new ze({}),{c(){X(e.$$.fragment)},l(i){G(e.$$.fragment,i)},m(i,n){Z(e,i,n),t=!0},i(i){t||(L(e.$$.fragment,i),t=!0)},o(i){R(e.$$.fragment,i),t=!1},d(i){Y(e,i)}}}function Ye(s){var i;let e,t;return e=new ht({props:{href:s[0].is_stream?(i=s[0].url)==null?void 0:i.replace("playlist.m3u8","playlist-file"):s[0].url,download:s[0].orig_name||s[0].path,$$slots:{default:[ai]},$$scope:{ctx:s}}}),{c(){X(e.$$.fragment)},l(n){G(e.$$.fragment,n)},m(n,r){Z(e,n,r),t=!0},p(n,r){var a;const o={};r&1&&(o.href=n[0].is_stream?(a=n[0].url)==null?void 0:a.replace("playlist.m3u8","playlist-file"):n[0].url),r&1&&(o.download=n[0].orig_name||n[0].path),r&262176&&(o.$$scope={dirty:r,ctx:n}),e.$set(o)},i(n){t||(L(e.$$.fragment,n),t=!0)},o(n){R(e.$$.fragment,n),t=!1},d(n){Y(e,n)}}}function ai(s){let e,t;return e=new it({props:{Icon:nt,label:s[5]("common.download")}}),{c(){X(e.$$.fragment)},l(i){G(e.$$.fragment,i)},m(i,n){Z(e,i,n),t=!0},p(i,n){const r={};n&32&&(r.label=i[5]("common.download")),e.$set(r)},i(i){t||(L(e.$$.fragment,i),t=!0)},o(i){R(e.$$.fragment,i),t=!1},d(i){Y(e,i)}}}function Je(s){let e,t;return e=new st({props:{i18n:s[5],formatter:s[10],value:s[0]}}),e.$on("error",s[11]),e.$on("share",s[12]),{c(){X(e.$$.fragment)},l(i){G(e.$$.fragment,i)},m(i,n){Z(e,i,n),t=!0},p(i,n){const r={};n&32&&(r.i18n=i[5]),n&1&&(r.value=i[0]),e.$set(r)},i(i){t||(L(e.$$.fragment,i),t=!0)},o(i){R(e.$$.fragment,i),t=!1},d(i){Y(e,i)}}}function ui(s){let e,t,i,n=s[3]&&Ye(s),r=s[4]&&Je(s);return{c(){n&&n.c(),e=x(),r&&r.c(),t=ae()},l(o){n&&n.l(o),e=$(o),r&&r.l(o),t=ae()},m(o,a){n&&n.m(o,a),j(o,e,a),r&&r.m(o,a),j(o,t,a),i=!0},p(o,a){o[3]?n?(n.p(o,a),a&8&&L(n,1)):(n=Ye(o),n.c(),L(n,1),n.m(e.parentNode,e)):n&&(oe(),R(n,1,1,()=>{n=null}),le()),o[4]?r?(r.p(o,a),a&16&&L(r,1)):(r=Je(o),r.c(),L(r,1),r.m(t.parentNode,t)):r&&(oe(),R(r,1,1,()=>{r=null}),le())},i(o){i||(L(n),L(r),i=!0)},o(o){R(n),R(r),i=!1},d(o){o&&(b(e),b(t)),n&&n.d(o),r&&r.d(o)}}}function di(s){let e,t,i,n,r,o;e=new rt({props:{show_label:s[2],Icon:ze,float:!1,label:s[1]||s[5]("audio.audio")}});const a=[oi,si],u=[];function h(l,d){return l[0]!==null?0:1}return i=h(s),n=u[i]=a[i](s),{c(){X(e.$$.fragment),t=x(),n.c(),r=ae()},l(l){G(e.$$.fragment,l),t=$(l),n.l(l),r=ae()},m(l,d){Z(e,l,d),j(l,t,d),u[i].m(l,d),j(l,r,d),o=!0},p(l,[d]){const y={};d&4&&(y.show_label=l[2]),d&34&&(y.label=l[1]||l[5]("audio.audio")),e.$set(y);let f=i;i=h(l),i===f?u[i].p(l,d):(oe(),R(u[f],1,1,()=>{u[f]=null}),le(),n=u[i],n?n.p(l,d):(n=u[i]=a[i](l),n.c()),L(n,1),n.m(r.parentNode,r))},i(l){o||(L(e.$$.fragment,l),L(n),o=!0)},o(l){R(e.$$.fragment,l),R(n),o=!1},d(l){l&&(b(t),b(r)),Y(e,l),u[i].d(l)}}}function hi(s,e,t){let{value:i=null}=e,{label:n}=e,{show_label:r=!0}=e,{show_download_button:o=!0}=e,{show_share_button:a=!1}=e,{i18n:u}=e,{waveform_settings:h}=e,{waveform_options:l}=e,{editable:d=!0}=e,{loop:y}=e;const f=xe(),m=async p=>p?`<audio controls src="${await tt(p.url)}"></audio>`:"";function C(p){pe.call(this,s,p)}function T(p){pe.call(this,s,p)}function g(p){pe.call(this,s,p)}function M(p){pe.call(this,s,p)}function A(p){pe.call(this,s,p)}function _(p){pe.call(this,s,p)}return s.$$set=p=>{"value"in p&&t(0,i=p.value),"label"in p&&t(1,n=p.label),"show_label"in p&&t(2,r=p.show_label),"show_download_button"in p&&t(3,o=p.show_download_button),"show_share_button"in p&&t(4,a=p.show_share_button),"i18n"in p&&t(5,u=p.i18n),"waveform_settings"in p&&t(6,h=p.waveform_settings),"waveform_options"in p&&t(7,l=p.waveform_options),"editable"in p&&t(8,d=p.editable),"loop"in p&&t(9,y=p.loop)},s.$$.update=()=>{s.$$.dirty&1&&i&&f("change",i)},[i,n,r,o,a,u,h,l,d,y,m,C,T,g,M,A,_]}class ci extends de{constructor(e){super(),he(this,e,hi,di,ue,{value:0,label:1,show_label:2,show_download_button:3,show_share_button:4,i18n:5,waveform_settings:6,waveform_options:7,editable:8,loop:9})}}const Ti=Object.freeze(Object.defineProperty({__proto__:null,default:ci},Symbol.toStringTag,{value:"Module"}));export{ri as A,ci as S,Qt as W,Ne as a,Ti as b,Ot as p,Ue as s};
