import{s as Be,J as ze,B as qe,a as D,e as j,g as F,c as G,b as U,f as v,p as w,i as p,r as Ne,z as O,P as Q,q as B,h as T,Q as fe,t as Ve,d as De,E as le,F as L,j as Fe,R as Pe,n as _e}from"./scheduler.xQsDa6L3.js";import{S as Se,i as je,c as z,a as q,m as N,t as k,b as I,d as V,g as Y,e as Z}from"./index.lnKugwF0.js";import{B as Ge,d as Le,b as Te,e as Ce,f as R,I as me}from"./2.BTUnExtG.js";import{B as Je}from"./BlockLabel.Di7mkPRC.js";import{E as Oe}from"./Empty.CHJfi3Iz.js";import{M as Qe,a as Re}from"./Minimize.CLXvCbVC.js";import{I as ce}from"./Image.BbdFb7mG.js";import{I as Ue}from"./IconButtonWrapper.CAIRHkaZ.js";import{r as ne}from"./file-url.l0dQUXp2.js";/* empty css                                                   */function te(n,e,t){const l=n.slice();return l[32]=e[t],l[34]=t,l}function ae(n,e,t){const l=n.slice();return l[32]=e[t],l[34]=t,l}function We(n){var M;let e,t,l,a,i,s,f,g,b;t=new Ue({props:{$$slots:{default:[He]},$$scope:{ctx:n}}});let c=R(n[15]?(M=n[15])==null?void 0:M.annotations:[]),_=[];for(let o=0;o<c.length;o+=1)_[o]=oe(ae(n,c,o));let m=n[6]&&n[15]&&re(n);return{c(){e=j("div"),z(t.$$.fragment),l=D(),a=j("img"),s=D();for(let o=0;o<_.length;o+=1)_[o].c();f=D(),m&&m.c(),g=O(),this.h()},l(o){e=G(o,"DIV",{class:!0});var u=U(e);q(t.$$.fragment,u),l=F(u),a=G(u,"IMG",{class:!0,src:!0,alt:!0}),s=F(u);for(let d=0;d<_.length;d+=1)_[d].l(u);u.forEach(v),f=F(o),m&&m.l(o),g=O(),this.h()},h(){w(a,"class","base-image svelte-303fln"),Q(a.src,i=n[15]?n[15].image.url:null)||w(a,"src",i),w(a,"alt","the base file that is annotated"),B(a,"fit-height",n[7]&&!n[17]),w(e,"class","image-container svelte-303fln")},m(o,u){p(o,e,u),N(t,e,null),T(e,l),T(e,a),T(e,s);for(let d=0;d<_.length;d+=1)_[d]&&_[d].m(e,null);n[26](e),p(o,f,u),m&&m.m(o,u),p(o,g,u),b=!0},p(o,u){var E;const d={};if(u[0]&147456|u[1]&32&&(d.$$scope={dirty:u,ctx:o}),t.$set(d),(!b||u[0]&32768&&!Q(a.src,i=o[15]?o[15].image.url:null))&&w(a,"src",i),(!b||u[0]&131200)&&B(a,"fit-height",o[7]&&!o[17]),u[0]&229904){c=R(o[15]?(E=o[15])==null?void 0:E.annotations:[]);let h;for(h=0;h<c.length;h+=1){const P=ae(o,c,h);_[h]?_[h].p(P,u):(_[h]=oe(P),_[h].c(),_[h].m(e,null))}for(;h<_.length;h+=1)_[h].d(1);_.length=c.length}o[6]&&o[15]?m?m.p(o,u):(m=re(o),m.c(),m.m(g.parentNode,g)):m&&(m.d(1),m=null)},i(o){b||(k(t.$$.fragment,o),b=!0)},o(o){I(t.$$.fragment,o),b=!1},d(o){o&&(v(e),v(f),v(g)),V(t),fe(_,o),n[26](null),m&&m.d(o)}}}function Ae(n){let e,t;return e=new Oe({props:{size:"large",unpadded_box:!0,$$slots:{default:[Ke]},$$scope:{ctx:n}}}),{c(){z(e.$$.fragment)},l(l){q(e.$$.fragment,l)},m(l,a){N(e,l,a),t=!0},p(l,a){const i={};a[1]&32&&(i.$$scope={dirty:a,ctx:l}),e.$set(i)},i(l){t||(k(e.$$.fragment,l),t=!0)},o(l){I(e.$$.fragment,l),t=!1},d(l){V(e,l)}}}function ie(n){let e,t;return e=new me({props:{Icon:Qe,label:"View in full screen"}}),e.$on("click",n[19]),{c(){z(e.$$.fragment)},l(l){q(e.$$.fragment,l)},m(l,a){N(e,l,a),t=!0},p:_e,i(l){t||(k(e.$$.fragment,l),t=!0)},o(l){I(e.$$.fragment,l),t=!1},d(l){V(e,l)}}}function se(n){let e,t;return e=new me({props:{Icon:Re,label:"Exit full screen"}}),e.$on("click",n[19]),{c(){z(e.$$.fragment)},l(l){q(e.$$.fragment,l)},m(l,a){N(e,l,a),t=!0},p:_e,i(l){t||(k(e.$$.fragment,l),t=!0)},o(l){I(e.$$.fragment,l),t=!1},d(l){V(e,l)}}}function He(n){let e,t,l,a=!n[17]&&n[14]&&ie(n),i=n[17]&&se(n);return{c(){a&&a.c(),e=D(),i&&i.c(),t=O()},l(s){a&&a.l(s),e=F(s),i&&i.l(s),t=O()},m(s,f){a&&a.m(s,f),p(s,e,f),i&&i.m(s,f),p(s,t,f),l=!0},p(s,f){!s[17]&&s[14]?a?(a.p(s,f),f[0]&147456&&k(a,1)):(a=ie(s),a.c(),k(a,1),a.m(e.parentNode,e)):a&&(Y(),I(a,1,1,()=>{a=null}),Z()),s[17]?i?(i.p(s,f),f[0]&131072&&k(i,1)):(i=se(s),i.c(),k(i,1),i.m(t.parentNode,t)):i&&(Y(),I(i,1,1,()=>{i=null}),Z())},i(s){l||(k(a),k(i),l=!0)},o(s){I(a),I(i),l=!1},d(s){s&&(v(e),v(t)),a&&a.d(s),i&&i.d(s)}}}function oe(n){let e,t,l,a;return{c(){e=j("img"),this.h()},l(i){e=G(i,"IMG",{alt:!0,class:!0,src:!0,style:!0}),this.h()},h(){var i;w(e,"alt",t="segmentation mask identifying "+n[4]+" within the uploaded file"),w(e,"class","mask fit-height svelte-303fln"),Q(e.src,l=n[32].image.url)||w(e,"src",l),w(e,"style",a=n[9]&&n[32].label in n[9]?null:`filter: hue-rotate(${Math.round(n[34]*360/((i=n[15])==null?void 0:i.annotations.length))}deg);`),B(e,"fit-height",!n[17]),B(e,"active",n[16]==n[32].label),B(e,"inactive",n[16]!=n[32].label&&n[16]!=null)},m(i,s){p(i,e,s)},p(i,s){var f;s[0]&16&&t!==(t="segmentation mask identifying "+i[4]+" within the uploaded file")&&w(e,"alt",t),s[0]&32768&&!Q(e.src,l=i[32].image.url)&&w(e,"src",l),s[0]&33280&&a!==(a=i[9]&&i[32].label in i[9]?null:`filter: hue-rotate(${Math.round(i[34]*360/((f=i[15])==null?void 0:f.annotations.length))}deg);`)&&w(e,"style",a),s[0]&131072&&B(e,"fit-height",!i[17]),s[0]&98304&&B(e,"active",i[16]==i[32].label),s[0]&98304&&B(e,"inactive",i[16]!=i[32].label&&i[16]!=null)},d(i){i&&v(e)}}}function re(n){let e,t=R(n[15].annotations),l=[];for(let a=0;a<t.length;a+=1)l[a]=ue(te(n,t,a));return{c(){e=j("div");for(let a=0;a<l.length;a+=1)l[a].c();this.h()},l(a){e=G(a,"DIV",{class:!0});var i=U(e);for(let s=0;s<l.length;s+=1)l[s].l(i);i.forEach(v),this.h()},h(){w(e,"class","legend svelte-303fln")},m(a,i){p(a,e,i);for(let s=0;s<l.length;s+=1)l[s]&&l[s].m(e,null)},p(a,i){if(i[0]&7373312){t=R(a[15].annotations);let s;for(s=0;s<t.length;s+=1){const f=te(a,t,s);l[s]?l[s].p(f,i):(l[s]=ue(f),l[s].c(),l[s].m(e,null))}for(;s<l.length;s+=1)l[s].d(1);l.length=t.length}},d(a){a&&v(e),fe(l,a)}}}function ue(n){let e,t=n[32].label+"",l,a,i,s;function f(){return n[27](n[32])}function g(){return n[28](n[32])}function b(){return n[31](n[34],n[32])}return{c(){e=j("button"),l=Ve(t),a=D(),this.h()},l(c){e=G(c,"BUTTON",{class:!0,style:!0});var _=U(e);l=De(_,t),a=F(_),_.forEach(v),this.h()},h(){w(e,"class","legend-item svelte-303fln"),le(e,"background-color",n[9]&&n[32].label in n[9]?n[9][n[32].label]+"88":`hsla(${Math.round(n[34]*360/n[15].annotations.length)}, 100%, 50%, 0.3)`)},m(c,_){p(c,e,_),T(e,l),T(e,a),i||(s=[L(e,"mouseover",f),L(e,"focus",g),L(e,"mouseout",n[29]),L(e,"blur",n[30]),L(e,"click",b)],i=!0)},p(c,_){n=c,_[0]&32768&&t!==(t=n[32].label+"")&&Fe(l,t),_[0]&33280&&le(e,"background-color",n[9]&&n[32].label in n[9]?n[9][n[32].label]+"88":`hsla(${Math.round(n[34]*360/n[15].annotations.length)}, 100%, 50%, 0.3)`)},d(c){c&&v(e),i=!1,Pe(s)}}}function Ke(n){let e,t;return e=new ce({}),{c(){z(e.$$.fragment)},l(l){q(e.$$.fragment,l)},m(l,a){N(e,l,a),t=!0},i(l){t||(k(e.$$.fragment,l),t=!0)},o(l){I(e.$$.fragment,l),t=!1},d(l){V(e,l)}}}function Xe(n){let e,t,l,a,i,s,f,g;const b=[{autoscroll:n[3].autoscroll},{i18n:n[3].i18n},n[13]];let c={};for(let o=0;o<b.length;o+=1)c=qe(c,b[o]);e=new Le({props:c}),l=new Je({props:{show_label:n[5],Icon:ce,label:n[4]||n[3].i18n("image.image")}});const _=[Ae,We],m=[];function M(o,u){return o[15]==null?0:1}return s=M(n),f=m[s]=_[s](n),{c(){z(e.$$.fragment),t=D(),z(l.$$.fragment),a=D(),i=j("div"),f.c(),this.h()},l(o){q(e.$$.fragment,o),t=F(o),q(l.$$.fragment,o),a=F(o),i=G(o,"DIV",{class:!0});var u=U(i);f.l(u),u.forEach(v),this.h()},h(){w(i,"class","container svelte-303fln")},m(o,u){N(e,o,u),p(o,t,u),N(l,o,u),p(o,a,u),p(o,i,u),m[s].m(i,null),g=!0},p(o,u){const d=u[0]&8200?Te(b,[u[0]&8&&{autoscroll:o[3].autoscroll},u[0]&8&&{i18n:o[3].i18n},u[0]&8192&&Ce(o[13])]):{};e.$set(d);const E={};u[0]&32&&(E.show_label=o[5]),u[0]&24&&(E.label=o[4]||o[3].i18n("image.image")),l.$set(E);let h=s;s=M(o),s===h?m[s].p(o,u):(Y(),I(m[h],1,1,()=>{m[h]=null}),Z(),f=m[s],f?f.p(o,u):(f=m[s]=_[s](o),f.c()),k(f,1),f.m(i,null))},i(o){g||(k(e.$$.fragment,o),k(l.$$.fragment,o),k(f),g=!0)},o(o){I(e.$$.fragment,o),I(l.$$.fragment,o),I(f),g=!1},d(o){o&&(v(t),v(a),v(i)),V(e,o),V(l,o),m[s].d()}}}function Ye(n){let e,t;return e=new Ge({props:{visible:n[2],elem_id:n[0],elem_classes:n[1],padding:!1,height:n[7],width:n[8],allow_overflow:!1,container:n[10],scale:n[11],min_width:n[12],$$slots:{default:[Xe]},$$scope:{ctx:n}}}),{c(){z(e.$$.fragment)},l(l){q(e.$$.fragment,l)},m(l,a){N(e,l,a),t=!0},p(l,a){const i={};a[0]&4&&(i.visible=l[2]),a[0]&1&&(i.elem_id=l[0]),a[0]&2&&(i.elem_classes=l[1]),a[0]&128&&(i.height=l[7]),a[0]&256&&(i.width=l[8]),a[0]&1024&&(i.container=l[10]),a[0]&2048&&(i.scale=l[11]),a[0]&4096&&(i.min_width=l[12]),a[0]&516856|a[1]&32&&(i.$$scope={dirty:a,ctx:l}),e.$set(i)},i(l){t||(k(e.$$.fragment,l),t=!0)},o(l){I(e.$$.fragment,l),t=!1},d(l){V(e,l)}}}function Ze(n,e,t){let{elem_id:l=""}=e,{elem_classes:a=[]}=e,{visible:i=!0}=e,{value:s=null}=e,f=null,g=null,{gradio:b}=e,{label:c=b.i18n("annotated_image.annotated_image")}=e,{show_label:_=!0}=e,{show_legend:m=!0}=e,{height:M}=e,{width:o}=e,{color_map:u}=e,{container:d=!0}=e,{scale:E=null}=e,{min_width:h=void 0}=e,P=null,{loading_status:y}=e,{show_fullscreen_button:$=!0}=e,W=!1,C;ze(()=>{document.addEventListener("fullscreenchange",()=>{t(17,W=!!document.fullscreenElement)})});const he=async()=>{W?await document.exitFullscreen():await C.requestFullscreen()};let A=null;function H(r){t(16,P=r)}function K(){t(16,P=null)}function x(r,J){b.dispatch("select",{value:c,index:r})}function ge(r){Ne[r?"unshift":"push"](()=>{C=r,t(18,C)})}const be=r=>H(r.label),de=r=>H(r.label),ke=()=>K(),we=()=>K(),ve=(r,J)=>x(r,J.label);return n.$$set=r=>{"elem_id"in r&&t(0,l=r.elem_id),"elem_classes"in r&&t(1,a=r.elem_classes),"visible"in r&&t(2,i=r.visible),"value"in r&&t(23,s=r.value),"gradio"in r&&t(3,b=r.gradio),"label"in r&&t(4,c=r.label),"show_label"in r&&t(5,_=r.show_label),"show_legend"in r&&t(6,m=r.show_legend),"height"in r&&t(7,M=r.height),"width"in r&&t(8,o=r.width),"color_map"in r&&t(9,u=r.color_map),"container"in r&&t(10,d=r.container),"scale"in r&&t(11,E=r.scale),"min_width"in r&&t(12,h=r.min_width),"loading_status"in r&&t(13,y=r.loading_status),"show_fullscreen_button"in r&&t(14,$=r.show_fullscreen_button)},n.$$.update=()=>{if(n.$$.dirty[0]&58720264)if(s!==f&&(t(24,f=s),b.dispatch("change")),s){const r={image:s.image,annotations:s.annotations.map(S=>({image:S.image,label:S.label}))};t(15,g=r);const J=ne(r.image.url),Ie=Promise.all(r.annotations.map(S=>ne(S.image.url))),X=Promise.all([J,Ie]);t(25,A=X),X.then(([S,pe])=>{if(A!==X)return;const Ee={image:{...r.image,url:S??void 0},annotations:r.annotations.map((ee,Me)=>({...ee,image:{...ee.image,url:pe[Me]??void 0}}))};t(15,g=Ee)})}else t(15,g=null)},[l,a,i,b,c,_,m,M,o,u,d,E,h,y,$,g,P,W,C,he,H,K,x,s,f,A,ge,be,de,ke,we,ve]}class ol extends Se{constructor(e){super(),je(this,e,Ze,Ye,Be,{elem_id:0,elem_classes:1,visible:2,value:23,gradio:3,label:4,show_label:5,show_legend:6,height:7,width:8,color_map:9,container:10,scale:11,min_width:12,loading_status:13,show_fullscreen_button:14},null,[-1,-1])}}export{ol as default};
