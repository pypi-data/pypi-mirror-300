import{s as Oe,A as Ie,e as i,k as T,t as O,c as r,a as m,B as je,o as A,b as j,d,f as l,i as Ee,g as e,C as Y,u as le,D as ze,h as z,E as We,F as Re,G as Ge,p as Je,j as Ke,H as we}from"./scheduler.Dyt_jldW.js";import{S as Qe,i as Xe,f as Ye,b as Ae,d as Ne,m as Be,t as Ue,a as He,e as qe}from"./index.g9C97g6-.js";import{g as Ze}from"./entry.BvGjoYWM.js";import{C as $e}from"./CodeEditor.DiYQpcvc.js";import{C as et}from"./ConfirmDialog.BEvjqHNe.js";function tt(t){let u,s,p,V=t[9].t("Please carefully review the following warnings:")+"",v,y,k,D,b=t[9].t("Functions allow arbitrary code execution.")+"",w,I,F,c=t[9].t("Do not install functions from sources you do not fully trust.")+"",_,C,f,N=t[9].t("I acknowledge that I have read and I understand the implications of my action. I am aware of the risks associated with executing arbitrary code and I have verified the trustworthiness of the source.")+"",H;return{c(){u=i("div"),s=i("div"),p=i("div"),v=O(V),y=T(),k=i("ul"),D=i("li"),w=O(b),I=T(),F=i("li"),_=O(c),C=T(),f=i("div"),H=O(N),this.h()},l(o){u=r(o,"DIV",{class:!0});var g=m(u);s=r(g,"DIV",{class:!0});var q=m(s);p=r(q,"DIV",{});var E=m(p);v=j(E,V),E.forEach(d),y=A(q),k=r(q,"UL",{class:!0});var B=m(k);D=r(B,"LI",{});var W=m(D);w=j(W,b),W.forEach(d),I=A(B),F=r(B,"LI",{});var U=m(F);_=j(U,c),U.forEach(d),B.forEach(d),q.forEach(d),C=A(g),f=r(g,"DIV",{class:!0});var x=m(f);H=j(x,N),x.forEach(d),g.forEach(d),this.h()},h(){l(k,"class","mt-1 list-disc pl-4 text-xs"),l(s,"class","bg-yellow-500/20 text-yellow-700 dark:text-yellow-200 rounded-lg px-4 py-3"),l(f,"class","my-3"),l(u,"class","text-sm text-gray-500")},m(o,g){Ee(o,u,g),e(u,s),e(s,p),e(p,v),e(s,y),e(s,k),e(k,D),e(D,w),e(k,I),e(k,F),e(F,_),e(u,C),e(u,f),e(f,H)},p(o,g){g&512&&V!==(V=o[9].t("Please carefully review the following warnings:")+"")&&z(v,V),g&512&&b!==(b=o[9].t("Functions allow arbitrary code execution.")+"")&&z(w,b),g&512&&c!==(c=o[9].t("Do not install functions from sources you do not fully trust.")+"")&&z(_,c),g&512&&N!==(N=o[9].t("I acknowledge that I have read and I understand the implications of my action. I am aware of the risks associated with executing arbitrary code and I have verified the trustworthiness of the source.")+"")&&z(H,N)},d(o){o&&d(u)}}}function st(t){let u,s,p,V,v,y,k='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="w-4 h-4"><path fill-rule="evenodd" d="M17 10a.75.75 0 01-.75.75H5.612l4.158 3.96a.75.75 0 11-1.04 1.08l-5.5-5.25a.75.75 0 010-1.08l5.5-5.25a.75.75 0 111.04 1.08L5.612 9.25H16.25A.75.75 0 0117 10z" clip-rule="evenodd"></path></svg>',D,b,w=t[9].t("Back")+"",I,F,c,_,C,f,N,H,o,g,q,E,B,W,U,x,Z,L,R,M,n,$=t[9].t("Warning:")+"",ne,me,ee=t[9].t("Functions allow arbitrary code execution")+"",oe,pe,_e,ve,Q,te=t[9].t("don't install random functions from sources you don't trust.")+"",ie,ge,K,se=t[9].t("Save")+"",re,ue,S,ye,P,be,ke,Le={value:t[1],lang:"python",boilerplate:t[11]};x=new $e({props:Le}),t[18](x),x.$on("change",t[19]),x.$on("save",t[20]);function Se(a){t[23](a)}let xe={$$slots:{default:[tt]},$$scope:{ctx:t}};return t[6]!==void 0&&(xe.show=t[6]),S=new et({props:xe}),Ie.push(()=>Ye(S,"show",Se)),S.$on("confirm",t[24]),{c(){u=i("div"),s=i("div"),p=i("form"),V=i("div"),v=i("button"),y=i("div"),y.innerHTML=k,D=T(),b=i("div"),I=O(w),F=T(),c=i("div"),_=i("div"),C=i("div"),f=i("input"),H=T(),o=i("input"),q=T(),E=i("input"),W=T(),U=i("div"),Ae(x.$$.fragment),Z=T(),L=i("div"),R=i("div"),M=i("div"),n=i("span"),ne=O($),me=T(),oe=O(ee),pe=T(),_e=i("br"),ve=O(`—
							`),Q=i("span"),ie=O(te),ge=T(),K=i("button"),re=O(se),ue=T(),Ae(S.$$.fragment),this.h()},l(a){u=r(a,"DIV",{class:!0});var h=m(u);s=r(h,"DIV",{class:!0});var ae=m(s);p=r(ae,"FORM",{class:!0});var G=m(p);V=r(G,"DIV",{class:!0});var De=m(V);v=r(De,"BUTTON",{class:!0,type:!0});var de=m(v);y=r(de,"DIV",{class:!0,"data-svelte-h":!0}),je(y)!=="svelte-1t52rj4"&&(y.innerHTML=k),D=A(de),b=r(de,"DIV",{class:!0});var Fe=m(b);I=j(Fe,w),Fe.forEach(d),de.forEach(d),De.forEach(d),F=A(G),c=r(G,"DIV",{class:!0});var X=m(c);_=r(X,"DIV",{class:!0});var fe=m(_);C=r(fe,"DIV",{class:!0});var ce=m(C);f=r(ce,"INPUT",{class:!0,type:!0,placeholder:!0}),H=A(ce),o=r(ce,"INPUT",{class:!0,type:!0,placeholder:!0}),ce.forEach(d),q=A(fe),E=r(fe,"INPUT",{class:!0,type:!0,placeholder:!0}),fe.forEach(d),W=A(X),U=r(X,"DIV",{class:!0});var Ve=m(U);Ne(x.$$.fragment,Ve),Ve.forEach(d),Z=A(X),L=r(X,"DIV",{class:!0});var he=m(L);R=r(he,"DIV",{class:!0});var Ce=m(R);M=r(Ce,"DIV",{class:!0});var J=m(M);n=r(J,"SPAN",{class:!0});var Me=m(n);ne=j(Me,$),Me.forEach(d),me=A(J),oe=j(J,ee),pe=A(J),_e=r(J,"BR",{}),ve=j(J,`—
							`),Q=r(J,"SPAN",{class:!0});var Pe=m(Q);ie=j(Pe,te),Pe.forEach(d),J.forEach(d),Ce.forEach(d),ge=A(he),K=r(he,"BUTTON",{class:!0,type:!0});var Te=m(K);re=j(Te,se),Te.forEach(d),he.forEach(d),X.forEach(d),G.forEach(d),ae.forEach(d),h.forEach(d),ue=A(a),Ne(S.$$.fragment,a),this.h()},h(){l(y,"class","self-center"),l(b,"class","self-center font-medium text-sm"),l(v,"class","flex space-x-1"),l(v,"type","button"),l(V,"class","mb-2.5"),l(f,"class","w-full px-3 py-2 text-sm font-medium bg-gray-50 dark:bg-gray-850 dark:text-gray-200 rounded-lg outline-none"),l(f,"type","text"),l(f,"placeholder",N=t[9].t("Function Name (e.g. My Filter)")),f.required=!0,l(o,"class","w-full px-3 py-2 text-sm font-medium disabled:text-gray-300 dark:disabled:text-gray-700 bg-gray-50 dark:bg-gray-850 dark:text-gray-200 rounded-lg outline-none"),l(o,"type","text"),l(o,"placeholder",g=t[9].t("Function ID (e.g. my_filter)")),o.required=!0,o.disabled=t[4],l(C,"class","flex gap-2 w-full"),l(E,"class","w-full px-3 py-2 text-sm font-medium bg-gray-50 dark:bg-gray-850 dark:text-gray-200 rounded-lg outline-none"),l(E,"type","text"),l(E,"placeholder",B=t[9].t("Function Description (e.g. A filter to remove profanity from text)")),E.required=!0,l(_,"class","w-full mb-2 flex flex-col gap-1.5"),l(U,"class","mb-2 flex-1 overflow-auto h-0 rounded-lg"),l(n,"class","font-semibold dark:text-gray-200"),l(Q,"class","font-medium dark:text-gray-400"),l(M,"class","text-xs text-gray-500 line-clamp-2"),l(R,"class","flex-1 pr-3"),l(K,"class","px-3 py-1.5 text-sm font-medium bg-emerald-600 hover:bg-emerald-700 text-gray-50 transition rounded-lg"),l(K,"type","submit"),l(L,"class","pb-3 flex justify-between"),l(c,"class","flex flex-col flex-1 overflow-auto h-0 rounded-lg"),l(p,"class","flex flex-col max-h-[100dvh] h-full"),l(s,"class","mx-auto w-full md:px-0 h-full"),l(u,"class","flex flex-col justify-between w-full overflow-y-auto h-full")},m(a,h){Ee(a,u,h),e(u,s),e(s,p),e(p,V),e(V,v),e(v,y),e(v,D),e(v,b),e(b,I),e(p,F),e(p,c),e(c,_),e(_,C),e(C,f),Y(f,t[0]),e(C,H),e(C,o),Y(o,t[2]),e(_,q),e(_,E),Y(E,t[3].description),e(c,W),e(c,U),Be(x,U,null),e(c,Z),e(c,L),e(L,R),e(R,M),e(M,n),e(n,ne),e(M,me),e(M,oe),e(M,pe),e(M,_e),e(M,ve),e(M,Q),e(Q,ie),e(L,ge),e(L,K),e(K,re),t[21](p),Ee(a,ue,h),Be(S,a,h),P=!0,be||(ke=[le(v,"click",t[14]),le(f,"input",t[15]),le(o,"input",t[16]),le(E,"input",t[17]),le(p,"submit",ze(t[22]))],be=!0)},p(a,[h]){(!P||h&512)&&w!==(w=a[9].t("Back")+"")&&z(I,w),(!P||h&512&&N!==(N=a[9].t("Function Name (e.g. My Filter)")))&&l(f,"placeholder",N),h&1&&f.value!==a[0]&&Y(f,a[0]),(!P||h&512&&g!==(g=a[9].t("Function ID (e.g. my_filter)")))&&l(o,"placeholder",g),(!P||h&16)&&(o.disabled=a[4]),h&4&&o.value!==a[2]&&Y(o,a[2]),(!P||h&512&&B!==(B=a[9].t("Function Description (e.g. A filter to remove profanity from text)")))&&l(E,"placeholder",B),h&8&&E.value!==a[3].description&&Y(E,a[3].description);const ae={};h&2&&(ae.value=a[1]),x.$set(ae),(!P||h&512)&&$!==($=a[9].t("Warning:")+"")&&z(ne,$),(!P||h&512)&&ee!==(ee=a[9].t("Functions allow arbitrary code execution")+"")&&z(oe,ee),(!P||h&512)&&te!==(te=a[9].t("don't install random functions from sources you don't trust.")+"")&&z(ie,te),(!P||h&512)&&se!==(se=a[9].t("Save")+"")&&z(re,se);const G={};h&1073742336&&(G.$$scope={dirty:h,ctx:a}),!ye&&h&64&&(ye=!0,G.show=a[6],We(()=>ye=!1)),S.$set(G)},i(a){P||(Ue(x.$$.fragment,a),Ue(S.$$.fragment,a),P=!0)},o(a){He(x.$$.fragment,a),He(S.$$.fragment,a),P=!1},d(a){a&&(d(u),d(ue)),t[18](null),qe(x),t[21](null),qe(S,a),be=!1,Re(ke)}}}function at(t,u,s){let p;const V=Ge(),v=Je("i18n");Ke(t,v,n=>s(9,p=n));let y=null,k=!1,{edit:D=!1}=u,{clone:b=!1}=u,{id:w=""}=u,{name:I=""}=u,{meta:F={description:""}}=u,{content:c=""}=u,_="";const C=()=>{s(7,_=c)};let f,N=`"""
title: Example Filter
author: open-webui
author_url: https://github.com/open-webui
funding_url: https://github.com/open-webui
version: 0.1
"""

from pydantic import BaseModel, Field
from typing import Optional


class Filter:
    class Valves(BaseModel):
        priority: int = Field(
            default=0, description="Priority level for the filter operations."
        )
        max_turns: int = Field(
            default=8, description="Maximum allowable conversation turns for a user."
        )
        pass

    class UserValves(BaseModel):
        max_turns: int = Field(
            default=4, description="Maximum allowable conversation turns for a user."
        )
        pass

    def __init__(self):
        # Indicates custom file handling logic. This flag helps disengage default routines in favor of custom
        # implementations, informing the WebUI to defer file-related operations to designated methods within this class.
        # Alternatively, you can remove the files directly from the body in from the inlet hook
        # self.file_handler = True

        # Initialize 'valves' with specific configurations. Using 'Valves' instance helps encapsulate settings,
        # which ensures settings are managed cohesively and not confused with operational flags like 'file_handler'.
        self.valves = self.Valves()
        pass

    def inlet(self, body: dict, __user__: Optional[dict] = None) -> dict:
        # Modify the request body or validate it before processing by the chat completion API.
        # This function is the pre-processor for the API where various checks on the input can be performed.
        # It can also modify the request before sending it to the API.
        print(f"inlet:{__name__}")
        print(f"inlet:body:{body}")
        print(f"inlet:user:{__user__}")

        if __user__.get("role", "admin") in ["user", "admin"]:
            messages = body.get("messages", [])

            max_turns = min(__user__["valves"].max_turns, self.valves.max_turns)
            if len(messages) > max_turns:
                raise Exception(
                    f"Conversation turn limit exceeded. Max turns: {max_turns}"
                )

        return body

    def outlet(self, body: dict, __user__: Optional[dict] = None) -> dict:
        # Modify or analyze the response body after processing by the API.
        # This function is the post-processor for the API, which can be used to modify the response
        # or perform additional checks and analytics.
        print(f"outlet:{__name__}")
        print(f"outlet:body:{body}")
        print(f"outlet:user:{__user__}")

        return body
`;const H=async()=>{V("save",{id:w,name:I,meta:F,content:c})},o=async()=>{if(f){s(1,c=_),await we();const n=await f.formatPythonCodeHandler();await we(),s(1,c=_),await we(),n&&(console.log("Code formatted successfully"),H())}},g=()=>{Ze("/workspace/functions")};function q(){I=this.value,s(0,I)}function E(){w=this.value,s(2,w),s(0,I),s(4,D),s(13,b)}function B(){F.description=this.value,s(3,F)}function W(n){Ie[n?"unshift":"push"](()=>{f=n,s(8,f)})}const U=n=>{s(7,_=n.detail.value)},x=async()=>{y&&y.requestSubmit()};function Z(n){Ie[n?"unshift":"push"](()=>{y=n,s(5,y)})}const L=()=>{D?o():s(6,k=!0)};function R(n){k=n,s(6,k)}const M=()=>{o()};return t.$$set=n=>{"edit"in n&&s(4,D=n.edit),"clone"in n&&s(13,b=n.clone),"id"in n&&s(2,w=n.id),"name"in n&&s(0,I=n.name),"meta"in n&&s(3,F=n.meta),"content"in n&&s(1,c=n.content)},t.$$.update=()=>{t.$$.dirty&2&&c&&C(),t.$$.dirty&8209&&I&&!D&&!b&&s(2,w=I.replace(/\s+/g,"_").toLowerCase())},[I,c,w,F,D,y,k,_,f,p,v,N,o,b,g,q,E,B,W,U,x,Z,L,R,M]}class ut extends Qe{constructor(u){super(),Xe(this,u,at,st,Oe,{edit:4,clone:13,id:2,name:0,meta:3,content:1})}}export{ut as F};
//# sourceMappingURL=FunctionEditor.BWJXJXYm.js.map
